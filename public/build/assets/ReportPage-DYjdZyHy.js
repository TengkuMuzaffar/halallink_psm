import{z as M,T as se,_ as x,r as c,p as z,c as g,a as t,w as P,t as u,v as $,b as O,F as j,i as W,e as A,o as f,C as V,m as Y,O as L,A as J,B as q,g as E,f as B,E as D,d as re,U as le,y as ie,h as de}from"./main-6TRAM3lj.js";import{R as K}from"./ResponsiveTable-Dmb47gmH.js";import{m as y}from"./modal-CNQBRbiU.js";import{L as ce}from"./LoadingSpinner-Bs7tkB0U.js";const F=()=>{const n=se.state.user;return n&&n.company?`/api/reports/${n.company.company_type}`:"/api/reports/admin"},me=async(n={})=>{try{const e=F();return await M.get(e,{params:n})}catch(e){throw console.error("Error fetching report validities:",e),e}},pe=async n=>{try{const e=F();return await M.get(`${e}/${n}`)}catch(e){throw console.error(`Error fetching report validity ${n}:`,e),e}},ue=async n=>{try{const e=F();return await M.post(e,n)}catch(e){throw console.error("Error creating report validity:",e),e}},ve=async(n,e)=>{try{const o=F();return await M.put(`${o}/${n}`,e)}catch(o){throw console.error(`Error updating report validity ${n}:`,o),o}},fe=async n=>{try{const e=F();return await M.delete(`${e}/${n}`)}catch(e){throw console.error(`Error deleting report validity ${n}:`,e),e}},be=async(n="")=>{try{return await M.get("/api/companies",{params:{company_type:"sme",search:n}})}catch(e){throw console.error("Error fetching SME companies:",e),e}},ye=n=>{const e=document.createElement("a");e.href=`/report-pdf/${n}`,e.target="_blank",document.body.appendChild(e),e.click(),document.body.removeChild(e)},he=async n=>{try{const e=`${window.location.origin}/report-pdf/${n}`,o=document.createElement("canvas");return o.width=300,o.height=300,document.body.appendChild(o),new Promise((a,i)=>{QRCode.toCanvas(o,e,{width:300,margin:4,color:{dark:"#000000",light:"#FFFFFF"},errorCorrectionLevel:"M"},function(v){if(v){console.error("Error generating QR code:",v),document.body.removeChild(o),i(v);return}o.toBlob(function(l){const r=window.URL.createObjectURL(l),d=document.createElement("a");d.href=r,d.download=`sme-report-qr-${n}.png`,document.body.appendChild(d),d.click(),window.URL.revokeObjectURL(r),document.body.removeChild(d),document.body.removeChild(o),a(!0)},"image/png")})})}catch(e){throw console.error(`Error generating QR code for report ${n}:`,e),e}},k={getReportValidities:me,getReportValidity:pe,createReportValidity:ue,updateReportValidity:ve,deleteReportValidity:fe,getSmeCompanies:be,downloadReportPdf:ye,downloadReportQrCode:he},ge={name:"CompanySearchAndSelection",props:{searchLabel:{type:String,default:"Search SME Companies"},searchPlaceholder:{type:String,default:"Search by name..."},selectedLabel:{type:String,default:"Selected Companies"},resultsLabel:{type:String,default:"Search Results"},initialSelectedCompanies:{type:Array,default:()=>[]}},emits:["update:selectedCompanies"],setup(n,{emit:e}){const o=c(""),a=c([]),i=c([...n.initialSelectedCompanies]),v=c(!1);z(i,m=>{e("update:selectedCompanies",m)},{deep:!0});const l=m=>i.value.some(w=>w.companyID===m.companyID),r=m=>{l(m)||i.value.push(m)},d=m=>{i.value=i.value.filter(w=>w.companyID!==m.companyID)};let b;return z(o,m=>{if(clearTimeout(b),m.length<2){a.value=[];return}v.value=!0,b=setTimeout(async()=>{try{const w=await k.getSmeCompanies(m);a.value=w.data}catch(w){console.error("Error searching companies:",w),a.value=[]}finally{v.value=!1}},500)}),{searchQuery:o,searchResults:a,selectedCompanies:i,loading:v,isCompanySelected:l,addCompany:r,removeCompany:d,reset:()=>{o.value="",a.value=[],i.value=[]}}}},_e={class:"company-search-selection"},Ce={class:"mb-3"},Re={for:"companySearch",class:"form-label"},we=["placeholder"],Se={class:"mt-3 mb-3"},De={class:"d-flex justify-content-between align-items-center mb-2"},ke={class:"mb-0"},Ie={class:"badge bg-primary"},Te={class:"list-group selected-companies-list"},Ee={key:0,class:"text-muted small"},Ae=["onClick"],Ve={class:"mt-3"},Me={class:"list-group search-results"},xe={key:0,class:"text-center"},Le={key:1,class:"text-muted small"},Pe={key:2,class:"text-muted small"},Fe=["onClick","disabled"];function Qe(n,e,o,a,i,v){return f(),g("div",_e,[t("div",Ce,[t("label",Re,u(o.searchLabel),1),P(t("input",{type:"text",class:"form-control",id:"companySearch","onUpdate:modelValue":e[0]||(e[0]=l=>a.searchQuery=l),placeholder:o.searchPlaceholder},null,8,we),[[$,a.searchQuery]])]),t("div",Se,[t("div",De,[t("h6",ke,u(o.selectedLabel),1),t("span",Ie,u(a.selectedCompanies.length),1)]),t("div",Te,[a.selectedCompanies.length===0?(f(),g("div",Ee," No companies selected ")):O("",!0),(f(!0),g(j,null,W(a.selectedCompanies,l=>(f(),g("div",{key:l.companyID,class:"list-group-item d-flex justify-content-between align-items-center"},[t("span",null,u(l.company_name),1),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:r=>a.removeCompany(l)},e[1]||(e[1]=[t("i",{class:"fas fa-times"},null,-1)]),8,Ae)]))),128))])]),t("div",Ve,[t("h6",null,u(o.resultsLabel),1),t("div",Me,[a.loading?(f(),g("div",xe,e[2]||(e[2]=[t("div",{class:"spinner-border spinner-border-sm",role:"status"},null,-1),A(" Searching... ")]))):a.searchResults.length===0&&a.searchQuery.length<2?(f(),g("div",Le," Enter at least 2 characters to search ")):a.searchResults.length===0?(f(),g("div",Pe," No companies found ")):O("",!0),(f(!0),g(j,null,W(a.searchResults,l=>(f(),g("div",{key:l.companyID,class:"list-group-item d-flex justify-content-between align-items-center"},[t("span",null,u(l.company_name),1),t("button",{type:"button",class:V(["btn btn-sm",a.isCompanySelected(l)?"btn-success disabled":"btn-outline-primary"]),onClick:r=>a.addCompany(l),disabled:a.isCompanySelected(l)},u(a.isCompanySelected(l)?"Added":"Add"),11,Fe)]))),128))])])])}const Ne=x(ge,[["render",Qe],["__scopeId","data-v-e0c8f840"]]),Ue={name:"ConfirmationModal",props:{modalId:{type:String,default:"confirmationModal"},title:{type:String,default:"Confirmation"},message:{type:String,default:"Are you sure you want to continue?"},confirmLabel:{type:String,default:"Yes, Continue"},cancelLabel:{type:String,default:"No, Cancel"}},emits:["confirm","cancel"],setup(n,{emit:e}){const o=c(null);Y(()=>{const r=document.getElementById(n.modalId);r&&(o.value=new L(r))});const a=()=>{o.value&&o.value.show()},i=()=>{o.value&&o.value.hide()};return{modalRef:o,show:a,hide:i,onConfirm:()=>{e("confirm"),i()},onCancel:()=>{e("cancel")}}}},Be=["id","aria-labelledby"],$e={class:"modal-dialog modal-dialog-centered"},je={class:"modal-content"},qe={class:"modal-header theme-header"},ze=["id"],Oe={class:"modal-body"},We={class:"modal-footer"};function Ye(n,e,o,a,i,v){return f(),g("div",{class:"modal fade",id:o.modalId,tabindex:"-1","aria-labelledby":o.modalId+"-label","aria-hidden":"true"},[t("div",$e,[t("div",je,[t("div",qe,[t("h5",{class:"modal-title",id:o.modalId+"-label"},u(o.title),9,ze),e[2]||(e[2]=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),t("div",Oe,[t("p",null,u(o.message),1)]),t("div",We,[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",onClick:e[0]||(e[0]=(...l)=>a.onCancel&&a.onCancel(...l))},u(o.cancelLabel),1),t("button",{type:"button",class:"btn btn-primary",onClick:e[1]||(e[1]=(...l)=>a.onConfirm&&a.onConfirm(...l))},u(o.confirmLabel),1)])])])],8,Be)}const Ge=x(Ue,[["render",Ye],["__scopeId","data-v-40bcb875"]]),X=(n,e=!1)=>{if(!n)return"";const o=new Date(n);if(isNaN(o.getTime()))return"Invalid date";const a={year:"numeric",month:"short",day:"numeric"};return e&&(a.hour="2-digit",a.minute="2-digit"),o.toLocaleDateString("en-US",a)},He={name:"ReportDetailsView",components:{LoadingSpinner:ce},props:{reportId:{type:[Number,String],required:!0}},emits:["loading"],setup(n,{emit:e}){const o=c({}),a=c(!0),i=c(""),v=async()=>{a.value=!0,e("loading",!0);try{const d=await k.getReportValidity(n.reportId);o.value=d.report_validity}catch(d){console.error("Error fetching report details:",d)}finally{a.value=!1,e("loading",!1)}},l=(d,b=!1)=>{if(!d)return"N/A";const s=new Date(d),m={year:"numeric",month:"short",day:"numeric"};return b&&(m.hour="2-digit",m.minute="2-digit"),s.toLocaleDateString("en-US",m)},r=J(()=>{if(!o.value||!o.value.reports)return[];if(!i.value.trim())return o.value.reports;const d=i.value.toLowerCase();return o.value.reports.filter(b=>b.company&&b.company.company_name&&b.company.company_name.toLowerCase().includes(d))});return v(),z(()=>n.reportId,()=>{v()}),{report:o,loading:a,companySearchQuery:i,filteredCompanies:r,formatDate:l}}},Je={class:"report-details-container"},Ke={key:1,class:"report-details-content"},Xe={class:"report-info-section"},Ze={class:"info-grid"},et={class:"info-item"},tt={class:"info-value"},at={class:"info-item"},ot={class:"info-value"},nt={class:"info-item"},st={class:"info-value"},rt={class:"info-item"},lt={class:"info-value"},it={class:"info-item"},dt={class:"companies-section"},ct={class:"search-container mb-3"},mt={class:"companies-list"},pt={key:0,class:"no-companies"},ut={class:"company-name"};function vt(n,e,o,a,i,v){const l=E("LoadingSpinner");return f(),g("div",Je,[a.loading?(f(),q(l,{key:0,overlay:"",size:"lg"})):(f(),g("div",Ke,[t("div",Xe,[e[6]||(e[6]=t("h5",{class:"section-title"},"Report Information",-1)),t("div",Ze,[t("div",et,[e[1]||(e[1]=t("span",{class:"info-label"},"Issued By:",-1)),t("span",tt,u(a.report.user?a.report.user.email:"N/A"),1)]),t("div",at,[e[2]||(e[2]=t("span",{class:"info-label"},"Phone:",-1)),t("span",ot,u(a.report.user?a.report.user.tel_number:"N/A"),1)]),t("div",nt,[e[3]||(e[3]=t("span",{class:"info-label"},"Start Date:",-1)),t("span",st,u(a.formatDate(a.report.start_timestamp)),1)]),t("div",rt,[e[4]||(e[4]=t("span",{class:"info-label"},"End Date:",-1)),t("span",lt,u(a.formatDate(a.report.end_timestamp)),1)]),t("div",it,[e[5]||(e[5]=t("span",{class:"info-label"},"Status:",-1)),t("span",{class:V(["info-value status-badge",a.report.approval?"status-approved":"status-pending"])},u(a.report.approval?"Approved":"Pending"),3)])])]),t("div",dt,[e[7]||(e[7]=t("h5",{class:"section-title"},"Related Companies",-1)),t("div",ct,[P(t("input",{type:"text",class:"form-control",placeholder:"Search companies...","onUpdate:modelValue":e[0]||(e[0]=r=>a.companySearchQuery=r)},null,512),[[$,a.companySearchQuery]])]),t("div",mt,[a.filteredCompanies.length===0?(f(),g("div",pt," No companies found ")):(f(!0),g(j,{key:1},W(a.filteredCompanies,r=>(f(),g("div",{class:"company-item",key:r.reportID},[t("div",ut,u(r.company?r.company.company_name:"Unknown Company"),1)]))),128))])])]))])}const ft=x(He,[["render",vt],["__scopeId","data-v-f98ed41f"]]),bt={name:"AdminReportTable",components:{CompanySearchAndSelection:Ne,ReportDetailsView:ft,ResponsiveTable:K,ConfirmationModal:Ge},setup(){const n=c([]),e=c(!0),o=c(null),a=c(null),i=c(1),v=c(10),l=c(0),r=c(""),d=c(null),b=c(null),s=c({startTimestamp:"",endTimestamp:"",approval:!1}),m=c([]),w=[{key:"start_timestamp",label:"Start Date",sortable:!0},{key:"end_timestamp",label:"End Date",sortable:!0},{key:"approval",label:"Status",sortable:!0},{key:"companies",label:"Companies",sortable:!1}],I=async()=>{e.value=!0;try{const p={page:i.value,per_page:v.value,search:r.value},h=await k.getReportValidities(p);n.value=h.data,l.value=h.pagination.total}catch(p){o.value=p.message||"Failed to fetch report validities",y.danger("Error",o.value)}finally{e.value=!1}},_=p=>{i.value=p,I()},T=p=>{r.value=p,i.value=1,I()},Q=async p=>{try{const h=document.getElementById("viewReportModal"),R=document.getElementById("viewReportModalBody");a.value=null,await ie(),a.value=p.reportValidityID,b.value||(b.value=new L(h)),b.value.show()}catch{y.danger("Error","Failed to load report details")}},N=async p=>{try{e.value=!0;const h=!p.approval;await k.updateReportValidity(p.reportValidityID,{approval:h});const R=n.value.findIndex(C=>C.reportValidityID===p.reportValidityID);R!==-1&&(n.value[R].approval=h),y.success("Success",`Report ${h?"approved":"marked as pending"} successfully`)}catch{y.danger("Error","Failed to update approval status")}finally{e.value=!1}},S=p=>{y.confirm("Delete Report","Are you sure you want to delete this report? This action cannot be undone.",async()=>{try{e.value=!0,await k.deleteReportValidity(p.reportValidityID),n.value=n.value.filter(h=>h.reportValidityID!==p.reportValidityID),y.success("Success","Report deleted successfully")}catch{y.danger("Error","Failed to delete report")}finally{e.value=!1}})},Z=()=>{if(!s.value.startTimestamp||!s.value.endTimestamp){y.warning("Warning","Please fill in all required fields");return}if(m.value.length===0){y.warning("Warning","Please select at least one company");return}const p={startTimestamp:s.value.startTimestamp,endTimestamp:s.value.endTimestamp,approval:s.value.approval},h=m.value.map(R=>R.companyID);d.value&&d.value.hide(),setTimeout(()=>{const R=document.getElementById("confirmCreateReportModal");R&&(window.reportFormData={formData:p,selectedCompanyIds:h},(L.getInstance(R)||new L(R)).show())},300)},ee=async()=>{var p,h,R;try{e.value=!0;const C=window.reportFormData||{};await k.createReportValidity({start_timestamp:((p=C.formData)==null?void 0:p.startTimestamp)||s.value.startTimestamp,end_timestamp:((h=C.formData)==null?void 0:h.endTimestamp)||s.value.endTimestamp,approval:((R=C.formData)==null?void 0:R.approval)||s.value.approval,company_ids:C.selectedCompanyIds||m.value.map(U=>U.companyID)}),delete window.reportFormData,d.value.hide(),I(),y.success("Success","Report created successfully"),G()}catch(C){if(console.error("Report creation error details:",C),C.response&&C.response.status===422&&C.response.data.errors){const U=C.response.data.errors;let H="Validation failed:<br>";for(const ne in U)H+=`- ${U[ne].join("<br>- ")}<br>`;y.danger("Validation Error",H)}else y.danger("Error","Failed to create report: "+(C.message||"Unknown error"))}finally{e.value=!1}},te=()=>{setTimeout(()=>{d.value&&d.value.show()},300)},ae=()=>{const p=document.getElementById("addReportModal");d.value||(d.value=new L(p),p.addEventListener("hidden.bs.modal",G)),d.value.show()},oe=()=>{i.value=1,o.value=null,I()},G=()=>{s.value={startTimestamp:"",endTimestamp:"",approval:!1},m.value=[]};return Y(()=>{I()}),{reportValidities:n,loading:e,error:o,currentPage:i,perPage:v,totalItems:l,searchQuery:r,columns:w,formData:s,selectedCompanies:m,fetchReportValidities:I,handlePageChange:_,handleSearch:T,viewReportDetails:Q,toggleApproval:N,confirmDelete:S,openAddReportModal:ae,handleCreateReport:Z,submitCreateReport:ee,closeConfirmationModal:te,formatDate:X,refreshData:oe,currentReportId:a}}},yt={class:"report-table-container"},ht={class:"card"},gt={class:"card-header theme-header d-flex justify-content-between align-items-center"},_t={class:"card-body"},Ct={class:"badge bg-info"},Rt={class:"d-flex justify-content-end"},wt=["onClick"],St=["onClick","title"],Dt=["onClick"],kt={class:"modal fade",id:"addReportModal",tabindex:"-1","aria-labelledby":"addReportModalLabel","aria-hidden":"true"},It={class:"modal-dialog modal-lg"},Tt={class:"modal-content"},Et={class:"modal-body"},At={class:"mb-3"},Vt={class:"mb-3"},Mt={class:"mb-3"},xt={class:"form-check"},Lt={class:"modal-footer"},Pt={class:"modal fade",id:"viewReportModal",tabindex:"-1","aria-labelledby":"viewReportModalLabel","aria-hidden":"true"},Ft={class:"modal-dialog modal-lg"},Qt={class:"modal-content"},Nt={class:"modal-body",id:"viewReportModalBody"};function Ut(n,e,o,a,i,v){const l=E("ResponsiveTable"),r=E("CompanySearchAndSelection"),d=E("ReportDetailsView"),b=E("ConfirmationModal");return f(),g(j,null,[t("div",yt,[t("div",ht,[t("div",gt,[e[11]||(e[11]=t("h5",{class:"mb-0"},"Report Validities",-1)),t("div",null,[t("button",{class:"btn btn-sm theme-btn-outline me-2",onClick:e[0]||(e[0]=(...s)=>a.refreshData&&a.refreshData(...s))},e[9]||(e[9]=[t("i",{class:"fas fa-sync-alt me-2"},null,-1),t("span",{class:"d-none d-md-inline"},"Refresh",-1)])),t("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=(...s)=>a.openAddReportModal&&a.openAddReportModal(...s))},e[10]||(e[10]=[t("i",{class:"fas fa-plus"},null,-1),t("span",{class:"d-none d-md-inline"},"Add Report",-1)]))])]),t("div",_t,[B(l,{columns:a.columns,items:a.reportValidities,loading:a.loading,"total-items":a.totalItems,"current-page":a.currentPage,"per-page":a.perPage,"server-side":!0,onPageChanged:a.handlePageChange,onSearch:a.handleSearch},{start_timestamp:D(({item:s})=>[A(u(a.formatDate(s.start_timestamp,!0)),1)]),end_timestamp:D(({item:s})=>[A(u(a.formatDate(s.end_timestamp,!0)),1)]),approval:D(({item:s})=>[t("span",{class:V(["badge",s.approval?"bg-success":"bg-warning"])},u(s.approval?"Approved":"Pending"),3)]),companies:D(({item:s})=>[t("span",Ct,u(s.reports?s.reports.length:0)+" Companies ",1)]),actions:D(({item:s})=>[t("div",Rt,[t("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:m=>a.viewReportDetails(s),title:"View Details"},e[12]||(e[12]=[t("i",{class:"fas fa-eye"},null,-1)]),8,wt),t("button",{class:V(["btn btn-sm me-1",s.approval?"btn-outline-warning":"btn-outline-success"]),onClick:m=>a.toggleApproval(s),title:s.approval?"Mark as Pending":"Approve"},[t("i",{class:V(s.approval?"fas fa-times":"fas fa-check")},null,2)],10,St),t("button",{class:"btn btn-sm btn-outline-danger",onClick:m=>a.confirmDelete(s),title:"Delete"},e[13]||(e[13]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Dt)])]),_:1},8,["columns","items","loading","total-items","current-page","per-page","onPageChanged","onSearch"])])]),t("div",kt,[t("div",It,[t("div",Tt,[e[19]||(e[19]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"addReportModalLabel"},"Add New Report"),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Et,[t("form",{id:"addReportForm",onSubmit:e[6]||(e[6]=re((...s)=>a.handleCreateReport&&a.handleCreateReport(...s),["prevent"]))},[t("div",At,[e[14]||(e[14]=t("label",{for:"startTimestamp",class:"form-label"},"Start Date",-1)),P(t("input",{type:"datetime-local",class:"form-control",id:"startTimestamp","onUpdate:modelValue":e[2]||(e[2]=s=>a.formData.startTimestamp=s),required:""},null,512),[[$,a.formData.startTimestamp]])]),t("div",Vt,[e[15]||(e[15]=t("label",{for:"endTimestamp",class:"form-label"},"End Date",-1)),P(t("input",{type:"datetime-local",class:"form-control",id:"endTimestamp","onUpdate:modelValue":e[3]||(e[3]=s=>a.formData.endTimestamp=s),required:""},null,512),[[$,a.formData.endTimestamp]])]),t("div",Mt,[e[17]||(e[17]=t("label",{class:"form-label"},"Approval Status",-1)),t("div",xt,[P(t("input",{class:"form-check-input",type:"checkbox",id:"approvalStatus","onUpdate:modelValue":e[4]||(e[4]=s=>a.formData.approval=s)},null,512),[[le,a.formData.approval]]),e[16]||(e[16]=t("label",{class:"form-check-label",for:"approvalStatus"},"Approved",-1))])]),B(r,{selectedCompanies:a.selectedCompanies,"onUpdate:selectedCompanies":e[5]||(e[5]=s=>a.selectedCompanies=s)},null,8,["selectedCompanies"])],32)]),t("div",Lt,[e[18]||(e[18]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn btn-primary",onClick:e[7]||(e[7]=(...s)=>a.handleCreateReport&&a.handleCreateReport(...s))},"Create Report")])])])]),t("div",Pt,[t("div",Ft,[t("div",Qt,[e[20]||(e[20]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"viewReportModalLabel"},"Report Details"),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Nt,[a.currentReportId?(f(),q(d,{key:0,reportId:a.currentReportId,onLoading:e[8]||(e[8]=s=>a.loading=s)},null,8,["reportId"])):O("",!0)]),e[21]||(e[21]=t("div",{class:"modal-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])])]),B(b,{modalId:"confirmCreateReportModal",title:"Confirm Report Creation",message:"Are you sure you want to create this report?",confirmLabel:"Yes, Create Report",cancelLabel:"No, Review Again",onConfirm:a.submitCreateReport,onCancel:a.closeConfirmationModal},null,8,["onConfirm","onCancel"])],64)}const Bt=x(bt,[["render",Ut],["__scopeId","data-v-42a586d4"]]),$t={name:"SmeReportTable",components:{ResponsiveTable:K},setup(){const n=c([]),e=c(!0),o=c(null),a=c(1),i=c(10),v=c(0),l=c(""),r=[{key:"start_timestamp",label:"Start Date",sortable:!0},{key:"end_timestamp",label:"End Date",sortable:!0},{key:"approval",label:"Status",sortable:!0}],d=()=>{a.value=1,o.value=null,b()},b=async()=>{e.value=!0;try{const _={page:a.value,per_page:i.value,search:l.value},T=await k.getReportValidities(_);n.value=T.data,v.value=T.pagination.total}catch(_){o.value=_.message||"Failed to fetch report validities",y.danger("Error",o.value)}finally{e.value=!1}},s=_=>{a.value=_,b()},m=_=>{l.value=_,a.value=1,b()},w=async _=>{if(!_.approval){y.warning("Report Not Available","This report has not been approved yet.");return}try{e.value=!0,k.downloadReportPdf(_.reportValidityID),y.success("Success","Report download initiated.")}catch{y.danger("Error","Failed to download report")}finally{e.value=!1}},I=async _=>{var T,Q,N;if(!_.approval){y.warning("QR Code Not Available","This report has not been approved yet.");return}try{e.value=!0;const S=await k.downloadReportQrCode(_.reportValidityID);y.success("Success","QR code download initiated.")}catch(S){console.error("QR Code Error:",S),console.error("Error details:",{message:S.message,status:(T=S.response)==null?void 0:T.status,statusText:(Q=S.response)==null?void 0:Q.statusText,data:(N=S.response)==null?void 0:N.data}),y.danger("Error","Failed to download QR code: "+(S.message||"Unknown error"))}finally{e.value=!1}};return Y(()=>{b()}),{reportValidities:n,loading:e,error:o,columns:r,currentPage:a,perPage:i,totalItems:v,handlePageChange:s,handleSearch:m,downloadReport:w,downloadQrCode:I,formatDate:X,refreshData:d}}},jt={class:"report-table-container"},qt={class:"card"},zt={class:"card-header theme-header d-flex justify-content-between align-items-center"},Ot={class:"card-body"},Wt={class:"d-flex justify-content-end"},Yt=["onClick","disabled","title"],Gt=["onClick","disabled","title"];function Ht(n,e,o,a,i,v){const l=E("ResponsiveTable");return f(),g("div",jt,[t("div",qt,[t("div",zt,[e[2]||(e[2]=t("h5",{class:"mb-0"},"Available Reports",-1)),t("button",{class:"btn btn-sm theme-btn-outline",onClick:e[0]||(e[0]=(...r)=>a.refreshData&&a.refreshData(...r))},e[1]||(e[1]=[t("i",{class:"fas fa-sync-alt me-2"},null,-1),A(),t("span",{class:"d-none d-md-inline"},"Refresh",-1)]))]),t("div",Ot,[B(l,{columns:a.columns,items:a.reportValidities,loading:a.loading,"total-items":a.totalItems,"current-page":a.currentPage,"per-page":a.perPage,"server-side":!0,onPageChanged:a.handlePageChange,onSearch:a.handleSearch},{start_timestamp:D(({item:r})=>[A(u(a.formatDate(r.start_timestamp,!0)),1)]),end_timestamp:D(({item:r})=>[A(u(a.formatDate(r.end_timestamp,!0)),1)]),approval:D(({item:r})=>[t("span",{class:V(["badge",r.approval?"bg-success":"bg-warning"])},u(r.approval?"Approved":"Pending"),3)]),actions:D(({item:r})=>[t("div",Wt,[t("button",{class:"btn btn-sm btn-outline-primary me-2",onClick:d=>a.downloadReport(r),disabled:!r.approval,title:r.approval?"Download Report":"Report not approved yet"},e[3]||(e[3]=[t("i",{class:"fas fa-download"},null,-1)]),8,Yt),t("button",{class:"btn btn-sm btn-outline-success",onClick:d=>a.downloadQrCode(r),disabled:!r.approval,title:r.approval?"Download QR Code":"Report not approved yet"},e[4]||(e[4]=[t("i",{class:"fas fa-qrcode"},null,-1)]),8,Gt)])]),_:1},8,["columns","items","loading","total-items","current-page","per-page","onPageChanged","onSearch"])])])])}const Jt=x($t,[["render",Ht],["__scopeId","data-v-8e35acb4"]]),Kt={name:"ReportPage",components:{AdminReportTable:Bt,SmeReportTable:Jt},setup(){const n=de();return{isAdmin:J(()=>{const o=n.state.user;return o&&o.company&&o.company.company_type==="admin"})}}},Xt={class:"report-page"};function Zt(n,e,o,a,i,v){const l=E("AdminReportTable"),r=E("SmeReportTable");return f(),g("div",Xt,[e[0]||(e[0]=t("h1",{class:"mb-4"},"Reports",-1)),a.isAdmin?(f(),q(l,{key:0})):(f(),q(r,{key:1}))])}const na=x(Kt,[["render",Zt]]);export{na as default};
