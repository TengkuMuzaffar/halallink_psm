import{_ as A,c as y,a,f as E,g as P,o as f,b as L,t as p,n as h,m as Q,i as B,p as S,q as G,s as K,x as W,e as R,d as T,F as X,r as g,j as Y,k as I,l as C,h as Z,w as ee,y as te}from"./main-6HkEK7r2.js";import{S as ae}from"./StatsCard-Daj1M7Ql.js";import{R as F}from"./ResponsiveTable-DO6c7ISj.js";import{m as b}from"./modal-BXblql9Y.js";import"./LoadingSpinner-TtFArfCL.js";const se={name:"EmployeeStats",components:{StatsCard:ae},props:{stats:{type:Object,default:()=>({total:0,active:0,inactive:0})}}},ne={class:"employee-stats"},oe={class:"row"},le={class:"col-md-4 col-sm-6 mb-3 mb-md-0"},ie={class:"col-md-4 col-sm-6 mb-3 mb-md-0"},re={class:"col-md-4 col-sm-12"};function ce(d,t,l,e,_,k){const i=P("StatsCard");return f(),y("div",ne,[a("div",oe,[a("div",le,[E(i,{title:"Total Employees",count:l.stats.total||0,icon:"fas fa-users","bg-color":"bg-primary"},null,8,["count"])]),a("div",ie,[E(i,{title:"Active Employees",count:l.stats.active||0,icon:"fas fa-user-check","bg-color":"bg-success"},null,8,["count"])]),a("div",re,[E(i,{title:"Inactive Employees",count:l.stats.inactive||0,icon:"fas fa-user-times","bg-color":"bg-danger"},null,8,["count"])])])])}const de=A(se,[["render",ce]]),me={name:"EmployeeTable",components:{ResponsiveTable:F},props:{title:{type:String,default:"Employees"},employees:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},columns:{type:Array,required:!0},showAddButton:{type:Boolean,default:!0}},emits:["add","sort","page-change","search"]},ue={class:"employee-table"},ge={class:"card"},pe={class:"card-header d-flex justify-content-between align-items-center"},ye={class:"mb-0"},fe=["disabled"],ve={class:"ms-1 d-none d-md-inline"},be={class:"card-body"};function he(d,t,l,e,_,k){const i=P("ResponsiveTable");return f(),y("div",ue,[a("div",ge,[a("div",pe,[a("h5",ye,p(l.title),1),l.showAddButton?(f(),y("button",{key:0,class:"btn btn-primary",onClick:t[0]||(t[0]=m=>d.$emit("add")),disabled:l.loading},[a("i",{class:h(["fas",l.loading?"fa-spinner fa-spin":"fa-copy"])},null,2),a("span",ve,p(l.loading?"Loading...":"Copy Registration Link"),1)],8,fe)):L("",!0)]),a("div",be,[E(i,{columns:l.columns,items:l.employees,loading:l.loading,"has-actions":!0,"item-key":"userID",onSort:t[1]||(t[1]=m=>d.$emit("sort",m)),onPageChange:t[2]||(t[2]=m=>d.$emit("page-change",m)),onSearch:t[3]||(t[3]=m=>d.$emit("search",m))},Q({_:2},[B(d.$slots,(m,o)=>({name:o,fn:S(v=>[G(d.$slots,o,K(W(v)))])}))]),1032,["columns","items","loading"])])])])}const _e=A(me,[["render",he]]),ke={name:"EmployeeManagement",components:{EmployeeStats:de,EmployeeTable:_e,ResponsiveTable:F},setup(){const d=Z(),t=g(!0),l=g(null),e=g([]),_=g(""),k=g(""),i=g(1),m=g(5),o=g({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),v=Y(()=>{const s=[],c=o.value.last_page;if(c<=5)for(let r=1;r<=c;r++)s.push(r);else{let r=Math.max(1,o.value.current_page-Math.floor(2.5)),D=Math.min(c,r+5-1);D===c&&(r=Math.max(1,D-5+1));for(let x=r;x<=D;x++)s.push(x)}return s}),M=g({total:0,active:0,inactive:0}),V=[{key:"fullname",label:"Name",sortable:!0},{key:"email",label:"Email",sortable:!0},{key:"tel_number",label:"Phone",sortable:!1},{key:"status",label:"Status",sortable:!0},{key:"created_at",label:"Joined",sortable:!0}],u=async()=>{try{t.value=!0,l.value=null;const s={page:i.value,per_page:m.value,search:k.value||null,status:_.value||null},n=await C.get("/api/employees",{params:s});console.log("API Response:",n),n.data&&n.success?(e.value=n.data,o.value=n.pagination,w()):(e.value=[],console.error("Unexpected response format:",n))}catch(s){console.error("Error fetching employees:",s),l.value=s.message||"Failed to load employees. Please try again later.",e.value=[]}finally{t.value=!1}},w=async()=>{try{const s={search:k.value||null,status:_.value||null},n=await C.get("/api/employees/all/stats",{params:s});n&&(M.value=n)}catch(s){console.error("Error fetching employee stats:",s)}},N=()=>{i.value=1,u(),w()},j=s=>{k.value=s,i.value=1,u(),w()},H=s=>{s<1||s>o.value.last_page||t.value||(i.value=s,u())};I(()=>{u(),w()});const $=s=>s?new Date(s).toLocaleDateString():"",q=s=>{const n="badge ";switch(s){case"active":return n+"bg-success";case"inactive":return n+"bg-danger";default:return n+"bg-secondary"}},z=()=>{console.log("Copying registration link:",d.state);const s=`${window.location.origin}/register-employee?formID=${d.state.user.company.formID}`;b.show({type:"info",title:"Add New Employee",message:`
            <p>Share this registration link with your new employee:</p>
            <div class="input-group mb-3">
              <input type="text" class="form-control" value="${s}" id="registration-link" readonly>
              <button class="btn btn-outline-secondary" type="button" id="copy-link-btn">
                <i class="fas fa-copy"></i> Copy
              </button>
            </div>
          `,onShown:()=>{const n=document.getElementById("copy-link-btn"),c=document.getElementById("registration-link");n&&c&&n.addEventListener("click",()=>{c.select(),document.execCommand("copy");const r=n.innerHTML;n.innerHTML='<i class="fas fa-check"></i> Copied!',n.classList.replace("btn-outline-secondary","btn-success"),setTimeout(()=>{n.innerHTML=r,n.classList.replace("btn-success","btn-outline-secondary")},2e3)})}})},U=async s=>{const n=s.status==="active"?"inactive":"active",c=n==="active"?"activate":"deactivate";b.confirm(`${n==="active"?"Activate":"Deactivate"} Employee`,`Are you sure you want to ${c} ${s.name}?`,async()=>{t.value=!0;try{await C.fetchData(`/api/employees/${s.userID}/status`,{method:"patch",data:{status:n},onSuccess:r=>{u(),b.success("Success",`Employee ${c}d successfully`)},onError:r=>{console.error(`Error ${c}ing employee:`,r),b.danger("Error",`Failed to ${c} employee. Please try again.`),u()}})}catch{u()}},null,{confirmLabel:n==="active"?"Activate":"Deactivate",confirmType:n==="active"?"success":"warning"})},J=s=>{console.log("Editing employee:",s)},O=async s=>{b.confirm("Delete Employee",`Are you sure you want to delete ${s.name}?`,async()=>{t.value=!0;try{await C.fetchData(`/api/employees/${s.userID}`,{method:"delete",onSuccess:n=>{b.success("Success","Employee deleted successfully"),u()},onError:n=>{console.error("Error deleting employee:",n),b.danger("Error","Failed to delete employee. Please try again."),u()}})}catch{u()}},null,{confirmLabel:"Delete",confirmType:"danger"})};return I(()=>{u()}),{loading:t,error:l,employees:e,employeeStats:M,columns:V,statusFilter:_,pagination:o,paginationRange:v,currentPage:i,formatDate:$,getStatusBadgeClass:q,copyRegistrationLink:z,editEmployee:J,deleteEmployee:O,toggleEmployeeStatus:U,applyFilters:N,handleSearch:j,changePage:H}}},Ee={class:"employee-management"},Se={class:"card"},we={class:"card-header d-flex justify-content-between align-items-center"},Ce={class:"card-body"},Pe={key:0,class:"alert alert-danger",role:"alert"},De={class:"d-flex gap-2"},xe=["onClick"],Te=["onClick"],Le=["onClick"],Ae={key:1,class:"d-flex justify-content-between align-items-center mt-3"},Me={class:"text-muted"},Re={"aria-label":"Table pagination"},Ie={class:"pagination mb-0"},Be=["onClick"];function Fe(d,t,l,e,_,k){const i=P("EmployeeStats"),m=P("ResponsiveTable");return f(),y("div",Ee,[t[12]||(t[12]=a("h1",{class:"mb-4"},"Employee Management",-1)),E(i,{stats:e.employeeStats,class:"mb-4"},null,8,["stats"]),a("div",Se,[a("div",we,[t[6]||(t[6]=a("h5",{class:"mb-0"},"Employees",-1)),a("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...o)=>e.copyRegistrationLink&&e.copyRegistrationLink(...o))},t[5]||(t[5]=[a("i",{class:"fas fa-plus me-1"},null,-1),R(" Add Employee ")]))]),a("div",Ce,[e.error?(f(),y("div",Pe,p(e.error),1)):L("",!0),E(m,{columns:e.columns,items:e.employees,loading:e.loading,"has-actions":!0,"item-key":"userID",onSearch:e.handleSearch,"show-pagination":!1,"server-side":!0},{filters:S(()=>[a("div",De,[ee(a("select",{class:"form-select form-select-sm","onUpdate:modelValue":t[1]||(t[1]=o=>e.statusFilter=o),onChange:t[2]||(t[2]=(...o)=>e.applyFilters&&e.applyFilters(...o))},t[7]||(t[7]=[a("option",{value:""},"All Status",-1),a("option",{value:"active"},"Active",-1),a("option",{value:"inactive"},"Inactive",-1)]),544),[[te,e.statusFilter]])])]),status:S(({item:o})=>[a("span",{class:h(e.getStatusBadgeClass(o.status))},p(o.status),3)]),created_at:S(({item:o})=>[R(p(e.formatDate(o.created_at)),1)]),actions:S(({item:o})=>[a("button",{class:h(["btn btn-sm me-1",o.status==="active"?"btn-outline-warning":"btn-outline-success"]),onClick:v=>e.toggleEmployeeStatus(o)},[a("i",{class:h(o.status==="active"?"fas fa-ban":"fas fa-check")},null,2)],10,xe),a("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:v=>e.editEmployee(o)},t[8]||(t[8]=[a("i",{class:"fas fa-edit"},null,-1)]),8,Te),a("button",{class:"btn btn-sm btn-outline-danger",onClick:v=>e.deleteEmployee(o)},t[9]||(t[9]=[a("i",{class:"fas fa-trash"},null,-1)]),8,Le)]),_:1},8,["columns","items","loading","onSearch"]),e.pagination.last_page>0?(f(),y("div",Ae,[a("div",null,[a("span",Me,"Showing "+p(e.pagination.from||0)+" to "+p(e.pagination.to||0)+" of "+p(e.pagination.total||0)+" entries",1)]),a("nav",Re,[a("ul",Ie,[a("li",{class:h(["page-item",{disabled:e.currentPage===1||e.loading}])},[a("a",{class:"page-link",href:"#",onClick:t[3]||(t[3]=T(o=>!e.loading&&e.changePage(e.currentPage-1),["prevent"]))},t[10]||(t[10]=[a("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(f(!0),y(X,null,B(e.paginationRange,o=>(f(),y("li",{key:o,class:h(["page-item",{active:o===e.currentPage,disabled:e.loading}])},[a("a",{class:"page-link",href:"#",onClick:T(v=>!e.loading&&e.changePage(o),["prevent"])},p(o),9,Be)],2))),128)),a("li",{class:h(["page-item",{disabled:e.currentPage===e.pagination.last_page||e.loading}])},[a("a",{class:"page-link",href:"#",onClick:t[4]||(t[4]=T(o=>!e.loading&&e.changePage(e.currentPage+1),["prevent"]))},t[11]||(t[11]=[a("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):L("",!0)])])])}const qe=A(ke,[["render",Fe],["__scopeId","data-v-149ddd97"]]);export{qe as default};
