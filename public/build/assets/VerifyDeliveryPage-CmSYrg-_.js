import{z as $,_ as z,r as v,p as J,c,o as l,b as x,d as S,a as e,t as f,B as O,C as M,F as C,i as U,w as q,X as T,v as Q,e as R,A as X,m as G,M as H,f as j,E as K}from"./main-6TRAM3lj.js";import{R as W}from"./ResponsiveTable-Dmb47gmH.js";import{L as A}from"./LoadingSpinner-Bs7tkB0U.js";const L={getDeliveryInfo:async m=>{try{return await $.get(`/api/deliveries/${m}`)}catch(o){return console.error("Error fetching delivery info:",o),{status:"error",message:o.message||"Failed to fetch delivery information"}}},getVerifications:async(m,o,a)=>{try{return await $.get(`/api/verifications?deliveryID=${m}&locationID=${o}&token=${a}`)}catch(r){return console.error("Error fetching verifications:",r),{status:"error",message:r.message||"Failed to fetch verification data"}}},getCheckpointDetails:async m=>{try{return await $.get(`/api/checkpoints/${m}`)}catch(o){return console.error("Error fetching checkpoint details:",o),{status:"error",message:o.message||"Failed to fetch checkpoint details"}}},getVerificationById:async(m,o,a,r)=>{try{return await $.get(`/api/verifications/${m}`,{params:{deliveryID:o,locationID:a,token:r}})}catch(s){return console.error("Error fetching verification by ID:",s),{status:"error",message:s.message||"Failed to fetch verification details"}}},updateVerification:async(m,o,a)=>{try{const r={...o,deliveryID:a};return await $.put(`/api/verifications/${m}`,r)}catch(r){return console.error("Error updating verification:",r),{status:"error",message:r.message||"Failed to update verification"}}},completeVerifications:async(m,o)=>{try{return await $.post(`/api/verifications/complete/${o}/${m}`)}catch(a){return console.error("Error completing verifications:",a),{status:"error",message:a.message||"Failed to complete verifications"}}}},Y={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},Z={class:"modal-content"},ee={class:"modal-header theme-header"},te={class:"modal-title"},se={class:"modal-body"},ae={key:1,class:"alert alert-danger mt-3"},ie={key:2,class:"verification-form"},le={class:"d-flex justify-content-between align-items-center mb-3"},oe={class:"d-flex align-items-center"},re={class:"mb-0 me-2"},ne={class:"badge bg-secondary me-2"},ce={class:"form-section mb-4"},ue={class:"items-section"},de={key:0},ve={class:"table-responsive"},fe={class:"table table-sm table-hover mb-0"},me={class:"order-header"},pe={colspan:"4",class:"order-header-cell"},ge={class:"d-flex align-items-center"},he={class:"order-badge me-2"},ye={class:"order-item-count"},_e={class:"text-center"},be={class:"text-center"},ke={class:"quantity-badge"},De={class:"text-center"},Ie={key:1,class:"text-center text-muted py-3"},Ve={class:"form-section"},we={class:"mb-4"},xe={class:"status-options"},$e={class:"form-check form-check-inline"},Ce={class:"form-check form-check-inline"},Se={class:"mb-3"},Me={key:3,class:"alert alert-danger mt-3"},Pe={key:4,class:"alert alert-success mt-3"},Ee={class:"modal-footer theme-footer"},Fe=["disabled"],Ne={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Be={key:1,class:"modal-backdrop fade show"},qe={__name:"VerifiesModalDetail",props:{show:{type:Boolean,required:!0},verifyId:{type:[Number,String],default:null},deliveryId:{type:[Number,String],default:null},locationId:{type:[Number,String],default:null},token:{type:String,default:null}},emits:["close","updated"],setup(m,{emit:o}){const a=m,r=o,s=v(null),b=v(!1),y=v(null),_=v(!1),w=v(!1),V=v(null);v(!1),J(()=>[a.show,a.verifyId],async([d,t])=>{d&&t?await k(t):(s.value=null,y.value=null,_.value=!1,V.value=null)},{immediate:!0});const k=async d=>{w.value=!0,V.value=null;try{const t=await L.getVerificationById(d,a.deliveryId,a.locationId,a.token);console.log("Response from fetchVerificationDetails:",JSON.stringify(t,null,2)),t.status==="success"?s.value={...t.data,associated_items:t.data.associated_items||[]}:V.value=t.message||"Failed to load verification details."}catch(t){console.error("Error fetching verification details:",t),V.value=t.message||"An unexpected error occurred while fetching details."}finally{w.value=!1}},D=()=>{r("close")},u=async()=>{var d,t;if(!(!s.value||!s.value.verifyID)){b.value=!0,y.value=null,_.value=!1;try{const g={verify_status:s.value.verify_status,verify_comment:s.value.verify_comment},p=await L.updateVerification(s.value.verifyID,g,a.deliveryId);p.status==="success"?(_.value=!0,r("updated",p.data),setTimeout(()=>{D()},1500)):(y.value=p.message||"Failed to update verification.",p.errors&&(y.value+=" Details: "+JSON.stringify(p.errors)))}catch(g){console.error("Error updating verification:",g),y.value=((t=(d=g.response)==null?void 0:d.data)==null?void 0:t.message)||g.message||"An unexpected error occurred."}finally{b.value=!1}}},P=d=>d==="complete"?"theme-badge-success":d==="pending"?"theme-badge-warning":d==="reject"?"theme-badge-danger":"theme-badge-secondary",E=()=>!s.value||!s.value.associated_items?{}:s.value.associated_items.reduce((d,t)=>{const g=t.orderID||"Unknown";return d[g]||(d[g]=[]),d[g].push(t),d},{});return(d,t)=>{var g;return l(),c(C,null,[m.show?(l(),c("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:S(D,["self"])},[e("div",Y,[e("div",Z,[e("form",{onSubmit:S(u,["prevent"])},[e("div",ee,[e("h5",te,"Verification Form #"+f((g=s.value)==null?void 0:g.verifyID),1),e("button",{type:"button",class:"btn-close theme-close",onClick:D,"aria-label":"Close"})]),e("div",se,[w.value?(l(),O(A,{key:0,size:"md",message:"Loading verification details..."})):V.value?(l(),c("div",ae,f(V.value),1)):s.value?(l(),c("div",ie,[e("div",le,[e("div",oe,[e("h6",re,"Delivery ID: "+f(s.value.deliveryID),1),e("span",ne,"Checkpoint: "+f(s.value.checkID),1)]),e("span",{class:M(["badge",P(s.value.verify_status)])},f(s.value.verify_status||"Pending"),3)]),e("div",ce,[t[5]||(t[5]=e("h6",{class:"section-title"},"Items to Verify",-1)),e("div",ue,[s.value.associated_items&&s.value.associated_items.length>0?(l(),c("div",de,[e("div",ve,[e("table",fe,[t[3]||(t[3]=e("thead",{class:"table-header"},[e("tr",null,[e("th",{scope:"col",class:"text-center"},"#"),e("th",{scope:"col"},"Name"),e("th",{scope:"col",class:"text-center"},"Quantity"),e("th",{scope:"col",class:"text-center"},"Status")])],-1)),e("tbody",null,[(l(!0),c(C,null,U(E(),(p,F)=>(l(),c(C,null,[e("tr",me,[e("td",pe,[e("div",ge,[e("span",he,"Order #"+f(F),1),e("span",ye,f(p.length)+" item(s)",1)])])]),(l(!0),c(C,null,U(p,(i,n)=>(l(),c("tr",{key:i.itemID,class:"align-middle item-row"},[e("td",_e,f(n+1),1),e("td",null,f(i.item_name||"Unknown Item"),1),e("td",be,[e("span",ke,f(i.quantity||1),1)]),e("td",De,[e("span",{class:M(["badge",P(s.value.verify_status)])},f(s.value.verify_status||"Pending"),3)])]))),128))],64))),256))])])])])):(l(),c("div",Ie,t[4]||(t[4]=[e("p",{class:"mb-0"},"No items associated with this verification checkpoint.",-1)])))])]),e("div",Ve,[t[10]||(t[10]=e("h6",{class:"section-title"},"Update Verification Status",-1)),e("div",we,[t[8]||(t[8]=e("label",{for:"verify_status",class:"form-label"},"Status:",-1)),e("div",xe,[e("div",$e,[q(e("input",{class:"form-check-input",type:"radio",name:"verify_status",id:"status-pending",value:"pending","onUpdate:modelValue":t[0]||(t[0]=p=>s.value.verify_status=p)},null,512),[[T,s.value.verify_status]]),t[6]||(t[6]=e("label",{class:"form-check-label",for:"status-pending"},[e("span",{class:"status-badge theme-badge-warning"},"Pending")],-1))]),e("div",Ce,[q(e("input",{class:"form-check-input",type:"radio",name:"verify_status",id:"status-complete",value:"complete","onUpdate:modelValue":t[1]||(t[1]=p=>s.value.verify_status=p)},null,512),[[T,s.value.verify_status]]),t[7]||(t[7]=e("label",{class:"form-check-label",for:"status-complete"},[e("span",{class:"status-badge theme-badge-success"},"Complete")],-1))])])]),e("div",Se,[t[9]||(t[9]=e("label",{for:"verify_comment",class:"form-label"},"Verification Notes:",-1)),q(e("textarea",{class:"form-control",id:"verify_comment","onUpdate:modelValue":t[2]||(t[2]=p=>s.value.verify_comment=p),rows:"4",placeholder:"Enter any notes or comments about this verification..."},null,512),[[Q,s.value.verify_comment]])])])])):x("",!0),y.value?(l(),c("div",Me,f(y.value),1)):x("",!0),_.value?(l(),c("div",Pe,t[11]||(t[11]=[e("i",{class:"fas fa-check-circle me-2"},null,-1),R(" Verification updated successfully! ")]))):x("",!0)]),e("div",Ee,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:D},"Cancel"),e("button",{type:"submit",class:"btn theme-btn-primary",disabled:b.value||!s.value},[b.value?(l(),c("span",Ne)):x("",!0),R(" "+f(b.value?"Saving...":"Save Verification"),1)],8,Fe)])],32)])])])):x("",!0),m.show?(l(),c("div",Be)):x("",!0)],64)}}},Ue=z(qe,[["__scopeId","data-v-577589b3"]]),Le={class:"verify-delivery-management"},Te={class:"card theme-card"},Re={class:"card-body theme-body"},je={key:0,class:"alert alert-danger",role:"alert"},ze={key:2},Oe=["onClick"],Ae={key:0,class:"d-flex justify-content-between align-items-center mt-3"},Je={class:"text-muted"},Qe={"aria-label":"Table pagination"},Xe={class:"pagination mb-0 theme-pagination"},Ge=["onClick"],He={__name:"VerifyDeliveryPage",setup(m){const o=H(),a=v(!0),r=v(null),s=v(null),b=v(null),y=v(null),_=v([]),w=v(null),V=v(!1),k=v(1),D=v(10),u=v({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),P=X(()=>{const i=[],h=u.value.last_page;if(h<=5)for(let I=1;I<=h;I++)i.push(I);else{let I=Math.max(1,u.value.current_page-Math.floor(2.5)),N=Math.min(h,I+5-1);N===h&&(I=Math.max(1,N-5+1));for(let B=I;B<=N;B++)i.push(B)}return i}),E=v([{key:"verifyID",label:"Verification ID",sortable:!0},{key:"verify_status",label:"Status",sortable:!0}]),d=async()=>{if(!s.value||!b.value||!y.value){r.value="Delivery ID, Location ID, and Token are required parameters.",a.value=!1;return}a.value=!0,r.value=null;try{const i=await L.getVerifications(s.value,b.value,y.value);if(i.status==="error")throw new Error(i.message);const n=i.data||i;if(_.value=n,!n.some(I=>I.verify_status==="pending")){window.location.href=`/deliveries?selectionID=${s.value}`;return}u.value.total=_.value.length,u.value.last_page=Math.ceil(_.value.length/D.value),u.value.current_page=k.value,u.value.from=_.value.length>0?(k.value-1)*D.value+1:0,u.value.to=Math.min(k.value*D.value,_.value.length)}catch(i){console.error("Error fetching verifications:",i),r.value=i.message||"Failed to fetch verification data. Please try again.",_.value=[],u.value={current_page:1,last_page:1,per_page:D.value,total:0,from:0,to:0}}finally{a.value=!1}},t=i=>{i<1||i>u.value.last_page||a.value||(k.value=i,u.value.current_page=i,u.value.from=(i-1)*D.value+1,u.value.to=Math.min(i*D.value,_.value.length))},g=i=>{w.value=i,V.value=!0},p=()=>{V.value=!1,w.value=null},F=()=>{d()};return G(()=>{s.value=o.query.deliveryID,b.value=o.query.locationID,y.value=o.query.token,!s.value||!b.value||!y.value?(r.value="Missing required parameters: Delivery ID, Location ID, and Token.",a.value=!1):d()}),(i,n)=>(l(),c("div",Le,[n[6]||(n[6]=e("h1",{class:"mb-4"},"Verify Delivery",-1)),e("div",Te,[n[5]||(n[5]=e("div",{class:"card-header d-flex justify-content-between align-items-center theme-header"},[e("h5",{class:"mb-0"},"Verifications")],-1)),e("div",Re,[r.value?(l(),c("div",je,f(r.value),1)):x("",!0),a.value?(l(),O(A,{key:1,size:"md",message:"Loading verifications..."})):(l(),c("div",ze,[j(W,{columns:E.value,items:_.value,loading:!1,"has-actions":!0,"item-key":"verifyID","show-pagination":!1},{actions:K(({item:h})=>[e("button",{class:"btn btn-sm theme-btn-info",onClick:I=>g(h)},n[2]||(n[2]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Oe)]),_:1},8,["columns","items"]),u.value.last_page>0?(l(),c("div",Ae,[e("div",null,[e("span",Je,"Showing "+f(u.value.from||0)+" to "+f(u.value.to||0)+" of "+f(u.value.total||0)+" entries",1)]),e("nav",Qe,[e("ul",Xe,[e("li",{class:M(["page-item",{disabled:k.value===1||a.value}])},[e("a",{class:"page-link",href:"#",onClick:n[0]||(n[0]=S(h=>!a.value&&t(k.value-1),["prevent"]))},n[3]||(n[3]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(l(!0),c(C,null,U(P.value,h=>(l(),c("li",{key:h,class:M(["page-item",{active:h===k.value,disabled:a.value}])},[e("a",{class:"page-link",href:"#",onClick:S(I=>!a.value&&t(h),["prevent"])},f(h),9,Ge)],2))),128)),e("li",{class:M(["page-item",{disabled:k.value===u.value.last_page||a.value}])},[e("a",{class:"page-link",href:"#",onClick:n[1]||(n[1]=S(h=>!a.value&&t(k.value+1),["prevent"]))},n[4]||(n[4]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):x("",!0)]))])]),j(Ue,{show:V.value,"verify-id":w.value?w.value.verifyID:null,"delivery-id":s.value,"location-id":b.value,token:y.value,onClose:p,onUpdated:F},null,8,["show","verify-id","delivery-id","location-id","token"])]))}},Ze=z(He,[["__scopeId","data-v-c28d6e4b"]]);export{Ze as default};
