import{_ as z,A as N,c as n,a as t,f as I,g as V,d as A,b as E,e as M,w as D,v as P,o as s,z as S,r as p,p as q,F as R,i as $,t as j,h as K,J as te,C as ae,B as ie,m as oe,M as se}from"./main-6TRAM3lj.js";import{m}from"./modal-CNQBRbiU.js";import{L as J}from"./LoadingSpinner-Bs7tkB0U.js";import{m as ne}from"./marketplaceService-CktxYDrS.js";const le={name:"ProfileInfo",components:{LoadingSpinner:J},props:{profileData:{type:Object,required:!0},profileImage:{type:String,default:null},editMode:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["toggle-edit","save","cancel","image-change"],setup(r){return{isAdmin:N(()=>r.profileData.role==="admin")}}},re={class:"card theme-card"},de={class:"card-header d-flex justify-content-between align-items-center theme-header"},ce={key:1},me={class:"card-body theme-body"},fe={key:0,class:"text-center py-4"},ue={key:1},pe={class:"row mb-4"},ye={class:"col-md-3 text-center"},ve={class:"avatar-container mb-3"},ge=["src"],be={key:0,class:"mt-2"},_e={class:"col-md-9"},we={key:0,class:"mb-3"},Ce=["disabled"],he={key:1,class:"mb-3"},ke=["disabled"],Le={class:"mb-3"},Ee=["disabled"],De={class:"mb-3"},Pe=["disabled"],Me={class:"mb-3"};function Se(r,e,l,a,b,y){const d=V("LoadingSpinner");return s(),n("div",re,[t("div",de,[e[13]||(e[13]=t("h5",{class:"mb-0"},"Profile Information",-1)),l.editMode?(s(),n("div",ce,[t("button",{class:"btn btn-success theme-btn-primary me-2",onClick:e[1]||(e[1]=i=>r.$emit("save"))},e[11]||(e[11]=[t("i",{class:"bi bi-check-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Save",-1)])),t("button",{class:"btn btn-secondary theme-btn-secondary",onClick:e[2]||(e[2]=i=>r.$emit("toggle-edit"))},e[12]||(e[12]=[t("i",{class:"bi bi-x-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Cancel",-1)]))])):(s(),n("button",{key:0,class:"btn btn-primary theme-btn-primary",onClick:e[0]||(e[0]=i=>r.$emit("toggle-edit"))},e[10]||(e[10]=[t("i",{class:"bi bi-pencil-fill me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Edit Profile",-1)])))]),t("div",me,[l.loading?(s(),n("div",fe,[I(d,{message:"Loading profile..."})])):(s(),n("div",ue,[t("form",{onSubmit:e[9]||(e[9]=A(i=>r.$emit("save"),["prevent"]))},[t("div",pe,[t("div",ye,[t("div",ve,[t("img",{src:l.profileImage||"/images/blank.jpg",alt:"Profile Picture",class:"rounded-circle img-thumbnail",style:{width:"150px",height:"150px","object-fit":"cover"}},null,8,ge),l.editMode?(s(),n("div",be,[e[14]||(e[14]=t("label",{for:"profile-image",class:"btn btn-sm btn-outline-primary"},[t("i",{class:"bi bi-camera-fill me-1"}),M(" Change Photo ")],-1)),t("input",{type:"file",id:"profile-image",class:"d-none",accept:"image/*",onChange:e[3]||(e[3]=i=>r.$emit("image-change",i))},null,32)])):E("",!0)])]),t("div",_e,[a.isAdmin?(s(),n("div",we,[e[15]||(e[15]=t("label",{for:"company_name",class:"form-label"},"Company Name",-1)),D(t("input",{type:"text",class:"form-control",id:"company_name","onUpdate:modelValue":e[4]||(e[4]=i=>l.profileData.company_name=i),disabled:!l.editMode,required:""},null,8,Ce),[[P,l.profileData.company_name]])])):(s(),n("div",he,[e[16]||(e[16]=t("label",{for:"fullname",class:"form-label"},"Full Name",-1)),D(t("input",{type:"text",class:"form-control",id:"fullname","onUpdate:modelValue":e[5]||(e[5]=i=>l.profileData.fullname=i),disabled:!l.editMode,required:""},null,8,ke),[[P,l.profileData.fullname]])])),t("div",Le,[e[17]||(e[17]=t("label",{for:"email",class:"form-label"},"Email Address",-1)),D(t("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":e[6]||(e[6]=i=>l.profileData.email=i),disabled:!l.editMode,required:""},null,8,Ee),[[P,l.profileData.email]])]),t("div",De,[e[18]||(e[18]=t("label",{for:"tel_number",class:"form-label"},"Phone Number",-1)),D(t("input",{type:"tel",class:"form-control",id:"tel_number","onUpdate:modelValue":e[7]||(e[7]=i=>l.profileData.tel_number=i),disabled:!l.editMode},null,8,Pe),[[P,l.profileData.tel_number]])]),t("div",Me,[e[19]||(e[19]=t("label",{for:"status",class:"form-label"},"Status",-1)),D(t("input",{type:"text",class:"form-control",id:"status","onUpdate:modelValue":e[8]||(e[8]=i=>l.profileData.status=i),disabled:""},null,512),[[P,l.profileData.status]])])])])],32)]))])])}const Fe=z(le,[["render",Se],["__scopeId","data-v-1ae1a320"]]),xe={async fetchCertifications(){try{return(await S.get("/api/profile/certifications")).certifications||[]}catch(r){return console.error("Error fetching certifications:",r),m.danger("Error","Failed to load certifications. Please try again."),[]}},async updateCertifications(r){try{return await S.post("/api/profile/certifications",r,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){throw console.error("Error updating certifications:",e),e}},async deleteCertification(r){try{return await S.delete(`/api/profile/certifications/${r}`)}catch(e){throw console.error("Error deleting certification:",e),e}}},Ie={name:"CompanyCertifications",components:{LoadingSpinner:J},props:{certifications:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["toggle-edit","loading","update:certifications","refresh-data"],setup(r,{emit:e}){const l=p(!1),a=p([]),b=()=>{a.value=r.certifications.map(o=>({...o,newFile:null})),a.value.length===0&&y()};q([()=>r.editMode,()=>r.certifications],([o])=>{o&&b()},{immediate:!0});const y=()=>{a.value.push({cert_type:"",cert_file:null,newFile:null})},d=async(o,C)=>{if(r.editMode){i(o);return}const _=C.cert_type||"this certification";try{m.confirm("Delete Certification",`Are you sure you want to delete "${_}"? This action cannot be undone and the certificate file will be permanently removed.`,()=>{i(o)},null,{confirmLabel:"Yes, Delete",cancelLabel:"Cancel",confirmType:"danger"})}catch{}},i=async o=>{const C=a.value[o];if(C.certID)try{await S.delete(`/api/profile/certifications/${C.certID}`)}catch(_){console.error("Error deleting certification from server:",_),m.danger("Error","Failed to delete certification from server");return}a.value.splice(o,1),a.value.length===0&&y()};return{saving:l,editableCertifications:a,addNewCertification:y,confirmDeleteCertification:d,removeCertification:i,handleFileChange:(o,C)=>{const _=o.target.files[0];if(!_)return;if(!["application/pdf","image/jpeg","image/jpg","image/png"].includes(_.type)){m.danger("Invalid File","Please select a PDF or image file"),o.target.value=null;return}if(_.size>5*1024*1024){m.danger("File Too Large","File size should not exceed 5MB"),o.target.value=null;return}a.value[C].newFile=_},getFileUrl:o=>o?o.startsWith("http")?o:`/storage/${o}`:"",saveCertifications:async()=>{try{e("loading",!0),l.value=!0;const o=new FormData,C=a.value.filter(w=>w.cert_type&&(w.cert_file||w.newFile));if(C.length===0){m.danger("Error","Please add at least one certification with both type and file.");return}C.forEach((w,F)=>{o.append(`certifications[${F}][cert_type]`,w.cert_type),w.newFile?o.append(`certifications[${F}][cert_file]`,w.newFile):w.cert_file&&o.append(`certifications[${F}][existing_file]`,w.cert_file)});const _=await xe.updateCertifications(o);m.success("Success","Certifications updated successfully"),e("update:certifications",_.certifications),e("toggle-edit"),e("refresh-data")}catch(o){console.error("Error updating certifications:",o),m.danger("Error","Failed to update certifications. Please try again.")}finally{e("loading",!1),l.value=!1}},cancelEdit:()=>{e("toggle-edit"),e("refresh-data")}}}},Ve={class:"card mb-4 theme-card"},Ue={class:"card-header d-flex justify-content-between align-items-center theme-header"},Te={key:1},Ne={class:"card-body theme-body"},Ae={key:0,class:"text-center py-4"},qe={key:1},Be={key:0},Re={key:0,class:"text-center py-3"},$e={key:1,class:"certification-list"},je={class:"d-flex justify-content-between align-items-center"},ze={class:"fw-bold"},Je={class:"text-muted small"},Oe=["href"],He={key:1},We={class:"row g-2"},Ye={class:"col-md-6"},Ke=["onUpdate:modelValue","onBlur"],Ge={class:"col-md-4"},Qe=["onChange","required"],Xe={key:0,class:"form-text"},Ze=["href"],et={class:"col-md-2 d-flex align-items-end"},tt=["onClick"],at={class:"mb-3"};function it(r,e,l,a,b,y){const d=V("LoadingSpinner");return s(),n("div",Ve,[t("div",Ue,[e[8]||(e[8]=t("h5",{class:"mb-0"},"Certifications",-1)),l.editMode?(s(),n("div",Te,[t("button",{class:"btn btn-success theme-btn-primary me-2",onClick:e[1]||(e[1]=(...i)=>a.saveCertifications&&a.saveCertifications(...i))},e[6]||(e[6]=[t("i",{class:"bi bi-check-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Save",-1)])),t("button",{class:"btn btn-secondary theme-btn-secondary",onClick:e[2]||(e[2]=(...i)=>a.cancelEdit&&a.cancelEdit(...i))},e[7]||(e[7]=[t("i",{class:"bi bi-x-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Cancel",-1)]))])):(s(),n("button",{key:0,class:"btn btn-primary theme-btn-primary",onClick:e[0]||(e[0]=i=>r.$emit("toggle-edit"))},e[5]||(e[5]=[t("i",{class:"bi bi-pencil-fill me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Manage Certifications",-1)])))]),t("div",Ne,[l.loading?(s(),n("div",Ae,[I(d,{message:"Loading certifications..."})])):(s(),n("div",qe,[l.editMode?(s(),n("div",He,[t("form",{onSubmit:e[4]||(e[4]=A((...i)=>a.saveCertifications&&a.saveCertifications(...i),["prevent"]))},[(s(!0),n(R,null,$(a.editableCertifications,(i,v)=>(s(),n("div",{key:v,class:"certification-item mb-3 p-3 border rounded"},[t("div",We,[t("div",Ye,[e[12]||(e[12]=t("label",{class:"form-label"},"Certificate Type",-1)),D(t("input",{type:"text",class:"form-control","onUpdate:modelValue":g=>i.cert_type=g,required:"",minlength:"1",placeholder:"e.g., Halal Certification",onBlur:g=>i.cert_type=i.cert_type.trim()},null,40,Ke),[[P,i.cert_type]])]),t("div",Ge,[e[14]||(e[14]=t("label",{class:"form-label"},"Certificate File",-1)),t("input",{type:"file",class:"form-control",onChange:g=>a.handleFileChange(g,v),accept:".pdf,.jpg,.jpeg,.png",required:!i.cert_file},null,40,Qe),i.cert_file&&!i.newFile?(s(),n("div",Xe,[t("a",{href:a.getFileUrl(i.cert_file),target:"_blank",class:"text-primary"},e[13]||(e[13]=[t("i",{class:"fas fa-file me-1"},null,-1),M(" Current file ")]),8,Ze)])):E("",!0)]),t("div",et,[t("button",{type:"button",class:"btn btn-danger btn-sm w-100",onClick:g=>a.confirmDeleteCertification(v,i)},e[15]||(e[15]=[t("i",{class:"fas fa-trash"},null,-1)]),8,tt)])])]))),128)),t("div",at,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:e[3]||(e[3]=(...i)=>a.addNewCertification&&a.addNewCertification(...i))},e[16]||(e[16]=[t("i",{class:"fas fa-plus me-1"},null,-1),M(" Add Certification ")]))])],32)])):(s(),n("div",Be,[l.certifications.length===0?(s(),n("div",Re,e[9]||(e[9]=[t("i",{class:"fas fa-certificate text-muted mb-2",style:{"font-size":"2rem"}},null,-1),t("p",{class:"text-muted"},"No certifications added yet",-1)]))):(s(),n("div",$e,[(s(!0),n(R,null,$(l.certifications,(i,v)=>(s(),n("div",{key:i.certID||v,class:"certification-item mb-3 p-3 border rounded"},[t("div",je,[t("div",null,[t("div",ze,j(i.cert_type),1),t("div",Je,[t("a",{href:a.getFileUrl(i.cert_file),target:"_blank",class:"text-primary"},e[10]||(e[10]=[t("i",{class:"fas fa-file-pdf me-1"},null,-1),M(" View Certificate ")]),8,Oe)])]),e[11]||(e[11]=t("div",{class:"ms-auto"},[t("span",{class:"badge bg-success"},"Active")],-1))])]))),128))]))]))]))])])}const ot=z(Ie,[["render",it],["__scopeId","data-v-277aa16d"]]),st={name:"CompanyLocations",components:{LoadingSpinner:J},props:{locations:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["update:locations","loading","toggle-edit"],setup(r,{emit:e}){const l=K(),a=p(!1),b=p([]),y=p([]),d=N(()=>{const f=l.getters.user;return f&&f.company?f.company.company_type:"admin"});return q(()=>r.locations,f=>{r.editMode&&(b.value=Array.isArray(f)?JSON.parse(JSON.stringify(f||[])):[])},{immediate:!0}),q(()=>r.editMode,f=>{f&&(b.value=Array.isArray(r.locations)?JSON.parse(JSON.stringify(r.locations||[])):[],y.value=[])}),{saving:a,editableLocations:b,companyType:d,addNewLocation:()=>{b.value.push({company_address:"",location_type:"headquarters"})},removeLocation:f=>{const h=b.value[f];h.locationID&&y.value.push(h.locationID),b.value.splice(f,1)},saveLocations:async()=>{a.value=!0,e("loading",!0);try{const f={locations:b.value||[],delete_ids:y.value||[]},h=await S.post("/api/profile/locations",f);e("update:locations",h.locations||[]),m.success("Success","Company locations updated successfully"),e("toggle-edit")}catch(f){console.error("Error saving locations:",f),m.danger("Error","Failed to update company locations. Please try again.")}finally{a.value=!1,e("loading",!1)}}}}},nt={class:"card mb-4 theme-card"},lt={class:"card-header d-flex justify-content-between align-items-center theme-header"},rt={key:1},dt={class:"card-body theme-body"},ct={key:0,class:"text-center py-4"},mt={key:1},ft={key:0},ut={key:0,class:"text-center py-3"},pt={key:1,class:"location-list"},yt={class:"d-flex justify-content-between"},vt={class:"fw-bold"},gt={class:"text-muted small"},bt={key:1},_t={class:"row g-2"},wt={class:"col-md-6"},Ct=["onUpdate:modelValue"],ht={class:"col-md-4"},kt=["onUpdate:modelValue"],Lt={key:0,value:"supplier"},Et={key:1,value:"slaughterhouse"},Dt={key:2,value:"kitchen"},Pt={class:"col-md-2 d-flex align-items-end"},Mt=["onClick"],St={class:"mb-3"},Ft={class:"d-flex justify-content-end"},xt=["disabled"],It={key:0,class:"spinner-border spinner-border-sm ms-1",role:"status","aria-hidden":"true"};function Vt(r,e,l,a,b,y){const d=V("LoadingSpinner");return s(),n("div",nt,[t("div",lt,[e[8]||(e[8]=t("h5",{class:"mb-0"},"Company Locations",-1)),l.editMode?(s(),n("div",rt,[t("button",{class:"btn btn-success theme-btn-primary me-2",onClick:e[1]||(e[1]=(...i)=>a.saveLocations&&a.saveLocations(...i))},e[6]||(e[6]=[t("i",{class:"bi bi-check-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Save",-1)])),t("button",{class:"btn btn-secondary theme-btn-secondary",onClick:e[2]||(e[2]=i=>r.$emit("toggle-edit"))},e[7]||(e[7]=[t("i",{class:"bi bi-x-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Cancel",-1)]))])):(s(),n("button",{key:0,class:"btn btn-primary theme-btn-primary",onClick:e[0]||(e[0]=i=>r.$emit("toggle-edit"))},e[5]||(e[5]=[t("i",{class:"bi bi-pencil-fill me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Edit Locations",-1)])))]),t("div",dt,[l.loading?(s(),n("div",ct,[I(d,{message:"Loading locations..."})])):(s(),n("div",mt,[l.editMode?(s(),n("div",bt,[t("form",{onSubmit:e[4]||(e[4]=A((...i)=>a.saveLocations&&a.saveLocations(...i),["prevent"]))},[(s(!0),n(R,null,$(a.editableLocations,(i,v)=>(s(),n("div",{key:v,class:"location-item mb-3 p-3 border rounded"},[t("div",_t,[t("div",wt,[e[10]||(e[10]=t("label",{class:"form-label"},"Address",-1)),D(t("input",{type:"text",class:"form-control","onUpdate:modelValue":g=>i.company_address=g,required:""},null,8,Ct),[[P,i.company_address]])]),t("div",ht,[e[12]||(e[12]=t("label",{class:"form-label"},"Type",-1)),D(t("select",{class:"form-select","onUpdate:modelValue":g=>i.location_type=g,required:""},[e[11]||(e[11]=t("option",{value:"headquarters"},"Headquarters",-1)),a.companyType==="broiler"?(s(),n("option",Lt,"Supplier")):E("",!0),a.companyType==="slaughterhouse"?(s(),n("option",Et,"Slaughterhouse")):E("",!0),a.companyType==="sme"?(s(),n("option",Dt,"Kitchen")):E("",!0)],8,kt),[[te,i.location_type]])]),t("div",Pt,[t("button",{type:"button",class:"btn btn-danger btn-sm w-100",onClick:g=>a.removeLocation(v)},e[13]||(e[13]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Mt)])])]))),128)),t("div",St,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:e[3]||(e[3]=(...i)=>a.addNewLocation&&a.addNewLocation(...i))},e[14]||(e[14]=[t("i",{class:"fas fa-plus me-1"},null,-1),M(" Add Location ")]))]),t("div",Ft,[t("button",{type:"submit",class:"btn btn-success",disabled:a.saving},[e[15]||(e[15]=t("i",{class:"fas fa-save me-1"},null,-1)),e[16]||(e[16]=M(" Save Locations ")),a.saving?(s(),n("span",It)):E("",!0)],8,xt)])],32)])):(s(),n("div",ft,[l.locations.length===0?(s(),n("div",ut,e[9]||(e[9]=[t("i",{class:"fas fa-map-marker-alt text-muted mb-2",style:{"font-size":"2rem"}},null,-1),t("p",{class:"text-muted"},"No locations added yet",-1)]))):(s(),n("div",pt,[(s(!0),n(R,null,$(l.locations,(i,v)=>(s(),n("div",{key:i.locationID||v,class:"location-item mb-3 p-3 border rounded"},[t("div",yt,[t("div",null,[t("div",vt,j(i.company_address),1),t("div",gt,j(i.location_type),1)])])]))),128))]))]))]))])])}const Ut=z(st,[["render",Vt],["__scopeId","data-v-c688e7b1"]]),Tt={name:"ProfilePage",components:{ProfileInfo:Fe,CompanyLocations:Ut,CompanyCertifications:ot,LoadingSpinner:J},setup(){const r=se(),e=K(),l=p(!1),a=p(!1),b=()=>{ne.clearLocationsCache()},y=p(!0),d=p({}),i=p(!1),v=p(!1),g=p(!1),f=p(null),h=p(null),o=p(!0),C=p(!1),_=p(0),w=p(null),F=p(!1),U=p({current_password:"",new_password:"",new_password_confirmation:""}),B=p(!1),Y=N(()=>U.value.new_password!==U.value.new_password_confirmation),T=N(()=>d.value.role==="admin"),x=N(()=>{var c;return d.value.role==="admin"?{...d.value,company_name:(c=d.value.company)==null?void 0:c.company_name}:{...d.value}});q(x,c=>{T.value&&c.company_name?(d.value.company||(d.value.company={}),d.value.company.company_name=c.company_name):d.value.fullname=c.fullname,d.value.email=c.email,d.value.tel_number=c.tel_number},{deep:!0});const O=async()=>{try{y.value=!0;const c=await S.get("/api/profile");d.value=c,o.value=!!c.email_verified_at,e.commit("SET_EMAIL_VERIFIED",!!c.email_verified_at),y.value=!1}catch{y.value=!1,m.danger("Error","Failed to load profile data")}};q(()=>e.getters.emailVerified,c=>{o.value=c});const G=async()=>{try{F.value=!0;const c=await e.dispatch("sendVerificationEmail");m.success("Email Sent",c.message||"Verification link sent to your email address"),F.value=!1}catch{F.value=!1,m.danger("Error","Failed to send verification email")}},Q=c=>{const u=c.target.files[0];if(!u)return;if(!u.type.match("image.*")){m.danger("Invalid File","Please select an image file");return}if(u.size>2*1024*1024){m.danger("File Too Large","Image size should not exceed 2MB");return}T.value?h.value=u:f.value=u;const k=new FileReader;k.onload=L=>{T.value?d.value.company.company_image=L.target.result:d.value.image=L.target.result},k.readAsDataURL(u)},X=async()=>{var c;if(!x.value){m.danger("Error","Profile data is not available");return}try{const u=new FormData;u.append("email",x.value.email||""),u.append("tel_number",x.value.tel_number||""),T.value?(u.append("company_name",x.value.company_name||""),h.value&&u.append("company_image",h.value)):(u.append("fullname",x.value.fullname||""),f.value&&u.append("profile_image",f.value));const k={};for(let[H,W]of u.entries())k[H]=W instanceof File?`File: ${W.name}`:W;const L=await S.post("/api/profile/update",u,{headers:{"Content-Type":"multipart/form-data"}});if(L.user){const H={...L.user,company:L.company||((c=d.value)==null?void 0:c.company)};e.commit("SET_USER",H),f.value=null,h.value=null,i.value=!1,m.success("Success","Profile updated successfully"),setTimeout(()=>{O()},300)}else m.danger("Error","Failed to update profile: No user data returned")}catch{m.danger("Error","Failed to update profile")}},Z=async()=>{var c;if(!Y.value)try{B.value=!0,await S.post("/api/profile/password",U.value),U.value={current_password:"",new_password:"",new_password_confirmation:""},m.success("Success","Password updated successfully"),B.value=!1}catch(u){if(((c=u.response)==null?void 0:c.status)===422){const k=u.response.data.errors||{};let L="Invalid password data";k.current_password?L=k.current_password[0]:k.new_password?L=k.new_password[0]:k.new_password_confirmation&&(L=k.new_password_confirmation[0]),m.danger("Validation Error",L)}else m.danger("Error","Failed to update password");B.value=!1}},ee=async()=>{var c;try{if(C.value)return;if(!d.value.email){m.warning("Warning","Email address is required");return}C.value=!0,_.value=30,w.value=setInterval(()=>{_.value--,_.value<=0&&(clearInterval(w.value),C.value=!1)},1e3),await S.post("/api/password/forgot",{email:d.value.email}),m.success("Email Sent","Password reset link has been sent to your email")}catch(u){((c=u.response)==null?void 0:c.status)===429?m.warning("Rate Limited","Please wait before requesting another password reset email"):m.danger("Error","Failed to send password reset email")}};return oe(()=>{O(),r.query.verifyEmail==="true"&&m.warning("Email Verification Required","Please verify your email to access all features")}),{loading:y,profileData:d,formattedProfileData:x,editProfileMode:i,editLocationsMode:v,locationsLoading:g,editCertificationsMode:l,certificationsLoading:a,isAdmin:T,handleImageChange:Q,saveProfile:X,emailVerified:o,sendVerificationEmail:G,sendingVerification:F,passwordData:U,passwordLoading:B,passwordMismatch:Y,updatePassword:Z,sendPasswordResetEmail:ee,handleLocationUpdate:b,fetchProfileData:O,isResetEmailLoading:C,resetEmailTimer:_,resetEmailInterval:w}}},Nt={class:"profile-page"},At={key:0,class:"alert alert-warning mb-4"},qt={class:"d-flex align-items-center"},Bt=["disabled"],Rt={key:0},$t={key:1},jt={class:"row"},zt={class:"col-lg-8"},Jt={class:"mb-4"},Ot={key:0,class:"mb-4"},Ht={key:1,class:"mb-4"},Wt={class:"col-lg-4"},Yt={class:"card mb-4"},Kt={class:"card-body"},Gt={class:"mb-4"},Qt={class:"d-flex align-items-center"},Xt={key:0,class:"text-success"},Zt={key:1,class:"text-warning"},ea=["value"],ta={class:"mb-3"},aa={class:"form-text"},ia={class:"mb-3"},oa={class:"mb-3"},sa={key:0,class:"form-text text-danger"},na=["disabled"];function la(r,e,l,a,b,y){var f,h;const d=V("LoadingSpinner"),i=V("ProfileInfo"),v=V("CompanyLocations"),g=V("CompanyCertifications");return s(),n("div",Nt,[e[23]||(e[23]=t("h1",{class:"mb-4"},"My Profile",-1)),a.emailVerified?E("",!0):(s(),n("div",At,[t("div",qt,[e[13]||(e[13]=t("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),e[14]||(e[14]=t("div",null,[t("strong",null,"Your email is not verified."),t("p",{class:"mb-0"},"Please verify your email to access all features of the application.")],-1)),t("button",{class:"btn btn-sm btn-primary ms-auto",onClick:e[0]||(e[0]=(...o)=>a.sendVerificationEmail&&a.sendVerificationEmail(...o)),disabled:a.sendingVerification},[a.sendingVerification?(s(),n("span",Rt,[I(d,{size:"sm"}),e[12]||(e[12]=M(" Sending... "))])):(s(),n("span",$t,"Send Verification Email"))],8,Bt)])])),t("div",jt,[t("div",zt,[t("div",Jt,[I(i,{profileData:a.formattedProfileData,profileImage:a.isAdmin?(f=a.profileData.company)==null?void 0:f.company_image:a.profileData.image,editMode:a.editProfileMode,loading:a.loading,onToggleEdit:e[1]||(e[1]=o=>a.editProfileMode=!a.editProfileMode),onSave:a.saveProfile,onImageChange:a.handleImageChange},null,8,["profileData","profileImage","editMode","loading","onSave","onImageChange"])]),a.isAdmin?(s(),n("div",Ot,[I(v,{locations:a.profileData.locations,"onUpdate:locations":e[2]||(e[2]=o=>a.profileData.locations=o),loading:a.locationsLoading,editMode:a.editLocationsMode,onLoading:e[3]||(e[3]=o=>a.locationsLoading=o),onToggleEdit:e[4]||(e[4]=o=>a.editLocationsMode=!a.editLocationsMode),onLocationUpdated:a.handleLocationUpdate},null,8,["locations","loading","editMode","onLocationUpdated"])])):E("",!0),a.isAdmin&&((h=a.profileData.company)==null?void 0:h.company_type)!=="admin"?(s(),n("div",Ht,[I(g,{certifications:a.profileData.certifications||[],"edit-mode":a.editCertificationsMode,loading:a.certificationsLoading,onToggleEdit:e[5]||(e[5]=o=>a.editCertificationsMode=!a.editCertificationsMode),onLoading:e[6]||(e[6]=o=>a.certificationsLoading=o),onRefreshData:a.fetchProfileData},null,8,["certifications","edit-mode","loading","onRefreshData"])])):E("",!0)]),t("div",Wt,[t("div",Yt,[e[22]||(e[22]=t("div",{class:"card-header theme-header"},[t("h5",{class:"mb-0"},"Security")],-1)),t("div",Kt,[t("div",Gt,[e[17]||(e[17]=t("h6",null,"Email Verification",-1)),t("div",Qt,[a.emailVerified?(s(),n("span",Xt,e[15]||(e[15]=[t("i",{class:"bi bi-check-circle-fill me-2"},null,-1),M(" Verified ")]))):(s(),n("span",Zt,e[16]||(e[16]=[t("i",{class:"bi bi-exclamation-circle-fill me-2"},null,-1),M(" Not Verified ")])))])]),t("form",{onSubmit:e[11]||(e[11]=A((...o)=>a.updatePassword&&a.updatePassword(...o),["prevent"]))},[t("input",{type:"text",name:"username",value:a.profileData.email,autocomplete:"username",style:{display:"none"},readonly:""},null,8,ea),t("div",ta,[e[18]||(e[18]=t("label",{for:"current-password",class:"form-label"},"Current Password",-1)),D(t("input",{type:"password",class:"form-control",id:"current-password","onUpdate:modelValue":e[7]||(e[7]=o=>a.passwordData.current_password=o),autocomplete:"current-password",required:""},null,512),[[P,a.passwordData.current_password]]),t("div",aa,[t("a",{href:"#",onClick:e[8]||(e[8]=A((...o)=>a.sendPasswordResetEmail&&a.sendPasswordResetEmail(...o),["prevent"])),class:ae(["text-primary",{disabled:a.isResetEmailLoading}])},j(a.isResetEmailLoading?`Please wait (${a.resetEmailTimer}s)`:"Forgot your password?"),3)])]),t("div",ia,[e[19]||(e[19]=t("label",{for:"new-password",class:"form-label"},"New Password",-1)),D(t("input",{type:"password",class:"form-control",id:"new-password","onUpdate:modelValue":e[9]||(e[9]=o=>a.passwordData.new_password=o),autocomplete:"new-password",required:"",minlength:"8"},null,512),[[P,a.passwordData.new_password]])]),t("div",oa,[e[20]||(e[20]=t("label",{for:"confirm-password",class:"form-label"},"Confirm Password",-1)),D(t("input",{type:"password",class:"form-control",id:"confirm-password","onUpdate:modelValue":e[10]||(e[10]=o=>a.passwordData.new_password_confirmation=o),autocomplete:"new-password",required:""},null,512),[[P,a.passwordData.new_password_confirmation]]),a.passwordMismatch?(s(),n("div",sa," Passwords do not match ")):E("",!0)]),t("button",{type:"submit",class:"btn btn-primary w-100",disabled:a.passwordLoading||a.passwordMismatch},[a.passwordLoading?(s(),ie(d,{key:0,size:"sm"})):E("",!0),e[21]||(e[21]=M(" Update Password "))],8,na)],32)])])])])])}const fa=z(Tt,[["render",la],["__scopeId","data-v-36e4af54"]]);export{fa as default};
