import{_ as C,c as n,a as e,f as F,g as S,d as b,w as g,b as f,v as y,t as h,e as _,r,x as q,y as E,D as N,z as R,u as D,o as t}from"./main-BpaYbEPg.js";import{L as U}from"./LoginLeftPanel-B-QNyV8a.js";const B={name:"ResetPasswordPage",components:{LoginLeftPanel:U},setup(){const m=D(),s=N(),l=r(""),o=r(""),i=r(""),d=r(""),p=r(!0),a=r(!1),w=r(null),k=r(null),c=r(!1),V=["Create a new password","Secure your account","Get back to your Halal network","We're here to help"],P=q(()=>i.value&&d.value&&i.value!==d.value);return E(async()=>{if(l.value=s.query.token||"",o.value=s.query.email||"",!l.value||!o.value){p.value=!1,c.value=!1;return}try{const u=await R.post("/api/password/validate-token",{token:l.value,email:o.value});c.value=u.valid}catch(u){console.error("Token validation error:",u),c.value=!1}finally{p.value=!1}}),{token:l,email:o,password:i,password_confirmation:d,loading:p,submitLoading:a,error:w,successMessage:k,isValidToken:c,animatedTexts:V,passwordMismatch:P,handleResetPassword:async()=>{var u,x,T,L;if(!P.value){a.value=!0,w.value=null,k.value=null;try{await R.post("/api/password/reset",{token:l.value,email:o.value,password:i.value,password_confirmation:d.value}),k.value="Your password has been reset successfully. You can now login with your new password.",i.value="",d.value="",setTimeout(()=>{m.push({name:"Login"})},3e3)}catch(v){if(console.error("Password reset error:",v),(x=(u=v.response)==null?void 0:u.data)!=null&&x.errors){const M=Object.values(v.response.data.errors).flat().join(`
`);w.value=M}else w.value=((L=(T=v.response)==null?void 0:T.data)==null?void 0:L.message)||"Failed to reset password. Please try again."}finally{a.value=!1}}},goToLogin:()=>{m.push({name:"Login"})},goToForgotPassword:()=>{m.push({name:"ForgotPassword"})}}}},Y={class:"login-container"},j={class:"login-card"},I={class:"right-panel"},O={key:0,class:"text-center py-4"},W={key:1,class:"alert alert-danger",role:"alert"},z={class:"mb-0"},A={class:"mb-3"},G={class:"mb-3"},H={key:0,class:"form-text text-danger"},J={key:0,class:"alert alert-danger",role:"alert"},K={key:1,class:"alert alert-success",role:"alert"},Q=["disabled"],X={key:0,class:"spinner-border spinner-border-sm me-2",role:"status"},Z={class:"text-center signup-link"};function $(m,s,l,o,i,d){const p=S("login-left-panel");return t(),n("div",Y,[e("div",j,[F(p,{texts:o.animatedTexts},null,8,["texts"]),e("div",I,[s[16]||(s[16]=e("h2",null,"Reset Your Password",-1)),s[17]||(s[17]=e("p",null,"Create a new password for your account",-1)),o.loading?(t(),n("div",O,s[7]||(s[7]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Verifying your reset link...",-1)]))):o.isValidToken?(t(),n("form",{key:2,onSubmit:s[6]||(s[6]=b((...a)=>o.handleResetPassword&&o.handleResetPassword(...a),["prevent"])),class:"w-100"},[g(e("input",{type:"hidden","onUpdate:modelValue":s[1]||(s[1]=a=>o.token=a)},null,512),[[y,o.token]]),g(e("input",{type:"hidden","onUpdate:modelValue":s[2]||(s[2]=a=>o.email=a)},null,512),[[y,o.email]]),e("div",A,[s[11]||(s[11]=e("label",{for:"password",class:"form-label"},"New Password",-1)),g(e("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":s[3]||(s[3]=a=>o.password=a),placeholder:"Enter your new password",required:"",minlength:"8"},null,512),[[y,o.password]]),s[12]||(s[12]=e("div",{class:"form-text"},"Password must be at least 8 characters long",-1))]),e("div",G,[s[13]||(s[13]=e("label",{for:"password_confirmation",class:"form-label"},"Confirm Password",-1)),g(e("input",{type:"password",class:"form-control",id:"password_confirmation","onUpdate:modelValue":s[4]||(s[4]=a=>o.password_confirmation=a),placeholder:"Confirm your new password",required:""},null,512),[[y,o.password_confirmation]]),o.passwordMismatch?(t(),n("div",H," Passwords do not match ")):f("",!0)]),o.error?(t(),n("div",J,h(o.error),1)):f("",!0),o.successMessage?(t(),n("div",K,h(o.successMessage),1)):f("",!0),e("button",{type:"submit",class:"login-btn",disabled:o.submitLoading||o.passwordMismatch||!o.password||!o.password_confirmation},[o.submitLoading?(t(),n("span",X)):f("",!0),s[14]||(s[14]=_(" RESET PASSWORD "))],8,Q),e("div",Z,[e("p",null,[s[15]||(s[15]=_("Remember your password? ")),e("a",{href:"#",onClick:s[5]||(s[5]=b((...a)=>o.goToLogin&&o.goToLogin(...a),["prevent"]))},"Login")])])],32)):(t(),n("div",W,[s[8]||(s[8]=e("h4",{class:"alert-heading"},"Invalid or Expired Link",-1)),s[9]||(s[9]=e("p",null,"The password reset link is invalid or has expired.",-1)),s[10]||(s[10]=e("hr",null,null,-1)),e("p",z,[e("a",{href:"#",onClick:s[0]||(s[0]=b((...a)=>o.goToForgotPassword&&o.goToForgotPassword(...a),["prevent"]))},"Request a new password reset link")])]))])])])}const ns=C(B,[["render",$],["__scopeId","data-v-ad5cdfb7"]]);export{ns as default};
