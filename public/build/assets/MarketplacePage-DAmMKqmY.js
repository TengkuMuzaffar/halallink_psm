import{_ as Q,c as d,a as e,w as F,v as R,d as W,e as b,J as K,F as J,i as z,b as h,o as c,t as g,C as L,g as V,f as Y,r as y,A as tt,B as $,K as et,O as Z,m as at}from"./main-6TRAM3lj.js";import{m as f}from"./marketplaceService-CktxYDrS.js";import{m as M}from"./modal-CNQBRbiU.js";import{L as nt}from"./LoadingSpinner-Bs7tkB0U.js";const it={name:"SearchFilterBar",props:{poultryTypes:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},initialPoultryType:{type:[String,Number],default:""},initialSortBy:{type:String,default:"newest"},initialMinPrice:{type:[Number,String],default:""},initialMaxPrice:{type:[Number,String],default:""}},data(){return{searchText:this.initialSearchQuery,selectedType:this.initialPoultryType,sortOption:this.initialSortBy,minPrice:this.initialMinPrice,maxPrice:this.initialMaxPrice}},methods:{onSearchInput(){this.$emit("search-input",this.searchText)},onSearchClick(){this.$emit("search-click",this.searchText)},onFilterChange(){this.$emit("filter-change",{poultryType:this.selectedType,sortBy:this.sortOption,minPrice:this.minPrice,maxPrice:this.maxPrice})},resetPriceFilter(){this.minPrice="",this.maxPrice="",this.onFilterChange()}}},ot={class:"card mb-4 search-filter-card"},rt={class:"card-body"},st={class:"row g-3"},lt={class:"col-md-6"},ct={class:"input-group"},dt={class:"col-md-6"},ut={class:"d-flex gap-2 justify-content-md-end"},mt=["value"],vt={class:"row mt-3"},gt={class:"col-12"},yt={class:"price-filter-container"},pt={class:"price-filter-header"},ft={class:"price-range-inputs"},bt={class:"price-input-group"},ht={class:"price-input-wrapper"},Ct={class:"price-input-group"},_t={class:"price-input-wrapper"};function Pt(m,t,n,a,s,l){return c(),d("div",ot,[e("div",rt,[e("div",st,[e("div",lt,[e("div",ct,[F(e("input",{type:"text",class:"form-control",placeholder:"Search products...","onUpdate:modelValue":t[0]||(t[0]=r=>s.searchText=r),onInput:t[1]||(t[1]=(...r)=>l.onSearchInput&&l.onSearchInput(...r))},null,544),[[R,s.searchText]]),e("button",{class:"btn btn-primary",type:"button",onClick:t[2]||(t[2]=W((...r)=>l.onSearchClick&&l.onSearchClick(...r),["prevent"]))},t[13]||(t[13]=[e("i",{class:"fas fa-search"},null,-1),b(" Search ")]))])]),e("div",dt,[e("div",ut,[F(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=r=>s.selectedType=r),onChange:t[4]||(t[4]=(...r)=>l.onFilterChange&&l.onFilterChange(...r))},[t[14]||(t[14]=e("option",{value:""},"All Poultry Types",-1)),(c(!0),d(J,null,z(n.poultryTypes,r=>(c(),d("option",{key:r.poultryID,value:r.poultryID},g(r.poultry_name),9,mt))),128))],544),[[K,s.selectedType]]),F(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=r=>s.sortOption=r),onChange:t[6]||(t[6]=(...r)=>l.onFilterChange&&l.onFilterChange(...r))},t[15]||(t[15]=[e("option",{value:"newest"},"Newest First",-1),e("option",{value:"price_low"},"Price: Low to High",-1),e("option",{value:"price_high"},"Price: High to Low",-1)]),544),[[K,s.sortOption]])])])]),e("div",vt,[e("div",gt,[e("div",yt,[e("div",pt,[t[17]||(t[17]=e("span",{class:"price-filter-label"},"Price Range",-1)),s.minPrice||s.maxPrice?(c(),d("button",{key:0,class:"btn btn-sm btn-link text-secondary p-0 ms-2",onClick:t[7]||(t[7]=(...r)=>l.resetPriceFilter&&l.resetPriceFilter(...r)),title:"Reset price filter"},t[16]||(t[16]=[e("i",{class:"fas fa-undo-alt"},null,-1),b(" Reset ")]))):h("",!0)]),e("div",ft,[e("div",bt,[e("div",ht,[t[18]||(t[18]=e("span",{class:"price-currency"},"$",-1)),F(e("input",{type:"number",class:"form-control price-input",placeholder:"Min","onUpdate:modelValue":t[8]||(t[8]=r=>s.minPrice=r),min:"0",onChange:t[9]||(t[9]=(...r)=>l.onFilterChange&&l.onFilterChange(...r))},null,544),[[R,s.minPrice,void 0,{number:!0}]])])]),t[20]||(t[20]=e("div",{class:"price-range-separator"},[e("span",null,"-")],-1)),e("div",Ct,[e("div",_t,[t[19]||(t[19]=e("span",{class:"price-currency"},"$",-1)),F(e("input",{type:"number",class:"form-control price-input",placeholder:"Max","onUpdate:modelValue":t[10]||(t[10]=r=>s.maxPrice=r),min:"0",onChange:t[11]||(t[11]=(...r)=>l.onFilterChange&&l.onFilterChange(...r))},null,544),[[R,s.maxPrice,void 0,{number:!0}]])])]),e("button",{class:"btn btn-sm btn-outline-primary apply-price-btn",onClick:t[12]||(t[12]=(...r)=>l.onFilterChange&&l.onFilterChange(...r))}," Apply ")])])])])])])}const kt=Q(it,[["render",Pt],["__scopeId","data-v-bc0d9aef"]]),wt={name:"ProductCard",props:{product:{type:Object,required:!0}},methods:{formatPrice(m){return parseFloat(m).toFixed(2)},getStockClass(m){return m<=5?"text-danger":m<=20?"text-warning":"text-success"}}},xt={class:"card h-100 product-card"},It={class:"product-image-container"},Et=["src","alt"],St={class:"card-body d-flex flex-column"},Tt=["title"],Mt={class:"card-text product-price mb-2"},Ft={class:"card-text product-measurement mb-2"},Ut={class:"card-text product-stock mb-2"},Lt=["title"],Dt=["title"],Nt={class:"mt-auto"};function qt(m,t,n,a,s,l){return c(),d("div",xt,[e("div",It,[e("img",{src:n.product.image||"/images/no-image.jpg",alt:n.product.name,class:"product-image"},null,8,Et)]),e("div",St,[e("h5",{class:"card-title product-title",title:n.product.name},g(n.product.name),9,Tt),e("p",Mt," RM "+g(l.formatPrice(n.product.price)),1),e("p",Ft,g(n.product.measurement_value)+" "+g(n.product.unit),1),e("p",Ut,[t[1]||(t[1]=e("span",{class:"stock-label"},"Stock:",-1)),e("span",{class:L(l.getStockClass(n.product.quantity))},g(n.product.quantity)+" available ",3)]),e("p",{class:"card-text product-seller mb-2",title:n.product.seller},[t[2]||(t[2]=e("i",{class:"fas fa-store me-1"},null,-1)),b(g(n.product.seller),1)],8,Lt),e("p",{class:"card-text product-location mb-3",title:n.product.location},[t[3]||(t[3]=e("i",{class:"fas fa-map-marker-alt me-1"},null,-1)),b(g(n.product.location),1)],8,Dt),e("div",Nt,[e("button",{class:"btn btn-primary w-100",onClick:t[0]||(t[0]=r=>m.$emit("add-to-cart",n.product))},t[4]||(t[4]=[e("i",{class:"fas fa-cart-plus me-1"},null,-1),b(" Add to Cart ")]))])])])}const At=Q(wt,[["render",qt],["__scopeId","data-v-8ee5db1a"]]),Bt={name:"ProductGrid",components:{ProductCard:At},props:{products:{type:Array,required:!0},loading:{type:Boolean,default:!1},error:{type:[String,null],default:null}}},Vt={key:0,class:"row g-4"},Qt={key:1,class:"text-center py-5"};function Ot(m,t,n,a,s,l){const r=V("ProductCard");return c(),d("div",null,[!n.loading&&!n.error?(c(),d("div",Vt,[(c(!0),d(J,null,z(n.products,i=>(c(),d("div",{key:i.id,class:"col-sm-6 col-md-4 col-xl-3"},[Y(r,{product:i,onAddToCart:C=>m.$emit("add-to-cart",i)},null,8,["product","onAddToCart"])]))),128))])):h("",!0),!n.loading&&!n.error&&n.products.length===0?(c(),d("div",Qt,t[0]||(t[0]=[e("div",{class:"alert alert-info"}," No products found. Try adjusting your search criteria. ",-1)]))):h("",!0)])}const jt=Q(Bt,[["render",Ot]]),Rt={name:"MarketplacePagination",props:{currentPage:{type:Number,required:!0},lastPage:{type:Number,required:!0},from:{type:Number,default:null},to:{type:Number,default:null},total:{type:Number,default:null},itemCount:{type:Number,default:0},loading:{type:Boolean,default:!1}},computed:{paginationRange(){let m=5;window.innerWidth<768?m=3:window.innerWidth<992&&(m=4),window.innerWidth<400&&(m=3);let t=1,n=this.lastPage;if(this.lastPage>m){const s=Math.floor(m/2);this.currentPage<=s?n=m:this.currentPage>this.lastPage-s?t=this.lastPage-m+1:(t=this.currentPage-s,n=this.currentPage+s),t=Math.max(1,t),n=Math.min(this.lastPage,n)}const a=[];for(let s=t;s<=n;s++)a.push(s);return a}},methods:{onPageChange(m){m<1||m>this.lastPage||this.loading||this.$emit("page-change",m)}},mounted(){window.addEventListener("resize",this.$forceUpdate)},beforeUnmount(){window.removeEventListener("resize",this.$forceUpdate)}},Jt={class:"pagination-container mt-4"},zt={class:"pagination-info"},Gt={class:"text-muted"},Ht={key:0,"aria-label":"Product pagination",class:"pagination-nav"},Wt={class:"pagination mb-0"},Yt=["onClick"];function Kt(m,t,n,a,s,l){return c(),d("div",Jt,[e("div",zt,[e("span",Gt,"Showing "+g(n.from||1)+"-"+g(n.to||n.itemCount)+" of "+g(n.total||n.itemCount),1)]),n.lastPage>1?(c(),d("nav",Ht,[e("ul",Wt,[e("li",{class:L(["page-item",{disabled:n.currentPage<=1||n.loading}])},[e("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=W(r=>!n.loading&&l.onPageChange(n.currentPage-1),["prevent"]))},t[2]||(t[2]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(c(!0),d(J,null,z(l.paginationRange,r=>(c(),d("li",{key:r,class:L(["page-item",{active:r===n.currentPage,disabled:n.loading,"page-number":!0}])},[e("a",{class:"page-link",href:"#",onClick:W(i=>!n.loading&&l.onPageChange(r),["prevent"])},g(r),9,Yt)],2))),128)),e("li",{class:L(["page-item",{disabled:n.currentPage>=n.lastPage||n.loading}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=W(r=>!n.loading&&l.onPageChange(n.currentPage+1),["prevent"]))},t[3]||(t[3]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])):h("",!0)])}const Xt=Q(Rt,[["render",Kt],["__scopeId","data-v-b5f8635e"]]),Zt={name:"CartModal",components:{LoadingSpinner:nt},setup(){const m=y(!1),t=y(!1),n=y(null),a=y(1),s=y([]),l=y([]),r=y(!1),i=y(!1),C=y(null),p=y(null),_=y([]),P=y(""),k=y(!1),I=y(!1),D=tt(()=>s.value.reduce((o,v)=>o+v.price_at_purchase*v.quantity,0)),T=()=>{const o=document.getElementById("addToCartModal");o&&(C.value=new Z(o),o.addEventListener("hidden.bs.modal",()=>{a.value=1,n.value=null,document.activeElement&&o.contains(document.activeElement)&&document.activeElement.blur()}),o.addEventListener("hide.bs.modal",()=>{document.activeElement&&o.contains(document.activeElement)&&document.activeElement.blur()}));const v=document.getElementById("viewCartModal");v&&(p.value=new Z(v),v.addEventListener("hidden.bs.modal",()=>{document.activeElement&&v.contains(document.activeElement)&&document.activeElement.blur()}),v.addEventListener("hide.bs.modal",()=>{document.activeElement&&v.contains(document.activeElement)&&document.activeElement.blur()}))},N=o=>{n.value=o,a.value=1,C.value||T(),C.value.show()},q=async()=>{try{const o=await f.getCartItems();o&&Array.isArray(o.cart_items)?(s.value=o.cart_items,l.value=JSON.parse(JSON.stringify(o.cart_items))):(s.value=[],l.value=[],console.warn("Cart items data is not in the expected format:",o)),r.value=!1,U(),I.value=!1,p.value||T(),p.value.show()}catch(o){console.error("Error fetching cart items:",o),s.value=[],l.value=[],p.value||T(),p.value.show()}},U=async()=>{k.value=!0;try{const o=await f.fetchUserLocations(),v=Array.isArray(o)?o.filter(x=>x.location_type==="kitchen"):[];_.value=v,_.value.length===1&&(P.value=_.value[0].locationID)}catch(o){console.error("Error loading locations:",o),_.value=[]}finally{k.value=!1}};return{selectedProduct:n,quantity:a,cartItems:s,cartTotal:D,isEditing:r,isLoading:i,isProcessingCheckout:m,isPaymentProcessing:t,locations:_,selectedLocationID:P,isLoadingLocations:k,locationError:I,showAddToCartModal:N,showViewCartModal:q,decreaseQuantity:()=>{a.value>1&&a.value--},increaseQuantity:()=>{a.value<99&&a.value++},decreaseCartItemQuantity:o=>{o.quantity>1&&o.quantity--},increaseCartItemQuantity:o=>{o.quantity<99&&o.quantity++},startEditing:()=>{r.value=!0},cancelEditing:()=>{s.value=JSON.parse(JSON.stringify(l.value)),r.value=!1},saveChanges:async()=>{try{i.value=!0;const o=s.value.map(async x=>{const B=l.value.find(H=>H.cartID===x.cartID);if(B&&B.quantity!==x.quantity)try{await f.updateCartItem(x.cartID,x.quantity)}catch(H){throw console.error(`Error updating item ${x.cartID}:`,H),H}});await Promise.all(o);const v=await f.getCartItems();v&&Array.isArray(v.cart_items)&&(s.value=v.cart_items,l.value=JSON.parse(JSON.stringify(v.cart_items))),f.notifyCartUpdate(v),r.value=!1,i.value=!1}catch{i.value=!1}},confirmAddToCart:async()=>{try{if(!n.value){console.error("No product selected");return}if(!a.value||a.value<1){console.error("Invalid quantity:",a.value),M.danger("Error","Please enter a valid quantity.");return}const o=n.value.itemID||n.value.id;if(!o){console.error("Invalid product ID:",n.value),M.danger("Error","Invalid product information. Please try again.");return}const v={...n.value,itemID:o,order_quantity:a.value},x=await f.addToCart(v,{suppressErrorModal:!0});C.value.hide();try{const B=await f.getCartItems();f.notifyCartUpdate(B)}catch(B){console.warn("Error refreshing cart count:",B)}f.animateCartButton()}catch(o){if(console.error("Error adding to cart:",o),o.response&&o.response.status===422){const v=o.response.data.errors;if(console.error("Validation errors:",v),v){const x=Object.values(v).flat().join(`
`);M.danger("Validation Error",x)}else M.danger("Error","Failed to add item to cart. Please try again.")}else if(o.response&&o.response.data){const v=o.response.data;M.danger("Error",v.error||v.message||"Failed to add item to cart. Please try again.")}else M.danger("Error","Failed to add item to cart. Please try again.")}},updateCartItem:async o=>{},removeCartItem:async o=>{try{await f.removeCartItem(o,{suppressErrorModal:!0});const v=await f.getCartItems();s.value=v.cart_items||[],l.value=JSON.parse(JSON.stringify(s.value)),f.notifyCartUpdate(v),r.value=!1,i.value=!1}catch(v){console.error("Error removing cart item:",v),M.danger("Error","Failed to remove item from cart. Please try again.")}},proceedToCheckout:async()=>{try{if(!P.value){I.value="Please select a delivery location";return}I.value="",m.value=!0,t.value=!0,await f.checkout(P.value)}catch(o){console.error("Checkout error:",o),t.value=!1,p.value&&p.value.hide(),M.danger("Checkout Error",o.message||"Unable to process payment. Please try again.",{onHidden:()=>{p.value&&p.value.show()}})}finally{m.value=!1}},formatPrice:o=>parseFloat(o).toFixed(2),loadLocations:U,isItemUnavailable:o=>!o.item||!o.item.poultry||!o.item.location||o.item.deleted_at||o.item.location.deleted_at}}},$t={class:"cart-modal-container"},te={class:"modal fade",id:"addToCartModal",tabindex:"-1"},ee={class:"modal-dialog modal-dialog-centered"},ae={class:"modal-content"},ne={class:"modal-body"},ie={key:0,class:"add-to-cart-item"},oe=["src","alt"],re={class:"add-to-cart-details"},se={class:"add-to-cart-title"},le={class:"add-to-cart-price"},ce={class:"add-to-cart-seller"},de={class:"add-to-cart-location"},ue={class:"text-center mt-4"},me={class:"input-group quantity-input"},ve={class:"modal-footer"},ge={class:"modal fade",id:"viewCartModal",tabindex:"-1"},ye={class:"modal-dialog modal-dialog-centered modal-lg"},pe={class:"modal-content"},fe={class:"modal-header"},be={class:"modal-title"},he={class:"modal-body position-relative"},Ce={key:1,class:"text-center py-4"},_e={key:2},Pe={class:"d-flex"},ke=["src","alt"],we={class:"cart-item-details flex-grow-1"},xe={class:"d-flex align-items-center"},Ie={class:"cart-item-title mb-0"},Ee={key:0,class:"badge bg-danger ms-2"},Se={key:0,class:"text-danger mb-1 mt-1"},Te={class:"cart-item-price"},Me={class:"cart-item-seller"},Fe={class:"cart-item-location"},Ue={class:"d-flex flex-column align-items-end"},Le={class:"input-group cart-item-quantity mb-2"},De=["onClick","disabled"],Ne=["onUpdate:modelValue","disabled"],qe=["onClick","disabled"],Ae=["onClick"],Be={class:"cart-total"},Ve={class:"d-flex justify-content-between align-items-center mb-2"},Qe={class:"mb-0"},Oe={class:"delivery-location mt-4 p-3 border rounded bg-light"},je={key:0,class:"text-center py-2"},Re={key:1,class:"alert alert-warning"},Je={key:2,class:"form-group"},ze=["value"],Ge={key:0,class:"invalid-feedback"},He={class:"modal-footer"},We=["disabled"],Ye={key:0,class:"payment-processing-overlay"};function Ke(m,t,n,a,s,l){const r=V("loading-spinner");return c(),d("div",$t,[e("div",te,[e("div",ee,[e("div",ae,[t[13]||(t[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Add to Cart"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",ne,[a.selectedProduct?(c(),d("div",ie,[e("img",{src:a.selectedProduct.image||"/images/no-image.jpg",alt:a.selectedProduct.name,class:"add-to-cart-image"},null,8,oe),e("div",re,[e("h5",se,g(a.selectedProduct.name),1),e("p",le,"RM "+g(a.formatPrice(a.selectedProduct.price)),1),e("p",ce,[t[9]||(t[9]=e("i",{class:"bi bi-shop me-1"},null,-1)),b(g(a.selectedProduct.seller||"Unknown Seller"),1)]),e("p",de,[t[10]||(t[10]=e("i",{class:"bi bi-geo-alt me-1"},null,-1)),b(g(a.selectedProduct.location||"Unknown Location"),1)])])])):h("",!0),e("div",ue,[t[11]||(t[11]=e("label",{for:"quantity-input",class:"form-label"},"Quantity:",-1)),e("div",me,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[0]||(t[0]=(...i)=>a.decreaseQuantity&&a.decreaseQuantity(...i))},"-"),F(e("input",{type:"number",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=i=>a.quantity=i),min:"1",max:"99"},null,512),[[R,a.quantity,void 0,{number:!0}]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[2]||(t[2]=(...i)=>a.increaseQuantity&&a.increaseQuantity(...i))},"+")])])]),e("div",ve,[t[12]||(t[12]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=(...i)=>a.confirmAddToCart&&a.confirmAddToCart(...i)),ref:"addToCartButton"},"Add to Cart",512)])])])]),e("div",ge,[e("div",ye,[e("div",pe,[e("div",fe,[e("h5",be,"Your Cart ("+g(a.cartItems.length)+" items)",1),t[14]||(t[14]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",he,[a.isLoading?(c(),$(r,{key:0,message:"Saving changes...",size:"lg",overlay:!0})):h("",!0),a.cartItems.length===0?(c(),d("div",Ce,t[15]||(t[15]=[e("i",{class:"bi bi-cart3",style:{"font-size":"3rem",color:"#ccc"}},null,-1),e("p",{class:"mt-3"},"Your cart is empty",-1)]))):(c(),d("div",_e,[(c(!0),d(J,null,z(a.cartItems,i=>{var C,p,_,P,k,I,D,T,N,q,U,O,j,A;return c(),d("div",{key:i.cartID,class:L(["cart-item",{"unavailable-item":a.isItemUnavailable(i)}])},[e("div",Pe,[e("img",{src:(C=i.item)!=null&&C.image?`/storage/${i.item.image}`:(_=(p=i.item)==null?void 0:p.poultry)!=null&&_.poultry_image?`/storage/${i.item.poultry.poultry_image}`:"/images/no-image.jpg",alt:((k=(P=i.item)==null?void 0:P.poultry)==null?void 0:k.poultry_name)||"Product",class:L(["cart-item-image",{"unavailable-image":a.isItemUnavailable(i)}])},null,10,ke),e("div",we,[e("div",xe,[e("h6",Ie,g(((D=(I=i.item)==null?void 0:I.poultry)==null?void 0:D.poultry_name)||"Product")+" ("+g(((T=i.item)==null?void 0:T.measurement_value)||0)+" "+g(((N=i.item)==null?void 0:N.measurement_type)||"units")+")",1),a.isItemUnavailable(i)?(c(),d("span",Ee,"Unavailable")):h("",!0)]),a.isItemUnavailable(i)?(c(),d("p",Se,t[16]||(t[16]=[e("i",{class:"bi bi-exclamation-triangle-fill me-1"},null,-1),b(" This item is no longer available and will be removed at checkout ")]))):h("",!0),e("p",Te,"RM "+g(a.formatPrice(i.price_at_purchase)),1),e("p",Me,[t[17]||(t[17]=e("i",{class:"bi bi-shop me-1"},null,-1)),b(g(((O=(U=(q=i.item)==null?void 0:q.user)==null?void 0:U.company)==null?void 0:O.company_name)||"Unknown Seller"),1)]),e("p",Fe,[t[18]||(t[18]=e("i",{class:"bi bi-geo-alt me-1"},null,-1)),b(g(((A=(j=i.item)==null?void 0:j.location)==null?void 0:A.company_address)||"Unknown Location"),1)])]),e("div",Ue,[e("div",Le,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:E=>a.decreaseCartItemQuantity(i),disabled:!a.isEditing||a.isItemUnavailable(i)},"-",8,De),F(e("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":E=>i.quantity=E,min:"1",max:"99",disabled:!a.isEditing||a.isItemUnavailable(i)},null,8,Ne),[[R,i.quantity,void 0,{number:!0}]]),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:E=>a.increaseCartItemQuantity(i),disabled:!a.isEditing||a.isItemUnavailable(i)},"+",8,qe)]),e("button",{class:"btn btn-sm btn-outline-danger",onClick:E=>a.removeCartItem(i.cartID)},t[19]||(t[19]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Ae)])])],2)}),128)),e("div",Be,[e("div",Ve,[t[20]||(t[20]=e("h5",{class:"mb-0"},"Total:",-1)),e("h5",Qe,"RM "+g(a.formatPrice(a.cartTotal)),1)]),t[21]||(t[21]=e("div",{class:"toyyibpay-notice mt-2 mb-3"},[e("i",{class:"bi bi-info-circle me-1"}),b(" A processing fee of RM1.00 will be charged by ToyyibPay during checkout. ")],-1))]),e("div",Oe,[t[26]||(t[26]=e("h6",{class:"mb-3"},[e("i",{class:"bi bi-geo-alt me-2"}),b("Delivery Location")],-1)),a.isLoadingLocations?(c(),d("div",je,t[22]||(t[22]=[e("div",{class:"spinner-border spinner-border-sm text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("span",{class:"ms-2"},"Loading locations...",-1)]))):a.locations.length===0?(c(),d("div",Re,t[23]||(t[23]=[e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1),b(" No delivery locations found. Please add a location in your profile settings. ")]))):(c(),d("div",Je,[t[25]||(t[25]=e("label",{for:"deliveryLocation",class:"form-label"},"Select delivery location:",-1)),F(e("select",{id:"deliveryLocation","onUpdate:modelValue":t[4]||(t[4]=i=>a.selectedLocationID=i),class:L(["form-select",{"is-invalid":a.locationError}])},[t[24]||(t[24]=e("option",{value:"",disabled:"",selected:""},"-- Select a delivery location --",-1)),(c(!0),d(J,null,z(a.locations,i=>(c(),d("option",{key:i.locationID,value:i.locationID},g(i.company_address)+" ("+g(i.location_type)+") ",9,ze))),128))],2),[[K,a.selectedLocationID]]),a.locationError?(c(),d("div",Ge," Please select a delivery location before checkout ")):h("",!0)]))])])),e("div",He,[!a.isEditing&&a.cartItems.length>0?(c(),d("button",{key:0,type:"button",class:"btn btn-outline-secondary me-2",onClick:t[5]||(t[5]=(...i)=>a.startEditing&&a.startEditing(...i))},t[27]||(t[27]=[e("i",{class:"bi bi-pencil me-1"},null,-1),b(" Edit Quantities ")]))):h("",!0),a.isEditing?(c(),d("button",{key:1,class:"btn btn-success me-2",onClick:t[6]||(t[6]=(...i)=>a.saveChanges&&a.saveChanges(...i))},t[28]||(t[28]=[e("i",{class:"bi bi-check-lg me-1"},null,-1),b(" Save Changes ")]))):h("",!0),a.isEditing?(c(),d("button",{key:2,class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...i)=>a.cancelEditing&&a.cancelEditing(...i))},t[29]||(t[29]=[e("i",{class:"bi bi-x-lg me-1"},null,-1),b(" Cancel ")]))):h("",!0),!a.isEditing&&a.cartItems.length>0?(c(),d("button",{key:3,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...i)=>a.proceedToCheckout&&a.proceedToCheckout(...i)),disabled:a.isProcessingCheckout},[t[30]||(t[30]=e("i",{class:"bi bi-credit-card me-1"},null,-1)),b(" "+g(a.isProcessingCheckout?"Processing...":"Proceed to Checkout"),1)],8,We)):h("",!0)])])])]),a.isPaymentProcessing?(c(),d("div",Ye,t[31]||(t[31]=[et('<div class="payment-processing-content" data-v-5a92c822><div class="payment-logo" data-v-5a92c822><i class="bi bi-shield-check" data-v-5a92c822></i></div><div class="payment-spinner" data-v-5a92c822><div class="spinner-ring" data-v-5a92c822><div data-v-5a92c822></div><div data-v-5a92c822></div><div data-v-5a92c822></div><div data-v-5a92c822></div></div></div><h4 class="payment-title" data-v-5a92c822>Processing Payment</h4><p class="payment-message" data-v-5a92c822>Connecting to secure payment gateway...</p><div class="payment-steps" data-v-5a92c822><div class="payment-step active" data-v-5a92c822><div class="step-indicator" data-v-5a92c822><i class="bi bi-check-circle-fill" data-v-5a92c822></i></div><div class="step-label" data-v-5a92c822>Preparing order</div></div><div class="payment-step current" data-v-5a92c822><div class="step-indicator" data-v-5a92c822><div class="step-pulse" data-v-5a92c822></div></div><div class="step-label" data-v-5a92c822>Processing payment</div></div><div class="payment-step" data-v-5a92c822><div class="step-indicator" data-v-5a92c822><i class="bi bi-circle" data-v-5a92c822></i></div><div class="step-label" data-v-5a92c822>Completing transaction</div></div></div><div class="payment-security-note" data-v-5a92c822><i class="bi bi-lock-fill" data-v-5a92c822></i> Your payment information is secure </div></div>',1)]))):h("",!0)])])}const Xe=Q(Zt,[["render",Ke],["__scopeId","data-v-5a92c822"]]),Ze={name:"MarketplacePage",components:{SearchFilterBar:kt,ProductGrid:jt,MarketplacePagination:Xt,CartModal:Xe},setup(){const m=y([]),t=y([]),n=y(!0),a=y(null),s=y(""),l=y(""),r=y("newest"),i=y(0),C=y({current_page:1,last_page:1,from:1,to:0,total:0}),p=y(null),_=y(""),P=y(""),k=async(u=1)=>{try{n.value=!0,a.value=null;const G={page:parseInt(u)||1,search:s.value||null,poultry_type:l.value||null,sort:r.value||"newest",min_price:_.value||null,max_price:P.value||null},S=await f.fetchItems(G);S&&S.data?(m.value=S.data,C.value=S.pagination||{current_page:1,last_page:1,from:1,to:S.data.length,total:S.data.length}):(m.value=[],a.value="Unexpected response format")}catch(w){console.error("Error fetching items:",w),a.value="Failed to load products. Please try again later.",m.value=[]}finally{n.value=!1}},I=async()=>{try{t.value=await f.fetchPoultryTypes()}catch(u){console.error("Error fetching poultry types:",u)}},D=u=>{s.value=u},T=()=>{k(1)},N=({poultryType:u,sortBy:w,minPrice:G,maxPrice:S})=>{l.value=u,r.value=w,_.value=G,P.value=S,k(1)},q=u=>{u<1||u>C.value.last_page||n.value||k(u)},U=u=>{},O=u=>{if(u.quantity<=0){modal.warning("Out of Stock","This item is currently out of stock.");return}p.value?p.value.showAddToCartModal(u):f.addToCart(u).then(()=>{A()}).catch(w=>{})},j=()=>{p.value?(p.value.showViewCartModal(),A()):f.viewCart()},A=async()=>{try{const u=await f.getCartItems();E(u)}catch{}},E=u=>{let w=0;u&&u.cart_items&&Array.isArray(u.cart_items)?w=u.cart_items.length:u&&u.cart_item?w=1:u&&typeof u.cart_count=="number"&&(w=u.cart_count),i.value=w||0},X=async()=>{try{const u=await f.getCartItems();E(u)}catch{i.value=0}};return f.onCartUpdate(u=>{E(u)}),at(()=>{k(),I(),X()}),{products:m,poultryTypes:t,loading:n,error:a,searchQuery:s,selectedPoultryType:l,sortBy:r,minPrice:_,maxPrice:P,pagination:C,cartModal:p,cartItemCount:i,handleSearch:D,handleSearchClick:T,handleFilters:N,changePage:q,viewProductDetails:U,addToCart:O,viewCart:j}}},$e={class:"marketplace-page"},ta={class:"d-flex justify-content-between align-items-center mb-4"},ea={class:"cart-badge"},aa={key:0,class:"text-center py-5"},na={key:1,class:"alert alert-danger",role:"alert"};function ia(m,t,n,a,s,l){const r=V("SearchFilterBar"),i=V("ProductGrid"),C=V("MarketplacePagination"),p=V("CartModal");return c(),d("div",$e,[e("div",ta,[t[3]||(t[3]=e("h1",{class:"mb-0"},"Marketplace",-1)),e("button",{class:"btn btn-primary cart-button",onClick:t[0]||(t[0]=(..._)=>a.viewCart&&a.viewCart(..._))},[t[1]||(t[1]=e("i",{class:"fas fa-shopping-cart me-2"},null,-1)),t[2]||(t[2]=b(" View Cart ")),e("span",ea,g(a.cartItemCount),1)])]),Y(r,{"poultry-types":a.poultryTypes,"initial-search-query":a.searchQuery,"initial-poultry-type":a.selectedPoultryType,"initial-sort-by":a.sortBy,"initial-min-price":a.minPrice,"initial-max-price":a.maxPrice,onSearchInput:a.handleSearch,onSearchClick:a.handleSearchClick,onFilterChange:a.handleFilters},null,8,["poultry-types","initial-search-query","initial-poultry-type","initial-sort-by","initial-min-price","initial-max-price","onSearchInput","onSearchClick","onFilterChange"]),a.loading?(c(),d("div",aa,t[4]||(t[4]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):h("",!0),a.error?(c(),d("div",na,g(a.error),1)):h("",!0),Y(i,{products:a.products,loading:a.loading,error:a.error,onViewDetails:a.viewProductDetails,onAddToCart:a.addToCart},null,8,["products","loading","error","onViewDetails","onAddToCart"]),!a.loading&&!a.error&&a.products.length>0?(c(),$(C,{key:2,"current-page":a.pagination.current_page,"last-page":a.pagination.last_page,from:a.pagination.from,to:a.pagination.to,total:a.pagination.total,"item-count":a.products.length,onPageChange:a.changePage},null,8,["current-page","last-page","from","to","total","item-count","onPageChange"])):h("",!0),Y(p,{id:"cart-modal-component",ref:"cartModal"},null,512)])}const va=Q(Ze,[["render",ia],["__scopeId","data-v-1b350fea"]]);export{va as default};
