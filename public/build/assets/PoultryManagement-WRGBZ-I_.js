import{_ as R,c as f,a as l,f as F,g as x,e as j,b as C,s as U,t as h,k as M,n as w,d as S,F as z,j as q,r as g,x as Q,y as G,z as _,o as y}from"./main-BpaYbEPg.js";import{S as H}from"./StatsCard-BQtpX15Y.js";import{R as J}from"./ResponsiveTable-B0dEHhy-.js";import{L as K}from"./LoadingSpinner-9sKMkQ1j.js";import{m as u}from"./modal-ByxZIVwL.js";const O={name:"PoultryManagement",components:{StatsCard:H,ResponsiveTable:J,LoadingSpinner:K},setup(){const m=g(!1),t=g(null),p=g([]),e=g(""),v=g(1),I=g(10),b=g({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),k=Q(()=>{const a=[],d=b.value.last_page;if(d<=5)for(let n=1;n<=d;n++)a.push(n);else{let n=Math.max(1,v.value-Math.floor(2.5)),c=Math.min(d,n+5-1);c===d&&(n=Math.max(1,c-5+1));for(let i=n;i<=c;i++)a.push(i)}return a}),P=g({total:0}),o=[{key:"poultry_image",label:"Image",sortable:!1},{key:"poultry_name",label:"Name",sortable:!0},{key:"created_at",label:"Created",sortable:!0}],s=async()=>{try{m.value=!0,t.value=null;const a={page:v.value,per_page:I.value,search:e.value||null},r=await _.get("/api/poultries",{params:a});r.data&&r.success?(p.value=r.data,b.value=r.pagination):(p.value=[],console.error("Unexpected response format:",r))}catch(a){console.error("Error fetching poultries:",a),t.value=a.message||"Failed to load poultries. Please try again later.",p.value=[]}finally{m.value=!1}},E=async()=>{try{const a={search:e.value||null},r=await _.get("/api/poultries/all/stats",{params:a});r&&(P.value=r)}catch(a){console.error("Error fetching poultry stats:",a)}},L=a=>{e.value=a,v.value=1,s(),E()},N=a=>{a<1||a>b.value.last_page||m.value||(v.value=a,s())},T=a=>a?new Date(a).toLocaleDateString():"",V=a=>{u.show({type:"info",title:"Edit Poultry",message:`
          <form id="edit-poultry-form">
            <div class="mb-3">
              <label for="edit-poultry-name" class="form-label">Poultry Name</label>
              <input type="text" class="form-control" id="edit-poultry-name" value="${a.poultry_name}" required>
            </div>
            <div class="mb-3">
              <label for="edit-poultry-image-file" class="form-label">Upload New Image</label>
              <input type="file" class="form-control" id="edit-poultry-image-file" accept="image/*">
            </div>
            ${a.poultry_image?`
            <div class="mb-3">
              <label class="form-label">Current Image</label>
              <div>
                <img src="${a.poultry_image}" alt="Current Poultry Image" class="img-thumbnail" style="max-width: 200px;">
              </div>
            </div>
            `:""}
          </form>
        `,buttons:[{label:"Cancel",type:"secondary",dismiss:!0},{label:"Save",type:"primary",onClick:async(r,d)=>{const n=document.getElementById("edit-poultry-name"),c=document.getElementById("edit-poultry-image-file");if(!n.value.trim()){n.classList.add("is-invalid");return}m.value=!0,p.value=[];try{const i=new FormData;i.append("poultry_name",n.value.trim()),i.append("_method","PUT"),c.files[0]&&i.append("poultry_image_file",c.files[0]),await _.post(`/api/poultries/${a.poultryID}`,i,{headers:{"Content-Type":"multipart/form-data"},onSuccess:D=>{s(),u.success("Success","Poultry updated successfully")},onError:D=>{console.error("Error updating poultry:",D),t.value="Failed to update poultry. Please try again.",u.danger("Error","Failed to update poultry. Please try again."),s()}}),d.hide()}catch{s()}}}]})},B=a=>{u.confirm("Delete Poultry",`Are you sure you want to delete "${a.poultry_name}"?`,async()=>{m.value=!0,p.value=[];try{await _.delete(`/api/poultries/${a.poultryID}`,{onSuccess:()=>{s(),u.success("Success","Poultry deleted successfully")},onError:r=>{console.error("Error deleting poultry:",r),t.value="Failed to delete poultry. Please try again.",u.danger("Error","Failed to delete poultry. Please try again."),s()}})}catch{s()}},null,{confirmLabel:"Delete",confirmType:"danger"})},A=()=>{u.show({type:"info",title:"Add New Poultry",message:`
          <form id="add-poultry-form">
            <div class="mb-3">
              <label for="poultry-name" class="form-label">Poultry Name</label>
              <input type="text" class="form-control" id="poultry-name" required>
            </div>
            <div class="mb-3">
              <label for="poultry-image-file" class="form-label">Upload Image</label>
              <input type="file" class="form-control" id="poultry-image-file" accept="image/*">
            </div>
          </form>
        `,buttons:[{label:"Cancel",type:"secondary",dismiss:!0},{label:"Save",type:"primary",onClick:async(a,r)=>{const d=document.getElementById("poultry-name"),n=document.getElementById("poultry-image-file");if(!d.value.trim()){d.classList.add("is-invalid");return}m.value=!0,p.value=[];try{const c=new FormData;c.append("poultry_name",d.value.trim()),n.files[0]&&c.append("poultry_image_file",n.files[0]),await _.post("/api/poultries",c,{headers:{"Content-Type":"multipart/form-data"},onSuccess:i=>{s(),u.success("Success","Poultry added successfully")},onError:i=>{console.error("Error adding poultry:",i),t.value="Failed to add poultry. Please try again.",u.danger("Error","Failed to add poultry. Please try again."),s()}}),r.hide()}catch{s()}}}]})};return G(()=>{s(),E()}),{loading:m,error:t,poultries:p,poultryStats:P,columns:o,searchQuery:e,currentPage:v,pagination:b,paginationRange:k,handleSearch:L,changePage:N,formatDate:T,editPoultry:V,confirmDelete:B,openAddModal:A}}},W={class:"poultry-management"},X={class:"row mb-4"},Y={class:"col-md-4 col-sm-6 mb-3"},Z={class:"card"},$={class:"card-header theme-header d-flex justify-content-between align-items-center"},ee={class:"card-body position-relative"},ae={key:0,class:"alert alert-danger",role:"alert"},te={class:"d-flex align-items-center"},le=["src"],oe={key:1,class:"bg-light d-flex align-items-center justify-content-center me-2",style:{width:"50px",height:"50px"}},re=["onClick"],se=["onClick"],ne={key:2,class:"d-flex justify-content-between align-items-center mt-4"},ie={class:"text-muted"},ce={"aria-label":"Poultry pagination"},de={class:"pagination mb-0"},ue=["onClick"];function me(m,t,p,e,v,I){const b=x("StatsCard"),k=x("LoadingSpinner"),P=x("ResponsiveTable");return y(),f("div",W,[t[10]||(t[10]=l("h1",{class:"mb-4"},"Poultry Management",-1)),l("div",X,[l("div",Y,[F(b,{title:"Total Poultries",count:e.poultryStats.total,icon:"fas fa-feather","bg-color":"bg-primary"},null,8,["count"])])]),l("div",Z,[l("div",$,[t[4]||(t[4]=l("h5",{class:"mb-0"},"Poultries",-1)),l("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...o)=>e.openAddModal&&e.openAddModal(...o))},t[3]||(t[3]=[l("i",{class:"fas fa-plus"},null,-1),j(),l("span",{class:"d-none d-md-inline"},"Add Poultry",-1)]))]),l("div",ee,[e.error?(y(),f("div",ae,h(e.error),1)):C("",!0),e.loading?(y(),U(k,{key:1,overlay:"",size:"md",message:"Loading poultries..."})):C("",!0),F(P,{columns:e.columns,items:e.poultries,loading:!1,"has-actions":!0,"item-key":"poultryID",onSearch:e.handleSearch,"show-pagination":!1,"server-side":!0},{poultry_image:M(({item:o})=>[l("div",te,[o.poultry_image?(y(),f("img",{key:0,src:o.poultry_image,alt:"Poultry Image",class:"img-thumbnail me-2",style:{width:"50px",height:"50px","object-fit":"cover"}},null,8,le)):(y(),f("div",oe,t[5]||(t[5]=[l("i",{class:"fas fa-feather text-muted"},null,-1)])))])]),actions:M(({item:o})=>[l("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:s=>e.editPoultry(o)},t[6]||(t[6]=[l("i",{class:"fas fa-edit"},null,-1)]),8,re),l("button",{class:"btn btn-sm btn-outline-danger",onClick:s=>e.confirmDelete(o)},t[7]||(t[7]=[l("i",{class:"fas fa-trash"},null,-1)]),8,se)]),_:1},8,["columns","items","onSearch"]),!e.loading&&e.poultries.length>0?(y(),f("div",ne,[l("div",null,[l("span",ie,"Showing "+h(e.pagination.from||1)+"-"+h(e.pagination.to||e.poultries.length)+" of "+h(e.pagination.total||e.poultries.length),1)]),l("nav",ce,[l("ul",de,[l("li",{class:w(["page-item",{disabled:e.currentPage<=1||e.loading}])},[l("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=S(o=>!e.loading&&e.changePage(e.currentPage-1),["prevent"]))},t[8]||(t[8]=[l("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(y(!0),f(z,null,q(e.paginationRange,o=>(y(),f("li",{key:o,class:w(["page-item",{active:o===e.currentPage,disabled:e.loading}])},[l("a",{class:"page-link",href:"#",onClick:S(s=>!e.loading&&e.changePage(o),["prevent"])},h(o),9,ue)],2))),128)),l("li",{class:w(["page-item",{disabled:e.currentPage>=e.pagination.last_page||e.loading}])},[l("a",{class:"page-link",href:"#",onClick:t[2]||(t[2]=S(o=>!e.loading&&e.changePage(e.currentPage+1),["prevent"]))},t[9]||(t[9]=[l("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):C("",!0)])])])}const be=R(O,[["render",me],["__scopeId","data-v-76ebddea"]]);export{be as default};
