import{a as ee,b as Q,c as z}from"./modal-ByxZIVwL.js";import{I as k,_ as R,c as d,a as t,f as F,g as E,o,n as I,d as U,F as D,j as S,t as c,e as _,s as H,r as O,y as Z,M as V,H as te,B as J,b as y,u as se,J as ie,w as N,K as ae,A as K,v as G,k as X,x as Y}from"./main-BpaYbEPg.js";import{S as ne}from"./StatsCard-BQtpX15Y.js";import{L as W}from"./LoadingSpinner-9sKMkQ1j.js";import{R as le}from"./ResponsiveTable-B0dEHhy-.js";const T={async getTrips(s={}){return k("/api/deliveries/trips",{params:s})},async getCreatedDeliveries(s=1,e=3){return k("/api/deliveries/created",{params:{page:s,per_page:e}})},async getDeliveryStats(){return k("/api/deliveries/stats")},async getLocations(){return k("/api/locations")},async getDrivers(s){return k("/api/users/get/drivers",{params:{scheduled_date:s}})},async getVehicles(s){return k("api/deliveries/get/vehicles",{params:{scheduled_date:s}})},async assignSingleTrip(s){return k("/api/deliveries/assign-trip",{method:"POST",data:s})},async updateDeliveryStatus(s,e){return k(`/api/deliveries/${s}/start`,{method:"put",data:e})},async getDeliveryDetails(s){return k(`/api/deliveries/${s}`)},async createDelivery(s){return k("/api/deliveries/create",{method:"post",data:s})},async getOrderForAssignment(s={}){const{locationID:e,orderID:i}=s;if(!e||!i)return{success:!1,message:"Location ID and Order ID are required"};try{const a=await this.getTrips({locationID:e});if(!a.success||!a.data)return{success:!1,message:"Failed to fetch order data"};const l=a.data.find(r=>r.locationID==e);if(!l||!l.orders)return{success:!1,message:"Location or orders not found"};const n=l.orders[i];return n?{success:!0,data:{locationID:e,locationAddress:l.company_address,orderID:i,orderData:n}}:{success:!1,message:"Order not found"}}catch(a){return console.error("Error fetching order for assignment:",a),{success:!1,message:"An error occurred while fetching order data"}}},async assignDelivery(s){return k("/api/deliveries/assign",{method:"POST",data:s})},async createDelivery(s){return k("/api/deliveries",{method:"POST",data:s})},async getDeliveryDetails(s){return k(`/api/deliveries/${s}`)},async createDelivery(s){return k("/api/deliveries/create",{method:"post",data:s})},async getExecutionDeliveries(s={}){return k("/api/deliveries/get/execution",{params:{statusFilter:s.status||"",dateFilter:s.date||"",searchTerm:s.searchTerm||""}})},async startDelivery(s){return k(`/api/deliveries/${s}/start`,{method:"post",data:{start_timestamp:new Date().toISOString()}})}},re={name:"DeliveryStatsCard",components:{StatsCard:ne},props:{stats:{type:Object,required:!0,default:()=>({pending:0,inProgress:0,completedToday:0,issues:0})}}},oe={class:"row mb-4"},de={class:"col-md-3 col-sm-6 mb-3"},ce={class:"col-md-3 col-sm-6 mb-3"},ue={class:"col-md-3 col-sm-6 mb-3"},ve={class:"col-md-3 col-sm-6 mb-3"};function he(s,e,i,a,l,n){const r=E("StatsCard",!0);return o(),d("div",oe,[t("div",de,[F(r,{title:"Pending Assignment",count:i.stats.pending,icon:"fas fa-clock",bgColor:"bg-warning"},null,8,["count"])]),t("div",ce,[F(r,{title:"In Progress",count:i.stats.inProgress,icon:"fas fa-truck",bgColor:"bg-info"},null,8,["count"])]),t("div",ue,[F(r,{title:"Completed Today",count:i.stats.completedToday,icon:"fas fa-check-circle",bgColor:"bg-success"},null,8,["count"])]),t("div",ve,[F(r,{title:"Issues",count:i.stats.issues,icon:"fas fa-exclamation-triangle",bgColor:"bg-danger"},null,8,["count"])])])}const me=R(re,[["render",he]]),ge={name:"Pagination",props:{pagination:{type:Object,required:!0,default:()=>({current_page:1,last_page:1,per_page:15,total:0,from:1,to:0})},maxVisiblePages:{type:Number,default:5}},computed:{displayedPages(){if(!this.pagination.last_page)return[];const s=this.pagination.current_page,e=this.pagination.last_page,i=Math.floor(this.maxVisiblePages/2);let a=s-i,l=s+i;a<=1&&(a=1,l=Math.min(this.maxVisiblePages,e)),l>=e&&(l=e,a=Math.max(e-this.maxVisiblePages+1,1));const n=[];for(let r=a;r<=l;r++)n.push(r);return n}},methods:{changePage(s){s<1||s>this.pagination.last_page||this.$emit("page-changed",s)}}},fe={"aria-label":"Page navigation"},ye={class:"pagination justify-content-center mb-0"},pe=["onClick"];function be(s,e,i,a,l,n){return o(),d("nav",fe,[t("ul",ye,[t("li",{class:I(["page-item",{disabled:i.pagination.current_page<=1}])},[t("a",{class:"page-link",href:"#",onClick:e[0]||(e[0]=U(r=>n.changePage(i.pagination.current_page-1),["prevent"]))},e[2]||(e[2]=[t("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(o(!0),d(D,null,S(n.displayedPages,r=>(o(),d("li",{key:r,class:I(["page-item",{active:i.pagination.current_page===r}])},[t("a",{class:"page-link",href:"#",onClick:U(v=>n.changePage(r),["prevent"])},c(r),9,pe)],2))),128)),t("li",{class:I(["page-item",{disabled:i.pagination.current_page>=i.pagination.last_page}])},[t("a",{class:"page-link",href:"#",onClick:e[1]||(e[1]=U(r=>n.changePage(i.pagination.current_page+1),["prevent"]))},e[3]||(e[3]=[t("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])}const _e=R(ge,[["render",be],["__scopeId","data-v-b4287979"]]),De={name:"ItemModal",props:{modalId:{type:String,required:!0},items:{type:Array,required:!0}},computed:{totalValue(){return this.items.reduce((s,e)=>s+e.price,0)}}},Ie=["id"],ke={class:"modal-dialog modal-dialog-centered"},xe={class:"modal-content"},Se={class:"modal-body p-3"},Ce={class:"delivery-summary mb-4"},we={class:"total-items"},Pe={class:"value"},Ee={class:"total-value"},Me={class:"value"},$e={class:"items-grid"},Te={class:"card h-100"},Fe={class:"card-header item-header"},Le={class:"item-id"},Oe={class:"card-body"},Re={class:"card-title d-flex align-items-center"},Ae={class:"item-details"},je={class:"detail-row"},Ne={class:"detail-value"},qe={class:"detail-row"},Qe={class:"detail-value price"};function Ve(s,e,i,a,l,n){return o(),d("div",{class:"modal fade",id:i.modalId,tabindex:"-1","aria-labelledby":"itemModalLabel","aria-hidden":"true"},[t("div",ke,[t("div",xe,[e[7]||(e[7]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"itemModalLabel"},[t("i",{class:"fas fa-box me-2"}),_("Delivery Items ")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Se,[t("div",Ce,[t("div",we,[e[0]||(e[0]=t("span",{class:"label"},"Total Items:",-1)),t("span",Pe,c(i.items.length),1)]),t("div",Ee,[e[1]||(e[1]=t("span",{class:"label"},"Total Value:",-1)),t("span",Me,"RM "+c(n.totalValue.toFixed(2)),1)])]),t("div",$e,[(o(!0),d(D,null,S(i.items,r=>(o(),d("div",{key:r.itemID,class:"item-card"},[t("div",Te,[t("div",Fe,[t("span",Le,"#"+c(r.itemID),1)]),t("div",Oe,[t("h6",Re,[e[2]||(e[2]=t("i",{class:"fas fa-cube me-2"},null,-1)),_(c(r.name),1)]),t("div",Ae,[t("div",je,[e[3]||(e[3]=t("i",{class:"fas fa-weight-hanging text-muted me-2"},null,-1)),e[4]||(e[4]=t("span",{class:"detail-label"},"Quantity:",-1)),t("span",Ne,c(r.measurement_value)+" "+c(r.measurement_type),1)]),t("div",qe,[e[5]||(e[5]=t("i",{class:"fas fa-tag text-muted me-2"},null,-1)),e[6]||(e[6]=t("span",{class:"detail-label"},"Price:",-1)),t("span",Qe,"RM "+c(r.price.toFixed(2)),1)])])])])]))),128))])])])])],8,Ie)}const Be=R(De,[["render",Ve],["__scopeId","data-v-cb14fafa"]]),Ue={name:"DeliveryAssignment",components:{Pagination:_e,ItemModal:Be,LoadingSpinner:W},props:{loading:Boolean,error:String,trips:{type:Array,default:()=>[]},pagination:Object,selectedDeliveryID:[Number,String],activePhase:{type:Number,required:!0}},data(){return{}},emits:["refresh","assign-trip","change-phase","change-page"],methods:{changePhase(s){this.$emit("change-phase",s)}}},ze={class:"delivery-assignment"},Je={class:"card"},He={class:"card-header d-flex justify-content-between align-items-center theme-header"},Ke={class:"d-flex"},Ge={class:"phase-tabs"},We={class:"nav nav-tabs",role:"tablist"},Xe={class:"card-body p-0"},Ye={key:0,class:"p-4"},Ze={class:"alert alert-danger mb-0"},et={key:1},tt={class:"table-responsive"},st={class:"table table-hover theme-table"},it={key:0,class:"table-loading-row"},at={colspan:"5",class:"text-center py-4"},nt={key:1,class:"table-empty-row"},lt={class:"text-nowrap"},rt={class:"text-nowrap"},ot={class:"location-cell"},dt={class:"location-type"},ct={class:"location-address"},ut={class:"location-cell"},vt={class:"location-type"},ht={class:"location-address"},mt={class:"d-flex gap-2 flex-wrap justify-content-start"},gt=["data-bs-target"],ft=["onClick","disabled"];function yt(s,e,i,a,l,n){const r=E("LoadingSpinner"),v=E("ItemModal");return o(),d("div",ze,[t("div",Je,[t("div",He,[e[4]||(e[4]=t("h5",{class:"mb-0"},"Assign Deliveries",-1)),t("div",Ke,[t("button",{class:"btn btn-sm btn-outline-primary theme-btn-outline",onClick:e[0]||(e[0]=h=>s.$emit("refresh"))},e[3]||(e[3]=[t("i",{class:"fas fa-sync-alt"},null,-1)]))])]),t("div",Ge,[t("div",We,[t("button",{class:I(["nav-link",{active:i.activePhase===1}]),onClick:e[1]||(e[1]=h=>n.changePhase(1)),id:"phase1-tab",type:"button",role:"tab","aria-controls":"phase1","aria-selected":"activePhase === 1"},e[5]||(e[5]=[t("i",{class:"fas fa-truck-loading me-2"},null,-1),_("Phase 1 (Supplier to Slaughterhouse) ")]),2),t("button",{class:I(["nav-link",{active:i.activePhase===2}]),onClick:e[2]||(e[2]=h=>n.changePhase(2)),id:"phase2-tab",type:"button",role:"tab","aria-controls":"phase2","aria-selected":"activePhase === 2"},e[6]||(e[6]=[t("i",{class:"fas fa-truck me-2"},null,-1),_("Phase 2 (Slaughterhouse to Customer) ")]),2)])]),t("div",Xe,[i.error?(o(),d("div",Ye,[t("div",Ze,c(i.error),1)])):(o(),d("div",et,[t("div",tt,[t("table",st,[e[10]||(e[10]=t("thead",{class:"theme-table-header"},[t("tr",null,[t("th",{style:{width:"5vw"}},"Trip ID"),t("th",{style:{width:"5vw"}},"Order ID"),t("th",null,"Start Location"),t("th",null,"End Location"),t("th",null,"Action")])],-1)),t("tbody",null,[i.loading?(o(),d("tr",it,[t("td",at,[F(r,{size:"md",message:"Loading delivery data..."})])])):!i.trips||i.trips.length===0?(o(),d("tr",nt,e[7]||(e[7]=[t("td",{colspan:"5",class:"text-center py-4"},[t("div",{class:"empty-state"},[t("i",{class:"fas fa-info-circle me-2 text-muted"}),_(" No trips found for the selected criteria. ")])],-1)]))):(o(!0),d(D,{key:2},S(i.trips,h=>(o(),d("tr",{key:h.tripID},[t("td",lt,c(h.tripID),1),t("td",rt,c(h.orderID),1),t("td",ot,[t("div",dt,c(h.start_location.type),1),t("div",ct,c(h.start_location.address),1)]),t("td",ut,[t("div",vt,c(h.end_location.type),1),t("div",ht,c(h.end_location.address),1)]),t("td",null,[t("div",mt,[t("button",{class:"btn btn-sm btn-outline-secondary","data-bs-toggle":"modal","data-bs-target":`#itemModal-${h.tripID}`},e[8]||(e[8]=[t("i",{class:"fas fa-box me-1"},null,-1),t("span",{class:"ms-1 d-none d-sm-inline"},"Items",-1)]),8,gt),t("button",{class:"btn btn-sm btn-primary",onClick:P=>s.$emit("assign-trip",h),disabled:!i.selectedDeliveryID},e[9]||(e[9]=[t("i",{class:"fas fa-plus-circle me-1"},null,-1),t("span",{class:"ms-1 d-none d-sm-inline"},"Assign",-1)]),8,ft)])])]))),128))])])]),(o(!0),d(D,null,S(i.trips,h=>(o(),H(v,{key:`modal-${h.tripID}`,"modal-id":`itemModal-${h.tripID}`,items:h.items},null,8,["modal-id","items"]))),128))]))])])])}const pt=R(Ue,[["render",yt],["__scopeId","data-v-ed3a76f2"]]),bt={name:"QRScannerModal",props:{deliveryID:{type:[Number,String],required:!0},locationID:{type:[Number,String],required:!0},checkpoints:{type:Array,required:!0}},emits:["scanner-closed"],setup(s,{emit:e}){se();const i=O(!0),a=O(null),l=O(null),n=O(null),r=O("");let v=null,h=null;function P(f){document.readyState==="complete"||document.readyState==="interactive"?setTimeout(f,1):document.addEventListener("DOMContentLoaded",f)}function M(f,C){if(h!==f){h=f,l.value=f;try{let u=f;u.startsWith("http")||(u=window.location.origin+(u.startsWith("/")?u:"/"+u));const w=new URL(u),g=window.location.hostname;if(w.hostname!==g){a.value="Security Error: QR code URL is from a different domain. Only URLs from the current domain are allowed.",l.value=null;return}let x=s.locationID,p=null;try{const A=w.pathname.split("/").filter($=>$).filter($=>!isNaN($));A.length>=2&&(x=parseInt(A[0]),p=parseInt(A[1]),console.log("Extracted from URL - Location ID:",x,"Company ID:",p))}catch(m){console.warn("Could not extract IDs from URL, using props value:",m)}const b={deliveryID:s.deliveryID,locationID:s.locationID,checkpoints:s.checkpoints,companyID:p};console.log("Sending data to server:",{url:u,postData:b}),l.value="QR code detected! Processing...",ie(u,b,{onSuccess:m=>{m.status==="success"?setTimeout(()=>{j(),console.log("url info: "+JSON.stringify(m,null,2)),m.redirect&&m.redirectUrl?(console.log("Navigating to:",m.redirectUrl),window.location.href=m.redirectUrl):(console.log("API response indicates no redirect needed or URL missing."),l.value=m.message||"Processing complete.")},1e3):(a.value=m.message||"Error processing QR code",l.value=null)},onError:m=>{console.error("API Error Details:",m),m.response&&m.response.data?(a.value=`Error processing QR code: ${m.response.data.message||m.message}`,console.error("Server error details:",m.response.data)):a.value=`Error processing QR code: ${m.message||"Unknown error"}`,l.value=null}})}catch(u){a.value=`Error processing QR code: ${u.message||"Unknown error"}`,l.value=null}}}function L(f,C){const g=f>C?C:f,x=Math.floor(g*.75);return x<250?g<250?{width:g,height:g}:{width:250,height:250}:{width:x,height:x}}Z(()=>{n.value=new V(document.getElementById("qrScannerModal")),r.value=window.location.origin;const f=document.createElement("script");f.src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js",f.async=!0,f.onload=()=>{i.value=!1,P(()=>{try{v=new Html5QrcodeScanner("reader",{fps:10,qrbox:L,experimentalFeatures:{useBarCodeDetectorIfSupported:!0},rememberLastUsedCamera:!0,showTorchButtonIfSupported:!0,formatsToSupport:[Html5QrcodeSupportedFormats.QR_CODE],hideSelectScanType:!0,showVideoSourcesSelect:!1}),v.render(M),console.log("QR scanner initialized successfully"),setTimeout(()=>{const C=document.querySelector("#reader select");C&&(C.style.display="none");const u=document.querySelector("#reader__scan_type_change_button");u&&(u.style.display="none");const w=document.querySelector("#reader__dashboard_section_swaplink");w&&(w.className="btn btn-sm btn-danger mt-2",w.innerHTML='<i class="fas fa-stop me-1"></i>Stop Scanning')},500)}catch(C){console.error("Error initializing QR scanner:",C),a.value=`Failed to initialize scanner: ${C.message||"Unknown error"}`}})},f.onerror=()=>{a.value="Failed to load QR scanner library. Please try again.",i.value=!1},document.head.appendChild(f)}),te(()=>{if(v)try{v.clear(),console.log("QR scanner cleared successfully")}catch(f){console.error("Error clearing QR scanner:",f)}});const q=()=>{n.value&&n.value.show()},j=()=>{n.value&&(n.value.hide(),e("scanner-closed"))};return{loading:i,error:a,scanResult:l,httpOrigin:r,showModal:q,closeModal:j}}},_t={class:"modal fade",id:"qrScannerModal",tabindex:"-1","aria-labelledby":"qrScannerModalLabel","aria-hidden":"true"},Dt={class:"modal-dialog modal-dialog-centered"},It={class:"modal-content theme-modal"},kt={class:"modal-body theme-body p-0"},xt={key:0,class:"text-center p-5"},St={key:1},Ct={key:0,class:"alert alert-danger m-3"},wt={key:1,class:"alert alert-success m-3"},Pt={key:2,class:"alert alert-info m-3"},Et={class:"mb-1"},Mt={class:"code-block mt-1"},$t={class:"modal-footer theme-footer"};function Tt(s,e,i,a,l,n){return o(),d("div",_t,[t("div",Dt,[t("div",It,[e[12]||(e[12]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"qrScannerModalLabel"},[t("i",{class:"fas fa-qrcode me-2"}),_("Scan QR Code ")]),t("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",kt,[a.loading?(o(),d("div",xt,e[1]||(e[1]=[t("div",{class:"spinner-border theme-spinner",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"mt-3 theme-text fw-bold"},"Initializing camera...",-1)]))):(o(),d("div",St,[e[10]||(e[10]=J('<div class="scanner-header text-center p-3" data-v-ab9786a9><p class="mb-0" data-v-ab9786a9><i class="fas fa-crosshairs me-2" data-v-ab9786a9></i>Position QR code within the scanner frame</p></div><div class="qr-scanner-container" data-v-ab9786a9><div id="reader" class="qr-reader" data-v-ab9786a9></div></div>',2)),a.error?(o(),d("div",Ct,[e[2]||(e[2]=t("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),_(c(a.error),1)])):y("",!0),a.scanResult?(o(),d("div",wt,e[3]||(e[3]=[t("i",{class:"fas fa-check-circle me-2"},null,-1),_("QR Code detected! Redirecting... ")]))):y("",!0),!a.scanResult&&!a.error?(o(),d("div",Pt,[e[8]||(e[8]=t("h6",{class:"alert-heading"},[t("i",{class:"fas fa-info-circle me-2"}),_("Troubleshooting")],-1)),e[9]||(e[9]=t("p",{class:"mb-1"},"If you can't see the video feed, try:",-1)),t("ul",Et,[e[6]||(e[6]=t("li",null,"Checking browser permissions",-1)),e[7]||(e[7]=t("li",null,"Refreshing the page",-1)),t("li",null,[e[4]||(e[4]=t("strong",null,"HTTP Solution:",-1)),e[5]||(e[5]=_(" For Chrome, run with this flag: ")),t("div",Mt,[t("code",null,"chrome --unsafely-treat-insecure-origin-as-secure="+c(a.httpOrigin)+" --user-data-dir=C:\\ChromeDevSession",1)])])])])):y("",!0)]))]),t("div",$t,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[0]||(e[0]=(...r)=>a.closeModal&&a.closeModal(...r))},e[11]||(e[11]=[t("i",{class:"fas fa-times me-1"},null,-1),_("Close ")]))])])])])}const Ft=R(bt,[["render",Tt],["__scopeId","data-v-ab9786a9"]]),Lt={name:"ExecuteModalDelivery",props:{loading:{type:Boolean,default:!1},delivery:{type:Object,default:()=>null}},components:{QRScannerModal:Ft},emits:["start-delivery","scan-qr-code","refresh","reopen-delivery-modal"],data(){return{modal:null,activeRouteTab:0,scannerData:null,expandedLocations:{}}},methods:{setActiveRoute(s){this.activeRouteTab=s},showModal(){this.modal||(this.modal=new V(document.getElementById("executeModal"))),this.modal.show()},hideModal(){this.modal&&this.modal.hide()},getRoutesCount(){return!this.delivery||!this.delivery.routes?0:Object.keys(this.delivery.routes).length},startDeliveryAndRefresh(s){this.hideModal(),this.$emit("start-delivery",s),this.$emit("refresh"),setTimeout(()=>{this.$emit("reopen-delivery-modal",s)},500)},getStatusBadgeClass(s){if(!s)return"bg-secondary";switch(s.toLowerCase()){case"complete":return"bg-success";case"in_progress":return"bg-warning";case"pending":default:return"bg-secondary"}},formatDate(s){if(!s)return"N/A";const e=new Date(s);return isNaN(e.getTime())?s:e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},toggleLocationItems(s,e){this.expandedLocations[s]||(this.expandedLocations[s]={}),this.expandedLocations[s][e]=!this.expandedLocations[s][e],this.$forceUpdate()},isLocationExpanded(s,e){return this.expandedLocations[s]&&this.expandedLocations[s][e]},canScanLocation(s,e,i){if(this.delivery.status==="pending")return!1;if(e==="start"){const a=Object.keys(s.start_locations),l=a.indexOf(i.toString());if(l===0)return!0;for(let n=0;n<l;n++){const r=a[n];if(s.start_locations[r].location_status!=="complete")return!1}return!0}if(e==="end"){for(const n in s.start_locations)if(s.start_locations[n].location_status!=="complete")return!1;const a=Object.keys(s.end_locations),l=a.indexOf(i.toString());if(l===0)return!0;for(let n=0;n<l;n++){const r=a[n];if(s.end_locations[r].location_status!=="complete")return!1}return!0}return!1},scanQRCode(s){let e=null;for(const[i,a]of Object.entries(this.delivery.routes[this.activeRouteTab].start_locations))if(a.checkpoints.some(l=>s.includes(l))){e=parseInt(i);break}if(!e){for(const[i,a]of Object.entries(this.delivery.routes[this.activeRouteTab].end_locations))if(a.checkpoints.some(l=>s.includes(l))){e=parseInt(i);break}}if(!e&&s.length>0)for(const[i,a]of Object.entries(this.delivery.routes)){for(const[l,n]of Object.entries(a.start_locations))if(n.checkpoints.some(r=>s.includes(r))){e=parseInt(l);break}if(!e){for(const[l,n]of Object.entries(a.end_locations))if(n.checkpoints.some(r=>s.includes(r))){e=parseInt(l);break}}if(e)break}if(!e){const i=Object.keys(this.delivery.routes[this.activeRouteTab].start_locations);i.length>0&&(e=parseInt(i[0]))}this.scannerData={locationID:e,checkpoints:s},this.hideModal(),this.$nextTick(()=>{this.$refs.qrScannerModal&&this.$refs.qrScannerModal.showModal()})},reopenExecuteModal(){setTimeout(()=>{this.showModal()},300)}}},Ot={class:"modal fade",id:"executeModal",tabindex:"-1","aria-labelledby":"executeModalLabel","aria-hidden":"true"},Rt={class:"modal-dialog modal-lg modal-dialog-scrollable"},At={class:"modal-content"},jt={class:"modal-body"},Nt={key:0,class:"text-center p-4"},qt={key:1},Qt={class:"form-group mb-4"},Vt={class:"card"},Bt={class:"card-header bg-light"},Ut={class:"d-flex justify-content-between align-items-center"},zt={class:"badge primary-badge me-2"},Jt={class:"card-body"},Ht={class:"row g-3"},Kt={class:"col-md-6 col-lg-4"},Gt={class:"text-truncate"},Wt={class:"col-md-6 col-lg-4"},Xt={class:"text-truncate"},Yt={class:"col-md-6 col-lg-4"},Zt={class:"text-truncate"},es={class:"form-group mb-4"},ts={class:"card"},ss={class:"card-header bg-light"},is={class:"d-flex justify-content-between align-items-center"},as={class:"badge secondary-badge"},ns={class:"card-body"},ls={key:0},rs={key:0,class:"nav nav-tabs mb-3"},os=["onClick"],ds={class:"timeline"},cs={key:0,class:"route-header mb-3"},us={class:"border-bottom pb-2"},vs={class:"timeline-panel"},hs={class:"timeline-heading"},ms={class:"d-flex flex-wrap align-items-start gap-2 w-100"},gs={class:"location-header-content"},fs={class:"d-flex flex-wrap align-items-center gap-2"},ys={class:"timeline-title mb-0"},ps={class:"location-actions mt-2 d-md-none"},bs={class:"d-flex gap-2"},_s=["onClick"],Ds=["onClick"],Is={class:"ms-auto location-actions d-none d-md-block"},ks={class:"d-flex gap-2"},xs=["onClick"],Ss=["onClick"],Cs={class:"timeline-body"},ws={class:"location-type"},Ps={key:0,class:"location-items mt-3"},Es={class:"card"},Ms={class:"card-body p-0"},$s={class:"table-responsive"},Ts={class:"table table-striped table-hover mb-0"},Fs={class:"timeline-panel"},Ls={class:"timeline-heading"},Os={class:"d-flex flex-wrap align-items-start gap-2 w-100"},Rs={class:"location-header-content"},As={class:"d-flex flex-wrap align-items-center gap-2"},js={class:"timeline-title mb-0"},Ns={class:"location-actions mt-2 d-md-none"},qs={class:"d-flex gap-2"},Qs=["onClick"],Vs=["onClick"],Bs={class:"ms-auto location-actions d-none d-md-block"},Us={class:"d-flex gap-2"},zs=["onClick"],Js=["onClick"],Hs={class:"timeline-body"},Ks={class:"location-type"},Gs={key:0,class:"location-items mt-3"},Ws={class:"card"},Xs={class:"card-body p-0"},Ys={class:"table-responsive"},Zs={class:"table table-striped table-hover mb-0"},ei={key:1,class:"text-center text-muted"};function ti(s,e,i,a,l,n){var v,h,P,M,L,q,j,f,C,u,w;const r=E("QRScannerModal");return o(),d(D,null,[t("div",Ot,[t("div",Rt,[t("div",At,[e[21]||(e[21]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"executeModalLabel"},"Delivery Details"),t("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",jt,[i.loading?(o(),d("div",Nt)):(o(),d("div",qt,[t("div",Qt,[e[5]||(e[5]=t("label",{class:"form-label fw-bold"},"Delivery Information",-1)),t("div",Vt,[t("div",Bt,[t("div",Ut,[t("div",null,[t("span",zt,"Delivery #"+c(((v=i.delivery)==null?void 0:v.deliveryID)||"N/A"),1)]),t("div",null,[t("span",{class:I(["badge",n.getStatusBadgeClass((h=i.delivery)==null?void 0:h.status)])},c(((P=i.delivery)==null?void 0:P.status)||"Pending"),3)])])]),t("div",Jt,[t("div",Ht,[t("div",Kt,[e[2]||(e[2]=t("p",{class:"mb-2"},[t("strong",null,"Scheduled Date:")],-1)),t("p",Gt,c(n.formatDate((M=i.delivery)==null?void 0:M.scheduled_date)),1)]),t("div",Wt,[e[3]||(e[3]=t("p",{class:"mb-2"},[t("strong",null,"Driver:")],-1)),t("p",Xt,c(((L=i.delivery)==null?void 0:L.fullname)||((j=(q=i.delivery)==null?void 0:q.driver)==null?void 0:j.fullname)||"N/A"),1)]),t("div",Yt,[e[4]||(e[4]=t("p",{class:"mb-2"},[t("strong",null,"Vehicle:")],-1)),t("p",Zt,c(((f=i.delivery)==null?void 0:f.vehicle_plate)||((u=(C=i.delivery)==null?void 0:C.vehicle)==null?void 0:u.vehicle_plate)||"N/A"),1)])])])])]),t("div",es,[e[20]||(e[20]=t("label",{class:"form-label fw-bold"},"Routes Information",-1)),t("div",ts,[t("div",ss,[t("div",is,[e[6]||(e[6]=t("div",null,[t("span",{class:"badge primary-badge me-2"},"Delivery Routes")],-1)),t("div",null,[t("span",as,c(n.getRoutesCount()),1)])])]),t("div",ns,[i.delivery&&i.delivery.routes&&Object.keys(i.delivery.routes).length>0?(o(),d("div",ls,[Object.keys(i.delivery.routes).length>1?(o(),d("ul",rs,[(o(!0),d(D,null,S(Object.entries(i.delivery.routes),(g,x)=>(o(),d("li",{class:"nav-item",key:x},[t("button",{class:I(["nav-link",{active:l.activeRouteTab===x}]),onClick:p=>n.setActiveRoute(x)}," Route #"+c(parseInt(g[0])+1),11,os)]))),128))])):y("",!0),t("div",ds,[(o(!0),d(D,null,S(Object.entries(i.delivery.routes),(g,x)=>N((o(),d("div",{key:x,class:"route-group mb-4"},[Object.keys(i.delivery.routes).length>1?(o(),d("div",cs,[t("h6",us,"Route #"+c(parseInt(g[0])+1),1)])):y("",!0),(o(!0),d(D,null,S(g[1].start_locations,(p,b)=>(o(),d("div",{key:b,class:"timeline-item"},[e[13]||(e[13]=t("div",{class:"timeline-badge"},[t("div",{class:"timeline-circle"})],-1)),t("div",vs,[t("div",hs,[t("div",ms,[t("div",gs,[t("div",fs,[t("h6",ys,"Pick Up #"+c(b),1),t("span",{class:I(["badge",n.getStatusBadgeClass(p.location_status)])},c(p.location_status||"Pending"),3)]),t("div",ps,[t("div",bs,[t("button",{class:"btn btn-sm btn-link p-1",onClick:m=>n.toggleLocationItems(g[0],`start-${b}`)},[t("i",{class:I(["fas",n.isLocationExpanded(g[0],`start-${b}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,_s),x===0&&b===Object.keys(g[1].start_locations)[0]&&i.delivery.status==="pending"?(o(),d("button",{key:0,class:"btn btn-sm btn-success",onClick:e[0]||(e[0]=m=>n.startDeliveryAndRefresh(i.delivery.deliveryID))},e[7]||(e[7]=[t("i",{class:"fas fa-play me-1"},null,-1),_(),t("span",{class:"d-none d-sm-inline"},"Start",-1)]))):y("",!0),n.canScanLocation(g[1],"start",b)&&p.location_status!=="complete"?(o(),d("button",{key:1,class:"btn btn-sm btn-primary",onClick:m=>n.scanQRCode(p.checkpoints)},e[8]||(e[8]=[t("i",{class:"fas fa-qrcode me-1"},null,-1),_(),t("span",{class:"d-none d-sm-inline"},"Scan QR",-1)]),8,Ds)):y("",!0)])])]),t("div",Is,[t("div",ks,[t("button",{class:"btn btn-sm btn-link p-1",onClick:m=>n.toggleLocationItems(g[0],`start-${b}`)},[t("i",{class:I(["fas",n.isLocationExpanded(g[0],`start-${b}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,xs),x===0&&b===Object.keys(g[1].start_locations)[0]&&i.delivery.status==="pending"?(o(),d("button",{key:0,class:"btn btn-sm btn-success",onClick:e[1]||(e[1]=m=>n.startDeliveryAndRefresh(i.delivery.deliveryID))},e[9]||(e[9]=[t("i",{class:"fas fa-play me-1"},null,-1),_(),t("span",null,"Start",-1)]))):y("",!0),n.canScanLocation(g[1],"start",b)&&p.location_status!=="complete"?(o(),d("button",{key:1,class:"btn btn-sm btn-primary",onClick:m=>n.scanQRCode(p.checkpoints)},e[10]||(e[10]=[t("i",{class:"fas fa-qrcode me-1"},null,-1),_(),t("span",null,"Scan QR",-1)]),8,Ss)):y("",!0)])])])]),t("div",Cs,[t("p",null,c(p.company_address),1),t("p",ws,"(Location ID: "+c(p.locationID)+")",1),n.isLocationExpanded(g[0],`start-${b}`)?(o(),d("div",Ps,[t("div",Es,[e[12]||(e[12]=t("div",{class:"card-header bg-light"},[t("strong",null,"Items")],-1)),t("div",Ms,[t("div",$s,[t("table",Ts,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"Item ID"),t("th",null,"Name"),t("th",null,"Quantity"),t("th",null,"Order ID")])],-1)),t("tbody",null,[(o(!0),d(D,null,S(p.checkpoints,(m,A)=>(o(),d(D,{key:A},[(o(!0),d(D,null,S(m.items,($,B)=>(o(),d("tr",{key:`${A}-${B}`},[t("td",null,c(B),1),t("td",null,c($.item_name||"Unknown Item"),1),t("td",null,c($.quantity||1),1),t("td",null,c($.orderID||"N/A"),1)]))),128))],64))),128))])])])])])])):y("",!0)])])]))),128)),(o(!0),d(D,null,S(g[1].end_locations,(p,b)=>(o(),d("div",{key:b,class:"timeline-item"},[e[18]||(e[18]=t("div",{class:"timeline-badge"},[t("div",{class:"timeline-circle"})],-1)),t("div",Fs,[t("div",Ls,[t("div",Os,[t("div",Rs,[t("div",As,[t("h6",js,"Destination #"+c(b),1),t("span",{class:I(["badge",n.getStatusBadgeClass(p.location_status)])},c(p.location_status||"Pending"),3)]),t("div",Ns,[t("div",qs,[t("button",{class:"btn btn-sm btn-link p-1",onClick:m=>n.toggleLocationItems(g[0],`end-${b}`)},[t("i",{class:I(["fas",n.isLocationExpanded(g[0],`end-${b}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Qs),n.canScanLocation(g[1],"end",b)&&p.location_status!=="complete"?(o(),d("button",{key:0,class:"btn btn-sm btn-primary",onClick:m=>n.scanQRCode(p.checkpoints)},e[14]||(e[14]=[t("i",{class:"fas fa-qrcode me-1"},null,-1),_(),t("span",null,"Scan QR",-1)]),8,Vs)):y("",!0)])])]),t("div",Bs,[t("div",Us,[t("button",{class:"btn btn-sm btn-link p-1",onClick:m=>n.toggleLocationItems(g[0],`end-${b}`)},[t("i",{class:I(["fas",n.isLocationExpanded(g[0],`end-${b}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,zs),n.canScanLocation(g[1],"end",b)&&p.location_status!=="complete"?(o(),d("button",{key:0,class:"btn btn-sm btn-primary",onClick:m=>n.scanQRCode(p.checkpoints)},e[15]||(e[15]=[t("i",{class:"fas fa-qrcode me-1"},null,-1),_(),t("span",null,"Scan QR",-1)]),8,Js)):y("",!0)])])])]),t("div",Hs,[t("p",null,c(p.company_address),1),t("p",Ks,"(Location ID: "+c(p.locationID)+")",1),n.isLocationExpanded(g[0],`end-${b}`)?(o(),d("div",Gs,[t("div",Ws,[e[17]||(e[17]=t("div",{class:"card-header bg-light"},[t("strong",null,"Items")],-1)),t("div",Xs,[t("div",Ys,[t("table",Zs,[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"Item ID"),t("th",null,"Name"),t("th",null,"Quantity"),t("th",null,"Order ID")])],-1)),t("tbody",null,[(o(!0),d(D,null,S(p.checkpoints,(m,A)=>(o(),d(D,{key:A},[(o(!0),d(D,null,S(m.items,($,B)=>(o(),d("tr",{key:`${A}-${B}`},[t("td",null,c(B),1),t("td",null,c($.item_name||"Unknown Item"),1),t("td",null,c($.quantity||1),1),t("td",null,c($.orderID||"N/A"),1)]))),128))],64))),128))])])])])])])):y("",!0)])])]))),128))])),[[ae,l.activeRouteTab===x||Object.keys(i.delivery.routes).length===1]])),128))])])):(o(),d("div",ei,e[19]||(e[19]=[t("p",null,"No routes information available",-1)])))])])])]))]),e[22]||(e[22]=t("div",{class:"modal-footer theme-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),l.scannerData?(o(),H(r,{key:0,deliveryID:(w=i.delivery)==null?void 0:w.deliveryID,locationID:l.scannerData.locationID,checkpoints:l.scannerData.checkpoints,ref:"qrScannerModal",onScannerClosed:n.reopenExecuteModal},null,8,["deliveryID","locationID","checkpoints","onScannerClosed"])):y("",!0)],64)}const si=R(Lt,[["render",ti],["__scopeId","data-v-9dc3d901"]]),ii={name:"DeliveryExecution",components:{ResponsiveTable:le,ExecuteModalDelivery:si,LoadingSpinner:W},props:{deliveries:{type:[Array,Object],default:()=>[]},drivers:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},data(){return{modalLoading:!1,error:null,selectedDelivery:null,statusFilter:"",dateFilter:"",searchTerm:"",columns:[{key:"deliveryID",label:"ID",sortable:!0},{key:"driver.fullname",label:"Driver",sortable:!0},{key:"vehicle.vehicle_plate",label:"Vehicle",sortable:!0},{key:"status",label:"Status",sortable:!0}]}},computed:{minDate(){return new Date().toISOString().split("T")[0]},filteredDeliveries(){if(console.log("Filtering deliveries:",this.deliveries),!this.deliveries)return console.log("Deliveries is null or undefined"),[];if(typeof this.deliveries=="object"&&!Array.isArray(this.deliveries)){if(Object.keys(this.deliveries).length===0)return[];const s=Object.values(this.deliveries);return console.log("Converted object to array:",s),this.applyFilters(s)}return Array.isArray(this.deliveries)?this.applyFilters(this.deliveries):(console.log("Deliveries is in an unexpected format"),[])}},methods:{viewDelivery(s){this.modalLoading=!0,console.log("selected deliveries: "+JSON.stringify(s,null,3));const e={...s};e.routes&&typeof e.routes=="object"&&!Array.isArray(e.routes)&&(e.routes=Object.values(e.routes).map(i=>(!i.routeID&&i.start_location&&i.end_location&&(i.routeID=`${i.start_location.locationID}-${i.end_location.locationID}`),i.start_location&&(i.start_location.address=i.start_location.company_address,i.start_location.checkpoints&&Array.isArray(i.start_location.checkpoints)&&(i.start_location.items={},i.start_location.checkpoints.forEach(a=>{a.items&&Object.assign(i.start_location.items,a.items)}))),i.end_location&&(i.end_location.address=i.end_location.company_address,i.end_location.checkpoints&&Array.isArray(i.end_location.checkpoints)&&(i.end_location.items={},i.end_location.checkpoints.forEach(a=>{a.items&&Object.assign(i.end_location.items,a.items)}))),i))),this.selectedDelivery=e,this.$nextTick(()=>{this.modalLoading=!1,this.$refs.executeModal.showModal()})},handleRefresh(){this.$emit("refresh",{status:this.statusFilter,date:this.dateFilter,searchTerm:this.searchTerm})},applyFilters(s){const e=this.searchTerm.toLowerCase();return s.filter(i=>{var a,l;if(this.statusFilter&&i.status!==this.statusFilter)return!1;if(this.dateFilter){const n=new Date(i.scheduled_date);if(new Date(n.getTime()-n.getTimezoneOffset()*6e4).toISOString().split("T")[0]!==this.dateFilter)return!1}if(e){const n=i.deliveryID?String(i.deliveryID).toLowerCase():"",r=(a=i.driver)!=null&&a.fullname?i.driver.fullname.toLowerCase():"",v=(l=i.vehicle)!=null&&l.vehicle_plate?i.vehicle.vehicle_plate.toLowerCase():"";if(!n.includes(e)&&!r.includes(e)&&!v.includes(e))return!1}return!0})},startDelivery(s){console.log("Starting delivery:",s),T.startDelivery(s).then(e=>{this.$emit("refresh")}).catch(e=>{console.error("Error starting delivery:",e)}).finally(()=>{})},getThemeStatusClass(s){switch(s){case"pending":return"bg-warning text-dark";case"in_progress":return"bg-info text-white";case"completed":return"bg-success text-white";case"failed":return"bg-danger text-white";default:return"bg-secondary text-white"}},handleFiltersChanged(){this.$emit("filter-changed",{statusFilter:this.statusFilter,dateFilter:this.dateFilter})},reopenDeliveryModal(s){this.$emit("refresh"),setTimeout(()=>{const e=this.filteredDeliveries.find(i=>i.deliveryID===s);e&&this.viewDelivery(e)},1e3)}},mounted(){},watch:{statusFilter(){this.$emit("filter-changed",{status:this.statusFilter,date:this.dateFilter})},dateFilter(){this.$emit("filter-changed",{status:this.statusFilter,date:this.dateFilter})},searchTerm(){}}},ai={class:"delivery-execution"},ni={class:"card theme-card"},li={class:"card-header d-flex justify-content-between align-items-center theme-header"},ri={class:"card-body theme-body"},oi={key:0,class:"alert alert-danger"},di={key:1},ci={class:"row mb-4"},ui={class:"col-md-4"},vi={class:"form-group"},hi={class:"col-md-4"},mi={class:"form-group"},gi=["min"],fi={class:"col-md-4"},yi={class:"form-group"},pi={class:"btn-group"},bi=["onClick"];function _i(s,e,i,a,l,n){const r=E("ResponsiveTable"),v=E("ExecuteModalDelivery");return o(),d("div",ai,[t("div",ni,[t("div",li,[e[6]||(e[6]=t("h5",{class:"mb-0"},"Execute Deliveries",-1)),t("button",{class:"btn btn-sm theme-btn-outline",onClick:e[0]||(e[0]=(...h)=>n.handleRefresh&&n.handleRefresh(...h))},e[5]||(e[5]=[t("i",{class:"fas fa-sync-alt"},null,-1)]))]),t("div",ri,[l.error?(o(),d("div",oi,c(l.error),1)):(o(),d("div",di,[t("div",ci,[t("div",ui,[t("div",vi,[e[8]||(e[8]=t("label",{for:"statusFilter",class:"form-label theme-label"},"Filter by Status",-1)),N(t("select",{id:"statusFilter","onUpdate:modelValue":e[1]||(e[1]=h=>l.statusFilter=h),class:"form-select theme-select"},e[7]||(e[7]=[J('<option value="" data-v-84b9ceaf>All Statuses</option><option value="pending" data-v-84b9ceaf>Pending</option><option value="in_progress" data-v-84b9ceaf>In Progress</option><option value="completed" data-v-84b9ceaf>Completed</option><option value="failed" data-v-84b9ceaf>Failed</option>',5)]),512),[[K,l.statusFilter]])])]),t("div",hi,[t("div",mi,[e[9]||(e[9]=t("label",{for:"dateFilter",class:"form-label theme-label"},"Filter by Date",-1)),N(t("input",{type:"date",id:"dateFilter","onUpdate:modelValue":e[2]||(e[2]=h=>l.dateFilter=h),class:"form-control theme-input",min:n.minDate,required:""},null,8,gi),[[G,l.dateFilter]])])]),t("div",fi,[t("div",yi,[e[10]||(e[10]=t("label",{for:"searchInput",class:"form-label theme-label"},"Search",-1)),N(t("input",{type:"text",id:"searchInput","onUpdate:modelValue":e[3]||(e[3]=h=>l.searchTerm=h),class:"form-control theme-input",placeholder:"Search by ID, Driver, Vehicle..."},null,512),[[G,l.searchTerm]])])])]),F(r,{columns:l.columns,items:n.filteredDeliveries,loading:i.loading,"has-actions":!0,"show-filters":!1,"item-key":"deliveryID",class:"delivery-table"},{status:X(({item:h})=>[t("span",{class:I(["badge",n.getThemeStatusClass(h.status)])},c(h.status||"Pending"),3)]),actions:X(({item:h})=>[t("div",pi,[t("button",{class:"btn btn-sm btn-primary",onClick:P=>n.viewDelivery(h)},e[11]||(e[11]=[t("i",{class:"fas fa-edit"},null,-1)]),8,bi)])]),_:1},8,["columns","items","loading"])]))])]),F(v,{loading:l.modalLoading,delivery:l.selectedDelivery,ref:"executeModal",onStartDelivery:n.startDelivery,onRefresh:e[4]||(e[4]=h=>s.$emit("refresh")),onReopenDeliveryModal:n.reopenDeliveryModal},null,8,["loading","delivery","onStartDelivery","onReopenDeliveryModal"])])}const Di=R(ii,[["render",_i],["__scopeId","data-v-84b9ceaf"]]),Ii={name:"DeliveryFormModal",emits:["delivery-created"],setup(s,{emit:e}){const i=O(!1),a=O([]),l=O([]),n=O({}),r=O({scheduled_date:"",userID:"",vehicleID:""}),v=Y(()=>new Date().toISOString().split("T")[0]),h=Y(()=>r.value.scheduled_date&&r.value.userID&&r.value.vehicleID),P=()=>{r.value.userID="",r.value.vehicleID="",r.value.scheduled_date&&(M(),L())},M=async()=>{if(r.value.scheduled_date)try{i.value=!0;const u=await T.getDrivers(r.value.scheduled_date);console.log(u),u.success?a.value=u.data:Q("Error",u.message||"Failed to load drivers")}catch(u){console.error("Error fetching drivers:",u),Q("Error","An unexpected error occurred while loading drivers")}finally{i.value=!1}},L=async()=>{if(r.value.scheduled_date)try{i.value=!0;const u=await T.getVehicles(r.value.scheduled_date);u.success?l.value=u.data:Q("Error",u.message||"Failed to load vehicles")}catch(u){console.error("Error fetching vehicles:",u),Q("Error","An unexpected error occurred while loading vehicles")}finally{i.value=!1}},q=()=>(n.value={},r.value.scheduled_date||(n.value.scheduled_date="Scheduled date is required"),r.value.userID||(n.value.userID="Driver is required"),r.value.vehicleID||(n.value.vehicleID="Vehicle is required"),Object.keys(n.value).length===0),j=async()=>{if(q())try{i.value=!0;const u=await T.createDelivery(r.value);if(u.success){ee("Success","Delivery created successfully"),e("delivery-created",u.data),f();const w=document.getElementById("deliveryFormModal");if(w){const g=V.getInstance(w);g&&g.hide()}}else Q("Error",u.message||"Failed to create delivery")}catch(u){console.error("Error creating delivery:",u),Q("Error","An unexpected error occurred while creating the delivery")}finally{i.value=!1}},f=()=>{r.value={scheduled_date:"",userID:"",vehicleID:""},n.value={},a.value=[],l.value=[]},C=()=>{f();const u=document.getElementById("deliveryFormModal");u&&new V(u).show()};return Z(()=>{const u=document.getElementById("deliveryFormModal");u&&u.addEventListener("hidden.bs.modal",f)}),{loading:i,formData:r,drivers:a,vehicles:l,errors:n,minDate:v,isFormValid:h,onDateChange:P,validateAndSubmit:j,showModal:C}}},ki={class:"modal fade",id:"deliveryFormModal",tabindex:"-1","aria-labelledby":"deliveryFormModalLabel","aria-hidden":"true"},xi={class:"modal-dialog"},Si={class:"modal-content theme-modal"},Ci={class:"modal-body theme-body"},wi={key:0,class:"text-center p-4"},Pi={class:"form-group mb-3"},Ei=["min"],Mi={key:0,class:"text-danger mt-1"},$i={class:"form-group mb-3"},Ti=["disabled"],Fi=["value"],Li={key:0,class:"text-muted mt-1"},Oi={key:1,class:"text-danger mt-1"},Ri={class:"form-group mb-3"},Ai=["disabled"],ji=["value"],Ni={key:0,class:"text-muted mt-1"},qi={key:1,class:"text-danger mt-1"},Qi={class:"modal-footer theme-footer"},Vi=["disabled"];function Bi(s,e,i,a,l,n){return o(),d("div",ki,[t("div",xi,[t("div",Si,[e[14]||(e[14]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"deliveryFormModalLabel"},"Create Delivery"),t("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Ci,[a.loading?(o(),d("div",wi,e[6]||(e[6]=[t("div",{class:"spinner-border theme-spinner",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"mt-2 theme-text"},"Processing...",-1)]))):(o(),d("form",{key:1,onSubmit:e[4]||(e[4]=U((...r)=>a.validateAndSubmit&&a.validateAndSubmit(...r),["prevent"]))},[t("div",Pi,[e[7]||(e[7]=t("label",{for:"scheduled_date",class:"form-label theme-label"},"Scheduled Date",-1)),N(t("input",{type:"date",id:"scheduled_date","onUpdate:modelValue":e[0]||(e[0]=r=>a.formData.scheduled_date=r),class:"form-control theme-input",min:a.minDate,onChange:e[1]||(e[1]=(...r)=>a.onDateChange&&a.onDateChange(...r)),required:""},null,40,Ei),[[G,a.formData.scheduled_date]]),a.errors.scheduled_date?(o(),d("div",Mi,c(a.errors.scheduled_date),1)):y("",!0)]),t("div",$i,[e[9]||(e[9]=t("label",{for:"driver",class:"form-label theme-label"},"Driver",-1)),N(t("select",{id:"driver","onUpdate:modelValue":e[2]||(e[2]=r=>a.formData.userID=r),class:"form-select theme-select",disabled:!a.formData.scheduled_date,required:""},[e[8]||(e[8]=t("option",{value:""},"Select Driver",-1)),(o(!0),d(D,null,S(a.drivers,r=>(o(),d("option",{key:r.userID,value:r.userID},c(r.fullname),9,Fi))),128))],8,Ti),[[K,a.formData.userID]]),!a.formData.scheduled_date&&!a.errors.userID?(o(),d("div",Li," Please select a date first ")):y("",!0),a.errors.userID?(o(),d("div",Oi,c(a.errors.userID),1)):y("",!0)]),t("div",Ri,[e[11]||(e[11]=t("label",{for:"vehicle",class:"form-label theme-label"},"Vehicle",-1)),N(t("select",{id:"vehicle","onUpdate:modelValue":e[3]||(e[3]=r=>a.formData.vehicleID=r),class:"form-select theme-select",disabled:!a.formData.scheduled_date,required:""},[e[10]||(e[10]=t("option",{value:""},"Select Vehicle",-1)),(o(!0),d(D,null,S(a.vehicles,r=>(o(),d("option",{key:r.vehicleID,value:r.vehicleID},c(r.vehicle_plate)+" - "+c(r.vehicle_load_weight)+"kg ",9,ji))),128))],8,Ai),[[K,a.formData.vehicleID]]),!a.formData.scheduled_date&&!a.errors.vehicleID?(o(),d("div",Ni," Please select a date first ")):y("",!0),a.errors.vehicleID?(o(),d("div",qi,c(a.errors.vehicleID),1)):y("",!0)])],32))]),t("div",Qi,[e[13]||(e[13]=t("button",{type:"button",class:"btn theme-btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn theme-btn-primary",onClick:e[5]||(e[5]=(...r)=>a.validateAndSubmit&&a.validateAndSubmit(...r)),disabled:a.loading||!a.isFormValid},e[12]||(e[12]=[t("i",{class:"fas fa-save me-1"},null,-1),_(" Create Delivery ")]),8,Vi)])])])])}const Ui=R(Ii,[["render",Bi],["__scopeId","data-v-c413d6ab"]]),zi={name:"CreatedDeliveriesList",components:{LoadingSpinner:W},props:{deliveries:{type:Object,required:!0},loading:{type:Boolean,default:!1},selectedDeliveryID:{type:[Number,String],default:null},expandedDeliveries:{type:Object,default:()=>({})},currentPage:{type:Number,default:1},pagination:{type:Object,default:()=>({current_page:1,last_page:1,total:0})},hasMorePages:{type:Boolean,default:!1}},methods:{formatDate(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Not scheduled"}}},Ji={class:"card theme-card"},Hi={class:"card-header d-flex justify-content-between align-items-center theme-header"},Ki={key:0,class:"p-2 theme-selected-delivery border-bottom"},Gi={class:"d-flex justify-content-between align-items-center"},Wi={class:"d-flex align-items-center"},Xi={class:"card-body p-0"},Yi={key:1,class:"p-3 text-center"},Zi={key:2,class:"list-group list-group-flush"},ea={class:"d-flex justify-content-between align-items-center"},ta={class:"d-flex align-items-center"},sa={class:"form-check me-2"},ia=["id","value","checked","onChange"],aa=["for"],na={class:"visually-hidden"},la={class:"fw-bold"},ra={class:"small"},oa={class:"badge theme-badge-primary me-1"},da={class:"text-muted"},ca=["onClick"],ua={key:0,class:"mt-3 delivery-details theme-details"},va={class:"card theme-inner-card"},ha={class:"card-body"},ma={class:"row"},ga={class:"col-12"},fa={class:"mb-1 w-100"},ya={class:"mb-1 w-100"},pa={class:"mb-1 w-100"},ba={class:"mb-1 w-100"},_a={key:3,class:"d-flex justify-content-center p-2 theme-pagination-container"},Da=["disabled"],Ia={class:"align-self-center mx-2 theme-pagination-text"},ka=["disabled"];function xa(s,e,i,a,l,n){const r=E("LoadingSpinner");return o(),d("div",Ji,[t("div",Hi,[e[7]||(e[7]=t("h5",{class:"mb-0"},"Created Deliveries",-1)),t("div",null,[t("button",{class:"btn btn-sm btn-primary me-2",onClick:e[0]||(e[0]=v=>s.$emit("create-delivery"))},e[5]||(e[5]=[t("i",{class:"fas fa-plus"},null,-1)])),t("button",{class:"btn btn-sm theme-btn-outline",onClick:e[1]||(e[1]=v=>s.$emit("refresh"))},e[6]||(e[6]=[t("i",{class:"fas fa-sync-alt"},null,-1)]))])]),i.selectedDeliveryID?(o(),d("div",Ki,[t("div",Gi,[t("div",Wi,[e[8]||(e[8]=t("span",{class:"badge theme-badge-accent me-2"},"Selected",-1)),t("span",null,"Delivery #"+c(i.selectedDeliveryID),1)]),t("button",{class:"btn btn-sm theme-btn-outline-danger",onClick:e[2]||(e[2]=v=>s.$emit("deselect"))},e[9]||(e[9]=[t("i",{class:"fas fa-times"},null,-1)]))])])):y("",!0),t("div",Xi,[i.loading?(o(),H(r,{key:0,size:"md",message:"Loading deliveries..."})):Object.keys(i.deliveries).length===0?(o(),d("div",Yi,e[10]||(e[10]=[t("p",{class:"text-muted mb-0"},"No deliveries found",-1)]))):(o(),d("ul",Zi,[(o(!0),d(D,null,S(i.deliveries,(v,h)=>{var P,M;return o(),d("li",{key:h,class:I(["list-group-item theme-list-item",{"theme-list-item-active":i.selectedDeliveryID===v.deliveryID}])},[t("div",ea,[t("div",ta,[t("div",sa,[t("input",{class:"form-check-input theme-checkbox",type:"radio",id:"delivery-"+v.deliveryID,name:"selectedDelivery",value:v.deliveryID,checked:i.selectedDeliveryID===v.deliveryID,onChange:L=>s.$emit("select",v.deliveryID)},null,40,ia),t("label",{class:"form-check-label",for:"delivery-"+v.deliveryID},[t("span",na,"Select Delivery #"+c(v.deliveryID),1)],8,aa)]),t("div",null,[t("div",la,"Delivery #"+c(v.deliveryID),1),t("div",ra,[t("span",oa,c(v.status||"Pending"),1),t("span",da,c(n.formatDate(v.scheduledDate)),1)])])]),t("div",null,[t("i",{class:I(["fas theme-icon expand-icon",i.expandedDeliveries[v.deliveryID]?"fa-chevron-up":"fa-chevron-down"]),onClick:U(L=>s.$emit("toggle-details",v.deliveryID),["stop"])},null,10,ca)])]),i.expandedDeliveries[v.deliveryID]?(o(),d("div",ua,[t("div",va,[t("div",ha,[t("div",ma,[t("div",ga,[e[15]||(e[15]=t("h6",{class:"theme-subtitle"},"Delivery Information",-1)),t("p",fa,[e[11]||(e[11]=t("strong",null,"Status:",-1)),_(" "+c(v.status||"Pending"),1)]),t("p",ya,[e[12]||(e[12]=t("strong",null,"Scheduled Date:",-1)),_(" "+c(n.formatDate(v.scheduledDate)),1)]),t("p",pa,[e[13]||(e[13]=t("strong",null,"Driver:",-1)),_(" "+c(((P=v.driver)==null?void 0:P.fullname)||"Not assigned"),1)]),t("p",ba,[e[14]||(e[14]=t("strong",null,"Vehicle:",-1)),_(" "+c(((M=v.vehicle)==null?void 0:M.vehicle_plate)||"Not assigned"),1)])])])])])])):y("",!0)],2)}),128))])),Object.keys(i.deliveries).length>0?(o(),d("div",_a,[t("button",{class:"btn btn-sm theme-btn-outline me-2",disabled:i.currentPage<=1,onClick:e[3]||(e[3]=v=>s.$emit("change-page",i.currentPage-1))},e[16]||(e[16]=[t("i",{class:"fas fa-chevron-left"},null,-1)]),8,Da),t("span",Ia," Page "+c(i.currentPage)+" of "+c(i.pagination.last_page)+" ("+c(i.pagination.total)+" total) ",1),t("button",{class:"btn btn-sm theme-btn-outline ms-2",disabled:!i.hasMorePages,onClick:e[4]||(e[4]=v=>s.$emit("change-page",i.currentPage+1))},e[17]||(e[17]=[t("i",{class:"fas fa-chevron-right"},null,-1)]),8,ka)])):y("",!0)])])}const Sa=R(zi,[["render",xa],["__scopeId","data-v-1ac892a8"]]),Ca={name:"DeliveryPage",components:{StatsCard:me,DeliveryAssignment:pt,DeliveryExecution:Di,DeliveryFormModal:Ui,CreatedDeliveriesList:Sa},data(){return{activeTab:"assign",loading:!0,createdDeliveriesLoading:!1,assignDeliveriesLoading:!1,executeDeliveriesLoading:!1,pendingSelectionID:null,assignError:null,executeError:null,trips:[],tripsPagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},executionDeliveries:{},pagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},createdDeliveriesPagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},deliveryStats:{pending:0,inProgress:0,completedToday:0,issues:0},selectedLocationID:"",locations:[],drivers:[],vehicles:[],expandedOrders:{},assignmentForm:{deliveryID:null,locationID:null,orderID:null,userID:"",vehicleID:"",scheduledDate:new Date().toISOString().split("T")[0],checkIDs:[],fromLocation:null,toLocation:null},locationInfo:{from:null,to:null},assignmentLoading:!1,createdDeliveries:{},createdDeliveriesPage:1,createdDeliveriesPerPage:3,hasMoreCreatedDeliveries:!1,selectedDeliveryID:null,selectedOrderInfo:null,expandedDeliveries:{},deliveryFormModal:null,activePhase:1}},mounted(){this.fetchTrips(),this.fetchDeliveryStats(),this.fetchCreatedDeliveries()},created(){const s=this.$route.query.selectionID;console.log("Selection ID From Parameter:",s),s&&(this.activeTab="execute",this.pendingSelectionID=s)},watch:{activeTab:{immediate:!0,handler(s){s==="execute"&&this.refreshExecutionDeliveries({}).then(()=>{if(this.pendingSelectionID){const e=Number(this.pendingSelectionID),i=this.executionDeliveries.find(a=>a.deliveryID===e);console.log("Delivery Found:",i),i&&(this.$refs.deliveryExecution.viewDelivery(i),this.pendingSelectionID=null)}})}}},methods:{async fetchTrips(){try{this.assignDeliveriesLoading=!0,this.assignError=null;const s=await T.getTrips({locationID:this.selectedLocationID,page:this.tripsPagination.current_page,per_page:this.tripsPagination.per_page,phase:this.activePhase});s.success?(this.trips=s.data,this.tripsPagination=s.pagination):this.assignError="Failed to fetch trips"}catch(s){console.error("Error fetching trips:",s),this.assignError=s.message||"An error occurred while fetching trips"}finally{this.assignDeliveriesLoading=!1}},handlePhaseChange(s){this.activePhase=s,this.fetchTrips()},handleTripsPageChange(s){this.currentPage=s,this.fetchTrips()},async assignTrip(s){try{if(!this.selectedDeliveryID){this.assignError="Please select a delivery first";return}const e=await T.assignSingleTrip({deliveryID:this.selectedDeliveryID,tripID:s.tripID});e&&e.success?(await this.fetchTrips(),await this.refreshCreatedDeliveries(),z({type:"success",title:"Success",message:e.message||"Delivery assigned successfully",buttons:[{label:"OK",type:"success",dismiss:!0,onClick:()=>{this.fetchTrips(),this.fetchDeliveryStats(),this.fetchCreatedDeliveries()}}]})):this.assignError=e&&e.message||"Failed to assign trip"}catch(e){console.error("Error assigning trip:",e),this.assignError=e.message||"An error occurred while assigning trip"}},deselectDelivery(){console.log("Deselecting delivery, current selectedDeliveryID:",this.selectedDeliveryID),this.selectedDeliveryID=null,console.log("After deselection, selectedDeliveryID:",this.selectedDeliveryID),this.fetchTrips()},onDeliveryCreated(){this.refreshCreatedDeliveries(),this.refreshAssignDeliveries()},formatDate(s){if(!s)return"";const e=new Date(s);return isNaN(e.getTime())?"":e.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})},async fetchCreatedDeliveries(){try{this.createdDeliveriesLoading=!0,this.assignError=null;const s=await T.getCreatedDeliveries(this.createdDeliveriesPage,3);s.success?(this.createdDeliveries=s.data,this.hasMoreCreatedDeliveries=s.pagination.current_page<s.pagination.last_page,this.createdDeliveriesPagination=s.pagination):this.assignError=s.message||"Failed to fetch created deliveries"}catch(s){console.error("Error fetching created deliveries:",s),this.assignError="An error occurred while fetching deliveries"}finally{this.createdDeliveriesLoading=!1}this.fetchDeliveryStats()},selectDelivery(s){this.selectedDeliveryID=s,this.fetchTrips()},changeCreatedDeliveriesPage(s){s<1||s>1&&!this.hasMoreCreatedDeliveries||(this.createdDeliveriesPage=s,this.fetchCreatedDeliveries())},viewDeliveryDetails(s){var e,i,a,l;z({type:"info",title:`Delivery Details - #${s.deliveryID}`,message:`
          <div>
            <p><strong>From:</strong> ${this.getLocationName((e=s.from)==null?void 0:e.locationID)}</p>
            <p><strong>To:</strong> ${this.getLocationName((i=s.to)==null?void 0:i.locationID)}</p>
            <p><strong>Status:</strong> ${s.status||"Pending"}</p>
            <p><strong>Scheduled Date:</strong> ${s.scheduledDate}</p>
            <p><strong>Driver:</strong> ${((a=s.driver)==null?void 0:a.name)||"Not assigned"}</p>
            <p><strong>Vehicle:</strong> ${((l=s.vehicle)==null?void 0:l.vehicle_plate)||"Not assigned"}</p>
          </div>
        `,buttons:[{label:"Close",type:"secondary",dismiss:!0}]})},handleLocationChange(s){this.selectedLocationID=s,this.pagination.current_page=1,this.fetchTrips()},refreshData(){this.fetchDeliveryStats(),this.selectedOrderInfo=null,this.activeTab==="execute"&&this.refreshExecutionDeliveries()},async refreshCreatedDeliveries(){try{this.createdDeliveriesLoading=!0,this.assignError=null;const s=await T.getCreatedDeliveries(this.createdDeliveriesPage,3);s.success?(this.createdDeliveries=s.data,this.hasMoreCreatedDeliveries=s.pagination.current_page<s.pagination.last_page,this.createdDeliveriesPagination=s.pagination):this.assignError=s.message||"Failed to fetch created deliveries"}catch(s){console.error("Error fetching created deliveries:",s),this.assignError="An error occurred while fetching deliveries"}finally{this.createdDeliveriesLoading=!1}this.fetchDeliveryStats()},async refreshAssignDeliveries(){try{this.assignDeliveriesLoading=!0,this.assignError=null;const s=await T.getTrips({locationID:this.selectedLocationID,page:this.tripsPagination.current_page,per_page:this.tripsPagination.per_page,phase:this.activePhase});console.log("API Response Assign Deliveries:",JSON.stringify(s,null,4)),s.success?(this.groupedDeliveries=s.data,this.tripsPagination=s.pagination):this.assignError=s.message||"Failed to load delivery data"}catch(s){console.error("Error fetching delivery data:",s),this.assignError="An unexpected error occurred while loading delivery data"}finally{this.assignDeliveriesLoading=!1}this.fetchDeliveryStats()},changePage(s){s<1||s>this.pagination.last_page||(this.pagination.current_page=s,this.fetchTrips())},getPageNumbers(){const s=this.pagination.last_page,e=this.pagination.current_page;return s<=5?Array.from({length:s},(i,a)=>a+1):e<=3?[1,2,3,4,5]:e>=s-2?[s-4,s-3,s-2,s-1,s]:[e-2,e-1,e,e+1,e+2]},getLocationName(s){const e=this.locations.find(i=>i.locationID==s);return e?e.company_address:null},formatPrice(s){return parseFloat(s).toFixed(2)},calculateTotalMeasurement(s){return Array.isArray(s)?s.reduce((i,a)=>a.measurement_type&&a.measurement_type.toLowerCase().includes("kg")?i+parseFloat(a.measurement_value||0)*parseFloat(a.quantity||1):i,0).toFixed(2):(console.warn("Items is not an array:",s),0)},toggleOrderDetails(s,e){const i=`${s}-${e}`;this.expandedOrders||(this.expandedOrders={}),this.expandedOrders[i]=!this.isOrderExpanded(s,e)},isOrderExpanded(s,e){if(!this.expandedOrders)return!1;const i=`${s}-${e}`;return!!this.expandedOrders[i]},getOrderInfo(s,e){return!this.groupedDeliveries[s]||!this.groupedDeliveries[s].orders[e]?null:this.groupedDeliveries[s].orders[e]},getLocationInfo(s,e){const i=this.getOrderInfo(s,e);return i?{from:i.from||null,to:i.to||null}:{from:null,to:null}},async assignDelivery(s,e){try{if(this.assignmentForm={locationID:s,orderID:e,deliveryID:this.selectedDeliveryID,scheduledDate:new Date().toISOString().split("T")[0],checkIDs:[],fromLocation:null,toLocation:null},console.log("Assignment form initialized:",this.assignmentForm),this.locationInfo={from:null,to:null},this.groupedDeliveries[s]){const i=this.groupedDeliveries[s];if(console.log("Location data found:",i),i.orders&&i.orders[e]){const a=i.orders[e];console.log("Order data found:",a),this.locationInfo={from:a.from||i.from||null,to:a.to||i.to||null},this.selectedOrderInfo=a}}this.$refs.assignmentModal.show()}catch(i){console.error("Error in assignDelivery:",i),z({type:"error",title:"Error",message:(i==null?void 0:i.message)||"An error occurred while preparing the assignment",buttons:[{label:"OK",type:"primary",dismiss:!0}]})}},getLocationInfo(s,e){const i=this.getOrderInfo(s,e);return i?{from:i.from||null,to:i.to||null}:{from:null,to:null}},handleValidationError(s){z({type:"warning",title:"Validation Error",message:s||"Please check your input and try again"})},toggleDeliveryDetails(s){if(this.expandedDeliveries||(this.expandedDeliveries={}),this.expandedDeliveries[s]=!this.expandedDeliveries[s],this.expandedDeliveries[s]){const e=s.toString();Object.keys(this.expandedDeliveries).forEach(i=>{i!==e&&(this.expandedDeliveries[i]=!1)})}},async fetchDeliveryStats(){try{const s=await T.getDeliveryStats();s.success?this.deliveryStats=s.data:console.error("Failed to fetch delivery stats:",s.message)}catch(s){console.error("Error fetching delivery stats:",s)}},async refreshExecutionDeliveries(s={}){try{this.executeDeliveriesLoading=!0,this.executeError=null,console.log("Fetching execution deliveries with filters:",s);const e=await T.getExecutionDeliveries(s);e.success?(this.executionDeliveries=Object.values(e.data),console.log("execution deliveries structure:",JSON.stringify(this.executionDeliveries,null,2))):this.executeError=e.message||"Failed to load execution deliveries"}catch(e){console.error("Error fetching execution deliveries:",e),this.executeError="An error occurred while loading execution deliveries. Please try again later."}finally{this.executeDeliveriesLoading=!1}},handleExecutionFilterChange(s){this.refreshExecutionDeliveries(s)},openCreateDeliveryModal(){const s=document.getElementById("deliveryFormModal");s?new V(s).show():console.error("Modal element not found with ID: deliveryFormModal")},openAssignmentModal(s){this.selectedOrderInfo=s;const e=this.$refs.assignmentModal;e&&e.setDeliveryID(this.selectedDeliveryID);const i=document.getElementById("assignmentModal");i&&new V(i).show()}}},wa={class:"delivery-management"},Pa={class:"row delivery-tabs mb-4"},Ea={class:"col-md-6 mb-3"},Ma={class:"col-md-6 mb-3"},$a={key:0,class:"row"},Ta={class:"col-lg-3 col-md-12 mb-4"},Fa={class:"col-lg-9 col-md-12"},La={key:1};function Oa(s,e,i,a,l,n){const r=E("StatsCard"),v=E("CreatedDeliveriesList"),h=E("DeliveryAssignment"),P=E("DeliveryExecution"),M=E("DeliveryFormModal");return o(),d("div",wa,[e[4]||(e[4]=t("h1",{class:"mb-4"},"Delivery Management",-1)),F(r,{stats:l.deliveryStats},null,8,["stats"]),t("div",Pa,[t("div",Ea,[t("div",{class:I(["delivery-tab-card",{active:l.activeTab==="assign"}]),onClick:e[0]||(e[0]=L=>l.activeTab="assign")},e[2]||(e[2]=[J('<div class="tab-icon" data-v-9d9ba381><i class="fas fa-clipboard-list" data-v-9d9ba381></i></div><div class="tab-content" data-v-9d9ba381><div class="tab-title" data-v-9d9ba381>Assign Deliveries</div><div class="tab-desc" data-v-9d9ba381>Create and assign delivery trips to drivers</div></div>',2)]),2)]),t("div",Ma,[t("div",{class:I(["delivery-tab-card",{active:l.activeTab==="execute"}]),onClick:e[1]||(e[1]=L=>l.activeTab="execute")},e[3]||(e[3]=[J('<div class="tab-icon" data-v-9d9ba381><i class="fas fa-truck" data-v-9d9ba381></i></div><div class="tab-content" data-v-9d9ba381><div class="tab-title" data-v-9d9ba381>Execute Deliveries</div><div class="tab-desc" data-v-9d9ba381>Track and manage ongoing deliveries</div></div>',2)]),2)])]),l.activeTab==="assign"?(o(),d("div",$a,[t("div",Ta,[F(v,{deliveries:l.createdDeliveries,loading:l.createdDeliveriesLoading,selectedDeliveryID:l.selectedDeliveryID,expandedDeliveries:l.expandedDeliveries,currentPage:l.createdDeliveriesPage,pagination:l.createdDeliveriesPagination,hasMorePages:l.hasMoreCreatedDeliveries,onCreateDelivery:n.openCreateDeliveryModal,onRefresh:n.refreshCreatedDeliveries,onSelect:n.selectDelivery,onDeselect:n.deselectDelivery,onToggleDetails:n.toggleDeliveryDetails,onChangePage:n.changeCreatedDeliveriesPage},null,8,["deliveries","loading","selectedDeliveryID","expandedDeliveries","currentPage","pagination","hasMorePages","onCreateDelivery","onRefresh","onSelect","onDeselect","onToggleDetails","onChangePage"])]),t("div",Fa,[l.activeTab==="assign"?(o(),H(h,{key:0,loading:l.assignDeliveriesLoading,error:l.assignError,trips:l.trips,pagination:l.tripsPagination,selectedDeliveryID:l.selectedDeliveryID,activePhase:l.activePhase,onRefresh:n.fetchTrips,onAssignTrip:n.assignTrip,onChangePhase:n.handlePhaseChange,onChangePage:n.handleTripsPageChange},null,8,["loading","error","trips","pagination","selectedDeliveryID","activePhase","onRefresh","onAssignTrip","onChangePhase","onChangePage"])):y("",!0)])])):y("",!0),l.activeTab==="execute"?(o(),d("div",La,[F(P,{ref:"deliveryExecution",deliveries:l.executionDeliveries,loading:l.executeDeliveriesLoading,error:l.executeError,onRefresh:n.refreshExecutionDeliveries,onFilterChanged:n.handleExecutionFilterChange},null,8,["deliveries","loading","error","onRefresh","onFilterChanged"])])):y("",!0),F(M,{ref:"deliveryFormModal",onDeliveryCreated:n.onDeliveryCreated},null,8,["onDeliveryCreated"])])}const Qa=R(Ca,[["render",Oa],["__scopeId","data-v-9d9ba381"]]);export{Qa as default};
