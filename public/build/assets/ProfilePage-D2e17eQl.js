import{_ as $,x as I,c as o,a as t,d as S,b as E,e as P,w as D,v as L,o as s,z as M,r as u,G as A,F as N,j as q,t as R,h as H,A as Z,f as B,g as z,n as ee,y as te,D as ie}from"./main-BpaYbEPg.js";import{m}from"./modal-ByxZIVwL.js";import{m as ae}from"./marketplaceService-CbDHmkiN.js";const oe={name:"ProfileInfo",props:{profileData:{type:Object,required:!0},profileImage:{type:String,default:null},editMode:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["toggle-edit","save","cancel","image-change"],setup(l){return{isAdmin:I(()=>l.profileData.role==="admin")}}},se={class:"card theme-card"},ne={class:"card-header d-flex justify-content-between align-items-center theme-header"},le={key:1},re={class:"card-body theme-body"},de={key:0,class:"text-center py-4"},ce={key:1},me={class:"row mb-4"},fe={class:"col-md-3 text-center"},ue={class:"avatar-container mb-3"},pe=["src"],ye={key:0,class:"mt-2"},ve={class:"col-md-9"},ge={key:0,class:"mb-3"},be=["disabled"],_e={key:1,class:"mb-3"},we=["disabled"],Ce={class:"mb-3"},he=["disabled"],ke={class:"mb-3"},Ee=["disabled"],De={class:"mb-3"};function Le(l,e,n,i,_,v){return s(),o("div",se,[t("div",ne,[e[13]||(e[13]=t("h5",{class:"mb-0"},"Profile Information",-1)),n.editMode?(s(),o("div",le,[t("button",{class:"btn btn-success theme-btn-primary me-2",onClick:e[1]||(e[1]=a=>l.$emit("save"))},e[11]||(e[11]=[t("i",{class:"bi bi-check-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Save",-1)])),t("button",{class:"btn btn-secondary theme-btn-secondary",onClick:e[2]||(e[2]=a=>l.$emit("toggle-edit"))},e[12]||(e[12]=[t("i",{class:"bi bi-x-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Cancel",-1)]))])):(s(),o("button",{key:0,class:"btn btn-primary theme-btn-primary",onClick:e[0]||(e[0]=a=>l.$emit("toggle-edit"))},e[10]||(e[10]=[t("i",{class:"bi bi-pencil-fill me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Edit Profile",-1)])))]),t("div",re,[n.loading?(s(),o("div",de,e[14]||(e[14]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):(s(),o("div",ce,[t("form",{onSubmit:e[9]||(e[9]=S(a=>l.$emit("save"),["prevent"]))},[t("div",me,[t("div",fe,[t("div",ue,[t("img",{src:n.profileImage||"/images/blank.jpg",alt:"Profile Picture",class:"rounded-circle img-thumbnail",style:{width:"150px",height:"150px","object-fit":"cover"}},null,8,pe),n.editMode?(s(),o("div",ye,[e[15]||(e[15]=t("label",{for:"profile-image",class:"btn btn-sm btn-outline-primary"},[t("i",{class:"bi bi-camera-fill me-1"}),P(" Change Photo ")],-1)),t("input",{type:"file",id:"profile-image",class:"d-none",accept:"image/*",onChange:e[3]||(e[3]=a=>l.$emit("image-change",a))},null,32)])):E("",!0)])]),t("div",ve,[i.isAdmin?(s(),o("div",ge,[e[16]||(e[16]=t("label",{for:"company_name",class:"form-label"},"Company Name",-1)),D(t("input",{type:"text",class:"form-control",id:"company_name","onUpdate:modelValue":e[4]||(e[4]=a=>n.profileData.company_name=a),disabled:!n.editMode,required:""},null,8,be),[[L,n.profileData.company_name]])])):(s(),o("div",_e,[e[17]||(e[17]=t("label",{for:"fullname",class:"form-label"},"Full Name",-1)),D(t("input",{type:"text",class:"form-control",id:"fullname","onUpdate:modelValue":e[5]||(e[5]=a=>n.profileData.fullname=a),disabled:!n.editMode,required:""},null,8,we),[[L,n.profileData.fullname]])])),t("div",Ce,[e[18]||(e[18]=t("label",{for:"email",class:"form-label"},"Email Address",-1)),D(t("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":e[6]||(e[6]=a=>n.profileData.email=a),disabled:!n.editMode,required:""},null,8,he),[[L,n.profileData.email]])]),t("div",ke,[e[19]||(e[19]=t("label",{for:"tel_number",class:"form-label"},"Phone Number",-1)),D(t("input",{type:"tel",class:"form-control",id:"tel_number","onUpdate:modelValue":e[7]||(e[7]=a=>n.profileData.tel_number=a),disabled:!n.editMode},null,8,Ee),[[L,n.profileData.tel_number]])]),t("div",De,[e[20]||(e[20]=t("label",{for:"status",class:"form-label"},"Status",-1)),D(t("input",{type:"text",class:"form-control",id:"status","onUpdate:modelValue":e[8]||(e[8]=a=>n.profileData.status=a),disabled:""},null,512),[[L,n.profileData.status]])])])])],32)]))])])}const Pe=$(oe,[["render",Le],["__scopeId","data-v-15ee4d71"]]),Me={async fetchCertifications(){try{return(await M.get("/api/profile/certifications")).certifications||[]}catch(l){return console.error("Error fetching certifications:",l),m.danger("Error","Failed to load certifications. Please try again."),[]}},async updateCertifications(l){try{return await M.post("/api/profile/certifications",l,{headers:{"Content-Type":"multipart/form-data"}})}catch(e){throw console.error("Error updating certifications:",e),e}},async deleteCertification(l){try{return await M.delete(`/api/profile/certifications/${l}`)}catch(e){throw console.error("Error deleting certification:",e),e}}},xe={name:"CompanyCertifications",props:{certifications:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["toggle-edit","loading","update:certifications","refresh-data"],setup(l,{emit:e}){const n=u(!1),i=u([]),_=()=>{i.value=l.certifications.map(d=>({...d,newFile:null})),i.value.length===0&&v()};A([()=>l.editMode,()=>l.certifications],([d])=>{d&&_()},{immediate:!0});const v=()=>{i.value.push({cert_type:"",cert_file:null,newFile:null})},a=async(d,h)=>{if(l.editMode){p(d);return}const w=h.cert_type||"this certification";try{m.confirm("Delete Certification",`Are you sure you want to delete "${w}"? This action cannot be undone and the certificate file will be permanently removed.`,()=>{p(d)},null,{confirmLabel:"Yes, Delete",cancelLabel:"Cancel",confirmType:"danger"})}catch{console.log("Delete cancelled")}},p=async d=>{const h=i.value[d];if(h.certID)try{await M.delete(`/api/profile/certifications/${h.certID}`),console.log("Certification deleted from server")}catch(w){console.error("Error deleting certification from server:",w),m.danger("Error","Failed to delete certification from server");return}i.value.splice(d,1),i.value.length===0&&v()};return{saving:n,editableCertifications:i,addNewCertification:v,confirmDeleteCertification:a,removeCertification:p,handleFileChange:(d,h)=>{const w=d.target.files[0];if(!w)return;if(!["application/pdf","image/jpeg","image/jpg","image/png"].includes(w.type)){m.danger("Invalid File","Please select a PDF or image file"),d.target.value=null;return}if(w.size>5*1024*1024){m.danger("File Too Large","File size should not exceed 5MB"),d.target.value=null;return}i.value[h].newFile=w},getFileUrl:d=>d?d.startsWith("http")?d:`/storage/${d}`:"",saveCertifications:async()=>{try{e("loading",!0),n.value=!0;const d=new FormData,h=i.value.filter(C=>C.cert_type&&(C.cert_file||C.newFile));if(h.length===0){m.danger("Error","Please add at least one certification with both type and file.");return}h.forEach((C,x)=>{d.append(`certifications[${x}][cert_type]`,C.cert_type),C.newFile?d.append(`certifications[${x}][cert_file]`,C.newFile):C.cert_file&&d.append(`certifications[${x}][existing_file]`,C.cert_file)});const w=await Me.updateCertifications(d);m.success("Success","Certifications updated successfully"),e("update:certifications",w.certifications),e("toggle-edit"),e("refresh-data")}catch(d){console.error("Error updating certifications:",d),m.danger("Error","Failed to update certifications. Please try again.")}finally{e("loading",!1),n.value=!1}},cancelEdit:()=>{e("toggle-edit"),e("refresh-data")}}}},Ve={class:"card mb-4 theme-card"},Fe={class:"card-header d-flex justify-content-between align-items-center theme-header"},Ie={key:1},Se={class:"card-body theme-body"},Ue={key:0,class:"text-center py-4"},Te={key:1},Ae={key:0},Ne={key:0,class:"text-center py-3"},qe={key:1,class:"certification-list"},Re={class:"d-flex justify-content-between align-items-center"},$e={class:"fw-bold"},je={class:"text-muted small"},Be=["href"],ze={key:1},Oe={class:"row g-2"},Je={class:"col-md-6"},He=["onUpdate:modelValue","onBlur"],We={class:"col-md-4"},Ye=["onChange","required"],Ge={key:0,class:"form-text"},Ke=["href"],Qe={class:"col-md-2 d-flex align-items-end"},Xe=["onClick"],Ze={class:"mb-3"};function et(l,e,n,i,_,v){return s(),o("div",Ve,[t("div",Fe,[e[8]||(e[8]=t("h5",{class:"mb-0"},"Certifications",-1)),n.editMode?(s(),o("div",Ie,[t("button",{class:"btn btn-success theme-btn-primary me-2",onClick:e[1]||(e[1]=(...a)=>i.saveCertifications&&i.saveCertifications(...a))},e[6]||(e[6]=[t("i",{class:"bi bi-check-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Save",-1)])),t("button",{class:"btn btn-secondary theme-btn-secondary",onClick:e[2]||(e[2]=(...a)=>i.cancelEdit&&i.cancelEdit(...a))},e[7]||(e[7]=[t("i",{class:"bi bi-x-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Cancel",-1)]))])):(s(),o("button",{key:0,class:"btn btn-primary theme-btn-primary",onClick:e[0]||(e[0]=a=>l.$emit("toggle-edit"))},e[5]||(e[5]=[t("i",{class:"bi bi-pencil-fill me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Manage Certifications",-1)])))]),t("div",Se,[n.loading?(s(),o("div",Ue,e[9]||(e[9]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):(s(),o("div",Te,[n.editMode?(s(),o("div",ze,[t("form",{onSubmit:e[4]||(e[4]=S((...a)=>i.saveCertifications&&i.saveCertifications(...a),["prevent"]))},[(s(!0),o(N,null,q(i.editableCertifications,(a,p)=>(s(),o("div",{key:p,class:"certification-item mb-3 p-3 border rounded"},[t("div",Oe,[t("div",Je,[e[13]||(e[13]=t("label",{class:"form-label"},"Certificate Type",-1)),D(t("input",{type:"text",class:"form-control","onUpdate:modelValue":g=>a.cert_type=g,required:"",minlength:"1",placeholder:"e.g., Halal Certification",onBlur:g=>a.cert_type=a.cert_type.trim()},null,40,He),[[L,a.cert_type]])]),t("div",We,[e[15]||(e[15]=t("label",{class:"form-label"},"Certificate File",-1)),t("input",{type:"file",class:"form-control",onChange:g=>i.handleFileChange(g,p),accept:".pdf,.jpg,.jpeg,.png",required:!a.cert_file},null,40,Ye),a.cert_file&&!a.newFile?(s(),o("div",Ge,[t("a",{href:i.getFileUrl(a.cert_file),target:"_blank",class:"text-primary"},e[14]||(e[14]=[t("i",{class:"fas fa-file me-1"},null,-1),P(" Current file ")]),8,Ke)])):E("",!0)]),t("div",Qe,[t("button",{type:"button",class:"btn btn-danger btn-sm w-100",onClick:g=>i.confirmDeleteCertification(p,a)},e[16]||(e[16]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Xe)])])]))),128)),t("div",Ze,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:e[3]||(e[3]=(...a)=>i.addNewCertification&&i.addNewCertification(...a))},e[17]||(e[17]=[t("i",{class:"fas fa-plus me-1"},null,-1),P(" Add Certification ")]))])],32)])):(s(),o("div",Ae,[n.certifications.length===0?(s(),o("div",Ne,e[10]||(e[10]=[t("i",{class:"fas fa-certificate text-muted mb-2",style:{"font-size":"2rem"}},null,-1),t("p",{class:"text-muted"},"No certifications added yet",-1)]))):(s(),o("div",qe,[(s(!0),o(N,null,q(n.certifications,(a,p)=>(s(),o("div",{key:a.certID||p,class:"certification-item mb-3 p-3 border rounded"},[t("div",Re,[t("div",null,[t("div",$e,R(a.cert_type),1),t("div",je,[t("a",{href:i.getFileUrl(a.cert_file),target:"_blank",class:"text-primary"},e[11]||(e[11]=[t("i",{class:"fas fa-file-pdf me-1"},null,-1),P(" View Certificate ")]),8,Be)])]),e[12]||(e[12]=t("div",{class:"ms-auto"},[t("span",{class:"badge bg-success"},"Active")],-1))])]))),128))]))]))]))])])}const tt=$(xe,[["render",et],["__scopeId","data-v-98f2ef4a"]]),it={name:"CompanyLocations",props:{locations:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["update:locations","loading","toggle-edit"],setup(l,{emit:e}){const n=H(),i=u(!1),_=u([]),v=u([]),a=I(()=>{const f=n.getters.user;return f&&f.company?f.company.company_type:"admin"});return A(()=>l.locations,f=>{l.editMode&&(_.value=Array.isArray(f)?JSON.parse(JSON.stringify(f||[])):[])},{immediate:!0}),A(()=>l.editMode,f=>{f&&(_.value=Array.isArray(l.locations)?JSON.parse(JSON.stringify(l.locations||[])):[],v.value=[])}),{saving:i,editableLocations:_,companyType:a,addNewLocation:()=>{_.value.push({company_address:"",location_type:"headquarters"})},removeLocation:f=>{const r=_.value[f];r.locationID&&v.value.push(r.locationID),_.value.splice(f,1)},saveLocations:async()=>{i.value=!0,e("loading",!0);try{const f={locations:_.value||[],delete_ids:v.value||[]},r=await M.post("/api/profile/locations",f);e("update:locations",r.locations||[]),m.success("Success","Company locations updated successfully"),e("toggle-edit")}catch(f){console.error("Error saving locations:",f),m.danger("Error","Failed to update company locations. Please try again.")}finally{i.value=!1,e("loading",!1)}}}}},at={class:"card mb-4 theme-card"},ot={class:"card-header d-flex justify-content-between align-items-center theme-header"},st={key:1},nt={class:"card-body theme-body"},lt={key:0,class:"text-center py-4"},rt={key:1},dt={key:0},ct={key:0,class:"text-center py-3"},mt={key:1,class:"location-list"},ft={class:"d-flex justify-content-between"},ut={class:"fw-bold"},pt={class:"text-muted small"},yt={key:1},vt={class:"row g-2"},gt={class:"col-md-6"},bt=["onUpdate:modelValue"],_t={class:"col-md-4"},wt=["onUpdate:modelValue"],Ct={key:0,value:"supplier"},ht={key:1,value:"slaughterhouse"},kt={key:2,value:"kitchen"},Et={class:"col-md-2 d-flex align-items-end"},Dt=["onClick"],Lt={class:"mb-3"},Pt={class:"d-flex justify-content-end"},Mt=["disabled"],xt={key:0,class:"spinner-border spinner-border-sm ms-1",role:"status","aria-hidden":"true"};function Vt(l,e,n,i,_,v){return s(),o("div",at,[t("div",ot,[e[8]||(e[8]=t("h5",{class:"mb-0"},"Company Locations",-1)),n.editMode?(s(),o("div",st,[t("button",{class:"btn btn-success theme-btn-primary me-2",onClick:e[1]||(e[1]=(...a)=>i.saveLocations&&i.saveLocations(...a))},e[6]||(e[6]=[t("i",{class:"bi bi-check-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Save",-1)])),t("button",{class:"btn btn-secondary theme-btn-secondary",onClick:e[2]||(e[2]=a=>l.$emit("toggle-edit"))},e[7]||(e[7]=[t("i",{class:"bi bi-x-lg me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Cancel",-1)]))])):(s(),o("button",{key:0,class:"btn btn-primary theme-btn-primary",onClick:e[0]||(e[0]=a=>l.$emit("toggle-edit"))},e[5]||(e[5]=[t("i",{class:"bi bi-pencil-fill me-1"},null,-1),t("span",{class:"d-none d-md-inline"},"Edit Locations",-1)])))]),t("div",nt,[n.loading?(s(),o("div",lt,e[9]||(e[9]=[t("div",{class:"spinner-border text-primary",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1)]))):(s(),o("div",rt,[n.editMode?(s(),o("div",yt,[t("form",{onSubmit:e[4]||(e[4]=S((...a)=>i.saveLocations&&i.saveLocations(...a),["prevent"]))},[(s(!0),o(N,null,q(i.editableLocations,(a,p)=>(s(),o("div",{key:p,class:"location-item mb-3 p-3 border rounded"},[t("div",vt,[t("div",gt,[e[11]||(e[11]=t("label",{class:"form-label"},"Address",-1)),D(t("input",{type:"text",class:"form-control","onUpdate:modelValue":g=>a.company_address=g,required:""},null,8,bt),[[L,a.company_address]])]),t("div",_t,[e[13]||(e[13]=t("label",{class:"form-label"},"Type",-1)),D(t("select",{class:"form-select","onUpdate:modelValue":g=>a.location_type=g,required:""},[e[12]||(e[12]=t("option",{value:"headquarters"},"Headquarters",-1)),i.companyType==="broiler"?(s(),o("option",Ct,"Supplier")):E("",!0),i.companyType==="slaughterhouse"?(s(),o("option",ht,"Slaughterhouse")):E("",!0),i.companyType==="sme"?(s(),o("option",kt,"Kitchen")):E("",!0)],8,wt),[[Z,a.location_type]])]),t("div",Et,[t("button",{type:"button",class:"btn btn-danger btn-sm w-100",onClick:g=>i.removeLocation(p)},e[14]||(e[14]=[t("i",{class:"fas fa-trash"},null,-1)]),8,Dt)])])]))),128)),t("div",Lt,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:e[3]||(e[3]=(...a)=>i.addNewLocation&&i.addNewLocation(...a))},e[15]||(e[15]=[t("i",{class:"fas fa-plus me-1"},null,-1),P(" Add Location ")]))]),t("div",Pt,[t("button",{type:"submit",class:"btn btn-success",disabled:i.saving},[e[16]||(e[16]=t("i",{class:"fas fa-save me-1"},null,-1)),e[17]||(e[17]=P(" Save Locations ")),i.saving?(s(),o("span",xt)):E("",!0)],8,Mt)])],32)])):(s(),o("div",dt,[n.locations.length===0?(s(),o("div",ct,e[10]||(e[10]=[t("i",{class:"fas fa-map-marker-alt text-muted mb-2",style:{"font-size":"2rem"}},null,-1),t("p",{class:"text-muted"},"No locations added yet",-1)]))):(s(),o("div",mt,[(s(!0),o(N,null,q(n.locations,(a,p)=>(s(),o("div",{key:a.locationID||p,class:"location-item mb-3 p-3 border rounded"},[t("div",ft,[t("div",null,[t("div",ut,R(a.company_address),1),t("div",pt,R(a.location_type),1)])])]))),128))]))]))]))])])}const Ft=$(it,[["render",Vt],["__scopeId","data-v-9ed0d720"]]),It={name:"ProfilePage",components:{ProfileInfo:Pe,CompanyLocations:Ft,CompanyCertifications:tt},setup(){const l=ie(),e=H(),n=u(!1),i=u(!1),_=()=>{ae.clearLocationsCache()},v=u(!0),a=u({}),p=u(!1),g=u(!1),V=u(!1),f=u(null),r=u(null),d=u(!0),h=u(!1),w=u(0),C=u(null),x=u(!1),F=u({current_password:"",new_password:"",new_password_confirmation:""}),U=u(!1),O=I(()=>F.value.new_password!==F.value.new_password_confirmation),T=I(()=>a.value.role==="admin"),W=I(()=>{var c;return a.value.role==="admin"?{...a.value,company_name:(c=a.value.company)==null?void 0:c.company_name}:{...a.value}}),j=async()=>{try{v.value=!0;const c=await M.get("/api/profile");a.value=c,console.log("Fetched profile data:",c),d.value=!!c.email_verified_at,e.commit("SET_EMAIL_VERIFIED",!!c.email_verified_at),console.log("Email verification status:",{email_verified_at:c.email_verified_at,emailVerified:d.value}),v.value=!1}catch(c){console.error("Error fetching profile data:",c),v.value=!1,m.danger("Error","Failed to load profile data")}};A(()=>e.getters.emailVerified,c=>{d.value=c});const Y=async()=>{try{x.value=!0;const c=await e.dispatch("sendVerificationEmail");m.success("Email Sent",c.message||"Verification link sent to your email address"),x.value=!1}catch(c){console.error("Error sending verification email:",c),x.value=!1,m.danger("Error","Failed to send verification email")}},G=c=>{const b=c.target.files[0];if(!b)return;if(!b.type.match("image.*")){m.danger("Invalid File","Please select an image file");return}if(b.size>2*1024*1024){m.danger("File Too Large","Image size should not exceed 2MB");return}T.value?r.value=b:f.value=b;const y=new FileReader;y.onload=k=>{T.value?a.value.company.company_image=k.target.result:a.value.image=k.target.result},y.readAsDataURL(b)},K=async()=>{var c,b;try{const y=new FormData;y.append("email",a.value.email),y.append("tel_number",a.value.tel_number||""),T.value?(y.append("company_name",((c=a.value.company)==null?void 0:c.company_name)||""),r.value&&y.append("company_image",r.value)):(y.append("fullname",a.value.fullname||""),f.value&&y.append("profile_image",f.value));const k=await M.post("/api/profile/update",y,{headers:{"Content-Type":"multipart/form-data"}});if(k.user){const J={...k.user,company:k.company||((b=user.value)==null?void 0:b.company)};a.value=J,e.commit("SET_USER",J)}f.value=null,r.value=null,p.value=!1,m.success("Success","Profile updated successfully"),j()}catch(y){console.error("Error updating profile:",y),m.danger("Error","Failed to update profile")}},Q=async()=>{var c;if(!O.value)try{U.value=!0,console.log(F.value),await M.post("/api/profile/password",F.value),F.value={current_password:"",new_password:"",new_password_confirmation:""},m.success("Success","Password updated successfully"),U.value=!1}catch(b){if(console.error("Error updating password:",b),((c=b.response)==null?void 0:c.status)===422){const y=b.response.data.errors||{};let k="Invalid password data";console.log("Validation errors:",y),y.current_password?k=y.current_password[0]:y.new_password?k=y.new_password[0]:y.new_password_confirmation&&(k=y.new_password_confirmation[0]),m.danger("Validation Error",k)}else m.danger("Error","Failed to update password");U.value=!1}},X=async()=>{var c;try{if(h.value)return;if(!a.value.email){m.warning("Warning","Email address is required");return}h.value=!0,w.value=30,C.value=setInterval(()=>{w.value--,w.value<=0&&(clearInterval(C.value),h.value=!1)},1e3),await M.post("/api/password/forgot",{email:a.value.email}),m.success("Email Sent","Password reset link has been sent to your email")}catch(b){console.error("Error sending password reset email:",b),((c=b.response)==null?void 0:c.status)===429?m.warning("Rate Limited","Please wait before requesting another password reset email"):m.danger("Error","Failed to send password reset email")}};return te(()=>{j(),l.query.verifyEmail==="true"&&m.warning("Email Verification Required","Please verify your email to access all features")}),{loading:v,profileData:a,formattedProfileData:W,editProfileMode:p,editLocationsMode:g,locationsLoading:V,editCertificationsMode:n,certificationsLoading:i,isAdmin:T,handleImageChange:G,saveProfile:K,emailVerified:d,sendVerificationEmail:Y,sendingVerification:x,passwordData:F,passwordLoading:U,passwordMismatch:O,updatePassword:Q,sendPasswordResetEmail:X,handleLocationUpdate:_,fetchProfileData:j,isResetEmailLoading:h,resetEmailTimer:w,resetEmailInterval:C}}},St={class:"profile-page"},Ut={key:0,class:"alert alert-warning mb-4"},Tt={class:"d-flex align-items-center"},At=["disabled"],Nt={key:0},qt={key:1},Rt={class:"row"},$t={class:"col-lg-8"},jt={class:"mb-4"},Bt={key:0,class:"mb-4"},zt={key:1,class:"mb-4"},Ot={class:"col-lg-4"},Jt={class:"card mb-4"},Ht={class:"card-body"},Wt={class:"mb-4"},Yt={class:"d-flex align-items-center"},Gt={key:0,class:"text-success"},Kt={key:1,class:"text-warning"},Qt=["value"],Xt={class:"mb-3"},Zt={class:"form-text"},ei={class:"mb-3"},ti={class:"mb-3"},ii={key:0,class:"form-text text-danger"},ai=["disabled"],oi={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"};function si(l,e,n,i,_,v){var V,f;const a=z("ProfileInfo"),p=z("CompanyLocations"),g=z("CompanyCertifications");return s(),o("div",St,[e[23]||(e[23]=t("h1",{class:"mb-4"},"My Profile",-1)),i.emailVerified?E("",!0):(s(),o("div",Ut,[t("div",Tt,[e[13]||(e[13]=t("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),e[14]||(e[14]=t("div",null,[t("strong",null,"Your email is not verified."),t("p",{class:"mb-0"},"Please verify your email to access all features of the application.")],-1)),t("button",{class:"btn btn-sm btn-primary ms-auto",onClick:e[0]||(e[0]=(...r)=>i.sendVerificationEmail&&i.sendVerificationEmail(...r)),disabled:i.sendingVerification},[i.sendingVerification?(s(),o("span",Nt,e[12]||(e[12]=[t("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),P(" Sending... ")]))):(s(),o("span",qt,"Send Verification Email"))],8,At)])])),t("div",Rt,[t("div",$t,[t("div",jt,[B(a,{profileData:i.formattedProfileData,profileImage:i.isAdmin?(V=i.profileData.company)==null?void 0:V.company_image:i.profileData.image,editMode:i.editProfileMode,loading:i.loading,onToggleEdit:e[1]||(e[1]=r=>i.editProfileMode=!i.editProfileMode),onSave:i.saveProfile,onImageChange:i.handleImageChange},null,8,["profileData","profileImage","editMode","loading","onSave","onImageChange"])]),i.isAdmin?(s(),o("div",Bt,[B(p,{locations:i.profileData.locations,"onUpdate:locations":e[2]||(e[2]=r=>i.profileData.locations=r),loading:i.locationsLoading,editMode:i.editLocationsMode,onLoading:e[3]||(e[3]=r=>i.locationsLoading=r),onToggleEdit:e[4]||(e[4]=r=>i.editLocationsMode=!i.editLocationsMode),onLocationUpdated:i.handleLocationUpdate},null,8,["locations","loading","editMode","onLocationUpdated"])])):E("",!0),i.isAdmin&&((f=i.profileData.company)==null?void 0:f.company_type)!=="admin"?(s(),o("div",zt,[B(g,{certifications:i.profileData.certifications||[],"edit-mode":i.editCertificationsMode,loading:i.certificationsLoading,onToggleEdit:e[5]||(e[5]=r=>i.editCertificationsMode=!i.editCertificationsMode),onLoading:e[6]||(e[6]=r=>i.certificationsLoading=r),onRefreshData:i.fetchProfileData},null,8,["certifications","edit-mode","loading","onRefreshData"])])):E("",!0)]),t("div",Ot,[t("div",Jt,[e[22]||(e[22]=t("div",{class:"card-header theme-header"},[t("h5",{class:"mb-0"},"Security")],-1)),t("div",Ht,[t("div",Wt,[e[17]||(e[17]=t("h6",null,"Email Verification",-1)),t("div",Yt,[i.emailVerified?(s(),o("span",Gt,e[15]||(e[15]=[t("i",{class:"bi bi-check-circle-fill me-2"},null,-1),P(" Verified ")]))):(s(),o("span",Kt,e[16]||(e[16]=[t("i",{class:"bi bi-exclamation-circle-fill me-2"},null,-1),P(" Not Verified ")])))])]),t("form",{onSubmit:e[11]||(e[11]=S((...r)=>i.updatePassword&&i.updatePassword(...r),["prevent"]))},[t("input",{type:"text",name:"username",value:i.profileData.email,autocomplete:"username",style:{display:"none"},readonly:""},null,8,Qt),t("div",Xt,[e[18]||(e[18]=t("label",{for:"current-password",class:"form-label"},"Current Password",-1)),D(t("input",{type:"password",class:"form-control",id:"current-password","onUpdate:modelValue":e[7]||(e[7]=r=>i.passwordData.current_password=r),autocomplete:"current-password",required:""},null,512),[[L,i.passwordData.current_password]]),t("div",Zt,[t("a",{href:"#",onClick:e[8]||(e[8]=S((...r)=>i.sendPasswordResetEmail&&i.sendPasswordResetEmail(...r),["prevent"])),class:ee(["text-primary",{disabled:i.isResetEmailLoading}])},R(i.isResetEmailLoading?`Please wait (${i.resetEmailTimer}s)`:"Forgot your password?"),3)])]),t("div",ei,[e[19]||(e[19]=t("label",{for:"new-password",class:"form-label"},"New Password",-1)),D(t("input",{type:"password",class:"form-control",id:"new-password","onUpdate:modelValue":e[9]||(e[9]=r=>i.passwordData.new_password=r),autocomplete:"new-password",required:"",minlength:"8"},null,512),[[L,i.passwordData.new_password]])]),t("div",ti,[e[20]||(e[20]=t("label",{for:"confirm-password",class:"form-label"},"Confirm Password",-1)),D(t("input",{type:"password",class:"form-control",id:"confirm-password","onUpdate:modelValue":e[10]||(e[10]=r=>i.passwordData.new_password_confirmation=r),autocomplete:"new-password",required:""},null,512),[[L,i.passwordData.new_password_confirmation]]),i.passwordMismatch?(s(),o("div",ii," Passwords do not match ")):E("",!0)]),t("button",{type:"submit",class:"btn btn-primary w-100",disabled:i.passwordLoading||i.passwordMismatch},[i.passwordLoading?(s(),o("span",oi)):E("",!0),e[21]||(e[21]=P(" Update Password "))],8,ai)],32)])])])])])}const di=$(It,[["render",si],["__scopeId","data-v-6b9924fa"]]);export{di as default};
