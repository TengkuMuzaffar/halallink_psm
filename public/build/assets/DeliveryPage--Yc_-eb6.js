import{a as Z,b as Q,c as z}from"./modal-BXblql9Y.js";import{H as k,_ as O,c as d,a as e,f as L,g as T,o,n as I,d as B,F as D,i as C,t as c,e as _,A as H,r as F,k as Y,M as V,G as ee,z as J,b as g,u as te,I as se,w as N,J as ie,y as G,v as K,p as W,j as X}from"./main-6HkEK7r2.js";import{S as ae}from"./StatsCard-Daj1M7Ql.js";import{R as le}from"./ResponsiveTable-DO6c7ISj.js";import{L as ne}from"./LoadingSpinner-TtFArfCL.js";const $={async getTrips(s={}){return k("/api/deliveries/trips",{params:s})},async getCreatedDeliveries(s=1,t=3){return k("/api/deliveries/created",{params:{page:s,per_page:t}})},async getDeliveryStats(){return k("/api/deliveries/stats")},async getLocations(){return k("/api/locations")},async getDrivers(s){return k("/api/users/get/drivers",{params:{scheduled_date:s}})},async getVehicles(s){return k("api/deliveries/get/vehicles",{params:{scheduled_date:s}})},async assignSingleTrip(s){return k("/api/deliveries/assign-trip",{method:"POST",data:s})},async updateDeliveryStatus(s,t){return k(`/api/deliveries/${s}/start`,{method:"put",data:t})},async getDeliveryDetails(s){return k(`/api/deliveries/${s}`)},async createDelivery(s){return k("/api/deliveries/create",{method:"post",data:s})},async getOrderForAssignment(s={}){const{locationID:t,orderID:i}=s;if(!t||!i)return{success:!1,message:"Location ID and Order ID are required"};try{const a=await this.getTrips({locationID:t});if(!a.success||!a.data)return{success:!1,message:"Failed to fetch order data"};const r=a.data.find(l=>l.locationID==t);if(!r||!r.orders)return{success:!1,message:"Location or orders not found"};const n=r.orders[i];return n?{success:!0,data:{locationID:t,locationAddress:r.company_address,orderID:i,orderData:n}}:{success:!1,message:"Order not found"}}catch(a){return console.error("Error fetching order for assignment:",a),{success:!1,message:"An error occurred while fetching order data"}}},async assignDelivery(s){return k("/api/deliveries/assign",{method:"POST",data:s})},async createDelivery(s){return k("/api/deliveries",{method:"POST",data:s})},async getDeliveryDetails(s){return k(`/api/deliveries/${s}`)},async createDelivery(s){return k("/api/deliveries/create",{method:"post",data:s})},async getExecutionDeliveries(s={}){return k("/api/deliveries/get/execution",{params:{statusFilter:s.status||"",dateFilter:s.date||"",searchTerm:s.searchTerm||""}})},async startDelivery(s){return k(`/api/deliveries/${s}/start`,{method:"post",data:{start_timestamp:new Date().toISOString()}})}},re={name:"DeliveryStatsCard",components:{StatsCard:ae},props:{stats:{type:Object,required:!0,default:()=>({pending:0,inProgress:0,completedToday:0,issues:0})}}},oe={class:"row mb-4"},de={class:"col-md-3 col-sm-6 mb-3"},ce={class:"col-md-3 col-sm-6 mb-3"},ue={class:"col-md-3 col-sm-6 mb-3"},ve={class:"col-md-3 col-sm-6 mb-3"};function he(s,t,i,a,r,n){const l=T("StatsCard",!0);return o(),d("div",oe,[e("div",de,[L(l,{title:"Pending Assignment",count:i.stats.pending,icon:"fas fa-clock",bgColor:"bg-warning"},null,8,["count"])]),e("div",ce,[L(l,{title:"In Progress",count:i.stats.inProgress,icon:"fas fa-truck",bgColor:"bg-info"},null,8,["count"])]),e("div",ue,[L(l,{title:"Completed Today",count:i.stats.completedToday,icon:"fas fa-check-circle",bgColor:"bg-success"},null,8,["count"])]),e("div",ve,[L(l,{title:"Issues",count:i.stats.issues,icon:"fas fa-exclamation-triangle",bgColor:"bg-danger"},null,8,["count"])])])}const me=O(re,[["render",he]]),ge={name:"Pagination",props:{pagination:{type:Object,required:!0,default:()=>({current_page:1,last_page:1,per_page:15,total:0,from:1,to:0})},maxVisiblePages:{type:Number,default:5}},computed:{displayedPages(){if(!this.pagination.last_page)return[];const s=this.pagination.current_page,t=this.pagination.last_page,i=Math.floor(this.maxVisiblePages/2);let a=s-i,r=s+i;a<=1&&(a=1,r=Math.min(this.maxVisiblePages,t)),r>=t&&(r=t,a=Math.max(t-this.maxVisiblePages+1,1));const n=[];for(let l=a;l<=r;l++)n.push(l);return n}},methods:{changePage(s){s<1||s>this.pagination.last_page||this.$emit("page-changed",s)}}},fe={"aria-label":"Page navigation"},ye={class:"pagination justify-content-center mb-0"},pe=["onClick"];function be(s,t,i,a,r,n){return o(),d("nav",fe,[e("ul",ye,[e("li",{class:I(["page-item",{disabled:i.pagination.current_page<=1}])},[e("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=B(l=>n.changePage(i.pagination.current_page-1),["prevent"]))},t[2]||(t[2]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(o(!0),d(D,null,C(n.displayedPages,l=>(o(),d("li",{key:l,class:I(["page-item",{active:i.pagination.current_page===l}])},[e("a",{class:"page-link",href:"#",onClick:B(v=>n.changePage(l),["prevent"])},c(l),9,pe)],2))),128)),e("li",{class:I(["page-item",{disabled:i.pagination.current_page>=i.pagination.last_page}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=B(l=>n.changePage(i.pagination.current_page+1),["prevent"]))},t[3]||(t[3]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])}const _e=O(ge,[["render",be],["__scopeId","data-v-b4287979"]]),De={name:"ItemModal",props:{modalId:{type:String,required:!0},items:{type:Array,required:!0}},computed:{totalValue(){return this.items.reduce((s,t)=>s+t.price,0)}}},Ie=["id"],ke={class:"modal-dialog modal-dialog-centered"},xe={class:"modal-content"},Se={class:"modal-body p-3"},Ce={class:"delivery-summary mb-4"},we={class:"total-items"},Pe={class:"value"},Ee={class:"total-value"},Me={class:"value"},$e={class:"items-grid"},Te={class:"card h-100"},Fe={class:"card-header item-header"},Le={class:"item-id"},Oe={class:"card-body"},Re={class:"card-title d-flex align-items-center"},Ae={class:"item-details"},je={class:"detail-row"},Ne={class:"detail-value"},qe={class:"detail-row"},Qe={class:"detail-value price"};function Ve(s,t,i,a,r,n){return o(),d("div",{class:"modal fade",id:i.modalId,tabindex:"-1","aria-labelledby":"itemModalLabel","aria-hidden":"true"},[e("div",ke,[e("div",xe,[t[7]||(t[7]=e("div",{class:"modal-header theme-header"},[e("h5",{class:"modal-title",id:"itemModalLabel"},[e("i",{class:"fas fa-box me-2"}),_("Delivery Items ")]),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Se,[e("div",Ce,[e("div",we,[t[0]||(t[0]=e("span",{class:"label"},"Total Items:",-1)),e("span",Pe,c(i.items.length),1)]),e("div",Ee,[t[1]||(t[1]=e("span",{class:"label"},"Total Value:",-1)),e("span",Me,"RM "+c(n.totalValue.toFixed(2)),1)])]),e("div",$e,[(o(!0),d(D,null,C(i.items,l=>(o(),d("div",{key:l.itemID,class:"item-card"},[e("div",Te,[e("div",Fe,[e("span",Le,"#"+c(l.itemID),1)]),e("div",Oe,[e("h6",Re,[t[2]||(t[2]=e("i",{class:"fas fa-cube me-2"},null,-1)),_(c(l.name),1)]),e("div",Ae,[e("div",je,[t[3]||(t[3]=e("i",{class:"fas fa-weight-hanging text-muted me-2"},null,-1)),t[4]||(t[4]=e("span",{class:"detail-label"},"Quantity:",-1)),e("span",Ne,c(l.measurement_value)+" "+c(l.measurement_type),1)]),e("div",qe,[t[5]||(t[5]=e("i",{class:"fas fa-tag text-muted me-2"},null,-1)),t[6]||(t[6]=e("span",{class:"detail-label"},"Price:",-1)),e("span",Qe,"RM "+c(l.price.toFixed(2)),1)])])])])]))),128))])])])])],8,Ie)}const Ue=O(De,[["render",Ve],["__scopeId","data-v-cb14fafa"]]),Be={name:"DeliveryAssignment",components:{Pagination:_e,ItemModal:Ue},props:{loading:Boolean,error:String,trips:{type:Array,default:()=>[]},pagination:Object,selectedDeliveryID:[Number,String],activePhase:{type:Number,required:!0}},data(){return{}},emits:["refresh","assign-trip","change-phase","change-page"],methods:{changePhase(s){this.$emit("change-phase",s)}}},ze={class:"delivery-assignment"},Je={class:"card"},He={class:"card-header d-flex justify-content-between align-items-center theme-header"},Ge={class:"d-flex"},Ke={class:"phase-tabs"},We={class:"nav nav-tabs",role:"tablist"},Xe={class:"card-body p-0"},Ye={key:0,class:"p-4 text-center"},Ze={key:1,class:"p-4"},et={class:"alert alert-danger mb-0"},tt={key:2,class:"p-4 text-center"},st={key:3},it={class:"table-responsive"},at={class:"table table-hover theme-table"},lt={class:"text-nowrap"},nt={class:"text-nowrap"},rt={class:"location-cell"},ot={class:"location-type"},dt={class:"location-address"},ct={class:"location-cell"},ut={class:"location-type"},vt={class:"location-address"},ht={class:"d-flex gap-2 flex-wrap justify-content-start"},mt=["data-bs-target"],gt=["onClick","disabled"];function ft(s,t,i,a,r,n){const l=T("ItemModal");return o(),d("div",ze,[e("div",Je,[e("div",He,[t[4]||(t[4]=e("h5",{class:"mb-0"},"Assign Deliveries",-1)),e("div",Ge,[e("button",{class:"btn btn-sm btn-outline-primary theme-btn-outline",onClick:t[0]||(t[0]=v=>s.$emit("refresh"))},t[3]||(t[3]=[e("i",{class:"fas fa-sync-alt"},null,-1)]))])]),e("div",Ke,[e("div",We,[e("button",{class:I(["nav-link",{active:i.activePhase===1}]),onClick:t[1]||(t[1]=v=>n.changePhase(1)),id:"phase1-tab",type:"button",role:"tab","aria-controls":"phase1","aria-selected":"activePhase === 1"},t[5]||(t[5]=[e("i",{class:"fas fa-truck-loading me-2"},null,-1),_("Phase 1 (Supplier to Slaughterhouse) ")]),2),e("button",{class:I(["nav-link",{active:i.activePhase===2}]),onClick:t[2]||(t[2]=v=>n.changePhase(2)),id:"phase2-tab",type:"button",role:"tab","aria-controls":"phase2","aria-selected":"activePhase === 2"},t[6]||(t[6]=[e("i",{class:"fas fa-truck me-2"},null,-1),_("Phase 2 (Slaughterhouse to Customer) ")]),2)])]),e("div",Xe,[i.loading?(o(),d("div",Ye,t[7]||(t[7]=[e("div",{class:"spinner-border theme-spinner",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2 text-muted"},"Loading delivery data...",-1)]))):i.error?(o(),d("div",Ze,[e("div",et,c(i.error),1)])):!i.trips||i.trips.length===0?(o(),d("div",tt,t[8]||(t[8]=[e("div",{class:"alert theme-alert-info mb-0"},[e("i",{class:"fas fa-info-circle me-2"}),_(" No trips found for the selected criteria. ")],-1)]))):(o(),d("div",st,[e("div",it,[e("table",at,[t[11]||(t[11]=e("thead",{class:"theme-table-header"},[e("tr",null,[e("th",{style:{width:"5vw"}},"Trip ID"),e("th",{style:{width:"5vw"}},"Order ID"),e("th",null,"Start Location"),e("th",null,"End Location"),e("th",null,"Action")])],-1)),e("tbody",null,[(o(!0),d(D,null,C(i.trips,v=>(o(),d("tr",{key:v.tripID},[e("td",lt,c(v.tripID),1),e("td",nt,c(v.orderID),1),e("td",rt,[e("div",ot,c(v.start_location.type),1),e("div",dt,c(v.start_location.address),1)]),e("td",ct,[e("div",ut,c(v.end_location.type),1),e("div",vt,c(v.end_location.address),1)]),e("td",null,[e("div",ht,[e("button",{class:"btn btn-sm btn-outline-secondary","data-bs-toggle":"modal","data-bs-target":`#itemModal-${v.tripID}`},t[9]||(t[9]=[e("i",{class:"fas fa-box me-1"},null,-1),e("span",{class:"ms-1 d-none d-sm-inline"},"Items",-1)]),8,mt),e("button",{class:"btn btn-sm btn-primary theme-btn-primary",onClick:x=>s.$emit("assign-trip",v),disabled:!i.selectedDeliveryID},t[10]||(t[10]=[e("i",{class:"fas fa-plus-circle me-1"},null,-1),e("span",{class:"ms-1 d-none d-sm-inline"},"Assign",-1)]),8,gt)])])]))),128))])])]),(o(!0),d(D,null,C(i.trips,v=>(o(),H(l,{key:`modal-${v.tripID}`,"modal-id":`itemModal-${v.tripID}`,items:v.items},null,8,["modal-id","items"]))),128))]))])])])}const yt=O(Be,[["render",ft],["__scopeId","data-v-e95e7745"]]),pt={name:"QRScannerModal",props:{deliveryID:{type:[Number,String],required:!0},locationID:{type:[Number,String],required:!0},checkpoints:{type:Array,required:!0}},emits:["scanner-closed"],setup(s,{emit:t}){te();const i=F(!0),a=F(null),r=F(null),n=F(null),l=F("");let v=null,x=null;function f(y){document.readyState==="complete"||document.readyState==="interactive"?setTimeout(y,1):document.addEventListener("DOMContentLoaded",y)}function E(y,w){if(x!==y){x=y,r.value=y;try{let u=y;u.startsWith("http")||(u=window.location.origin+(u.startsWith("/")?u:"/"+u));const P=new URL(u),m=window.location.hostname;if(P.hostname!==m){a.value="Security Error: QR code URL is from a different domain. Only URLs from the current domain are allowed.",r.value=null;return}let S=s.locationID,p=null;try{const R=P.pathname.split("/").filter(M=>M).filter(M=>!isNaN(M));R.length>=2&&(S=parseInt(R[0]),p=parseInt(R[1]),console.log("Extracted from URL - Location ID:",S,"Company ID:",p))}catch(h){console.warn("Could not extract IDs from URL, using props value:",h)}const b={deliveryID:s.deliveryID,locationID:s.locationID,checkpoints:s.checkpoints,companyID:p};console.log("Sending data to server:",{url:u,postData:b}),r.value="QR code detected! Processing...",se(u,b,{onSuccess:h=>{h.status==="success"?setTimeout(()=>{j(),console.log("url info: "+JSON.stringify(h,null,2)),h.redirect&&h.redirectUrl?(console.log("Navigating to:",h.redirectUrl),window.location.href=h.redirectUrl):(console.log("API response indicates no redirect needed or URL missing."),r.value=h.message||"Processing complete.")},1e3):(a.value=h.message||"Error processing QR code",r.value=null)},onError:h=>{console.error("API Error Details:",h),h.response&&h.response.data?(a.value=`Error processing QR code: ${h.response.data.message||h.message}`,console.error("Server error details:",h.response.data)):a.value=`Error processing QR code: ${h.message||"Unknown error"}`,r.value=null}})}catch(u){a.value=`Error processing QR code: ${u.message||"Unknown error"}`,r.value=null}}}function A(y,w){const m=y>w?w:y,S=Math.floor(m*.75);return S<250?m<250?{width:m,height:m}:{width:250,height:250}:{width:S,height:S}}Y(()=>{n.value=new V(document.getElementById("qrScannerModal")),l.value=window.location.origin;const y=document.createElement("script");y.src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js",y.async=!0,y.onload=()=>{i.value=!1,f(()=>{try{v=new Html5QrcodeScanner("reader",{fps:10,qrbox:A,experimentalFeatures:{useBarCodeDetectorIfSupported:!0},rememberLastUsedCamera:!0,showTorchButtonIfSupported:!0,formatsToSupport:[Html5QrcodeSupportedFormats.QR_CODE],hideSelectScanType:!0,showVideoSourcesSelect:!1}),v.render(E),console.log("QR scanner initialized successfully"),setTimeout(()=>{const w=document.querySelector("#reader select");w&&(w.style.display="none");const u=document.querySelector("#reader__scan_type_change_button");u&&(u.style.display="none");const P=document.querySelector("#reader__dashboard_section_swaplink");P&&(P.className="btn btn-sm btn-danger mt-2",P.innerHTML='<i class="fas fa-stop me-1"></i>Stop Scanning')},500)}catch(w){console.error("Error initializing QR scanner:",w),a.value=`Failed to initialize scanner: ${w.message||"Unknown error"}`}})},y.onerror=()=>{a.value="Failed to load QR scanner library. Please try again.",i.value=!1},document.head.appendChild(y)}),ee(()=>{if(v)try{v.clear(),console.log("QR scanner cleared successfully")}catch(y){console.error("Error clearing QR scanner:",y)}});const q=()=>{n.value&&n.value.show()},j=()=>{n.value&&(n.value.hide(),t("scanner-closed"))};return{loading:i,error:a,scanResult:r,httpOrigin:l,showModal:q,closeModal:j}}},bt={class:"modal fade",id:"qrScannerModal",tabindex:"-1","aria-labelledby":"qrScannerModalLabel","aria-hidden":"true"},_t={class:"modal-dialog modal-dialog-centered"},Dt={class:"modal-content theme-modal"},It={class:"modal-body theme-body p-0"},kt={key:0,class:"text-center p-5"},xt={key:1},St={key:0,class:"alert alert-danger m-3"},Ct={key:1,class:"alert alert-success m-3"},wt={key:2,class:"alert alert-info m-3"},Pt={class:"mb-1"},Et={class:"code-block mt-1"},Mt={class:"modal-footer theme-footer"};function $t(s,t,i,a,r,n){return o(),d("div",bt,[e("div",_t,[e("div",Dt,[t[12]||(t[12]=e("div",{class:"modal-header theme-header"},[e("h5",{class:"modal-title",id:"qrScannerModalLabel"},[e("i",{class:"fas fa-qrcode me-2"}),_("Scan QR Code ")]),e("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",It,[a.loading?(o(),d("div",kt,t[1]||(t[1]=[e("div",{class:"spinner-border theme-spinner",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-3 theme-text fw-bold"},"Initializing camera...",-1)]))):(o(),d("div",xt,[t[10]||(t[10]=J('<div class="scanner-header text-center p-3" data-v-ab9786a9><p class="mb-0" data-v-ab9786a9><i class="fas fa-crosshairs me-2" data-v-ab9786a9></i>Position QR code within the scanner frame</p></div><div class="qr-scanner-container" data-v-ab9786a9><div id="reader" class="qr-reader" data-v-ab9786a9></div></div>',2)),a.error?(o(),d("div",St,[t[2]||(t[2]=e("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),_(c(a.error),1)])):g("",!0),a.scanResult?(o(),d("div",Ct,t[3]||(t[3]=[e("i",{class:"fas fa-check-circle me-2"},null,-1),_("QR Code detected! Redirecting... ")]))):g("",!0),!a.scanResult&&!a.error?(o(),d("div",wt,[t[8]||(t[8]=e("h6",{class:"alert-heading"},[e("i",{class:"fas fa-info-circle me-2"}),_("Troubleshooting")],-1)),t[9]||(t[9]=e("p",{class:"mb-1"},"If you can't see the video feed, try:",-1)),e("ul",Pt,[t[6]||(t[6]=e("li",null,"Checking browser permissions",-1)),t[7]||(t[7]=e("li",null,"Refreshing the page",-1)),e("li",null,[t[4]||(t[4]=e("strong",null,"HTTP Solution:",-1)),t[5]||(t[5]=_(" For Chrome, run with this flag: ")),e("div",Et,[e("code",null,"chrome --unsafely-treat-insecure-origin-as-secure="+c(a.httpOrigin)+" --user-data-dir=C:\\ChromeDevSession",1)])])])])):g("",!0)]))]),e("div",Mt,[e("button",{type:"button",class:"btn btn-secondary",onClick:t[0]||(t[0]=(...l)=>a.closeModal&&a.closeModal(...l))},t[11]||(t[11]=[e("i",{class:"fas fa-times me-1"},null,-1),_("Close ")]))])])])])}const Tt=O(pt,[["render",$t],["__scopeId","data-v-ab9786a9"]]),Ft={name:"ExecuteModalDelivery",props:{loading:{type:Boolean,default:!1},delivery:{type:Object,default:()=>null}},components:{QRScannerModal:Tt},emits:["start-delivery","scan-qr-code","refresh"],data(){return{modal:null,activeRouteTab:0,scannerData:null,expandedLocations:{}}},methods:{setActiveRoute(s){this.activeRouteTab=s},showModal(){this.modal||(this.modal=new V(document.getElementById("executeModal"))),this.modal.show()},hideModal(){this.modal&&this.modal.hide()},getRoutesCount(){return!this.delivery||!this.delivery.routes?0:Object.keys(this.delivery.routes).length},startDeliveryAndRefresh(s){this.$emit("start-delivery",s),this.$emit("refresh")},getStatusBadgeClass(s){if(!s)return"bg-secondary";switch(s.toLowerCase()){case"complete":return"bg-success";case"in_progress":return"bg-warning";case"pending":default:return"bg-secondary"}},formatDate(s){if(!s)return"N/A";const t=new Date(s);return isNaN(t.getTime())?s:t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},toggleLocationItems(s,t){this.expandedLocations[s]||(this.expandedLocations[s]={}),this.expandedLocations[s][t]=!this.expandedLocations[s][t],this.$forceUpdate()},isLocationExpanded(s,t){return this.expandedLocations[s]&&this.expandedLocations[s][t]},canScanLocation(s,t,i){if(this.delivery.status==="pending")return!1;if(t==="start"){const a=Object.keys(s.start_locations),r=a.indexOf(i.toString());if(r===0)return!0;for(let n=0;n<r;n++){const l=a[n];if(s.start_locations[l].location_status!=="complete")return!1}return!0}if(t==="end"){for(const n in s.start_locations)if(s.start_locations[n].location_status!=="complete")return!1;const a=Object.keys(s.end_locations),r=a.indexOf(i.toString());if(r===0)return!0;for(let n=0;n<r;n++){const l=a[n];if(s.end_locations[l].location_status!=="complete")return!1}return!0}return!1},scanQRCode(s){let t=null;for(const[i,a]of Object.entries(this.delivery.routes[this.activeRouteTab].start_locations))if(a.checkpoints.some(r=>s.includes(r))){t=parseInt(i);break}if(!t){for(const[i,a]of Object.entries(this.delivery.routes[this.activeRouteTab].end_locations))if(a.checkpoints.some(r=>s.includes(r))){t=parseInt(i);break}}if(!t&&s.length>0)for(const[i,a]of Object.entries(this.delivery.routes)){for(const[r,n]of Object.entries(a.start_locations))if(n.checkpoints.some(l=>s.includes(l))){t=parseInt(r);break}if(!t){for(const[r,n]of Object.entries(a.end_locations))if(n.checkpoints.some(l=>s.includes(l))){t=parseInt(r);break}}if(t)break}if(!t){const i=Object.keys(this.delivery.routes[this.activeRouteTab].start_locations);i.length>0&&(t=parseInt(i[0]))}this.scannerData={locationID:t,checkpoints:s},this.hideModal(),this.$nextTick(()=>{this.$refs.qrScannerModal&&this.$refs.qrScannerModal.showModal()})},reopenExecuteModal(){setTimeout(()=>{this.showModal()},300)}}},Lt={class:"modal fade",id:"executeModal",tabindex:"-1","aria-labelledby":"executeModalLabel","aria-hidden":"true"},Ot={class:"modal-dialog modal-lg modal-dialog-scrollable"},Rt={class:"modal-content"},At={class:"modal-body"},jt={key:0,class:"text-center p-4"},Nt={key:1},qt={class:"form-group mb-4"},Qt={class:"card"},Vt={class:"card-header bg-light"},Ut={class:"d-flex justify-content-between align-items-center"},Bt={class:"badge primary-badge me-2"},zt={class:"card-body"},Jt={class:"row g-3"},Ht={class:"col-md-6 col-lg-4"},Gt={class:"text-truncate"},Kt={class:"col-md-6 col-lg-4"},Wt={class:"text-truncate"},Xt={class:"col-md-6 col-lg-4"},Yt={class:"text-truncate"},Zt={class:"form-group mb-4"},es={class:"card"},ts={class:"card-header bg-light"},ss={class:"d-flex justify-content-between align-items-center"},is={class:"badge secondary-badge"},as={class:"card-body"},ls={key:0},ns={key:0,class:"nav nav-tabs mb-3"},rs=["onClick"],os={class:"timeline"},ds={key:0,class:"route-header mb-3"},cs={class:"border-bottom pb-2"},us={class:"timeline-panel"},vs={class:"timeline-heading"},hs={class:"d-flex flex-wrap align-items-start gap-2 w-100"},ms={class:"location-header-content"},gs={class:"d-flex flex-wrap align-items-center gap-2"},fs={class:"timeline-title mb-0"},ys={class:"location-actions mt-2 d-md-none"},ps={class:"d-flex gap-2"},bs=["onClick"],_s=["onClick"],Ds={class:"ms-auto location-actions d-none d-md-block"},Is={class:"d-flex gap-2"},ks=["onClick"],xs=["onClick"],Ss={class:"timeline-body"},Cs={class:"location-type"},ws={key:0,class:"location-items mt-3"},Ps={class:"card"},Es={class:"card-body p-0"},Ms={class:"table-responsive"},$s={class:"table table-striped table-hover mb-0"},Ts={class:"timeline-panel"},Fs={class:"timeline-heading"},Ls={class:"d-flex flex-wrap align-items-start gap-2 w-100"},Os={class:"location-header-content"},Rs={class:"d-flex flex-wrap align-items-center gap-2"},As={class:"timeline-title mb-0"},js={class:"location-actions mt-2 d-md-none"},Ns={class:"d-flex gap-2"},qs=["onClick"],Qs=["onClick"],Vs={class:"ms-auto location-actions d-none d-md-block"},Us={class:"d-flex gap-2"},Bs=["onClick"],zs=["onClick"],Js={class:"timeline-body"},Hs={class:"location-type"},Gs={key:0,class:"location-items mt-3"},Ks={class:"card"},Ws={class:"card-body p-0"},Xs={class:"table-responsive"},Ys={class:"table table-striped table-hover mb-0"},Zs={key:1,class:"text-center text-muted"};function ei(s,t,i,a,r,n){var v,x,f,E,A,q,j,y,w,u,P;const l=T("QRScannerModal");return o(),d(D,null,[e("div",Lt,[e("div",Ot,[e("div",Rt,[t[22]||(t[22]=e("div",{class:"modal-header theme-header"},[e("h5",{class:"modal-title",id:"executeModalLabel"},"Delivery Details"),e("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",At,[i.loading?(o(),d("div",jt,t[2]||(t[2]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Loading delivery details...",-1)]))):(o(),d("div",Nt,[e("div",qt,[t[6]||(t[6]=e("label",{class:"form-label fw-bold"},"Delivery Information",-1)),e("div",Qt,[e("div",Vt,[e("div",Ut,[e("div",null,[e("span",Bt,"Delivery #"+c(((v=i.delivery)==null?void 0:v.deliveryID)||"N/A"),1)]),e("div",null,[e("span",{class:I(["badge",n.getStatusBadgeClass((x=i.delivery)==null?void 0:x.status)])},c(((f=i.delivery)==null?void 0:f.status)||"Pending"),3)])])]),e("div",zt,[e("div",Jt,[e("div",Ht,[t[3]||(t[3]=e("p",{class:"mb-2"},[e("strong",null,"Scheduled Date:")],-1)),e("p",Gt,c(n.formatDate((E=i.delivery)==null?void 0:E.scheduled_date)),1)]),e("div",Kt,[t[4]||(t[4]=e("p",{class:"mb-2"},[e("strong",null,"Driver:")],-1)),e("p",Wt,c(((A=i.delivery)==null?void 0:A.fullname)||((j=(q=i.delivery)==null?void 0:q.driver)==null?void 0:j.fullname)||"N/A"),1)]),e("div",Xt,[t[5]||(t[5]=e("p",{class:"mb-2"},[e("strong",null,"Vehicle:")],-1)),e("p",Yt,c(((y=i.delivery)==null?void 0:y.vehicle_plate)||((u=(w=i.delivery)==null?void 0:w.vehicle)==null?void 0:u.vehicle_plate)||"N/A"),1)])])])])]),e("div",Zt,[t[21]||(t[21]=e("label",{class:"form-label fw-bold"},"Routes Information",-1)),e("div",es,[e("div",ts,[e("div",ss,[t[7]||(t[7]=e("div",null,[e("span",{class:"badge primary-badge me-2"},"Delivery Routes")],-1)),e("div",null,[e("span",is,c(n.getRoutesCount()),1)])])]),e("div",as,[i.delivery&&i.delivery.routes&&Object.keys(i.delivery.routes).length>0?(o(),d("div",ls,[Object.keys(i.delivery.routes).length>1?(o(),d("ul",ns,[(o(!0),d(D,null,C(Object.entries(i.delivery.routes),(m,S)=>(o(),d("li",{class:"nav-item",key:S},[e("button",{class:I(["nav-link",{active:r.activeRouteTab===S}]),onClick:p=>n.setActiveRoute(S)}," Route #"+c(parseInt(m[0])+1),11,rs)]))),128))])):g("",!0),e("div",os,[(o(!0),d(D,null,C(Object.entries(i.delivery.routes),(m,S)=>N((o(),d("div",{key:S,class:"route-group mb-4"},[Object.keys(i.delivery.routes).length>1?(o(),d("div",ds,[e("h6",cs,"Route #"+c(parseInt(m[0])+1),1)])):g("",!0),(o(!0),d(D,null,C(m[1].start_locations,(p,b)=>(o(),d("div",{key:b,class:"timeline-item"},[t[14]||(t[14]=e("div",{class:"timeline-badge"},[e("div",{class:"timeline-circle"})],-1)),e("div",us,[e("div",vs,[e("div",hs,[e("div",ms,[e("div",gs,[e("h6",fs,"Pick Up #"+c(b),1),e("span",{class:I(["badge",n.getStatusBadgeClass(p.location_status)])},c(p.location_status||"Pending"),3)]),e("div",ys,[e("div",ps,[e("button",{class:"btn btn-sm btn-link p-1",onClick:h=>n.toggleLocationItems(m[0],`start-${b}`)},[e("i",{class:I(["fas",n.isLocationExpanded(m[0],`start-${b}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,bs),S===0&&b===Object.keys(m[1].start_locations)[0]&&i.delivery.status==="pending"?(o(),d("button",{key:0,class:"btn btn-sm btn-success",onClick:t[0]||(t[0]=h=>n.startDeliveryAndRefresh(i.delivery.deliveryID))},t[8]||(t[8]=[e("i",{class:"fas fa-play me-1"},null,-1),_(),e("span",{class:"d-none d-sm-inline"},"Start",-1)]))):g("",!0),n.canScanLocation(m[1],"start",b)&&p.location_status!=="complete"?(o(),d("button",{key:1,class:"btn btn-sm btn-primary",onClick:h=>n.scanQRCode(p.checkpoints)},t[9]||(t[9]=[e("i",{class:"fas fa-qrcode me-1"},null,-1),_(),e("span",{class:"d-none d-sm-inline"},"Scan QR",-1)]),8,_s)):g("",!0)])])]),e("div",Ds,[e("div",Is,[e("button",{class:"btn btn-sm btn-link p-1",onClick:h=>n.toggleLocationItems(m[0],`start-${b}`)},[e("i",{class:I(["fas",n.isLocationExpanded(m[0],`start-${b}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,ks),S===0&&b===Object.keys(m[1].start_locations)[0]&&i.delivery.status==="pending"?(o(),d("button",{key:0,class:"btn btn-sm btn-success",onClick:t[1]||(t[1]=h=>n.startDeliveryAndRefresh(i.delivery.deliveryID))},t[10]||(t[10]=[e("i",{class:"fas fa-play me-1"},null,-1),_(),e("span",null,"Start",-1)]))):g("",!0),n.canScanLocation(m[1],"start",b)&&p.location_status!=="complete"?(o(),d("button",{key:1,class:"btn btn-sm btn-primary",onClick:h=>n.scanQRCode(p.checkpoints)},t[11]||(t[11]=[e("i",{class:"fas fa-qrcode me-1"},null,-1),_(),e("span",null,"Scan QR",-1)]),8,xs)):g("",!0)])])])]),e("div",Ss,[e("p",null,c(p.company_address),1),e("p",Cs,"(Location ID: "+c(p.locationID)+")",1),n.isLocationExpanded(m[0],`start-${b}`)?(o(),d("div",ws,[e("div",Ps,[t[13]||(t[13]=e("div",{class:"card-header bg-light"},[e("strong",null,"Items")],-1)),e("div",Es,[e("div",Ms,[e("table",$s,[t[12]||(t[12]=e("thead",null,[e("tr",null,[e("th",null,"Item ID"),e("th",null,"Name"),e("th",null,"Quantity"),e("th",null,"Order ID")])],-1)),e("tbody",null,[(o(!0),d(D,null,C(p.checkpoints,(h,R)=>(o(),d(D,{key:R},[(o(!0),d(D,null,C(h.items,(M,U)=>(o(),d("tr",{key:`${R}-${U}`},[e("td",null,c(U),1),e("td",null,c(M.item_name||"Unknown Item"),1),e("td",null,c(M.quantity||1),1),e("td",null,c(M.orderID||"N/A"),1)]))),128))],64))),128))])])])])])])):g("",!0)])])]))),128)),(o(!0),d(D,null,C(m[1].end_locations,(p,b)=>(o(),d("div",{key:b,class:"timeline-item"},[t[19]||(t[19]=e("div",{class:"timeline-badge"},[e("div",{class:"timeline-circle"})],-1)),e("div",Ts,[e("div",Fs,[e("div",Ls,[e("div",Os,[e("div",Rs,[e("h6",As,"Destination #"+c(b),1),e("span",{class:I(["badge",n.getStatusBadgeClass(p.location_status)])},c(p.location_status||"Pending"),3)]),e("div",js,[e("div",Ns,[e("button",{class:"btn btn-sm btn-link p-1",onClick:h=>n.toggleLocationItems(m[0],`end-${b}`)},[e("i",{class:I(["fas",n.isLocationExpanded(m[0],`end-${b}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,qs),n.canScanLocation(m[1],"end",b)&&p.location_status!=="complete"?(o(),d("button",{key:0,class:"btn btn-sm btn-primary",onClick:h=>n.scanQRCode(p.checkpoints)},t[15]||(t[15]=[e("i",{class:"fas fa-qrcode me-1"},null,-1),_(),e("span",null,"Scan QR",-1)]),8,Qs)):g("",!0)])])]),e("div",Vs,[e("div",Us,[e("button",{class:"btn btn-sm btn-link p-1",onClick:h=>n.toggleLocationItems(m[0],`end-${b}`)},[e("i",{class:I(["fas",n.isLocationExpanded(m[0],`end-${b}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Bs),n.canScanLocation(m[1],"end",b)&&p.location_status!=="complete"?(o(),d("button",{key:0,class:"btn btn-sm btn-primary",onClick:h=>n.scanQRCode(p.checkpoints)},t[16]||(t[16]=[e("i",{class:"fas fa-qrcode me-1"},null,-1),_(),e("span",null,"Scan QR",-1)]),8,zs)):g("",!0)])])])]),e("div",Js,[e("p",null,c(p.company_address),1),e("p",Hs,"(Location ID: "+c(p.locationID)+")",1),n.isLocationExpanded(m[0],`end-${b}`)?(o(),d("div",Gs,[e("div",Ks,[t[18]||(t[18]=e("div",{class:"card-header bg-light"},[e("strong",null,"Items")],-1)),e("div",Ws,[e("div",Xs,[e("table",Ys,[t[17]||(t[17]=e("thead",null,[e("tr",null,[e("th",null,"Item ID"),e("th",null,"Name"),e("th",null,"Quantity"),e("th",null,"Order ID")])],-1)),e("tbody",null,[(o(!0),d(D,null,C(p.checkpoints,(h,R)=>(o(),d(D,{key:R},[(o(!0),d(D,null,C(h.items,(M,U)=>(o(),d("tr",{key:`${R}-${U}`},[e("td",null,c(U),1),e("td",null,c(M.item_name||"Unknown Item"),1),e("td",null,c(M.quantity||1),1),e("td",null,c(M.orderID||"N/A"),1)]))),128))],64))),128))])])])])])])):g("",!0)])])]))),128))])),[[ie,r.activeRouteTab===S||Object.keys(i.delivery.routes).length===1]])),128))])])):(o(),d("div",Zs,t[20]||(t[20]=[e("p",null,"No routes information available",-1)])))])])])]))]),t[23]||(t[23]=e("div",{class:"modal-footer theme-footer"},[e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),r.scannerData?(o(),H(l,{key:0,deliveryID:(P=i.delivery)==null?void 0:P.deliveryID,locationID:r.scannerData.locationID,checkpoints:r.scannerData.checkpoints,ref:"qrScannerModal",onScannerClosed:n.reopenExecuteModal},null,8,["deliveryID","locationID","checkpoints","onScannerClosed"])):g("",!0)],64)}const ti=O(Ft,[["render",ei],["__scopeId","data-v-13b178f1"]]),si={name:"DeliveryExecution",components:{ResponsiveTable:le,ExecuteModalDelivery:ti,LoadingSpinner:ne},props:{deliveries:{type:[Array,Object],default:()=>[]},drivers:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},data(){return{localLoading:!1,modalLoading:!1,error:null,selectedDelivery:null,statusFilter:"",dateFilter:"",searchTerm:"",columns:[{key:"deliveryID",label:"ID",sortable:!0},{key:"driver.fullname",label:"Driver",sortable:!0},{key:"vehicle.vehicle_plate",label:"Vehicle",sortable:!0},{key:"status",label:"Status",sortable:!0}]}},computed:{minDate(){return new Date().toISOString().split("T")[0]},filteredDeliveries(){if(console.log("Filtering deliveries:",this.deliveries),!this.deliveries)return console.log("Deliveries is null or undefined"),[];if(typeof this.deliveries=="object"&&!Array.isArray(this.deliveries)){if(Object.keys(this.deliveries).length===0)return[];const s=Object.values(this.deliveries);return console.log("Converted object to array:",s),this.applyFilters(s)}return Array.isArray(this.deliveries)?this.applyFilters(this.deliveries):(console.log("Deliveries is in an unexpected format"),[])}},methods:{viewDelivery(s){this.modalLoading=!0,console.log("selected deliveries: "+JSON.stringify(s,null,3));const t={...s};t.routes&&typeof t.routes=="object"&&!Array.isArray(t.routes)&&(t.routes=Object.values(t.routes).map(i=>(!i.routeID&&i.start_location&&i.end_location&&(i.routeID=`${i.start_location.locationID}-${i.end_location.locationID}`),i.start_location&&(i.start_location.address=i.start_location.company_address,i.start_location.checkpoints&&Array.isArray(i.start_location.checkpoints)&&(i.start_location.items={},i.start_location.checkpoints.forEach(a=>{a.items&&Object.assign(i.start_location.items,a.items)}))),i.end_location&&(i.end_location.address=i.end_location.company_address,i.end_location.checkpoints&&Array.isArray(i.end_location.checkpoints)&&(i.end_location.items={},i.end_location.checkpoints.forEach(a=>{a.items&&Object.assign(i.end_location.items,a.items)}))),i))),this.selectedDelivery=t,this.$nextTick(()=>{this.modalLoading=!1,this.$refs.executeModal.showModal()})},handleRefresh(){this.$emit("refresh",{status:this.statusFilter,date:this.dateFilter,searchTerm:this.searchTerm})},applyFilters(s){const t=this.searchTerm.toLowerCase();return s.filter(i=>{var a,r;if(this.statusFilter&&i.status!==this.statusFilter)return!1;if(this.dateFilter){const n=new Date(i.scheduled_date);if(new Date(n.getTime()-n.getTimezoneOffset()*6e4).toISOString().split("T")[0]!==this.dateFilter)return!1}if(t){const n=i.deliveryID?String(i.deliveryID).toLowerCase():"",l=(a=i.driver)!=null&&a.fullname?i.driver.fullname.toLowerCase():"",v=(r=i.vehicle)!=null&&r.vehicle_plate?i.vehicle.vehicle_plate.toLowerCase():"";if(!n.includes(t)&&!l.includes(t)&&!v.includes(t))return!1}return!0})},startDelivery(s){console.log("Starting delivery:",s),this.localLoading=!0,$.startDelivery(s).then(t=>{this.$emit("refresh")}).catch(t=>{console.error("Error starting delivery:",t)}).finally(()=>{this.localLoading=!1})},getThemeStatusClass(s){switch(s){case"pending":return"bg-warning text-dark";case"in_progress":return"bg-info text-white";case"completed":return"bg-success text-white";case"failed":return"bg-danger text-white";default:return"bg-secondary text-white"}},handleFiltersChanged(){this.$emit("filter-changed",{statusFilter:this.statusFilter,dateFilter:this.dateFilter})}},watch:{statusFilter(){this.$emit("filter-changed",{status:this.statusFilter,date:this.dateFilter})},dateFilter(){this.$emit("filter-changed",{status:this.statusFilter,date:this.dateFilter})},searchTerm(){}}},ii={class:"delivery-execution"},ai={class:"card theme-card"},li={class:"card-header d-flex justify-content-between align-items-center theme-header"},ni={class:"card-body theme-body"},ri={key:0,class:"alert alert-danger"},oi={key:1},di={class:"row mb-4"},ci={class:"col-md-4"},ui={class:"form-group"},vi={class:"col-md-4"},hi={class:"form-group"},mi=["min"],gi={class:"col-md-4"},fi={class:"form-group"},yi={class:"btn-group"},pi=["onClick"];function bi(s,t,i,a,r,n){const l=T("LoadingSpinner"),v=T("ResponsiveTable"),x=T("ExecuteModalDelivery");return o(),d("div",ii,[r.localLoading?(o(),H(l,{key:0,size:"md",message:"Starting delivery...",overlay:!0})):g("",!0),e("div",ai,[e("div",li,[t[6]||(t[6]=e("h5",{class:"mb-0"},"Execute Deliveries",-1)),e("button",{class:"btn btn-sm theme-btn-outline",onClick:t[0]||(t[0]=(...f)=>n.handleRefresh&&n.handleRefresh(...f))},t[5]||(t[5]=[e("i",{class:"fas fa-sync-alt"},null,-1)]))]),e("div",ni,[r.error?(o(),d("div",ri,c(r.error),1)):(o(),d("div",oi,[e("div",di,[e("div",ci,[e("div",ui,[t[8]||(t[8]=e("label",{for:"statusFilter",class:"form-label theme-label"},"Filter by Status",-1)),N(e("select",{id:"statusFilter","onUpdate:modelValue":t[1]||(t[1]=f=>r.statusFilter=f),class:"form-select theme-select"},t[7]||(t[7]=[J('<option value="" data-v-4fb0a56f>All Statuses</option><option value="pending" data-v-4fb0a56f>Pending</option><option value="in_progress" data-v-4fb0a56f>In Progress</option><option value="completed" data-v-4fb0a56f>Completed</option><option value="failed" data-v-4fb0a56f>Failed</option>',5)]),512),[[G,r.statusFilter]])])]),e("div",vi,[e("div",hi,[t[9]||(t[9]=e("label",{for:"dateFilter",class:"form-label theme-label"},"Filter by Date",-1)),N(e("input",{type:"date",id:"dateFilter","onUpdate:modelValue":t[2]||(t[2]=f=>r.dateFilter=f),class:"form-control theme-input",min:n.minDate,required:""},null,8,mi),[[K,r.dateFilter]])])]),e("div",gi,[e("div",fi,[t[10]||(t[10]=e("label",{for:"searchInput",class:"form-label theme-label"},"Search",-1)),N(e("input",{type:"text",id:"searchInput","onUpdate:modelValue":t[3]||(t[3]=f=>r.searchTerm=f),class:"form-control theme-input",placeholder:"Search by ID, Driver, Vehicle..."},null,512),[[K,r.searchTerm]])])])]),L(v,{columns:r.columns,items:n.filteredDeliveries,loading:i.loading,"has-actions":!0,"show-filters":!1,"item-key":"deliveryID",class:"delivery-table"},{status:W(({item:f})=>[e("span",{class:I(["badge",n.getThemeStatusClass(f.status)])},c(f.status||"Pending"),3)]),actions:W(({item:f})=>[e("div",yi,[e("button",{class:"btn btn-sm btn-primary",onClick:E=>n.viewDelivery(f)},t[11]||(t[11]=[e("i",{class:"fas fa-edit"},null,-1)]),8,pi)])]),_:1},8,["columns","items","loading"])]))])]),L(x,{loading:r.modalLoading,delivery:r.selectedDelivery,ref:"executeModal",onStartDelivery:n.startDelivery,onRefresh:t[4]||(t[4]=f=>s.$emit("refresh"))},null,8,["loading","delivery","onStartDelivery"])])}const _i=O(si,[["render",bi],["__scopeId","data-v-4fb0a56f"]]),Di={name:"DeliveryFormModal",emits:["delivery-created"],setup(s,{emit:t}){const i=F(!1),a=F([]),r=F([]),n=F({}),l=F({scheduled_date:"",userID:"",vehicleID:""}),v=X(()=>new Date().toISOString().split("T")[0]),x=X(()=>l.value.scheduled_date&&l.value.userID&&l.value.vehicleID),f=()=>{l.value.userID="",l.value.vehicleID="",l.value.scheduled_date&&(E(),A())},E=async()=>{if(l.value.scheduled_date)try{i.value=!0;const u=await $.getDrivers(l.value.scheduled_date);console.log(u),u.success?a.value=u.data:Q("Error",u.message||"Failed to load drivers")}catch(u){console.error("Error fetching drivers:",u),Q("Error","An unexpected error occurred while loading drivers")}finally{i.value=!1}},A=async()=>{if(l.value.scheduled_date)try{i.value=!0;const u=await $.getVehicles(l.value.scheduled_date);u.success?r.value=u.data:Q("Error",u.message||"Failed to load vehicles")}catch(u){console.error("Error fetching vehicles:",u),Q("Error","An unexpected error occurred while loading vehicles")}finally{i.value=!1}},q=()=>(n.value={},l.value.scheduled_date||(n.value.scheduled_date="Scheduled date is required"),l.value.userID||(n.value.userID="Driver is required"),l.value.vehicleID||(n.value.vehicleID="Vehicle is required"),Object.keys(n.value).length===0),j=async()=>{if(q())try{i.value=!0;const u=await $.createDelivery(l.value);if(u.success){Z("Success","Delivery created successfully"),t("delivery-created",u.data),y();const P=document.getElementById("deliveryFormModal");if(P){const m=V.getInstance(P);m&&m.hide()}}else Q("Error",u.message||"Failed to create delivery")}catch(u){console.error("Error creating delivery:",u),Q("Error","An unexpected error occurred while creating the delivery")}finally{i.value=!1}},y=()=>{l.value={scheduled_date:"",userID:"",vehicleID:""},n.value={},a.value=[],r.value=[]},w=()=>{y();const u=document.getElementById("deliveryFormModal");u&&new V(u).show()};return Y(()=>{const u=document.getElementById("deliveryFormModal");u&&u.addEventListener("hidden.bs.modal",y)}),{loading:i,formData:l,drivers:a,vehicles:r,errors:n,minDate:v,isFormValid:x,onDateChange:f,validateAndSubmit:j,showModal:w}}},Ii={class:"modal fade",id:"deliveryFormModal",tabindex:"-1","aria-labelledby":"deliveryFormModalLabel","aria-hidden":"true"},ki={class:"modal-dialog"},xi={class:"modal-content theme-modal"},Si={class:"modal-body theme-body"},Ci={key:0,class:"text-center p-4"},wi={class:"form-group mb-3"},Pi=["min"],Ei={key:0,class:"text-danger mt-1"},Mi={class:"form-group mb-3"},$i=["disabled"],Ti=["value"],Fi={key:0,class:"text-muted mt-1"},Li={key:1,class:"text-danger mt-1"},Oi={class:"form-group mb-3"},Ri=["disabled"],Ai=["value"],ji={key:0,class:"text-muted mt-1"},Ni={key:1,class:"text-danger mt-1"},qi={class:"modal-footer theme-footer"},Qi=["disabled"];function Vi(s,t,i,a,r,n){return o(),d("div",Ii,[e("div",ki,[e("div",xi,[t[14]||(t[14]=e("div",{class:"modal-header theme-header"},[e("h5",{class:"modal-title",id:"deliveryFormModalLabel"},"Create Delivery"),e("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",Si,[a.loading?(o(),d("div",Ci,t[6]||(t[6]=[e("div",{class:"spinner-border theme-spinner",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2 theme-text"},"Processing...",-1)]))):(o(),d("form",{key:1,onSubmit:t[4]||(t[4]=B((...l)=>a.validateAndSubmit&&a.validateAndSubmit(...l),["prevent"]))},[e("div",wi,[t[7]||(t[7]=e("label",{for:"scheduled_date",class:"form-label theme-label"},"Scheduled Date",-1)),N(e("input",{type:"date",id:"scheduled_date","onUpdate:modelValue":t[0]||(t[0]=l=>a.formData.scheduled_date=l),class:"form-control theme-input",min:a.minDate,onChange:t[1]||(t[1]=(...l)=>a.onDateChange&&a.onDateChange(...l)),required:""},null,40,Pi),[[K,a.formData.scheduled_date]]),a.errors.scheduled_date?(o(),d("div",Ei,c(a.errors.scheduled_date),1)):g("",!0)]),e("div",Mi,[t[9]||(t[9]=e("label",{for:"driver",class:"form-label theme-label"},"Driver",-1)),N(e("select",{id:"driver","onUpdate:modelValue":t[2]||(t[2]=l=>a.formData.userID=l),class:"form-select theme-select",disabled:!a.formData.scheduled_date,required:""},[t[8]||(t[8]=e("option",{value:""},"Select Driver",-1)),(o(!0),d(D,null,C(a.drivers,l=>(o(),d("option",{key:l.userID,value:l.userID},c(l.fullname),9,Ti))),128))],8,$i),[[G,a.formData.userID]]),!a.formData.scheduled_date&&!a.errors.userID?(o(),d("div",Fi," Please select a date first ")):g("",!0),a.errors.userID?(o(),d("div",Li,c(a.errors.userID),1)):g("",!0)]),e("div",Oi,[t[11]||(t[11]=e("label",{for:"vehicle",class:"form-label theme-label"},"Vehicle",-1)),N(e("select",{id:"vehicle","onUpdate:modelValue":t[3]||(t[3]=l=>a.formData.vehicleID=l),class:"form-select theme-select",disabled:!a.formData.scheduled_date,required:""},[t[10]||(t[10]=e("option",{value:""},"Select Vehicle",-1)),(o(!0),d(D,null,C(a.vehicles,l=>(o(),d("option",{key:l.vehicleID,value:l.vehicleID},c(l.vehicle_plate)+" - "+c(l.vehicle_load_weight)+"kg ",9,Ai))),128))],8,Ri),[[G,a.formData.vehicleID]]),!a.formData.scheduled_date&&!a.errors.vehicleID?(o(),d("div",ji," Please select a date first ")):g("",!0),a.errors.vehicleID?(o(),d("div",Ni,c(a.errors.vehicleID),1)):g("",!0)])],32))]),e("div",qi,[t[13]||(t[13]=e("button",{type:"button",class:"btn theme-btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn theme-btn-primary",onClick:t[5]||(t[5]=(...l)=>a.validateAndSubmit&&a.validateAndSubmit(...l)),disabled:a.loading||!a.isFormValid},t[12]||(t[12]=[e("i",{class:"fas fa-save me-1"},null,-1),_(" Create Delivery ")]),8,Qi)])])])])}const Ui=O(Di,[["render",Vi],["__scopeId","data-v-c413d6ab"]]),Bi={name:"CreatedDeliveriesList",props:{deliveries:{type:Object,required:!0},loading:{type:Boolean,default:!1},selectedDeliveryID:{type:[Number,String],default:null},expandedDeliveries:{type:Object,default:()=>({})},currentPage:{type:Number,default:1},pagination:{type:Object,default:()=>({current_page:1,last_page:1,total:0})},hasMorePages:{type:Boolean,default:!1}},methods:{formatDate(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Not scheduled"}}},zi={class:"card theme-card"},Ji={class:"card-header d-flex justify-content-between align-items-center theme-header"},Hi={key:0,class:"p-2 theme-selected-delivery border-bottom"},Gi={class:"d-flex justify-content-between align-items-center"},Ki={class:"d-flex align-items-center"},Wi={class:"card-body p-0"},Xi={key:0,class:"p-3 text-center"},Yi={key:1,class:"p-3 text-center"},Zi={key:2,class:"list-group list-group-flush"},ea={class:"d-flex justify-content-between align-items-center"},ta={class:"d-flex align-items-center"},sa={class:"form-check me-2"},ia=["id","value","checked","onChange"],aa=["for"],la={class:"visually-hidden"},na={class:"fw-bold"},ra={class:"small"},oa={class:"badge theme-badge-primary me-1"},da={class:"text-muted"},ca=["onClick"],ua={key:0,class:"mt-3 delivery-details theme-details"},va={class:"card theme-inner-card"},ha={class:"card-body"},ma={class:"row"},ga={class:"col-12"},fa={class:"mb-1 w-100"},ya={class:"mb-1 w-100"},pa={class:"mb-1 w-100"},ba={class:"mb-1 w-100"},_a={key:3,class:"d-flex justify-content-center p-2 theme-pagination-container"},Da=["disabled"],Ia={class:"align-self-center mx-2 theme-pagination-text"},ka=["disabled"];function xa(s,t,i,a,r,n){return o(),d("div",zi,[e("div",Ji,[t[7]||(t[7]=e("h5",{class:"mb-0"},"Created Deliveries",-1)),e("div",null,[e("button",{class:"btn btn-sm theme-btn-accent me-2",onClick:t[0]||(t[0]=l=>s.$emit("create-delivery"))},t[5]||(t[5]=[e("i",{class:"fas fa-plus"},null,-1)])),e("button",{class:"btn btn-sm theme-btn-outline",onClick:t[1]||(t[1]=l=>s.$emit("refresh"))},t[6]||(t[6]=[e("i",{class:"fas fa-sync-alt"},null,-1)]))])]),i.selectedDeliveryID?(o(),d("div",Hi,[e("div",Gi,[e("div",Ki,[t[8]||(t[8]=e("span",{class:"badge theme-badge-accent me-2"},"Selected",-1)),e("span",null,"Delivery #"+c(i.selectedDeliveryID),1)]),e("button",{class:"btn btn-sm theme-btn-outline-danger",onClick:t[2]||(t[2]=l=>s.$emit("deselect"))},t[9]||(t[9]=[e("i",{class:"fas fa-times"},null,-1)]))])])):g("",!0),e("div",Wi,[i.loading?(o(),d("div",Xi,t[10]||(t[10]=[e("div",{class:"spinner-border theme-spinner",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):Object.keys(i.deliveries).length===0?(o(),d("div",Yi,t[11]||(t[11]=[e("p",{class:"text-muted mb-0"},"No deliveries found",-1)]))):(o(),d("ul",Zi,[(o(!0),d(D,null,C(i.deliveries,(l,v)=>{var x,f;return o(),d("li",{key:v,class:I(["list-group-item theme-list-item",{"theme-list-item-active":i.selectedDeliveryID===l.deliveryID}])},[e("div",ea,[e("div",ta,[e("div",sa,[e("input",{class:"form-check-input theme-checkbox",type:"radio",id:"delivery-"+l.deliveryID,name:"selectedDelivery",value:l.deliveryID,checked:i.selectedDeliveryID===l.deliveryID,onChange:E=>s.$emit("select",l.deliveryID)},null,40,ia),e("label",{class:"form-check-label",for:"delivery-"+l.deliveryID},[e("span",la,"Select Delivery #"+c(l.deliveryID),1)],8,aa)]),e("div",null,[e("div",na,"Delivery #"+c(l.deliveryID),1),e("div",ra,[e("span",oa,c(l.status||"Pending"),1),e("span",da,c(n.formatDate(l.scheduledDate)),1)])])]),e("div",null,[e("i",{class:I(["fas theme-icon expand-icon",i.expandedDeliveries[l.deliveryID]?"fa-chevron-up":"fa-chevron-down"]),onClick:B(E=>s.$emit("toggle-details",l.deliveryID),["stop"])},null,10,ca)])]),i.expandedDeliveries[l.deliveryID]?(o(),d("div",ua,[e("div",va,[e("div",ha,[e("div",ma,[e("div",ga,[t[16]||(t[16]=e("h6",{class:"theme-subtitle"},"Delivery Information",-1)),e("p",fa,[t[12]||(t[12]=e("strong",null,"Status:",-1)),_(" "+c(l.status||"Pending"),1)]),e("p",ya,[t[13]||(t[13]=e("strong",null,"Scheduled Date:",-1)),_(" "+c(n.formatDate(l.scheduledDate)),1)]),e("p",pa,[t[14]||(t[14]=e("strong",null,"Driver:",-1)),_(" "+c(((x=l.driver)==null?void 0:x.fullname)||"Not assigned"),1)]),e("p",ba,[t[15]||(t[15]=e("strong",null,"Vehicle:",-1)),_(" "+c(((f=l.vehicle)==null?void 0:f.vehicle_plate)||"Not assigned"),1)])])])])])])):g("",!0)],2)}),128))])),Object.keys(i.deliveries).length>0?(o(),d("div",_a,[e("button",{class:"btn btn-sm theme-btn-outline me-2",disabled:i.currentPage<=1,onClick:t[3]||(t[3]=l=>s.$emit("change-page",i.currentPage-1))},t[17]||(t[17]=[e("i",{class:"fas fa-chevron-left"},null,-1)]),8,Da),e("span",Ia," Page "+c(i.currentPage)+" of "+c(i.pagination.last_page)+" ("+c(i.pagination.total)+" total) ",1),e("button",{class:"btn btn-sm theme-btn-outline ms-2",disabled:!i.hasMorePages,onClick:t[4]||(t[4]=l=>s.$emit("change-page",i.currentPage+1))},t[18]||(t[18]=[e("i",{class:"fas fa-chevron-right"},null,-1)]),8,ka)])):g("",!0)])])}const Sa=O(Bi,[["render",xa],["__scopeId","data-v-bcd6b8b4"]]),Ca={name:"DeliveryPage",components:{StatsCard:me,DeliveryAssignment:yt,DeliveryExecution:_i,DeliveryFormModal:Ui,CreatedDeliveriesList:Sa},data(){return{activeTab:"assign",loading:!0,createdDeliveriesLoading:!1,assignDeliveriesLoading:!1,executeDeliveriesLoading:!1,pendingSelectionID:null,assignError:null,executeError:null,trips:[],tripsPagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},executionDeliveries:{},pagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},createdDeliveriesPagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},deliveryStats:{pending:0,inProgress:0,completedToday:0,issues:0},selectedLocationID:"",locations:[],drivers:[],vehicles:[],expandedOrders:{},assignmentForm:{deliveryID:null,locationID:null,orderID:null,userID:"",vehicleID:"",scheduledDate:new Date().toISOString().split("T")[0],checkIDs:[],fromLocation:null,toLocation:null},locationInfo:{from:null,to:null},assignmentLoading:!1,createdDeliveries:{},createdDeliveriesPage:1,createdDeliveriesPerPage:3,hasMoreCreatedDeliveries:!1,selectedDeliveryID:null,selectedOrderInfo:null,expandedDeliveries:{},deliveryFormModal:null,activePhase:1}},mounted(){this.fetchTrips(),this.fetchDeliveryStats(),this.fetchCreatedDeliveries()},created(){const s=this.$route.query.selectionID;console.log("Selection ID From Parameter:",s),s&&(this.activeTab="execute",this.pendingSelectionID=s)},watch:{activeTab:{immediate:!0,handler(s){s==="execute"&&this.refreshExecutionDeliveries({}).then(()=>{if(this.pendingSelectionID){const t=Number(this.pendingSelectionID),i=this.executionDeliveries.find(a=>a.deliveryID===t);console.log("Delivery Found:",i),i&&(this.$refs.deliveryExecution.viewDelivery(i),this.pendingSelectionID=null)}})}}},methods:{async fetchTrips(){try{this.assignDeliveriesLoading=!0,this.assignError=null;const s=await $.getTrips({locationID:this.selectedLocationID,page:this.tripsPagination.current_page,per_page:this.tripsPagination.per_page,phase:this.activePhase});s.success?(this.trips=s.data,this.tripsPagination=s.pagination):this.assignError="Failed to fetch trips"}catch(s){console.error("Error fetching trips:",s),this.assignError=s.message||"An error occurred while fetching trips"}finally{this.assignDeliveriesLoading=!1}},handlePhaseChange(s){this.activePhase=s,this.fetchTrips()},handleTripsPageChange(s){this.currentPage=s,this.fetchTrips()},async assignTrip(s){try{if(!this.selectedDeliveryID){this.assignError="Please select a delivery first";return}const t=await $.assignSingleTrip({deliveryID:this.selectedDeliveryID,tripID:s.tripID});t&&t.success?(await this.fetchTrips(),await this.refreshCreatedDeliveries(),z({type:"success",title:"Success",message:t.message||"Delivery assigned successfully",buttons:[{label:"OK",type:"success",dismiss:!0,onClick:()=>{this.fetchTrips(),this.fetchDeliveryStats(),this.fetchCreatedDeliveries()}}]})):this.assignError=t&&t.message||"Failed to assign trip"}catch(t){console.error("Error assigning trip:",t),this.assignError=t.message||"An error occurred while assigning trip"}},deselectDelivery(){console.log("Deselecting delivery, current selectedDeliveryID:",this.selectedDeliveryID),this.selectedDeliveryID=null,console.log("After deselection, selectedDeliveryID:",this.selectedDeliveryID),this.fetchTrips()},onDeliveryCreated(){this.refreshCreatedDeliveries(),this.refreshAssignDeliveries()},formatDate(s){if(!s)return"";const t=new Date(s);return isNaN(t.getTime())?"":t.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})},async fetchCreatedDeliveries(){try{this.createdDeliveriesLoading=!0,this.assignError=null;const s=await $.getCreatedDeliveries(this.createdDeliveriesPage,3);s.success?(this.createdDeliveries=s.data,this.hasMoreCreatedDeliveries=s.pagination.current_page<s.pagination.last_page,this.createdDeliveriesPagination=s.pagination):this.assignError=s.message||"Failed to fetch created deliveries"}catch(s){console.error("Error fetching created deliveries:",s),this.assignError="An error occurred while fetching deliveries"}finally{this.createdDeliveriesLoading=!1}this.fetchDeliveryStats()},selectDelivery(s){this.selectedDeliveryID=s,this.fetchTrips()},changeCreatedDeliveriesPage(s){s<1||s>1&&!this.hasMoreCreatedDeliveries||(this.createdDeliveriesPage=s,this.fetchCreatedDeliveries())},viewDeliveryDetails(s){var t,i,a,r;z({type:"info",title:`Delivery Details - #${s.deliveryID}`,message:`
          <div>
            <p><strong>From:</strong> ${this.getLocationName((t=s.from)==null?void 0:t.locationID)}</p>
            <p><strong>To:</strong> ${this.getLocationName((i=s.to)==null?void 0:i.locationID)}</p>
            <p><strong>Status:</strong> ${s.status||"Pending"}</p>
            <p><strong>Scheduled Date:</strong> ${s.scheduledDate}</p>
            <p><strong>Driver:</strong> ${((a=s.driver)==null?void 0:a.name)||"Not assigned"}</p>
            <p><strong>Vehicle:</strong> ${((r=s.vehicle)==null?void 0:r.vehicle_plate)||"Not assigned"}</p>
          </div>
        `,buttons:[{label:"Close",type:"secondary",dismiss:!0}]})},handleLocationChange(s){this.selectedLocationID=s,this.pagination.current_page=1,this.fetchTrips()},refreshData(){this.fetchDeliveryStats(),this.selectedOrderInfo=null,this.activeTab==="execute"&&this.refreshExecutionDeliveries()},async refreshCreatedDeliveries(){try{this.createdDeliveriesLoading=!0,this.assignError=null;const s=await $.getCreatedDeliveries(this.createdDeliveriesPage,3);s.success?(this.createdDeliveries=s.data,this.hasMoreCreatedDeliveries=s.pagination.current_page<s.pagination.last_page,this.createdDeliveriesPagination=s.pagination):this.assignError=s.message||"Failed to fetch created deliveries"}catch(s){console.error("Error fetching created deliveries:",s),this.assignError="An error occurred while fetching deliveries"}finally{this.createdDeliveriesLoading=!1}this.fetchDeliveryStats()},async refreshAssignDeliveries(){try{this.assignDeliveriesLoading=!0,this.assignError=null;const s=await $.getTrips({locationID:this.selectedLocationID,page:this.tripsPagination.current_page,per_page:this.tripsPagination.per_page,phase:this.activePhase});console.log("API Response Assign Deliveries:",JSON.stringify(s,null,4)),s.success?(this.groupedDeliveries=s.data,this.tripsPagination=s.pagination):this.assignError=s.message||"Failed to load delivery data"}catch(s){console.error("Error fetching delivery data:",s),this.assignError="An unexpected error occurred while loading delivery data"}finally{this.assignDeliveriesLoading=!1}this.fetchDeliveryStats()},changePage(s){s<1||s>this.pagination.last_page||(this.pagination.current_page=s,this.fetchTrips())},getPageNumbers(){const s=this.pagination.last_page,t=this.pagination.current_page;return s<=5?Array.from({length:s},(i,a)=>a+1):t<=3?[1,2,3,4,5]:t>=s-2?[s-4,s-3,s-2,s-1,s]:[t-2,t-1,t,t+1,t+2]},getLocationName(s){const t=this.locations.find(i=>i.locationID==s);return t?t.company_address:null},formatPrice(s){return parseFloat(s).toFixed(2)},calculateTotalMeasurement(s){return Array.isArray(s)?s.reduce((i,a)=>a.measurement_type&&a.measurement_type.toLowerCase().includes("kg")?i+parseFloat(a.measurement_value||0)*parseFloat(a.quantity||1):i,0).toFixed(2):(console.warn("Items is not an array:",s),0)},toggleOrderDetails(s,t){const i=`${s}-${t}`;this.expandedOrders||(this.expandedOrders={}),this.expandedOrders[i]=!this.isOrderExpanded(s,t)},isOrderExpanded(s,t){if(!this.expandedOrders)return!1;const i=`${s}-${t}`;return!!this.expandedOrders[i]},getOrderInfo(s,t){return!this.groupedDeliveries[s]||!this.groupedDeliveries[s].orders[t]?null:this.groupedDeliveries[s].orders[t]},getLocationInfo(s,t){const i=this.getOrderInfo(s,t);return i?{from:i.from||null,to:i.to||null}:{from:null,to:null}},async assignDelivery(s,t){try{if(this.assignmentForm={locationID:s,orderID:t,deliveryID:this.selectedDeliveryID,scheduledDate:new Date().toISOString().split("T")[0],checkIDs:[],fromLocation:null,toLocation:null},console.log("Assignment form initialized:",this.assignmentForm),this.locationInfo={from:null,to:null},this.groupedDeliveries[s]){const i=this.groupedDeliveries[s];if(console.log("Location data found:",i),i.orders&&i.orders[t]){const a=i.orders[t];console.log("Order data found:",a),this.locationInfo={from:a.from||i.from||null,to:a.to||i.to||null},this.selectedOrderInfo=a}}this.$refs.assignmentModal.show()}catch(i){console.error("Error in assignDelivery:",i),z({type:"error",title:"Error",message:(i==null?void 0:i.message)||"An error occurred while preparing the assignment",buttons:[{label:"OK",type:"primary",dismiss:!0}]})}},getLocationInfo(s,t){const i=this.getOrderInfo(s,t);return i?{from:i.from||null,to:i.to||null}:{from:null,to:null}},handleValidationError(s){z({type:"warning",title:"Validation Error",message:s||"Please check your input and try again"})},toggleDeliveryDetails(s){if(this.expandedDeliveries||(this.expandedDeliveries={}),this.expandedDeliveries[s]=!this.expandedDeliveries[s],this.expandedDeliveries[s]){const t=s.toString();Object.keys(this.expandedDeliveries).forEach(i=>{i!==t&&(this.expandedDeliveries[i]=!1)})}},async fetchDeliveryStats(){try{const s=await $.getDeliveryStats();s.success?this.deliveryStats=s.data:console.error("Failed to fetch delivery stats:",s.message)}catch(s){console.error("Error fetching delivery stats:",s)}},async refreshExecutionDeliveries(s={}){try{this.executeDeliveriesLoading=!0,this.executeError=null,console.log("Fetching execution deliveries with filters:",s);const t=await $.getExecutionDeliveries(s);t.success?(this.executionDeliveries=Object.values(t.data),console.log("execution deliveries structure:",JSON.stringify(this.executionDeliveries,null,2))):this.executeError=t.message||"Failed to load execution deliveries"}catch(t){console.error("Error fetching execution deliveries:",t),this.executeError="An error occurred while loading execution deliveries. Please try again later."}finally{this.executeDeliveriesLoading=!1}},handleExecutionFilterChange(s){this.refreshExecutionDeliveries(s)},openCreateDeliveryModal(){const s=document.getElementById("deliveryFormModal");s?new V(s).show():console.error("Modal element not found with ID: deliveryFormModal")},openAssignmentModal(s){this.selectedOrderInfo=s;const t=this.$refs.assignmentModal;t&&t.setDeliveryID(this.selectedDeliveryID);const i=document.getElementById("assignmentModal");i&&new V(i).show()}}},wa={class:"delivery-management"},Pa={class:"row delivery-tabs mb-4"},Ea={class:"col-md-6 mb-3"},Ma={class:"col-md-6 mb-3"},$a={key:0,class:"row"},Ta={class:"col-lg-3 col-md-12 mb-4"},Fa={class:"col-lg-9 col-md-12"},La={key:1};function Oa(s,t,i,a,r,n){const l=T("StatsCard"),v=T("CreatedDeliveriesList"),x=T("DeliveryAssignment"),f=T("DeliveryExecution"),E=T("DeliveryFormModal");return o(),d("div",wa,[t[4]||(t[4]=e("h1",{class:"mb-4"},"Delivery Management",-1)),L(l,{stats:r.deliveryStats},null,8,["stats"]),e("div",Pa,[e("div",Ea,[e("div",{class:I(["delivery-tab-card",{active:r.activeTab==="assign"}]),onClick:t[0]||(t[0]=A=>r.activeTab="assign")},t[2]||(t[2]=[J('<div class="tab-icon" data-v-d1897b1f><i class="fas fa-clipboard-list" data-v-d1897b1f></i></div><div class="tab-content" data-v-d1897b1f><div class="tab-title" data-v-d1897b1f>Assign Deliveries</div><div class="tab-desc" data-v-d1897b1f>Create and assign delivery trips to drivers</div></div>',2)]),2)]),e("div",Ma,[e("div",{class:I(["delivery-tab-card",{active:r.activeTab==="execute"}]),onClick:t[1]||(t[1]=A=>r.activeTab="execute")},t[3]||(t[3]=[J('<div class="tab-icon" data-v-d1897b1f><i class="fas fa-truck" data-v-d1897b1f></i></div><div class="tab-content" data-v-d1897b1f><div class="tab-title" data-v-d1897b1f>Execute Deliveries</div><div class="tab-desc" data-v-d1897b1f>Track and manage ongoing deliveries</div></div>',2)]),2)])]),r.activeTab==="assign"?(o(),d("div",$a,[e("div",Ta,[L(v,{deliveries:r.createdDeliveries,loading:r.createdDeliveriesLoading,selectedDeliveryID:r.selectedDeliveryID,expandedDeliveries:r.expandedDeliveries,currentPage:r.createdDeliveriesPage,pagination:r.createdDeliveriesPagination,hasMorePages:r.hasMoreCreatedDeliveries,onCreateDelivery:n.openCreateDeliveryModal,onRefresh:n.refreshCreatedDeliveries,onSelect:n.selectDelivery,onDeselect:n.deselectDelivery,onToggleDetails:n.toggleDeliveryDetails,onChangePage:n.changeCreatedDeliveriesPage},null,8,["deliveries","loading","selectedDeliveryID","expandedDeliveries","currentPage","pagination","hasMorePages","onCreateDelivery","onRefresh","onSelect","onDeselect","onToggleDetails","onChangePage"])]),e("div",Fa,[r.activeTab==="assign"?(o(),H(x,{key:0,loading:r.assignDeliveriesLoading,error:r.assignError,trips:r.trips,pagination:r.tripsPagination,selectedDeliveryID:r.selectedDeliveryID,activePhase:r.activePhase,onRefresh:n.fetchTrips,onAssignTrip:n.assignTrip,onChangePhase:n.handlePhaseChange,onChangePage:n.handleTripsPageChange},null,8,["loading","error","trips","pagination","selectedDeliveryID","activePhase","onRefresh","onAssignTrip","onChangePhase","onChangePage"])):g("",!0)])])):g("",!0),r.activeTab==="execute"?(o(),d("div",La,[L(f,{ref:"deliveryExecution",deliveries:r.executionDeliveries,loading:r.executeDeliveriesLoading,error:r.executeError,onRefresh:n.refreshExecutionDeliveries,onFilterChanged:n.handleExecutionFilterChange},null,8,["deliveries","loading","error","onRefresh","onFilterChanged"])])):g("",!0),L(E,{ref:"deliveryFormModal",onDeliveryCreated:n.onDeliveryCreated},null,8,["onDeliveryCreated"])])}const Qa=O(Ca,[["render",Oa],["__scopeId","data-v-d1897b1f"]]);export{Qa as default};
