import{l as $,_ as O,r as d,E as A,c as n,o as r,b as x,d as S,a as e,t as v,n as P,F as C,i as U,w as B,L,v as J,e as R,j as z,k as Q,C as G,f as j,p as H}from"./main-6HkEK7r2.js";import{R as K}from"./ResponsiveTable-DO6c7ISj.js";import"./LoadingSpinner-TtFArfCL.js";const T={getDeliveryInfo:async f=>{try{return await $.get(`/api/deliveries/${f}`)}catch(i){return console.error("Error fetching delivery info:",i),{status:"error",message:i.message||"Failed to fetch delivery information"}}},getVerifications:async(f,i,a)=>{try{return await $.get(`/api/verifications?deliveryID=${f}&locationID=${i}&token=${a}`)}catch(p){return console.error("Error fetching verifications:",p),{status:"error",message:p.message||"Failed to fetch verification data"}}},getCheckpointDetails:async f=>{try{return await $.get(`/api/checkpoints/${f}`)}catch(i){return console.error("Error fetching checkpoint details:",i),{status:"error",message:i.message||"Failed to fetch checkpoint details"}}},getVerificationById:async(f,i,a,p)=>{try{return await $.get(`/api/verifications/${f}`,{params:{deliveryID:i,locationID:a,token:p}})}catch(s){return console.error("Error fetching verification by ID:",s),{status:"error",message:s.message||"Failed to fetch verification details"}}},updateVerification:async(f,i)=>{try{return await $.put(`/api/verifications/${f}`,i)}catch(a){return console.error("Error updating verification:",a),{status:"error",message:a.message||"Failed to update verification"}}},completeVerifications:async(f,i)=>{try{return await $.post(`/api/verifications/complete/${i}/${f}`)}catch(a){return console.error("Error completing verifications:",a),{status:"error",message:a.message||"Failed to complete verifications"}}}},W={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},X={class:"modal-content"},Y={class:"modal-header theme-header"},Z={class:"modal-title"},ee={class:"modal-body"},te={key:0,class:"text-center p-4"},se={key:1,class:"alert alert-danger mt-3"},ae={key:2,class:"verification-form"},le={class:"d-flex justify-content-between align-items-center mb-3"},ie={class:"d-flex align-items-center"},oe={class:"mb-0 me-2"},ne={class:"badge bg-secondary me-2"},re={class:"form-section mb-4"},ce={class:"items-section"},ue={key:0},de={class:"table-responsive"},ve={class:"table table-sm table-hover mb-0"},fe={class:"order-header"},me={colspan:"4",class:"order-header-cell"},pe={class:"d-flex align-items-center"},ge={class:"order-badge me-2"},he={class:"order-item-count"},ye={class:"text-center"},_e={class:"text-center"},be={class:"quantity-badge"},ke={class:"text-center"},De={key:1,class:"text-center text-muted py-3"},Ve={class:"form-section"},we={class:"mb-4"},Ie={class:"status-options"},xe={class:"form-check form-check-inline"},$e={class:"form-check form-check-inline"},Ce={class:"mb-3"},Se={key:3,class:"alert alert-danger mt-3"},Pe={key:4,class:"alert alert-success mt-3"},Me={class:"modal-footer theme-footer"},Ee=["disabled"],Fe={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Ne={key:1,class:"modal-backdrop fade show"},qe={__name:"VerifiesModalDetail",props:{show:{type:Boolean,required:!0},verifyId:{type:[Number,String],default:null},deliveryId:{type:[Number,String],default:null},locationId:{type:[Number,String],default:null},token:{type:String,default:null}},emits:["close","updated"],setup(f,{emit:i}){const a=f,p=i,s=d(null),b=d(!1),y=d(null),_=d(!1),I=d(!1),w=d(null);d(!1),A(()=>[a.show,a.verifyId],async([u,t])=>{u&&t?await k(t):(s.value=null,y.value=null,_.value=!1,w.value=null)},{immediate:!0});const k=async u=>{I.value=!0,w.value=null;try{const t=await T.getVerificationById(u,a.deliveryId,a.locationId,a.token);console.log("Response from fetchVerificationDetails:",JSON.stringify(t,null,2)),t.status==="success"?s.value={...t.data,associated_items:t.data.associated_items||[]}:w.value=t.message||"Failed to load verification details."}catch(t){console.error("Error fetching verification details:",t),w.value=t.message||"An unexpected error occurred while fetching details."}finally{I.value=!1}},D=()=>{p("close")},c=async()=>{var u,t;if(!(!s.value||!s.value.verifyID)){b.value=!0,y.value=null,_.value=!1;try{const g={verify_status:s.value.verify_status,verify_comment:s.value.verify_comment},m=await T.updateVerification(s.value.verifyID,g);m.status==="success"?(_.value=!0,p("updated",m.data),setTimeout(()=>{D()},1500)):(y.value=m.message||"Failed to update verification.",m.errors&&(y.value+=" Details: "+JSON.stringify(m.errors)))}catch(g){console.error("Error updating verification:",g),y.value=((t=(u=g.response)==null?void 0:u.data)==null?void 0:t.message)||g.message||"An unexpected error occurred."}finally{b.value=!1}}},M=u=>u==="complete"?"theme-badge-success":u==="pending"?"theme-badge-warning":u==="reject"?"theme-badge-danger":"theme-badge-secondary",E=()=>!s.value||!s.value.associated_items?{}:s.value.associated_items.reduce((u,t)=>{const g=t.orderID||"Unknown";return u[g]||(u[g]=[]),u[g].push(t),u},{});return(u,t)=>{var g;return r(),n(C,null,[f.show?(r(),n("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:S(D,["self"])},[e("div",W,[e("div",X,[e("form",{onSubmit:S(c,["prevent"])},[e("div",Y,[e("h5",Z,"Verification Form #"+v((g=s.value)==null?void 0:g.verifyID),1),e("button",{type:"button",class:"btn-close theme-close",onClick:D,"aria-label":"Close"})]),e("div",ee,[I.value?(r(),n("div",te,t[3]||(t[3]=[e("div",{class:"spinner-border theme-spinner",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("p",{class:"mt-2"},"Loading verification details...",-1)]))):w.value?(r(),n("div",se,v(w.value),1)):s.value?(r(),n("div",ae,[e("div",le,[e("div",ie,[e("h6",oe,"Delivery ID: "+v(s.value.deliveryID),1),e("span",ne,"Checkpoint: "+v(s.value.checkID),1)]),e("span",{class:P(["badge",M(s.value.verify_status)])},v(s.value.verify_status||"Pending"),3)]),e("div",re,[t[6]||(t[6]=e("h6",{class:"section-title"},"Items to Verify",-1)),e("div",ce,[s.value.associated_items&&s.value.associated_items.length>0?(r(),n("div",ue,[e("div",de,[e("table",ve,[t[4]||(t[4]=e("thead",{class:"table-header"},[e("tr",null,[e("th",{scope:"col",class:"text-center"},"#"),e("th",{scope:"col"},"Name"),e("th",{scope:"col",class:"text-center"},"Quantity"),e("th",{scope:"col",class:"text-center"},"Status")])],-1)),e("tbody",null,[(r(!0),n(C,null,U(E(),(m,F)=>(r(),n(C,null,[e("tr",fe,[e("td",me,[e("div",pe,[e("span",ge,"Order #"+v(F),1),e("span",he,v(m.length)+" item(s)",1)])])]),(r(!0),n(C,null,U(m,(l,o)=>(r(),n("tr",{key:l.itemID,class:"align-middle item-row"},[e("td",ye,v(o+1),1),e("td",null,v(l.item_name||"Unknown Item"),1),e("td",_e,[e("span",be,v(l.quantity||1),1)]),e("td",ke,[e("span",{class:P(["badge",M(s.value.verify_status)])},v(s.value.verify_status||"Pending"),3)])]))),128))],64))),256))])])])])):(r(),n("div",De,t[5]||(t[5]=[e("p",{class:"mb-0"},"No items associated with this verification checkpoint.",-1)])))])]),e("div",Ve,[t[11]||(t[11]=e("h6",{class:"section-title"},"Update Verification Status",-1)),e("div",we,[t[9]||(t[9]=e("label",{for:"verify_status",class:"form-label"},"Status:",-1)),e("div",Ie,[e("div",xe,[B(e("input",{class:"form-check-input",type:"radio",name:"verify_status",id:"status-pending",value:"pending","onUpdate:modelValue":t[0]||(t[0]=m=>s.value.verify_status=m)},null,512),[[L,s.value.verify_status]]),t[7]||(t[7]=e("label",{class:"form-check-label",for:"status-pending"},[e("span",{class:"status-badge theme-badge-warning"},"Pending")],-1))]),e("div",$e,[B(e("input",{class:"form-check-input",type:"radio",name:"verify_status",id:"status-complete",value:"complete","onUpdate:modelValue":t[1]||(t[1]=m=>s.value.verify_status=m)},null,512),[[L,s.value.verify_status]]),t[8]||(t[8]=e("label",{class:"form-check-label",for:"status-complete"},[e("span",{class:"status-badge theme-badge-success"},"Complete")],-1))])])]),e("div",Ce,[t[10]||(t[10]=e("label",{for:"verify_comment",class:"form-label"},"Verification Notes:",-1)),B(e("textarea",{class:"form-control",id:"verify_comment","onUpdate:modelValue":t[2]||(t[2]=m=>s.value.verify_comment=m),rows:"4",placeholder:"Enter any notes or comments about this verification..."},null,512),[[J,s.value.verify_comment]])])])])):x("",!0),y.value?(r(),n("div",Se,v(y.value),1)):x("",!0),_.value?(r(),n("div",Pe,t[12]||(t[12]=[e("i",{class:"fas fa-check-circle me-2"},null,-1),R(" Verification updated successfully! ")]))):x("",!0)]),e("div",Me,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:D},"Cancel"),e("button",{type:"submit",class:"btn theme-btn-primary",disabled:b.value||I.value||!s.value},[b.value?(r(),n("span",Fe)):x("",!0),R(" "+v(b.value?"Saving...":"Save Verification"),1)],8,Ee)])],32)])])])):x("",!0),f.show?(r(),n("div",Ne)):x("",!0)],64)}}},Be=O(qe,[["__scopeId","data-v-1c15512a"]]),Ue={class:"verify-delivery-management"},Te={class:"card theme-card"},Le={class:"card-body theme-body"},Re={key:0,class:"alert alert-danger",role:"alert"},je=["onClick"],Oe={key:1,class:"d-flex justify-content-between align-items-center mt-3"},Ae={class:"text-muted"},Je={"aria-label":"Table pagination"},ze={class:"pagination mb-0 theme-pagination"},Qe=["onClick"],Ge={__name:"VerifyDeliveryPage",setup(f){const i=G(),a=d(!0),p=d(null),s=d(null),b=d(null),y=d(null),_=d([]),I=d(null),w=d(!1),k=d(1),D=d(10),c=d({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),M=z(()=>{const l=[],h=c.value.last_page;if(h<=5)for(let V=1;V<=h;V++)l.push(V);else{let V=Math.max(1,c.value.current_page-Math.floor(2.5)),N=Math.min(h,V+5-1);N===h&&(V=Math.max(1,N-5+1));for(let q=V;q<=N;q++)l.push(q)}return l}),E=d([{key:"verifyID",label:"Verification ID",sortable:!0},{key:"verify_status",label:"Status",sortable:!0}]),u=async()=>{if(!s.value||!b.value||!y.value){p.value="Delivery ID, Location ID, and Token are required parameters.",a.value=!1;return}a.value=!0,p.value=null;try{const l=await T.getVerifications(s.value,b.value,y.value);if(l.status==="error")throw new Error(l.message);const o=l.data||l;if(_.value=o,!o.some(V=>V.verify_status==="pending")){window.location.href=`/deliveries?selectionID=${s}`;return}c.value.total=_.value.length,c.value.last_page=Math.ceil(_.value.length/D.value),c.value.current_page=k.value,c.value.from=_.value.length>0?(k.value-1)*D.value+1:0,c.value.to=Math.min(k.value*D.value,_.value.length)}catch(l){console.error("Error fetching verifications:",l),p.value=l.message||"Failed to fetch verification data. Please try again.",_.value=[],c.value={current_page:1,last_page:1,per_page:D.value,total:0,from:0,to:0}}finally{a.value=!1}},t=l=>{l<1||l>c.value.last_page||a.value||(k.value=l,c.value.current_page=l,c.value.from=(l-1)*D.value+1,c.value.to=Math.min(l*D.value,_.value.length))},g=l=>{I.value=l,w.value=!0},m=()=>{w.value=!1,I.value=null},F=()=>{u()};return Q(()=>{s.value=i.query.deliveryID,b.value=i.query.locationID,y.value=i.query.token,!s.value||!b.value||!y.value?(p.value="Missing required parameters: Delivery ID, Location ID, and Token.",a.value=!1):u()}),(l,o)=>(r(),n("div",Ue,[o[6]||(o[6]=e("h1",{class:"mb-4"},"Verify Delivery",-1)),e("div",Te,[o[5]||(o[5]=e("div",{class:"card-header d-flex justify-content-between align-items-center theme-header"},[e("h5",{class:"mb-0"},"Verifications")],-1)),e("div",Le,[p.value?(r(),n("div",Re,v(p.value),1)):x("",!0),j(K,{columns:E.value,items:_.value,loading:a.value,"has-actions":!0,"item-key":"verifyID","show-pagination":!1},{actions:H(({item:h})=>[e("button",{class:"btn btn-sm theme-btn-info",onClick:V=>g(h)},o[2]||(o[2]=[e("i",{class:"fas fa-edit"},null,-1)]),8,je)]),_:1},8,["columns","items","loading"]),c.value.last_page>0?(r(),n("div",Oe,[e("div",null,[e("span",Ae,"Showing "+v(c.value.from||0)+" to "+v(c.value.to||0)+" of "+v(c.value.total||0)+" entries",1)]),e("nav",Je,[e("ul",ze,[e("li",{class:P(["page-item",{disabled:k.value===1||a.value}])},[e("a",{class:"page-link",href:"#",onClick:o[0]||(o[0]=S(h=>!a.value&&t(k.value-1),["prevent"]))},o[3]||(o[3]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(r(!0),n(C,null,U(M.value,h=>(r(),n("li",{key:h,class:P(["page-item",{active:h===k.value,disabled:a.value}])},[e("a",{class:"page-link",href:"#",onClick:S(V=>!a.value&&t(h),["prevent"])},v(h),9,Qe)],2))),128)),e("li",{class:P(["page-item",{disabled:k.value===c.value.last_page||a.value}])},[e("a",{class:"page-link",href:"#",onClick:o[1]||(o[1]=S(h=>!a.value&&t(k.value+1),["prevent"]))},o[4]||(o[4]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):x("",!0)])]),j(Be,{show:w.value,"verify-id":I.value?I.value.verifyID:null,"delivery-id":s.value,"location-id":b.value,token:y.value,onClose:m,onUpdated:F},null,8,["show","verify-id","delivery-id","location-id","token"])]))}},Xe=O(Ge,[["__scopeId","data-v-8ccba4e1"]]);export{Xe as default};
