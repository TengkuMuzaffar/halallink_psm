import{_ as h,j as M,c as t,a as s,d as x,b,e as P,w as y,v as L,o as n,r as p,h as j,E as I,F as A,i as F,l as S,t as q,y as G,f as T,g as R,k as Q,C as X,u as Z}from"./main-6HkEK7r2.js";import{m as u}from"./modal-BXblql9Y.js";import{m as $}from"./marketplaceService-Sfc_2ZME.js";const ee={name:"ProfileInfo",props:{profileData:{type:Object,required:!0},profileImage:{type:String,default:null},editMode:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["toggle-edit","save","cancel","image-change"],setup(c){return{isAdmin:M(()=>c.profileData.role==="admin")}}},se={class:"card"},oe={class:"card-header d-flex justify-content-between align-items-center"},ae={key:1},te={class:"card-body"},ne={key:0,class:"text-center py-4"},ie={key:1},le={class:"row mb-4"},de={class:"col-md-3 text-center"},re={class:"avatar-container mb-3"},me=["src"],ce={key:0,class:"mt-2"},ue={class:"col-md-9"},fe={key:0,class:"mb-3"},pe=["disabled"],ve={key:1,class:"mb-3"},ge=["disabled"],be={class:"mb-3"},ye=["disabled"],we={class:"mb-3"},_e=["disabled"],ke={class:"mb-3"};function Le(c,e,i,o,l,w){return n(),t("div",se,[s("div",oe,[e[13]||(e[13]=s("h5",{class:"mb-0"},"Profile Information",-1)),i.editMode?(n(),t("div",ae,[s("button",{class:"btn btn-success me-2",onClick:e[1]||(e[1]=a=>c.$emit("save"))},e[11]||(e[11]=[s("i",{class:"bi bi-check-lg me-1"},null,-1),s("span",{class:"d-none d-md-inline"},"Save",-1)])),s("button",{class:"btn btn-secondary",onClick:e[2]||(e[2]=a=>c.$emit("toggle-edit"))},e[12]||(e[12]=[s("i",{class:"bi bi-x-lg me-1"},null,-1),s("span",{class:"d-none d-md-inline"},"Cancel",-1)]))])):(n(),t("button",{key:0,class:"btn btn-primary",onClick:e[0]||(e[0]=a=>c.$emit("toggle-edit"))},e[10]||(e[10]=[s("i",{class:"bi bi-pencil-fill me-1"},null,-1),s("span",{class:"d-none d-md-inline"},"Edit Profile",-1)])))]),s("div",te,[i.loading?(n(),t("div",ne,e[14]||(e[14]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):(n(),t("div",ie,[s("form",{onSubmit:e[9]||(e[9]=x(a=>c.$emit("save"),["prevent"]))},[s("div",le,[s("div",de,[s("div",re,[s("img",{src:i.profileImage||"/images/blank.jpg",alt:"Profile Picture",class:"rounded-circle img-thumbnail",style:{width:"150px",height:"150px","object-fit":"cover"}},null,8,me),i.editMode?(n(),t("div",ce,[e[15]||(e[15]=s("label",{for:"profile-image",class:"btn btn-sm btn-outline-primary"},[s("i",{class:"bi bi-camera-fill me-1"}),P(" Change Photo ")],-1)),s("input",{type:"file",id:"profile-image",class:"d-none",accept:"image/*",onChange:e[3]||(e[3]=a=>c.$emit("image-change",a))},null,32)])):b("",!0)])]),s("div",ue,[o.isAdmin?(n(),t("div",fe,[e[16]||(e[16]=s("label",{for:"company_name",class:"form-label"},"Company Name",-1)),y(s("input",{type:"text",class:"form-control",id:"company_name","onUpdate:modelValue":e[4]||(e[4]=a=>i.profileData.company_name=a),disabled:!i.editMode,required:""},null,8,pe),[[L,i.profileData.company_name]])])):(n(),t("div",ve,[e[17]||(e[17]=s("label",{for:"fullname",class:"form-label"},"Full Name",-1)),y(s("input",{type:"text",class:"form-control",id:"fullname","onUpdate:modelValue":e[5]||(e[5]=a=>i.profileData.fullname=a),disabled:!i.editMode,required:""},null,8,ge),[[L,i.profileData.fullname]])])),s("div",be,[e[18]||(e[18]=s("label",{for:"email",class:"form-label"},"Email Address",-1)),y(s("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":e[6]||(e[6]=a=>i.profileData.email=a),disabled:!i.editMode,required:""},null,8,ye),[[L,i.profileData.email]])]),s("div",we,[e[19]||(e[19]=s("label",{for:"tel_number",class:"form-label"},"Phone Number",-1)),y(s("input",{type:"tel",class:"form-control",id:"tel_number","onUpdate:modelValue":e[7]||(e[7]=a=>i.profileData.tel_number=a),disabled:!i.editMode},null,8,_e),[[L,i.profileData.tel_number]])]),s("div",ke,[e[20]||(e[20]=s("label",{for:"status",class:"form-label"},"Status",-1)),y(s("input",{type:"text",class:"form-control",id:"status","onUpdate:modelValue":e[8]||(e[8]=a=>i.profileData.status=a),disabled:""},null,512),[[L,i.profileData.status]])])])])],32)]))])])}const Pe=h(ee,[["render",Le],["__scopeId","data-v-46d3daa0"]]),Ee={name:"CompanyLocations",props:{locations:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1},editMode:{type:Boolean,default:!1}},emits:["update:locations","loading","toggle-edit"],setup(c,{emit:e}){const i=j(),o=p(!1),l=p([]),w=p([]),a=M(()=>{const m=i.getters.user;return m&&m.company?m.company.company_type:"admin"});return I(()=>c.locations,m=>{c.editMode&&(l.value=Array.isArray(m)?JSON.parse(JSON.stringify(m||[])):[])},{immediate:!0}),I(()=>c.editMode,m=>{m&&(l.value=Array.isArray(c.locations)?JSON.parse(JSON.stringify(c.locations||[])):[],w.value=[])}),{saving:o,editableLocations:l,companyType:a,addNewLocation:()=>{l.value.push({company_address:"",location_type:"headquarters"})},removeLocation:m=>{const k=l.value[m];k.locationID&&w.value.push(k.locationID),l.value.splice(m,1)},saveLocations:async()=>{o.value=!0,e("loading",!0);try{const m={locations:l.value||[],delete_ids:w.value||[]},k=await S.post("/api/profile/locations",m);e("update:locations",k.locations||[]),u.success("Success","Company locations updated successfully"),e("toggle-edit")}catch(m){console.error("Error saving locations:",m),u.danger("Error","Failed to update company locations. Please try again.")}finally{o.value=!1,e("loading",!1)}}}}},De={class:"card mb-4"},Se={class:"card-header d-flex justify-content-between align-items-center"},Me={key:1},Ve={class:"card-body"},Ce={key:0,class:"text-center py-4"},xe={key:1},Ie={key:0},he={key:0,class:"text-center py-3"},Ue={key:1,class:"location-list"},Ne={class:"d-flex justify-content-between"},Ae={class:"fw-bold"},Fe={class:"text-muted small"},qe={key:1},Te={class:"row g-2"},Re={class:"col-md-6"},je=["onUpdate:modelValue"],Be={class:"col-md-4"},Oe=["onUpdate:modelValue"],Je={key:0,value:"supplier"},ze={key:1,value:"slaughterhouse"},He={key:2,value:"kitchen"},Ke={class:"col-md-2 d-flex align-items-end"},We=["onClick"],Ye={class:"mb-3"},Ge={class:"d-flex justify-content-end"},Qe=["disabled"],Xe={key:0,class:"spinner-border spinner-border-sm ms-1",role:"status","aria-hidden":"true"};function Ze(c,e,i,o,l,w){return n(),t("div",De,[s("div",Se,[e[8]||(e[8]=s("h5",{class:"mb-0"},"Company Locations",-1)),i.editMode?(n(),t("div",Me,[s("button",{class:"btn btn-success me-2",onClick:e[1]||(e[1]=(...a)=>o.saveLocations&&o.saveLocations(...a))},e[6]||(e[6]=[s("i",{class:"bi bi-check-lg me-1"},null,-1),s("span",{class:"d-none d-md-inline"},"Save",-1)])),s("button",{class:"btn btn-secondary",onClick:e[2]||(e[2]=a=>c.$emit("toggle-edit"))},e[7]||(e[7]=[s("i",{class:"bi bi-x-lg me-1"},null,-1),s("span",{class:"d-none d-md-inline"},"Cancel",-1)]))])):(n(),t("button",{key:0,class:"btn btn-primary",onClick:e[0]||(e[0]=a=>c.$emit("toggle-edit"))},e[5]||(e[5]=[s("i",{class:"bi bi-pencil-fill me-1"},null,-1),s("span",{class:"d-none d-md-inline"},"Edit Locations",-1)])))]),s("div",Ve,[i.loading?(n(),t("div",Ce,e[9]||(e[9]=[s("div",{class:"spinner-border text-primary",role:"status"},[s("span",{class:"visually-hidden"},"Loading...")],-1)]))):(n(),t("div",xe,[i.editMode?(n(),t("div",qe,[s("form",{onSubmit:e[4]||(e[4]=x((...a)=>o.saveLocations&&o.saveLocations(...a),["prevent"]))},[(n(!0),t(A,null,F(o.editableLocations,(a,_)=>(n(),t("div",{key:_,class:"location-item mb-3 p-3 border rounded"},[s("div",Te,[s("div",Re,[e[11]||(e[11]=s("label",{class:"form-label"},"Address",-1)),y(s("input",{type:"text",class:"form-control","onUpdate:modelValue":v=>a.company_address=v,required:""},null,8,je),[[L,a.company_address]])]),s("div",Be,[e[13]||(e[13]=s("label",{class:"form-label"},"Type",-1)),y(s("select",{class:"form-select","onUpdate:modelValue":v=>a.location_type=v,required:""},[e[12]||(e[12]=s("option",{value:"headquarters"},"Headquarters",-1)),o.companyType==="broiler"?(n(),t("option",Je,"Supplier")):b("",!0),o.companyType==="slaughterhouse"?(n(),t("option",ze,"Slaughterhouse")):b("",!0),o.companyType==="SME"?(n(),t("option",He,"Kitchen")):b("",!0)],8,Oe),[[G,a.location_type]])]),s("div",Ke,[s("button",{type:"button",class:"btn btn-danger btn-sm w-100",onClick:v=>o.removeLocation(_)},e[14]||(e[14]=[s("i",{class:"fas fa-trash"},null,-1)]),8,We)])])]))),128)),s("div",Ye,[s("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:e[3]||(e[3]=(...a)=>o.addNewLocation&&o.addNewLocation(...a))},e[15]||(e[15]=[s("i",{class:"fas fa-plus me-1"},null,-1),P(" Add Location ")]))]),s("div",Ge,[s("button",{type:"submit",class:"btn btn-success",disabled:o.saving},[e[16]||(e[16]=s("i",{class:"fas fa-save me-1"},null,-1)),e[17]||(e[17]=P(" Save Locations ")),o.saving?(n(),t("span",Xe)):b("",!0)],8,Qe)])],32)])):(n(),t("div",Ie,[i.locations.length===0?(n(),t("div",he,e[10]||(e[10]=[s("i",{class:"fas fa-map-marker-alt text-muted mb-2",style:{"font-size":"2rem"}},null,-1),s("p",{class:"text-muted"},"No locations added yet",-1)]))):(n(),t("div",Ue,[(n(!0),t(A,null,F(i.locations,(a,_)=>(n(),t("div",{key:a.locationID||_,class:"location-item mb-3 p-3 border rounded"},[s("div",Ne,[s("div",null,[s("div",Ae,q(a.company_address),1),s("div",Fe,q(a.location_type),1)])])]))),128))]))]))]))])])}const $e=h(Ee,[["render",Ze],["__scopeId","data-v-9c2deb67"]]),es={name:"ProfilePage",components:{ProfileInfo:Pe,CompanyLocations:$e},setup(){const c=X();Z();const e=j(),i=()=>{$.clearLocationsCache()},o=p(!0),l=p({}),w=p(!1),a=p(!1),_=p(!1),v=p(null),r=p(null),m=p(!0),k=p(!1),D=p({current_password:"",new_password:"",new_password_confirmation:""}),V=p(!1),U=M(()=>D.value.new_password!==D.value.new_password_confirmation),C=M(()=>l.value.role==="admin"),B=M(()=>{var d;return l.value.role==="admin"?{...l.value,company_name:(d=l.value.company)==null?void 0:d.company_name}:{...l.value}}),O=async()=>{try{o.value=!0;const d=await S.get("/api/profile");l.value=d,console.log("Fetched profile data:",d),m.value=!!d.email_verified_at,e.commit("SET_EMAIL_VERIFIED",!!d.email_verified_at),console.log("Email verification status:",{email_verified_at:d.email_verified_at,emailVerified:m.value}),o.value=!1}catch(d){console.error("Error fetching profile data:",d),o.value=!1,u.danger("Error","Failed to load profile data")}};I(()=>e.getters.emailVerified,d=>{m.value=d});const J=async()=>{try{k.value=!0;const d=await e.dispatch("sendVerificationEmail");u.success("Email Sent",d.message||"Verification link sent to your email address"),k.value=!1}catch(d){console.error("Error sending verification email:",d),k.value=!1,u.danger("Error","Failed to send verification email")}},z=d=>{const g=d.target.files[0];if(!g)return;if(!g.type.match("image.*")){u.danger("Invalid File","Please select an image file");return}if(g.size>2*1024*1024){u.danger("File Too Large","Image size should not exceed 2MB");return}C.value?r.value=g:v.value=g;const f=new FileReader;f.onload=E=>{C.value?l.value.company.company_image=E.target.result:l.value.image=E.target.result},f.readAsDataURL(g)},H=async()=>{var d,g;try{const f=new FormData;f.append("email",l.value.email),f.append("tel_number",l.value.tel_number||""),C.value?(f.append("company_name",((d=l.value.company)==null?void 0:d.company_name)||""),r.value&&f.append("company_image",r.value)):(f.append("fullname",l.value.fullname||""),v.value&&f.append("profile_image",v.value));const E=await S.post("/api/profile/update",f,{headers:{"Content-Type":"multipart/form-data"}});if(E.user){const N={...E.user,company:E.company||((g=user.value)==null?void 0:g.company)};l.value=N,e.commit("SET_USER",N)}v.value=null,r.value=null,w.value=!1,u.success("Success","Profile updated successfully")}catch(f){console.error("Error updating profile:",f),u.danger("Error","Failed to update profile")}},K=async()=>{var d;if(!U.value)try{V.value=!0,await S.post("/api/profile/password",D.value),D.value={current_password:"",new_password:"",new_password_confirmation:""},u.success("Success","Password updated successfully"),V.value=!1}catch(g){if(console.error("Error updating password:",g),((d=g.response)==null?void 0:d.status)===422){const f=g.response.data.message||"Invalid password data";u.danger("Validation Error",f)}else u.danger("Error","Failed to update password");V.value=!1}},W=async()=>{try{if(!l.value.email){u.warning("Warning","Email address is required");return}await S.post("/api/password/forgot",{email:l.value.email}),u.success("Email Sent","Password reset link has been sent to your email")}catch(d){console.error("Error sending password reset email:",d),u.danger("Error","Failed to send password reset email")}},Y=()=>{u.info("Language Settings","Language settings functionality will be implemented soon.")};return Q(()=>{O(),c.query.verifyEmail==="true"&&u.warning("Email Verification Required","Please verify your email to access all features")}),{loading:o,profileData:l,formattedProfileData:B,editProfileMode:w,editLocationsMode:a,locationsLoading:_,isAdmin:C,handleImageChange:z,saveProfile:H,emailVerified:m,sendVerificationEmail:J,sendingVerification:k,passwordData:D,passwordLoading:V,passwordMismatch:U,updatePassword:K,sendPasswordResetEmail:W,openLanguageSettings:Y,handleLocationUpdate:i}}},ss={class:"profile-page"},os={key:0,class:"alert alert-warning mb-4"},as={class:"d-flex align-items-center"},ts=["disabled"],ns={key:0},is={key:1},ls={class:"row"},ds={class:"col-lg-8"},rs={class:"mb-4"},ms={key:0,class:"mb-4"},cs={class:"col-lg-4"},us={class:"card mb-4"},fs={class:"card-body"},ps={class:"mb-4"},vs={class:"d-flex align-items-center"},gs={key:0,class:"text-success"},bs={key:1,class:"text-warning"},ys={class:"mb-3"},ws={class:"form-text"},_s={class:"mb-3"},ks={class:"mb-3"},Ls={key:0,class:"form-text text-danger"},Ps=["disabled"],Es={key:0,class:"spinner-border spinner-border-sm me-2",role:"status","aria-hidden":"true"},Ds={key:0,class:"mb-4"};function Ss(c,e,i,o,l,w){var v;const a=R("ProfileInfo"),_=R("CompanyLocations");return n(),t("div",ss,[e[23]||(e[23]=s("h1",{class:"mb-4"},"My Profile",-1)),o.emailVerified?b("",!0):(n(),t("div",os,[s("div",as,[e[12]||(e[12]=s("i",{class:"bi bi-exclamation-triangle-fill me-2"},null,-1)),e[13]||(e[13]=s("div",null,[s("strong",null,"Your email is not verified."),s("p",{class:"mb-0"},"Please verify your email to access all features of the application.")],-1)),s("button",{class:"btn btn-sm btn-primary ms-auto",onClick:e[0]||(e[0]=(...r)=>o.sendVerificationEmail&&o.sendVerificationEmail(...r)),disabled:o.sendingVerification},[o.sendingVerification?(n(),t("span",ns,e[11]||(e[11]=[s("span",{class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},null,-1),P(" Sending... ")]))):(n(),t("span",is,"Send Verification Email"))],8,ts)])])),s("div",ls,[s("div",ds,[s("div",rs,[T(a,{profileData:o.formattedProfileData,profileImage:o.isAdmin?(v=o.profileData.company)==null?void 0:v.company_image:o.profileData.image,editMode:o.editProfileMode,loading:o.loading,onToggleEdit:e[1]||(e[1]=r=>o.editProfileMode=!o.editProfileMode),onSave:o.saveProfile,onImageChange:o.handleImageChange},null,8,["profileData","profileImage","editMode","loading","onSave","onImageChange"])]),o.isAdmin?(n(),t("div",ms,[T(_,{locations:o.profileData.locations,"onUpdate:locations":e[2]||(e[2]=r=>o.profileData.locations=r),loading:o.locationsLoading,editMode:o.editLocationsMode,onLoading:e[3]||(e[3]=r=>o.locationsLoading=r),onToggleEdit:e[4]||(e[4]=r=>o.editLocationsMode=!o.editLocationsMode),onLocationUpdated:o.handleLocationUpdate},null,8,["locations","loading","editMode","onLocationUpdated"])])):b("",!0)]),s("div",cs,[s("div",us,[e[21]||(e[21]=s("div",{class:"card-header"},[s("h5",{class:"mb-0"},"Security")],-1)),s("div",fs,[s("div",ps,[e[16]||(e[16]=s("h6",null,"Email Verification",-1)),s("div",vs,[o.emailVerified?(n(),t("span",gs,e[14]||(e[14]=[s("i",{class:"bi bi-check-circle-fill me-2"},null,-1),P(" Verified ")]))):(n(),t("span",bs,e[15]||(e[15]=[s("i",{class:"bi bi-exclamation-circle-fill me-2"},null,-1),P(" Not Verified ")])))])]),s("form",{onSubmit:e[9]||(e[9]=x((...r)=>o.updatePassword&&o.updatePassword(...r),["prevent"]))},[s("div",ys,[e[17]||(e[17]=s("label",{for:"current-password",class:"form-label"},"Current Password",-1)),y(s("input",{type:"password",class:"form-control",id:"current-password","onUpdate:modelValue":e[5]||(e[5]=r=>o.passwordData.current_password=r),required:""},null,512),[[L,o.passwordData.current_password]]),s("div",ws,[s("a",{href:"#",onClick:e[6]||(e[6]=x((...r)=>o.sendPasswordResetEmail&&o.sendPasswordResetEmail(...r),["prevent"])),class:"text-primary"}," Forgot your password? ")])]),s("div",_s,[e[18]||(e[18]=s("label",{for:"new-password",class:"form-label"},"New Password",-1)),y(s("input",{type:"password",class:"form-control",id:"new-password","onUpdate:modelValue":e[7]||(e[7]=r=>o.passwordData.new_password=r),required:"",minlength:"8"},null,512),[[L,o.passwordData.new_password]])]),s("div",ks,[e[19]||(e[19]=s("label",{for:"confirm-password",class:"form-label"},"Confirm Password",-1)),y(s("input",{type:"password",class:"form-control",id:"confirm-password","onUpdate:modelValue":e[8]||(e[8]=r=>o.passwordData.new_password_confirmation=r),required:""},null,512),[[L,o.passwordData.new_password_confirmation]]),o.passwordMismatch?(n(),t("div",Ls," Passwords do not match ")):b("",!0)]),s("button",{type:"submit",class:"btn btn-primary w-100",disabled:o.passwordLoading||o.passwordMismatch},[o.passwordLoading?(n(),t("span",Es)):b("",!0),e[20]||(e[20]=P(" Update Password "))],8,Ps)],32)])]),o.isAdmin?(n(),t("div",Ds,[s("button",{class:"btn btn-outline-primary w-100",onClick:e[10]||(e[10]=(...r)=>o.openLanguageSettings&&o.openLanguageSettings(...r))},e[22]||(e[22]=[s("i",{class:"fas fa-language me-2"},null,-1),P(" Language Settings ")]))])):b("",!0)])])])}const xs=h(es,[["render",Ss],["__scopeId","data-v-6bf57b81"]]);export{xs as default};
