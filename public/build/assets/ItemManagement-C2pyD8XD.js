import{l as S,_ as J,r as i,B as X,E as ie,j as Z,k as $,G as me,c as d,a,t as m,d as R,w as h,y as M,F,i as T,v as K,b as Y,o as c,f as G,g as z,e as H,p as C,n as O,u as de,h as ce}from"./main-6HkEK7r2.js";import{m as L}from"./modal-BXblql9Y.js";import{f as U}from"./formatter-CdZpJCmm.js";import{S as ue}from"./StatsCard-Daj1M7Ql.js";import{R as ge}from"./ResponsiveTable-DO6c7ISj.js";import"./LoadingSpinner-TtFArfCL.js";const P={itemUpdateListeners:[],onItemUpdate(l){typeof l=="function"&&this.itemUpdateListeners.push(l)},notifyItemUpdate(l){this.itemUpdateListeners.forEach(e=>{try{e(l)}catch(r){console.error("Error in item update callback:",r)}})},async fetchItems(l={}){try{const e=await S.get("/api/items",{params:l});return e!=null&&e.data?{items:e.data,pagination:e.pagination||this.getDefaultPagination()}:{items:[],pagination:this.getDefaultPagination()}}catch(e){throw console.error("Error fetching items:",e),e}},async fetchItemStats(l={}){try{return await S.get("/api/items/stats",{params:l})||this.getDefaultItemStats()}catch(e){throw console.error("Error fetching item stats:",e),e}},async fetchPoultryTypes(){try{const l=await S.get("/api/poultries");return(l==null?void 0:l.data)||[]}catch(l){throw console.error("Error fetching poultry types:",l),l}},async fetchLocations(){try{const l=await S.get("/api/items/company/locations"),e=await S.get("/api/items/slaughterhouse/locations");return{companyLocations:(l==null?void 0:l.data)||[],slaughterhouseLocations:(e==null?void 0:e.data)||[]}}catch(l){return console.error("Error fetching locations:",l),L.danger("Error","Failed to load locations. Please try again."),{companyLocations:[],slaughterhouseLocations:[]}}},async saveItem(l,e=!1){var t,p;const r=new FormData;for(const[u,s]of Object.entries(l))u!=="item_image"&&s!==null&&r.append(u,s);l.item_image instanceof File&&r.append("item_image",l.item_image);try{const u=await(e?S.post(`/api/items/${l.itemID}`,r,{headers:{"Content-Type":"multipart/form-data"}}):S.post("/api/items",r,{headers:{"Content-Type":"multipart/form-data"}}));return this.notifyItemUpdate(u.data),L.toast(e?"Item updated successfully":"Item created successfully","success",{position:"top-right",delay:3e3}),u}catch(u){throw console.error("Error saving item:",u),L.toast(`Failed to ${e?"update":"create"} item: ${((p=(t=u.response)==null?void 0:t.data)==null?void 0:p.message)||u.message}`,"danger",{position:"top-right",delay:5e3}),u}},async deleteItem(l){var e,r;try{const t=await S.delete(`/api/items/${l}`);return this.notifyItemUpdate({deleted:l}),L.toast("Item deleted successfully","success",{position:"top-right",delay:3e3}),t}catch(t){throw console.error("Error deleting item:",t),L.toast(`Failed to delete item: ${((r=(e=t.response)==null?void 0:e.data)==null?void 0:r.message)||t.message}`,"danger",{position:"top-right",delay:5e3}),t}},formatCurrency:(l,e=!1)=>U.formatCurrency(l,"MYR","en-MY",e),formatDate:l=>U.formatDate(l,"medium"),formatLargeNumber:l=>U.formatLargeNumber(l),formatPrice:l=>Number(l).toFixed(2),getDefaultItemForm(){return{itemID:null,poultryID:"",locationID:"",slaughterhouse_locationID:"",measurement_type:"kg",measurement_value:"",price:"",stock:"",item_image:null}},getDefaultItemStats(){return{total_items:0,total_kg:0,total_units:0,total_value:0}},getDefaultPagination(){return{current_page:1,last_page:1,per_page:10,total:0,from:1,to:0}}},fe={name:"CustomModal",props:{modalId:{type:String,required:!0,default:"itemModal"},isEditing:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},poultryTypes:{type:Array,default:()=>[]},companyLocations:{type:Array,default:()=>[]},slaughterhouseLocations:{type:Array,default:()=>[]},initialData:{type:Object,default:()=>({})}},emits:["submit","image-change"],setup(l,{emit:e}){const r=i(null),t=i(null),p=i(null),u=X({itemID:null,poultryID:"",locationID:"",slaughterhouse_locationID:"",measurement_type:"kg",measurement_value:"",price:"",stock:"",item_image:null});ie(()=>l.initialData,f=>{Object.assign(u,f)},{deep:!0});const s=()=>{e("submit",u)},_=f=>{const v=f.target.files[0];if(!v)return;const V=new FileReader;V.onload=B=>{p.value=B.target.result},V.readAsDataURL(v),e("image-change",v)},D=Z(()=>l.isEditing?"Edit Item":"Add New Item"),n=()=>{t.value&&t.value.focus()},k=()=>{const f=document.getElementById(l.modalId),v=bootstrap.Modal.getInstance(f);v&&v.hide()};return $(()=>{const f=document.getElementById(l.modalId);f&&f.addEventListener("shown.bs.modal",n)}),me(()=>{const f=document.getElementById(l.modalId);f&&f.removeEventListener("shown.bs.modal",n)}),{closeButton:r,modalTitle:t,closeModal:k,imagePreview:p,formData:u,handleSubmit:s,handleImageChange:_,title:D}}},ye=["id","aria-labelledby"],pe={class:"modal-dialog",role:"document"},ve={class:"modal-content"},he={class:"modal-header"},be=["id"],Ie={class:"modal-body"},_e={class:"mb-3"},De=["value"],ke={class:"mb-3"},we=["value"],Se={class:"mb-3"},Ce=["value"],Le={class:"row mb-3"},Pe={class:"col"},Me={class:"col"},xe={class:"form-label"},Ee=["placeholder"],Fe={class:"form-text"},Te={class:"row mb-3"},Ue={class:"col"},Ve={class:"col"},Be={class:"mb-3"},Ae={key:0,class:"mt-2"},Ne=["src"],Re={class:"modal-footer"},je=["disabled"];function qe(l,e,r,t,p,u){return c(),d("div",{class:"modal fade",id:r.modalId,tabindex:"-1",role:"dialog","aria-labelledby":r.modalId+"Label","aria-modal":!0},[a("div",pe,[a("div",ve,[a("div",he,[a("h5",{class:"modal-title",id:r.modalId+"Label",ref:"modalTitle"},m(t.title),9,be),a("button",{type:"button",class:"btn-close",onClick:e[0]||(e[0]=(...s)=>t.closeModal&&t.closeModal(...s)),"aria-label":"Close",ref:"closeButton"},null,512)]),a("div",Ie,[a("form",{onSubmit:e[9]||(e[9]=R((...s)=>t.handleSubmit&&t.handleSubmit(...s),["prevent"]))},[a("div",_e,[e[12]||(e[12]=a("label",{class:"form-label"},"Poultry Type",-1)),h(a("select",{class:"form-select","onUpdate:modelValue":e[1]||(e[1]=s=>t.formData.poultryID=s),required:""},[e[11]||(e[11]=a("option",{value:""},"Select Poultry",-1)),(c(!0),d(F,null,T(r.poultryTypes,s=>(c(),d("option",{key:s.poultryID,value:s.poultryID},m(s.poultry_name),9,De))),128))],512),[[M,t.formData.poultryID]])]),a("div",ke,[e[14]||(e[14]=a("label",{class:"form-label"},"Storage Location",-1)),h(a("select",{class:"form-select","onUpdate:modelValue":e[2]||(e[2]=s=>t.formData.locationID=s),required:""},[e[13]||(e[13]=a("option",{value:""},"Select Storage Location",-1)),(c(!0),d(F,null,T(r.companyLocations,s=>(c(),d("option",{key:s.locationID,value:s.locationID},m(s.company_address),9,we))),128))],512),[[M,t.formData.locationID]]),e[15]||(e[15]=a("div",{class:"form-text"},"Select where the item will be stored",-1))]),a("div",Se,[e[17]||(e[17]=a("label",{class:"form-label"},"Slaughterhouse Location",-1)),h(a("select",{class:"form-select","onUpdate:modelValue":e[3]||(e[3]=s=>t.formData.slaughterhouse_locationID=s)},[e[16]||(e[16]=a("option",{value:""},"Select Slaughterhouse",-1)),(c(!0),d(F,null,T(r.slaughterhouseLocations,s=>(c(),d("option",{key:s.locationID,value:s.locationID},m(s.company_address),9,Ce))),128))],512),[[M,t.formData.slaughterhouse_locationID]]),e[18]||(e[18]=a("div",{class:"form-text"},"Select where the item will be slaughtered",-1))]),a("div",Le,[a("div",Pe,[e[20]||(e[20]=a("label",{class:"form-label"},"Measurement Type",-1)),h(a("select",{class:"form-select","onUpdate:modelValue":e[4]||(e[4]=s=>t.formData.measurement_type=s),required:""},e[19]||(e[19]=[a("option",{value:"kg"},"Kilogram (KG)",-1),a("option",{value:"unit"},"Unit",-1)]),512),[[M,t.formData.measurement_type]])]),a("div",Me,[a("label",xe,m(t.formData.measurement_type==="kg"?"Weight per Item (KG)":"Size per Item"),1),h(a("input",{type:"number",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=s=>t.formData.measurement_value=s),required:"",min:"0",step:"0.01",placeholder:t.formData.measurement_type==="kg"?"Enter weight in KG":"Enter size"},null,8,Ee),[[K,t.formData.measurement_value]]),a("div",Fe,m(t.formData.measurement_type==="kg"?"Weight of each item in kilograms":"Size/volume of each item"),1)])]),a("div",Te,[a("div",Ue,[e[21]||(e[21]=a("label",{class:"form-label"},"Price per Item (RM)",-1)),h(a("input",{type:"number",class:"form-control","onUpdate:modelValue":e[6]||(e[6]=s=>t.formData.price=s),required:"",min:"0",step:"0.01",placeholder:"Enter price"},null,512),[[K,t.formData.price]])]),a("div",Ve,[e[22]||(e[22]=a("label",{class:"form-label"},"Quantity in Stock",-1)),h(a("input",{type:"number",class:"form-control","onUpdate:modelValue":e[7]||(e[7]=s=>t.formData.stock=s),required:"",min:"0",placeholder:"Enter quantity"},null,512),[[K,t.formData.stock]]),e[23]||(e[23]=a("div",{class:"form-text"},"Number of items available",-1))])]),a("div",Be,[e[24]||(e[24]=a("label",{class:"form-label"},"Item Image",-1)),a("input",{type:"file",class:"form-control",onChange:e[8]||(e[8]=(...s)=>t.handleImageChange&&t.handleImageChange(...s)),accept:"image/*"},null,32),t.imagePreview?(c(),d("div",Ae,[a("img",{src:t.imagePreview,class:"img-thumbnail",style:{"max-height":"200px"}},null,8,Ne)])):Y("",!0)])],32)]),a("div",Re,[e[25]||(e[25]=a("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),a("button",{type:"button",class:"btn btn-primary",onClick:e[10]||(e[10]=(...s)=>t.handleSubmit&&t.handleSubmit(...s)),disabled:r.loading},m(r.loading?"Saving...":r.isEditing?"Update":"Save"),9,je)])])])],8,ye)}const Ke=J(fe,[["render",qe]]),Ge={name:"ItemManagement",components:{StatsCard:ue,ResponsiveTable:ge,CustomModal:Ke},setup(){de(),ce();const l=i(!0),e=i(null),r=i(!1),t=i([]),p=i([]),u=i([]),s=i(null),_=i(!1),D=i(null),n=i(""),k=i(""),f=i(""),v=i(""),V=i([]),B=i([]),y=X({itemID:null,poultryID:"",locationID:"",slaughterhouse_locationID:"",measurement_type:"kg",measurement_value:"",price:"",stock:"",item_image:null}),ee=i(null),A=i("created_at"),W=i("desc"),x=i(1),te=i(10),N=i({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),ae=Z(()=>{const o=[],b=N.value.last_page;if(b<=5)for(let I=1;I<=b;I++)o.push(I);else{let I=Math.max(1,x.value-Math.floor(2.5)),j=Math.min(b,I+5-1);j===b&&(I=Math.max(1,j-5+1));for(let q=I;q<=j;q++)o.push(q)}return o}),Q=i({total_items:0,total_kg:0,total_units:0,total_value:0}),w=async()=>{try{l.value=!0,e.value=null;const o={page:x.value,per_page:te.value,search:k.value||null,poultryID:f.value||null,locationID:v.value||null,measurement_type:n.value||null,sort_field:A.value,sort_direction:W.value},{items:g,pagination:b}=await P.fetchItems(o);t.value=g,N.value=b||P.getDefaultPagination()}catch(o){e.value=o.message||"Failed to load items. Please try again later.",t.value=[]}finally{l.value=!1}},E=async()=>{try{const o={search:k.value||null,poultryID:f.value||null,locationID:v.value||null,measurement_type:n.value||null},g=await P.fetchItemStats(o);Q.value=g}catch(o){console.error("Error fetching item stats:",o)}},oe=async()=>{try{const{companyLocations:o,slaughterhouseLocations:g}=await P.fetchLocations();B.value=o,V.value=g}catch{L.toast("Failed to fetch locations","danger")}},le=async()=>{try{const o=await P.fetchPoultryTypes();p.value=o}catch(o){console.error("Error fetching poultry types:",o),L.toast("Failed to fetch poultry types","danger")}},ne=async()=>{try{r.value=!0,t.value=[],l.value=!0,await P.saveItem(y,_.value);const o=bootstrap.Modal.getInstance(document.getElementById("itemModal"));o&&o.hide(),setTimeout(()=>{w(),E()},300)}finally{r.value=!1,l.value=!1}},se=async o=>{L.confirm("Delete Item","Are you sure you want to delete this item? This action cannot be undone.",async()=>{try{l.value=!0,await P.deleteItem(o),await w(),await E()}finally{l.value=!1}},null,{type:"warning",confirmLabel:"Delete",confirmType:"danger",cancelLabel:"Cancel"})},re=()=>{x.value=1,w(),E()};return $(()=>{w(),E(),le(),oe()}),{slaughterhouseLocations:V,loading:l,error:e,items:t,poultryTypes:p,locations:u,itemStats:Q,columns:[{key:"poultry",label:"Poultry",sortable:!1},{key:"measurement",label:"Weight",sortable:!0,sortKey:"measurement_value"},{key:"price",label:"Price",sortable:!0},{key:"stock",label:"Stock",sortable:!0}],poultryFilter:f,locationFilter:v,measurementTypeFilter:n,currentPage:x,pagination:N,paginationRange:ae,isEditing:_,formLoading:r,imagePreview:D,selectedItem:s,itemForm:y,fetchItems:w,fetchItemStats:E,applyFilters:re,handleSearch:o=>{k.value=o,x.value=1,w(),E()},handleSort:({field:o,direction:g})=>{o==="measurement"?A.value="measurement_value":o==="price"?A.value=o:A.value="price",W.value=g,w()},changePage:o=>{o<1||o>N.value.last_page||l.value||(x.value=o,w())},formatCurrency:(o,g=!1)=>U.formatCurrency(o,"MYR","en-MY",g),formatDate:o=>U.formatDate(o,"medium"),formatLargeNumber:o=>U.formatLargeNumber(o),editItem:o=>{_.value=!0,s.value=o,y.itemID=o.itemID,y.poultryID=o.poultryID,y.locationID=o.locationID,y.measurement_type=o.measurement_type,y.measurement_value=o.measurement_value,y.price=o.price,y.stock=o.stock,y.item_image=o.item_image,D.value=null;try{new bootstrap.Modal(document.getElementById("itemModal")).show()}catch(g){console.error("Error showing modal:",g)}},confirmDelete:se,openAddModal:()=>{Object.assign(y,{itemID:null,poultryID:"",locationID:"",measurement_type:"kg",measurement_value:"",price:"",stock:"",item_image:null}),D.value=null,_.value=!1;try{new bootstrap.Modal(document.getElementById("itemModal")).show()}catch(o){console.error("Error showing modal:",o)}},closeButton:ee,handleImageChange:o=>{const g=o.target.files[0];if(!g)return;const b=new FileReader;b.onload=I=>{D.value=I.target.result},b.readAsDataURL(g)},saveItem:ne,formatPrice:o=>Number(o).toFixed(2),companyLocations:B}}},ze={class:"item-management"},Oe={class:"row mb-4"},Ye={class:"col-md-4 col-sm-6 mb-3"},We={class:"card"},Qe={class:"card-header d-flex justify-content-between align-items-center"},He={class:"card-body"},Je={key:0,class:"alert alert-danger",role:"alert"},Xe={class:"d-flex gap-2"},Ze=["value"],$e=["value"],et={key:0,class:"text-muted"},tt={class:"d-flex align-items-center"},at=["src"],ot={key:1,class:"bg-light d-flex align-items-center justify-content-center me-2",style:{width:"40px",height:"40px"}},lt={class:"btn-group"},nt=["onClick"],st=["onClick"],rt={class:"d-flex justify-content-between align-items-center mt-4"},it={class:"text-muted"},mt={"aria-label":"Item pagination"},dt={class:"pagination mb-0"},ct=["onClick"];function ut(l,e,r,t,p,u){const s=z("StatsCard"),_=z("ResponsiveTable"),D=z("CustomModal");return c(),d("div",ze,[e[20]||(e[20]=a("h1",{class:"mb-4"},"Item Management",-1)),a("div",Oe,[a("div",Ye,[G(s,{title:"Total Items",count:t.formatLargeNumber(t.itemStats.total_items),icon:"fas fa-boxes","bg-color":"bg-primary"},null,8,["count"])])]),a("div",We,[a("div",Qe,[e[10]||(e[10]=a("h5",{class:"mb-0"},"Items",-1)),a("button",{class:"btn btn-primary",onClick:e[0]||(e[0]=(...n)=>t.openAddModal&&t.openAddModal(...n))},e[9]||(e[9]=[a("i",{class:"fas fa-plus me-1"},null,-1),H(" Add Item ")]))]),a("div",He,[t.error?(c(),d("div",Je,m(t.error),1)):Y("",!0),G(_,{columns:t.columns,items:t.items,loading:t.loading,"has-actions":!0,"item-key":"itemID",onSearch:t.handleSearch,"show-pagination":!1,"server-side":!0,onSort:t.handleSort},{filters:C(()=>[a("div",Xe,[h(a("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[1]||(e[1]=n=>t.poultryFilter=n),onChange:e[2]||(e[2]=(...n)=>t.applyFilters&&t.applyFilters(...n))},[e[11]||(e[11]=a("option",{value:""},"All Poultries",-1)),(c(!0),d(F,null,T(t.poultryTypes,n=>(c(),d("option",{key:n.poultryID,value:n.poultryID},m(n.poultry_name),9,Ze))),128))],544),[[M,t.poultryFilter]]),h(a("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[3]||(e[3]=n=>t.locationFilter=n),onChange:e[4]||(e[4]=(...n)=>t.applyFilters&&t.applyFilters(...n))},[e[12]||(e[12]=a("option",{value:""},"All Company Locations",-1)),(c(!0),d(F,null,T(t.companyLocations,n=>(c(),d("option",{key:n.locationID,value:n.locationID},m(n.company_address),9,$e))),128))],544),[[M,t.locationFilter]]),h(a("select",{class:"form-select form-select-sm","onUpdate:modelValue":e[5]||(e[5]=n=>t.measurementTypeFilter=n),onChange:e[6]||(e[6]=(...n)=>t.applyFilters&&t.applyFilters(...n))},e[13]||(e[13]=[a("option",{value:""},"All Types",-1),a("option",{value:"kg"},"KG",-1),a("option",{value:"unit"},"Unit",-1)]),544),[[M,t.measurementTypeFilter]])])]),location:C(({item:n})=>[a("div",null,[a("div",null,m(n.location?n.location.company_address:"-"),1),n.slaughterhouse?(c(),d("small",et," Slaughterhouse: "+m(n.slaughterhouse.company_address),1)):Y("",!0)])]),poultry:C(({item:n})=>[a("div",tt,[n.poultry_image?(c(),d("img",{key:0,src:n.poultry_image,alt:"Poultry Image",class:"img-thumbnail me-2",style:{width:"40px",height:"40px","object-fit":"cover"}},null,8,at)):(c(),d("div",ot,e[14]||(e[14]=[a("i",{class:"fas fa-feather text-muted"},null,-1)]))),a("span",null,m(n.poultry_name),1)])]),measurement:C(({item:n})=>[a("span",null,m(n.measurement_value)+" "+m(n.measurement_type==="kg"?"KG":"Units"),1)]),price:C(({item:n})=>[a("span",null,m(t.formatCurrency(n.price)),1)]),stock:C(({item:n})=>[a("span",null,m(n.stock),1)]),actions:C(({item:n})=>[a("div",lt,[a("button",{class:"btn btn-sm btn-outline-primary",onClick:k=>t.editItem(n)},e[15]||(e[15]=[a("i",{class:"fas fa-edit"},null,-1)]),8,nt),a("button",{class:"btn btn-sm btn-outline-danger",onClick:k=>t.confirmDelete(n.itemID)},e[16]||(e[16]=[a("i",{class:"fas fa-trash"},null,-1)]),8,st)])]),default:C(()=>[e[17]||(e[17]=H(" // Make sure you have the actions template in your ResponsiveTable "))]),_:1},8,["columns","items","loading","onSearch","onSort"]),a("div",rt,[a("div",null,[a("span",it,"Showing "+m(t.pagination.from||1)+"-"+m(t.pagination.to||t.items.length)+" of "+m(t.pagination.total||t.items.length),1)]),a("nav",mt,[a("ul",dt,[a("li",{class:O(["page-item",{disabled:t.currentPage<=1||t.loading}])},[a("a",{class:"page-link",href:"#",onClick:e[7]||(e[7]=R(n=>!t.loading&&t.changePage(t.currentPage-1),["prevent"]))},e[18]||(e[18]=[a("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(c(!0),d(F,null,T(t.paginationRange,n=>(c(),d("li",{key:n,class:O(["page-item",{active:n===t.currentPage,disabled:t.loading}])},[a("a",{class:"page-link",href:"#",onClick:R(k=>!t.loading&&t.changePage(n),["prevent"])},m(n),9,ct)],2))),128)),a("li",{class:O(["page-item",{disabled:t.currentPage>=t.pagination.last_page||t.loading}])},[a("a",{class:"page-link",href:"#",onClick:e[8]||(e[8]=R(n=>!t.loading&&t.changePage(t.currentPage+1),["prevent"]))},e[19]||(e[19]=[a("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])])]),G(D,{"modal-id":"itemModal","is-editing":t.isEditing,loading:t.formLoading,"poultry-types":t.poultryTypes,"company-locations":t.companyLocations,"slaughterhouse-locations":t.slaughterhouseLocations,"initial-data":t.itemForm,onSubmit:t.saveItem,onImageChange:t.handleImageChange},null,8,["is-editing","loading","poultry-types","company-locations","slaughterhouse-locations","initial-data","onSubmit","onImageChange"])])}const Lt=J(Ge,[["render",ut],["__scopeId","data-v-3b1e5c3d"]]);export{Lt as default};
