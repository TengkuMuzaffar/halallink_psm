import{a as ee,b as V,c as z}from"./modal-CNQBRbiU.js";import{P as x,_ as R,c as o,a as t,f as T,g as E,o as r,e as _,t as u,F as I,i as P,C as k,b as g,B as U,r as O,m as Y,O as B,Q as te,K as W,u as se,R as ie,w as N,S as ae,J as H,v as K,E as J,A as X,d as Z}from"./main-6TRAM3lj.js";import{S as ne}from"./StatsCard-CQZ5Yey2.js";import{P as le}from"./Pagination-BlCQa_G8.js";import{L as G}from"./LoadingSpinner-Bs7tkB0U.js";import{R as re}from"./ResponsiveTable-Dmb47gmH.js";const L={async getTrips(s={}){return x("/api/deliveries/trips",{params:s})},async getCreatedDeliveries(s=1,e=3){return x("/api/deliveries/created",{params:{page:s,per_page:e}})},async getDeliveryStats(){return x("/api/deliveries/stats")},async getLocations(){return x("/api/locations")},async getDrivers(s){return x("/api/users/get/drivers",{params:{scheduled_date:s}})},async getVehicles(s){return x("api/deliveries/get/vehicles",{params:{scheduled_date:s}})},async assignSingleTrip(s){return x("/api/deliveries/assign-trip",{method:"POST",data:s})},async updateDeliveryStatus(s,e){return x(`/api/deliveries/${s}/start`,{method:"put",data:e})},async getDeliveryDetails(s){return x(`/api/deliveries/${s}`)},async createDelivery(s){return x("/api/deliveries/create",{method:"post",data:s})},async getOrderForAssignment(s={}){const{locationID:e,orderID:i}=s;if(!e||!i)return{success:!1,message:"Location ID and Order ID are required"};try{const a=await this.getTrips({locationID:e});if(!a.success||!a.data)return{success:!1,message:"Failed to fetch order data"};const l=a.data.find(d=>d.locationID==e);if(!l||!l.orders)return{success:!1,message:"Location or orders not found"};const n=l.orders[i];return n?{success:!0,data:{locationID:e,locationAddress:l.company_address,orderID:i,orderData:n}}:{success:!1,message:"Order not found"}}catch(a){return console.error("Error fetching order for assignment:",a),{success:!1,message:"An error occurred while fetching order data"}}},async assignDelivery(s){return x("/api/deliveries/assign",{method:"POST",data:s})},async createDelivery(s){return x("/api/deliveries",{method:"POST",data:s})},async getDeliveryDetails(s){return x(`/api/deliveries/${s}`)},async createDelivery(s){return x("/api/deliveries/create",{method:"post",data:s})},async getExecutionDeliveries(s={}){return x("/api/deliveries/get/execution",{params:{statusFilter:s.status||"",dateFilter:s.date||"",searchTerm:s.searchTerm||""}})},async startDelivery(s){return x(`/api/deliveries/${s}/start`,{method:"post",data:{start_timestamp:new Date().toISOString()}})}},oe={name:"DeliveryStatsCard",components:{StatsCard:ne},props:{stats:{type:Object,required:!0,default:()=>({pending:0,inProgress:0,completedToday:0,issues:0})}}},de={class:"row mb-4"},ce={class:"col-md-3 col-sm-6 mb-3"},ue={class:"col-md-3 col-sm-6 mb-3"},ve={class:"col-md-3 col-sm-6 mb-3"},me={class:"col-md-3 col-sm-6 mb-3"};function he(s,e,i,a,l,n){const d=E("StatsCard",!0);return r(),o("div",de,[t("div",ce,[T(d,{title:"Pending Assignment",count:i.stats.pending,icon:"fas fa-clock",bgColor:"bg-warning"},null,8,["count"])]),t("div",ue,[T(d,{title:"In Progress",count:i.stats.inProgress,icon:"fas fa-truck",bgColor:"bg-info"},null,8,["count"])]),t("div",ve,[T(d,{title:"Completed Today",count:i.stats.completedToday,icon:"fas fa-check-circle",bgColor:"bg-success"},null,8,["count"])]),t("div",me,[T(d,{title:"Issues",count:i.stats.issues,icon:"fas fa-exclamation-triangle",bgColor:"bg-danger"},null,8,["count"])])])}const ge=R(oe,[["render",he]]),fe={name:"ItemModal",props:{modalId:{type:String,required:!0},items:{type:Array,required:!0}},computed:{totalValue(){return this.items.reduce((s,e)=>{const i=parseFloat(e.price)||0;return s+i},0)}}},ye=["id"],pe={class:"modal-dialog modal-dialog-centered"},be={class:"modal-content"},_e={class:"modal-body p-3"},De={class:"delivery-summary mb-4"},Ie={class:"total-items"},ke={class:"value"},xe={class:"total-value"},Se={class:"value"},we={class:"items-grid"},Ce={class:"card h-100"},Ee={class:"card-header item-header"},Pe={class:"item-id"},Me={class:"card-body"},Te={class:"card-title d-flex align-items-center"},$e={class:"item-details"},Le={class:"detail-row"},Fe={class:"detail-value"},Oe={class:"detail-row"},Re={class:"detail-value price"};function Ae(s,e,i,a,l,n){return r(),o("div",{class:"modal fade",id:i.modalId,tabindex:"-1","aria-labelledby":"itemModalLabel","aria-hidden":"true"},[t("div",pe,[t("div",be,[e[7]||(e[7]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"itemModalLabel"},[t("i",{class:"fas fa-box me-2"}),_("Delivery Items ")]),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",_e,[t("div",De,[t("div",Ie,[e[0]||(e[0]=t("span",{class:"label"},"Total Items:",-1)),t("span",ke,u(i.items.length),1)]),t("div",xe,[e[1]||(e[1]=t("span",{class:"label"},"Total Value:",-1)),t("span",Se,"RM "+u(typeof n.totalValue=="number"?n.totalValue.toFixed(2):"0.00"),1)])]),t("div",we,[(r(!0),o(I,null,P(i.items,d=>(r(),o("div",{key:d.itemID,class:"item-card"},[t("div",Ce,[t("div",Ee,[t("span",Pe,"#"+u(d.itemID),1)]),t("div",Me,[t("h6",Te,[e[2]||(e[2]=t("i",{class:"fas fa-cube me-2"},null,-1)),_(u(d.name),1)]),t("div",$e,[t("div",Le,[e[3]||(e[3]=t("i",{class:"fas fa-weight-hanging text-muted me-2"},null,-1)),e[4]||(e[4]=t("span",{class:"detail-label"},"Quantity:",-1)),t("span",Fe,u(d.measurement_value)+" "+u(d.measurement_type),1)]),t("div",Oe,[e[5]||(e[5]=t("i",{class:"fas fa-tag text-muted me-2"},null,-1)),e[6]||(e[6]=t("span",{class:"detail-label"},"Price:",-1)),t("span",Re,"RM "+u(typeof d.price=="number"?d.price.toFixed(2):parseFloat(d.price).toFixed(2)||"0.00"),1)])])])])]))),128))])])])])],8,ye)}const je=R(fe,[["render",Ae],["__scopeId","data-v-4babb5ea"]]),qe={name:"DeliveryAssignment",components:{Pagination:le,ItemModal:je,LoadingSpinner:G},props:{loading:Boolean,error:String,trips:{type:Array,default:()=>[]},pagination:Object,selectedDeliveryID:[Number,String],activePhase:{type:Number,required:!0}},data(){return{}},emits:["refresh","assign-trip","change-phase","change-page"],methods:{changePhase(s){this.$emit("change-phase",s)}}},Ne={class:"delivery-assignment"},Qe={class:"card"},Ve={class:"card-header d-flex justify-content-between align-items-center theme-header"},Be={class:"d-flex"},Ue={class:"phase-tabs"},ze={class:"nav nav-tabs",role:"tablist"},We={class:"card-body p-0"},He={key:0,class:"p-4"},Ke={class:"alert alert-danger mb-0"},Ge={key:1},Je={class:"table-responsive"},Xe={class:"table table-hover theme-table"},Ye={key:0,class:"table-loading-row"},Ze={colspan:"5",class:"text-center py-4"},et={key:1,class:"table-empty-row"},tt={class:"text-nowrap"},st={class:"text-nowrap"},it={class:"location-cell"},at={class:"location-type"},nt={class:"location-address"},lt={class:"location-cell"},rt={class:"location-type"},ot={class:"location-address"},dt={class:"d-flex gap-2 flex-wrap justify-content-start"},ct=["data-bs-target"],ut=["onClick","disabled"],vt={key:0,class:"d-flex justify-content-center p-3"};function mt(s,e,i,a,l,n){const d=E("LoadingSpinner"),c=E("ItemModal"),S=E("Pagination");return r(),o("div",Ne,[t("div",Qe,[t("div",Ve,[e[5]||(e[5]=t("h5",{class:"mb-0"},"Assign Deliveries",-1)),t("div",Be,[t("button",{class:"btn btn-sm btn-outline-primary theme-btn-outline",onClick:e[0]||(e[0]=v=>s.$emit("refresh"))},e[4]||(e[4]=[t("i",{class:"fas fa-sync-alt"},null,-1)]))])]),t("div",Ue,[t("div",ze,[t("button",{class:k(["nav-link",{active:i.activePhase===1}]),onClick:e[1]||(e[1]=v=>n.changePhase(1)),id:"phase1-tab",type:"button",role:"tab","aria-controls":"phase1","aria-selected":"activePhase === 1"},e[6]||(e[6]=[t("i",{class:"fas fa-truck-loading me-2"},null,-1),_("Phase 1 (Supplier to Slaughterhouse) ")]),2),t("button",{class:k(["nav-link",{active:i.activePhase===2}]),onClick:e[2]||(e[2]=v=>n.changePhase(2)),id:"phase2-tab",type:"button",role:"tab","aria-controls":"phase2","aria-selected":"activePhase === 2"},e[7]||(e[7]=[t("i",{class:"fas fa-truck me-2"},null,-1),_("Phase 2 (Slaughterhouse to Customer) ")]),2)])]),t("div",We,[i.error?(r(),o("div",He,[t("div",Ke,u(i.error),1)])):(r(),o("div",Ge,[t("div",Je,[t("table",Xe,[e[11]||(e[11]=t("thead",{class:"theme-table-header"},[t("tr",null,[t("th",{style:{width:"5vw"}},"Trip ID"),t("th",{style:{width:"5vw"}},"Order ID"),t("th",null,"Start Location"),t("th",null,"End Location"),t("th",null,"Action")])],-1)),t("tbody",null,[i.loading?(r(),o("tr",Ye,[t("td",Ze,[T(d,{size:"md",message:"Loading delivery data..."})])])):!i.trips||i.trips.length===0?(r(),o("tr",et,e[8]||(e[8]=[t("td",{colspan:"5",class:"text-center py-4"},[t("div",{class:"empty-state"},[t("i",{class:"fas fa-info-circle me-2 text-muted"}),_(" No trips found for the selected criteria. ")])],-1)]))):(r(!0),o(I,{key:2},P(i.trips,v=>(r(),o("tr",{key:v.tripID},[t("td",tt,u(v.tripID),1),t("td",st,u(v.orderID),1),t("td",it,[t("div",at,u(v.start_location.type),1),t("div",nt,u(v.start_location.address),1)]),t("td",lt,[t("div",rt,u(v.end_location.type),1),t("div",ot,u(v.end_location.address),1)]),t("td",null,[t("div",dt,[t("button",{class:"btn btn-sm btn-outline-secondary","data-bs-toggle":"modal","data-bs-target":`#itemModal-${v.tripID}`},e[9]||(e[9]=[t("i",{class:"fas fa-box me-1"},null,-1),t("span",{class:"ms-1 d-none d-sm-inline"},"Items",-1)]),8,ct),t("button",{class:"btn btn-sm btn-primary",onClick:M=>s.$emit("assign-trip",v),disabled:!i.selectedDeliveryID},e[10]||(e[10]=[t("i",{class:"fas fa-plus-circle me-1"},null,-1),t("span",{class:"ms-1 d-none d-sm-inline"},"Assign",-1)]),8,ut)])])]))),128))])])]),(r(!0),o(I,null,P(i.trips,v=>(r(),U(c,{key:`modal-${v.tripID}`,"modal-id":`itemModal-${v.tripID}`,items:v.items},null,8,["modal-id","items"]))),128)),i.pagination&&i.pagination.last_page>1?(r(),o("div",vt,[T(S,{pagination:i.pagination,onPageChanged:e[3]||(e[3]=v=>s.$emit("change-page",v))},null,8,["pagination"])])):g("",!0)]))])])])}const ht=R(qe,[["render",mt],["__scopeId","data-v-7e034934"]]),gt={name:"QRScannerModal",props:{deliveryID:{type:[Number,String],required:!0},locationID:{type:[Number,String],required:!0},checkpoints:{type:Array,required:!0}},emits:["scanner-closed"],setup(s,{emit:e}){se();const i=O(!0),a=O(null),l=O(null),n=O(null),d=O("");let c=null,S=null;function v(f){document.readyState==="complete"||document.readyState==="interactive"?setTimeout(f,1):document.addEventListener("DOMContentLoaded",f)}function M(f,m){if(S!==f){S=f,l.value=f;try{let D=f;D.startsWith("http")||(D=window.location.origin+(D.startsWith("/")?D:"/"+D));const h=new URL(D),w=window.location.hostname;if(h.hostname!==w){a.value="Security Error: QR code URL is from a different domain. Only URLs from the current domain are allowed.",l.value=null;return}let y=s.locationID,p=null;try{const $=h.pathname.split("/").filter(A=>A).filter(A=>!isNaN(A));$.length>=2&&(y=parseInt($[0]),p=parseInt($[1]))}catch(b){console.warn("Could not extract IDs from URL, using props value:",b)}const C={deliveryID:s.deliveryID,locationID:s.locationID,checkpoints:s.checkpoints,companyID:p};l.value="QR code detected! Processing...",ie(D,C,{onSuccess:b=>{b.status==="success"?setTimeout(()=>{q(),b.redirect&&b.redirectUrl?window.location.href=b.redirectUrl:l.value=b.message||"Processing complete."},1e3):(a.value=b.message||"Error processing QR code",l.value=null)},onError:b=>{console.error("API Error Details:",b),b.response&&b.response.data?(a.value=`Error processing QR code: ${b.response.data.message||b.message}`,console.error("Server error details:",b.response.data)):a.value=`Error processing QR code: ${b.message||"Unknown error"}`,l.value=null}})}catch(D){a.value=`Error processing QR code: ${D.message||"Unknown error"}`,l.value=null}}}function F(f,m){const w=f>m?m:f,y=Math.floor(w*.75);return y<250?w<250?{width:w,height:w}:{width:250,height:250}:{width:y,height:y}}Y(()=>{n.value=new B(document.getElementById("qrScannerModal")),d.value=window.location.origin;const f=document.createElement("script");f.src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js",f.async=!0,f.onload=()=>{i.value=!1,v(()=>{try{c=new Html5QrcodeScanner("reader",{fps:10,qrbox:F,experimentalFeatures:{useBarCodeDetectorIfSupported:!0},rememberLastUsedCamera:!0,showTorchButtonIfSupported:!0,formatsToSupport:[Html5QrcodeSupportedFormats.QR_CODE],hideSelectScanType:!0,showVideoSourcesSelect:!1}),c.render(M),setTimeout(()=>{const m=document.querySelector("#reader select");m&&(m.style.display="none");const D=document.querySelector("#reader__scan_type_change_button");D&&(D.style.display="none");const h=document.querySelector("#reader__dashboard_section_swaplink");h&&(h.className="btn btn-sm btn-danger mt-2",h.innerHTML='<i class="fas fa-stop me-1"></i>Stop Scanning')},500)}catch(m){console.error("Error initializing QR scanner:",m),a.value=`Failed to initialize scanner: ${m.message||"Unknown error"}`}})},f.onerror=()=>{a.value="Failed to load QR scanner library. Please try again.",i.value=!1},document.head.appendChild(f)}),te(()=>{if(c)try{c.clear()}catch(f){console.error("Error clearing QR scanner:",f)}});const Q=()=>{n.value&&n.value.show()};function q(){n.value&&(n.value.hide(),e("scanner-closed"))}function j(){const f=new URL(window.location.href);f.searchParams.delete("selectedID"),f.searchParams.set("selectionID",s.deliveryID),window.location.href=f.toString()}return{loading:i,error:a,scanResult:l,httpOrigin:d,showModal:Q,closeModal:q,refreshWithDeliveryID:j}}},ft={class:"modal fade",id:"qrScannerModal",tabindex:"-1","aria-labelledby":"qrScannerModalLabel","aria-hidden":"true"},yt={class:"modal-dialog modal-dialog-centered"},pt={class:"modal-content theme-modal"},bt={class:"modal-body theme-body p-0"},_t={key:0,class:"text-center p-5"},Dt={key:1},It={key:0,class:"alert alert-danger m-3"},kt={key:1,class:"alert alert-success m-3"},xt={key:2,class:"alert alert-info m-3"},St={class:"mb-1"},wt={class:"code-block mt-1"},Ct={class:"modal-footer theme-footer"};function Et(s,e,i,a,l,n){return r(),o("div",ft,[t("div",yt,[t("div",pt,[e[14]||(e[14]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"qrScannerModalLabel"},[t("i",{class:"fas fa-qrcode me-2"}),_("Scan QR Code ")]),t("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",bt,[a.loading?(r(),o("div",_t,e[2]||(e[2]=[t("div",{class:"spinner-border theme-spinner",role:"status"},[t("span",{class:"visually-hidden"},"Loading...")],-1),t("p",{class:"mt-3 theme-text fw-bold"},"Initializing camera...",-1)]))):(r(),o("div",Dt,[e[12]||(e[12]=W('<div class="scanner-header text-center p-3" data-v-acad2285><p class="mb-0" data-v-acad2285><i class="fas fa-crosshairs me-2" data-v-acad2285></i>Position QR code within the scanner frame</p></div><div class="qr-scanner-container" data-v-acad2285><div id="reader" class="qr-reader" data-v-acad2285></div></div>',2)),a.error?(r(),o("div",It,[e[3]||(e[3]=t("i",{class:"fas fa-exclamation-triangle me-2"},null,-1)),_(u(a.error),1)])):g("",!0),a.scanResult?(r(),o("div",kt,e[4]||(e[4]=[t("i",{class:"fas fa-check-circle me-2"},null,-1),_("QR Code detected! Redirecting... ")]))):g("",!0),!a.scanResult&&!a.error?(r(),o("div",xt,[e[10]||(e[10]=t("h6",{class:"alert-heading"},[t("i",{class:"fas fa-info-circle me-2"}),_("Troubleshooting")],-1)),e[11]||(e[11]=t("p",{class:"mb-1"},"If you can't see the video feed, try:",-1)),t("ul",St,[e[8]||(e[8]=t("li",null,"Checking browser permissions",-1)),e[9]||(e[9]=t("li",null,"Refreshing the page",-1)),t("li",null,[t("button",{class:"btn btn-sm btn-primary mt-1",onClick:e[0]||(e[0]=(...d)=>a.refreshWithDeliveryID&&a.refreshWithDeliveryID(...d))},e[5]||(e[5]=[t("i",{class:"fas fa-sync-alt me-1"},null,-1),_("Refresh with Current Delivery ID ")]))]),t("li",null,[e[6]||(e[6]=t("strong",null,"HTTP Solution:",-1)),e[7]||(e[7]=_(" For Chrome, run with this flag: ")),t("div",wt,[t("code",null,"chrome --unsafely-treat-insecure-origin-as-secure="+u(a.httpOrigin)+" --user-data-dir=C:\\ChromeDevSession",1)])])])])):g("",!0)]))]),t("div",Ct,[t("button",{type:"button",class:"btn btn-secondary",onClick:e[1]||(e[1]=(...d)=>a.closeModal&&a.closeModal(...d))},e[13]||(e[13]=[t("i",{class:"fas fa-times me-1"},null,-1),_("Close ")]))])])])])}const Pt=R(gt,[["render",Et],["__scopeId","data-v-acad2285"]]),Mt={name:"ExecuteModalDelivery",props:{loading:{type:Boolean,default:!1},delivery:{type:Object,default:()=>null}},components:{QRScannerModal:Pt},emits:["start-delivery","scan-qr-code","refresh","reopen-delivery-modal"],data(){return{modal:null,activeRouteTab:0,scannerData:null,expandedLocations:{}}},methods:{setActiveRoute(s){this.activeRouteTab=s},showModal(){this.modal||(this.modal=new B(document.getElementById("executeModal"))),this.modal.show()},hideModal(){this.modal&&this.modal.hide()},getRoutesCount(){return!this.delivery||!this.delivery.routes?0:Object.keys(this.delivery.routes).length},startDeliveryAndRefresh(s){this.hideModal(),this.$emit("start-delivery",s),this.$emit("refresh"),setTimeout(()=>{this.$emit("reopen-delivery-modal",s)},500)},getStatusBadgeClass(s){if(!s)return"bg-secondary";switch(s.toLowerCase()){case"complete":return"bg-success";case"in_progress":return"bg-warning";case"pending":default:return"bg-secondary"}},formatDate(s){if(!s)return"N/A";const e=new Date(s);return isNaN(e.getTime())?s:e.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})},toggleLocationItems(s,e){this.expandedLocations[s]||(this.expandedLocations[s]={}),this.expandedLocations[s][e]=!this.expandedLocations[s][e],this.$forceUpdate()},isLocationExpanded(s,e){return this.expandedLocations[s]&&this.expandedLocations[s][e]},canScanLocation(s,e,i){if(this.delivery.status==="pending")return!1;if(e==="start"){const a=Object.keys(s.start_locations),l=a.indexOf(i.toString());if(l===0)return!0;for(let n=0;n<l;n++){const d=a[n];if(s.start_locations[d].location_status!=="complete")return!1}return!0}if(e==="end"){for(const n in s.start_locations)if(s.start_locations[n].location_status!=="complete")return!1;const a=Object.keys(s.end_locations),l=a.indexOf(i.toString());if(l===0)return!0;for(let n=0;n<l;n++){const d=a[n];if(s.end_locations[d].location_status!=="complete")return!1}return!0}return!1},scanQRCode(s){let e=null;for(const[i,a]of Object.entries(this.delivery.routes[this.activeRouteTab].start_locations))if(a.checkpoints.some(l=>s.includes(l))){e=parseInt(i);break}if(!e){for(const[i,a]of Object.entries(this.delivery.routes[this.activeRouteTab].end_locations))if(a.checkpoints.some(l=>s.includes(l))){e=parseInt(i);break}}if(!e&&s.length>0)for(const[i,a]of Object.entries(this.delivery.routes)){for(const[l,n]of Object.entries(a.start_locations))if(n.checkpoints.some(d=>s.includes(d))){e=parseInt(l);break}if(!e){for(const[l,n]of Object.entries(a.end_locations))if(n.checkpoints.some(d=>s.includes(d))){e=parseInt(l);break}}if(e)break}if(!e){const i=Object.keys(this.delivery.routes[this.activeRouteTab].start_locations);i.length>0&&(e=parseInt(i[0]))}this.scannerData={locationID:e,checkpoints:s},this.hideModal(),this.$nextTick(()=>{this.$refs.qrScannerModal&&this.$refs.qrScannerModal.showModal()})},reopenExecuteModal(){setTimeout(()=>{this.showModal()},300)}}},Tt={class:"modal fade",id:"executeModal",tabindex:"-1","aria-labelledby":"executeModalLabel","aria-hidden":"true"},$t={class:"modal-dialog modal-lg modal-dialog-scrollable"},Lt={class:"modal-content"},Ft={class:"modal-body"},Ot={key:0,class:"text-center p-4"},Rt={key:1},At={class:"form-group mb-4"},jt={class:"card"},qt={class:"card-header bg-light"},Nt={class:"d-flex justify-content-between align-items-center"},Qt={class:"badge primary-badge me-2"},Vt={class:"card-body"},Bt={class:"row g-3"},Ut={class:"col-md-6 col-lg-4"},zt={class:"text-truncate"},Wt={class:"col-md-6 col-lg-4"},Ht={class:"text-truncate"},Kt={class:"col-md-6 col-lg-4"},Gt={class:"text-truncate"},Jt={class:"form-group mb-4"},Xt={class:"card"},Yt={class:"card-header bg-light"},Zt={class:"d-flex justify-content-between align-items-center"},es={class:"badge secondary-badge"},ts={class:"card-body"},ss={key:0},is={key:0,class:"nav nav-tabs mb-3"},as=["onClick"],ns={class:"timeline"},ls={key:0,class:"route-header mb-3"},rs={class:"border-bottom pb-2"},os={class:"timeline-panel"},ds={class:"timeline-heading"},cs={class:"d-flex flex-wrap align-items-start gap-2 w-100"},us={class:"location-header-content"},vs={class:"d-flex flex-wrap align-items-center gap-2"},ms={class:"timeline-title mb-0"},hs={class:"location-actions mt-2 d-md-none"},gs={class:"d-flex gap-2"},fs=["onClick"],ys=["onClick"],ps={class:"ms-auto location-actions d-none d-md-block"},bs={class:"d-flex gap-2"},_s=["onClick"],Ds=["onClick"],Is={class:"timeline-body"},ks={class:"location-type"},xs={key:0,class:"location-items mt-3"},Ss={class:"card"},ws={class:"card-body p-0"},Cs={class:"table-responsive"},Es={class:"table table-striped table-hover mb-0"},Ps={class:"timeline-panel"},Ms={class:"timeline-heading"},Ts={class:"d-flex flex-wrap align-items-start gap-2 w-100"},$s={class:"location-header-content"},Ls={class:"d-flex flex-wrap align-items-center gap-2"},Fs={class:"timeline-title mb-0"},Os={class:"location-actions mt-2 d-md-none"},Rs={class:"d-flex gap-2"},As=["onClick"],js=["onClick"],qs={class:"ms-auto location-actions d-none d-md-block"},Ns={class:"d-flex gap-2"},Qs=["onClick"],Vs=["onClick"],Bs={class:"timeline-body"},Us={class:"location-type"},zs={key:0,class:"location-items mt-3"},Ws={class:"card"},Hs={class:"card-body p-0"},Ks={class:"table-responsive"},Gs={class:"table table-striped table-hover mb-0"},Js={key:1,class:"text-center text-muted"};function Xs(s,e,i,a,l,n){var c,S,v,M,F,Q,q,j,f,m,D;const d=E("QRScannerModal");return r(),o(I,null,[t("div",Tt,[t("div",$t,[t("div",Lt,[e[21]||(e[21]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"executeModalLabel"},"Delivery Details"),t("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Ft,[i.loading?(r(),o("div",Ot)):(r(),o("div",Rt,[t("div",At,[e[5]||(e[5]=t("label",{class:"form-label fw-bold"},"Delivery Information",-1)),t("div",jt,[t("div",qt,[t("div",Nt,[t("div",null,[t("span",Qt,"Delivery #"+u(((c=i.delivery)==null?void 0:c.deliveryID)||"N/A"),1)]),t("div",null,[t("span",{class:k(["badge",n.getStatusBadgeClass((S=i.delivery)==null?void 0:S.status)])},u(((v=i.delivery)==null?void 0:v.status)||"Pending"),3)])])]),t("div",Vt,[t("div",Bt,[t("div",Ut,[e[2]||(e[2]=t("p",{class:"mb-2"},[t("strong",null,"Scheduled Date:")],-1)),t("p",zt,u(n.formatDate((M=i.delivery)==null?void 0:M.scheduled_date)),1)]),t("div",Wt,[e[3]||(e[3]=t("p",{class:"mb-2"},[t("strong",null,"Driver:")],-1)),t("p",Ht,u(((F=i.delivery)==null?void 0:F.fullname)||((q=(Q=i.delivery)==null?void 0:Q.driver)==null?void 0:q.fullname)||"N/A"),1)]),t("div",Kt,[e[4]||(e[4]=t("p",{class:"mb-2"},[t("strong",null,"Vehicle:")],-1)),t("p",Gt,u(((j=i.delivery)==null?void 0:j.vehicle_plate)||((m=(f=i.delivery)==null?void 0:f.vehicle)==null?void 0:m.vehicle_plate)||"N/A"),1)])])])])]),t("div",Jt,[e[20]||(e[20]=t("label",{class:"form-label fw-bold"},"Routes Information",-1)),t("div",Xt,[t("div",Yt,[t("div",Zt,[e[6]||(e[6]=t("div",null,[t("span",{class:"badge primary-badge me-2"},"Delivery Routes")],-1)),t("div",null,[t("span",es,u(n.getRoutesCount()),1)])])]),t("div",ts,[i.delivery&&i.delivery.routes&&Object.keys(i.delivery.routes).length>0?(r(),o("div",ss,[Object.keys(i.delivery.routes).length>1?(r(),o("ul",is,[(r(!0),o(I,null,P(Object.entries(i.delivery.routes),(h,w)=>(r(),o("li",{class:"nav-item",key:w},[t("button",{class:k(["nav-link",{active:l.activeRouteTab===w}]),onClick:y=>n.setActiveRoute(w)}," Route #"+u(parseInt(h[0])+1),11,as)]))),128))])):g("",!0),t("div",ns,[(r(!0),o(I,null,P(Object.entries(i.delivery.routes),(h,w)=>N((r(),o("div",{key:w,class:"route-group mb-4"},[Object.keys(i.delivery.routes).length>1?(r(),o("div",ls,[t("h6",rs,"Route #"+u(parseInt(h[0])+1),1)])):g("",!0),(r(!0),o(I,null,P(h[1].start_locations,(y,p)=>(r(),o("div",{key:p,class:"timeline-item"},[e[13]||(e[13]=t("div",{class:"timeline-badge"},[t("div",{class:"timeline-circle"})],-1)),t("div",os,[t("div",ds,[t("div",cs,[t("div",us,[t("div",vs,[t("h6",ms,"Pick Up #"+u(p),1),t("span",{class:k(["badge",n.getStatusBadgeClass(y.location_status)])},u(y.location_status||"Pending"),3)]),t("div",hs,[t("div",gs,[t("button",{class:"btn btn-sm btn-link p-1",onClick:C=>n.toggleLocationItems(h[0],`start-${p}`)},[t("i",{class:k(["fas",n.isLocationExpanded(h[0],`start-${p}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,fs),w===0&&p===Object.keys(h[1].start_locations)[0]&&i.delivery.status==="pending"?(r(),o("button",{key:0,class:"btn btn-sm btn-success",onClick:e[0]||(e[0]=C=>n.startDeliveryAndRefresh(i.delivery.deliveryID))},e[7]||(e[7]=[t("i",{class:"fas fa-play me-1"},null,-1),_(),t("span",{class:"d-none d-sm-inline"},"Start",-1)]))):g("",!0),n.canScanLocation(h[1],"start",p)&&y.location_status!=="complete"?(r(),o("button",{key:1,class:"btn btn-sm btn-primary",onClick:C=>n.scanQRCode(y.checkpoints)},e[8]||(e[8]=[t("i",{class:"fas fa-qrcode me-1"},null,-1),_(),t("span",{class:"d-none d-sm-inline"},"Scan QR",-1)]),8,ys)):g("",!0)])])]),t("div",ps,[t("div",bs,[t("button",{class:"btn btn-sm btn-link p-1",onClick:C=>n.toggleLocationItems(h[0],`start-${p}`)},[t("i",{class:k(["fas",n.isLocationExpanded(h[0],`start-${p}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,_s),w===0&&p===Object.keys(h[1].start_locations)[0]&&i.delivery.status==="pending"?(r(),o("button",{key:0,class:"btn btn-sm btn-success",onClick:e[1]||(e[1]=C=>n.startDeliveryAndRefresh(i.delivery.deliveryID))},e[9]||(e[9]=[t("i",{class:"fas fa-play me-1"},null,-1),_(),t("span",null,"Start",-1)]))):g("",!0),n.canScanLocation(h[1],"start",p)&&y.location_status!=="complete"?(r(),o("button",{key:1,class:"btn btn-sm btn-primary",onClick:C=>n.scanQRCode(y.checkpoints)},e[10]||(e[10]=[t("i",{class:"fas fa-qrcode me-1"},null,-1),_(),t("span",null,"Scan QR",-1)]),8,Ds)):g("",!0)])])])]),t("div",Is,[t("p",null,u(y.company_address),1),t("p",ks,"(Location ID: "+u(y.locationID)+")",1),n.isLocationExpanded(h[0],`start-${p}`)?(r(),o("div",xs,[t("div",Ss,[e[12]||(e[12]=t("div",{class:"card-header bg-light"},[t("strong",null,"Items")],-1)),t("div",ws,[t("div",Cs,[t("table",Es,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,"Item ID"),t("th",null,"Name"),t("th",null,"Quantity"),t("th",null,"Order ID")])],-1)),t("tbody",null,[(r(!0),o(I,null,P(y.checkpoints,(C,b)=>(r(),o(I,{key:b},[(r(!0),o(I,null,P(C.items,($,A)=>(r(),o("tr",{key:`${b}-${A}`},[t("td",null,u(A),1),t("td",null,u($.item_name||"Unknown Item"),1),t("td",null,u($.quantity||1),1),t("td",null,u($.orderID||"N/A"),1)]))),128))],64))),128))])])])])])])):g("",!0)])])]))),128)),(r(!0),o(I,null,P(h[1].end_locations,(y,p)=>(r(),o("div",{key:p,class:"timeline-item"},[e[18]||(e[18]=t("div",{class:"timeline-badge"},[t("div",{class:"timeline-circle"})],-1)),t("div",Ps,[t("div",Ms,[t("div",Ts,[t("div",$s,[t("div",Ls,[t("h6",Fs,"Destination #"+u(p),1),t("span",{class:k(["badge",n.getStatusBadgeClass(y.location_status)])},u(y.location_status||"Pending"),3)]),t("div",Os,[t("div",Rs,[t("button",{class:"btn btn-sm btn-link p-1",onClick:C=>n.toggleLocationItems(h[0],`end-${p}`)},[t("i",{class:k(["fas",n.isLocationExpanded(h[0],`end-${p}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,As),n.canScanLocation(h[1],"end",p)&&y.location_status!=="complete"?(r(),o("button",{key:0,class:"btn btn-sm btn-primary",onClick:C=>n.scanQRCode(y.checkpoints)},e[14]||(e[14]=[t("i",{class:"fas fa-qrcode me-1"},null,-1),_(),t("span",null,"Scan QR",-1)]),8,js)):g("",!0)])])]),t("div",qs,[t("div",Ns,[t("button",{class:"btn btn-sm btn-link p-1",onClick:C=>n.toggleLocationItems(h[0],`end-${p}`)},[t("i",{class:k(["fas",n.isLocationExpanded(h[0],`end-${p}`)?"fa-chevron-up":"fa-chevron-down"])},null,2)],8,Qs),n.canScanLocation(h[1],"end",p)&&y.location_status!=="complete"?(r(),o("button",{key:0,class:"btn btn-sm btn-primary",onClick:C=>n.scanQRCode(y.checkpoints)},e[15]||(e[15]=[t("i",{class:"fas fa-qrcode me-1"},null,-1),_(),t("span",null,"Scan QR",-1)]),8,Vs)):g("",!0)])])])]),t("div",Bs,[t("p",null,u(y.company_address),1),t("p",Us,"(Location ID: "+u(y.locationID)+")",1),n.isLocationExpanded(h[0],`end-${p}`)?(r(),o("div",zs,[t("div",Ws,[e[17]||(e[17]=t("div",{class:"card-header bg-light"},[t("strong",null,"Items")],-1)),t("div",Hs,[t("div",Ks,[t("table",Gs,[e[16]||(e[16]=t("thead",null,[t("tr",null,[t("th",null,"Item ID"),t("th",null,"Name"),t("th",null,"Quantity"),t("th",null,"Order ID")])],-1)),t("tbody",null,[(r(!0),o(I,null,P(y.checkpoints,(C,b)=>(r(),o(I,{key:b},[(r(!0),o(I,null,P(C.items,($,A)=>(r(),o("tr",{key:`${b}-${A}`},[t("td",null,u(A),1),t("td",null,u($.item_name||"Unknown Item"),1),t("td",null,u($.quantity||1),1),t("td",null,u($.orderID||"N/A"),1)]))),128))],64))),128))])])])])])])):g("",!0)])])]))),128))])),[[ae,l.activeRouteTab===w||Object.keys(i.delivery.routes).length===1]])),128))])])):(r(),o("div",Js,e[19]||(e[19]=[t("p",null,"No routes information available",-1)])))])])])]))]),e[22]||(e[22]=t("div",{class:"modal-footer theme-footer"},[t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Close")],-1))])])]),l.scannerData?(r(),U(d,{key:0,deliveryID:(D=i.delivery)==null?void 0:D.deliveryID,locationID:l.scannerData.locationID,checkpoints:l.scannerData.checkpoints,ref:"qrScannerModal",onScannerClosed:n.reopenExecuteModal},null,8,["deliveryID","locationID","checkpoints","onScannerClosed"])):g("",!0)],64)}const Ys=R(Mt,[["render",Xs],["__scopeId","data-v-9dc3d901"]]),Zs={name:"LoadingOverlay",props:{size:{type:String,default:"md",validator:s=>["sm","md","lg"].includes(s)},message:{type:String,default:""},overlay:{type:Boolean,default:!1}},computed:{sizeClass(){return{sm:"spinner-border-sm",md:"",lg:"spinner-border-lg"}[this.size]||""}}},ei={class:"spinner-container"},ti={key:0,class:"loading-message mt-2"};function si(s,e,i,a,l,n){return r(),o("div",{class:k(["loading-spinner-container",{overlay:i.overlay}])},[t("div",ei,[t("div",{class:k(["spinner-border",n.sizeClass]),role:"status"},e[0]||(e[0]=[t("span",{class:"visually-hidden"},"Loading...",-1)]),2),i.message?(r(),o("p",ti,u(i.message),1)):g("",!0)])],2)}const ii=R(Zs,[["render",si],["__scopeId","data-v-bea0c85b"]]),ai={name:"DeliveryExecution",components:{ResponsiveTable:re,ExecuteModalDelivery:Ys,LoadingOverlay:ii},props:{deliveries:{type:[Array,Object],default:()=>[]},drivers:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},data(){return{modalLoading:!1,error:null,selectedDelivery:null,statusFilter:"",dateFilter:"",searchTerm:"",columns:[{key:"deliveryID",label:"ID",sortable:!0},{key:"driver.fullname",label:"Driver",sortable:!0},{key:"vehicle.vehicle_plate",label:"Vehicle",sortable:!0},{key:"status",label:"Status",sortable:!0}]}},computed:{minDate(){return new Date().toISOString().split("T")[0]},filteredDeliveries(){if(!this.deliveries)return[];if(typeof this.deliveries=="object"&&!Array.isArray(this.deliveries)){if(Object.keys(this.deliveries).length===0)return[];const s=Object.values(this.deliveries);return this.applyFilters(s)}return Array.isArray(this.deliveries)?this.applyFilters(this.deliveries):[]}},methods:{viewDelivery(s){this.modalLoading=!0,console.log("modalLoading set to true in viewDelivery");const e={...s};e.routes&&typeof e.routes=="object"&&!Array.isArray(e.routes)&&(e.routes=Object.values(e.routes).map(i=>(!i.routeID&&i.start_location&&i.end_location&&(i.routeID=`${i.start_location.locationID}-${i.end_location.locationID}`),i.start_location&&(i.start_location.address=i.start_location.company_address,i.start_location.checkpoints&&Array.isArray(i.start_location.checkpoints)&&(i.start_location.items={},i.start_location.checkpoints.forEach(a=>{a.items&&Object.assign(i.start_location.items,a.items)}))),i.end_location&&(i.end_location.address=i.end_location.company_address,i.end_location.checkpoints&&Array.isArray(i.end_location.checkpoints)&&(i.end_location.items={},i.end_location.checkpoints.forEach(a=>{a.items&&Object.assign(i.end_location.items,a.items)}))),i))),this.selectedDelivery=e,this.$nextTick(()=>{this.modalLoading=!1,console.log("modalLoading set to false in viewDelivery"),this.$refs.executeModal.showModal()})},handleRefresh(){this.$emit("refresh",{status:this.statusFilter,date:this.dateFilter,searchTerm:this.searchTerm})},applyFilters(s){const e=this.searchTerm.toLowerCase();return s.filter(i=>{var a,l;if(this.statusFilter&&i.status!==this.statusFilter)return!1;if(this.dateFilter){const n=new Date(i.scheduled_date);if(new Date(n.getTime()-n.getTimezoneOffset()*6e4).toISOString().split("T")[0]!==this.dateFilter)return!1}if(e){const n=i.deliveryID?String(i.deliveryID).toLowerCase():"",d=(a=i.driver)!=null&&a.fullname?i.driver.fullname.toLowerCase():"",c=(l=i.vehicle)!=null&&l.vehicle_plate?i.vehicle.vehicle_plate.toLowerCase():"";if(!n.includes(e)&&!d.includes(e)&&!c.includes(e))return!1}return!0})},startDelivery(s){this.modalLoading=!0,this.$refs.executeModal&&this.$refs.executeModal.hideModal(),L.startDelivery(s).then(e=>{this.$emit("refresh")}).catch(e=>{console.error("Error starting delivery:",e)}).finally(()=>{setTimeout(()=>{this.modalLoading=!1},2e3)})},getThemeStatusClass(s){switch(s){case"pending":return"bg-warning text-dark";case"in_progress":return"bg-info text-white";case"completed":return"bg-success text-white";case"failed":return"bg-danger text-white";default:return"bg-secondary text-white"}},handleFiltersChanged(){this.$emit("filter-changed",{statusFilter:this.statusFilter,dateFilter:this.dateFilter})},reopenDeliveryModal(s){this.$emit("refresh"),setTimeout(()=>{const e=this.filteredDeliveries.find(i=>i.deliveryID===s);e&&this.viewDelivery(e)},1e3)}},mounted(){},watch:{statusFilter(){this.$emit("filter-changed",{status:this.statusFilter,date:this.dateFilter})},dateFilter(){this.$emit("filter-changed",{status:this.statusFilter,date:this.dateFilter})},searchTerm(){}}},ni={class:"delivery-execution"},li={class:"card theme-card"},ri={class:"card-header d-flex justify-content-between align-items-center theme-header"},oi={class:"card-body theme-body"},di={key:0,class:"alert alert-danger"},ci={key:1},ui={class:"row mb-4"},vi={class:"col-md-4"},mi={class:"form-group"},hi={class:"col-md-4"},gi={class:"form-group"},fi=["min"],yi={class:"col-md-4"},pi={class:"form-group"},bi={class:"btn-group"},_i=["onClick"];function Di(s,e,i,a,l,n){const d=E("LoadingOverlay"),c=E("ResponsiveTable"),S=E("ExecuteModalDelivery");return r(),o("div",ni,[l.modalLoading?(r(),U(d,{key:0,overlay:!0,size:"lg",message:"Please wait while the delivery is loading..."})):g("",!0),t("div",li,[t("div",ri,[e[6]||(e[6]=t("h5",{class:"mb-0"},"Execute Deliveries",-1)),t("button",{class:"btn btn-sm theme-btn-outline",onClick:e[0]||(e[0]=(...v)=>n.handleRefresh&&n.handleRefresh(...v))},e[5]||(e[5]=[t("i",{class:"fas fa-sync-alt"},null,-1)]))]),t("div",oi,[l.error?(r(),o("div",di,u(l.error),1)):(r(),o("div",ci,[t("div",ui,[t("div",vi,[t("div",mi,[e[8]||(e[8]=t("label",{for:"statusFilter",class:"form-label theme-label"},"Filter by Status",-1)),N(t("select",{id:"statusFilter","onUpdate:modelValue":e[1]||(e[1]=v=>l.statusFilter=v),class:"form-select theme-select"},e[7]||(e[7]=[W('<option value="" data-v-0756d5b0>All Statuses</option><option value="pending" data-v-0756d5b0>Pending</option><option value="in_progress" data-v-0756d5b0>In Progress</option><option value="completed" data-v-0756d5b0>Completed</option><option value="failed" data-v-0756d5b0>Failed</option>',5)]),512),[[H,l.statusFilter]])])]),t("div",hi,[t("div",gi,[e[9]||(e[9]=t("label",{for:"dateFilter",class:"form-label theme-label"},"Filter by Date",-1)),N(t("input",{type:"date",id:"dateFilter","onUpdate:modelValue":e[2]||(e[2]=v=>l.dateFilter=v),class:"form-control theme-input",min:n.minDate,required:""},null,8,fi),[[K,l.dateFilter]])])]),t("div",yi,[t("div",pi,[e[10]||(e[10]=t("label",{for:"searchInput",class:"form-label theme-label"},"Search",-1)),N(t("input",{type:"text",id:"searchInput","onUpdate:modelValue":e[3]||(e[3]=v=>l.searchTerm=v),class:"form-control theme-input",placeholder:"Search by ID, Driver, Vehicle..."},null,512),[[K,l.searchTerm]])])])]),T(c,{columns:l.columns,items:n.filteredDeliveries,loading:i.loading,"has-actions":!0,"show-filters":!1,"item-key":"deliveryID",class:"delivery-table"},{status:J(({item:v})=>[t("span",{class:k(["badge",n.getThemeStatusClass(v.status)])},u(v.status||"Pending"),3)]),actions:J(({item:v})=>[t("div",bi,[t("button",{class:"btn btn-sm btn-primary",onClick:M=>n.viewDelivery(v)},e[11]||(e[11]=[t("i",{class:"fas fa-edit"},null,-1)]),8,_i)])]),_:1},8,["columns","items","loading"])]))])]),T(S,{loading:l.modalLoading,delivery:l.selectedDelivery,ref:"executeModal",onStartDelivery:n.startDelivery,onRefresh:e[4]||(e[4]=v=>s.$emit("refresh")),onReopenDeliveryModal:n.reopenDeliveryModal},null,8,["loading","delivery","onStartDelivery","onReopenDeliveryModal"])])}const Ii=R(ai,[["render",Di],["__scopeId","data-v-0756d5b0"]]),ki={name:"DeliveryFormModal",components:{LoadingSpinner:G},emits:["delivery-created"],setup(s,{emit:e}){const i=O(!1),a=O([]),l=O([]),n=O({}),d=O({scheduled_date:"",userID:"",vehicleID:""}),c=X(()=>new Date().toISOString().split("T")[0]),S=X(()=>d.value.scheduled_date&&d.value.userID&&d.value.vehicleID),v=()=>{d.value.userID="",d.value.vehicleID="",d.value.scheduled_date&&(M(),F())},M=async()=>{if(d.value.scheduled_date)try{i.value=!0;const m=await L.getDrivers(d.value.scheduled_date);m.success?a.value=m.data:V("Error",m.message||"Failed to load drivers")}catch(m){console.error("Error fetching drivers:",m),V("Error","An unexpected error occurred while loading drivers")}finally{i.value=!1}},F=async()=>{if(d.value.scheduled_date)try{i.value=!0;const m=await L.getVehicles(d.value.scheduled_date);m.success?l.value=m.data:V("Error",m.message||"Failed to load vehicles")}catch(m){console.error("Error fetching vehicles:",m),V("Error","An unexpected error occurred while loading vehicles")}finally{i.value=!1}},Q=()=>(n.value={},d.value.scheduled_date||(n.value.scheduled_date="Scheduled date is required"),d.value.userID||(n.value.userID="Driver is required"),d.value.vehicleID||(n.value.vehicleID="Vehicle is required"),Object.keys(n.value).length===0),q=async()=>{if(Q())try{i.value=!0;const m=await L.createDelivery(d.value);if(m.success){ee("Success","Delivery created successfully"),e("delivery-created",m.data),j();const D=document.getElementById("deliveryFormModal");if(D){const h=B.getInstance(D);h&&h.hide()}}else V("Error",m.message||"Failed to create delivery")}catch(m){console.error("Error creating delivery:",m),V("Error","An unexpected error occurred while creating the delivery")}finally{i.value=!1}},j=()=>{d.value={scheduled_date:"",userID:"",vehicleID:""},n.value={},a.value=[],l.value=[]},f=()=>{j();const m=document.getElementById("deliveryFormModal");m&&new B(m).show()};return Y(()=>{const m=document.getElementById("deliveryFormModal");m&&m.addEventListener("hidden.bs.modal",j)}),{loading:i,formData:d,drivers:a,vehicles:l,errors:n,minDate:c,isFormValid:S,onDateChange:v,validateAndSubmit:q,showModal:f}}},xi={class:"modal fade",id:"deliveryFormModal",tabindex:"-1","aria-labelledby":"deliveryFormModalLabel","aria-hidden":"true"},Si={class:"modal-dialog"},wi={class:"modal-content theme-modal"},Ci={class:"modal-body theme-body"},Ei={class:"form-group mb-3"},Pi=["min"],Mi={key:0,class:"text-danger mt-1"},Ti={class:"form-group mb-3"},$i=["disabled"],Li=["value"],Fi={key:0,class:"text-muted mt-1"},Oi={key:1,class:"text-danger mt-1"},Ri={class:"form-group mb-3"},Ai=["disabled"],ji=["value"],qi={key:0,class:"text-muted mt-1"},Ni={key:1,class:"text-danger mt-1"},Qi={class:"modal-footer theme-footer"},Vi=["disabled"];function Bi(s,e,i,a,l,n){const d=E("LoadingSpinner");return r(),o("div",xi,[t("div",Si,[t("div",wi,[e[13]||(e[13]=t("div",{class:"modal-header theme-header"},[t("h5",{class:"modal-title",id:"deliveryFormModalLabel"},"Create Delivery"),t("button",{type:"button",class:"btn-close theme-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Ci,[a.loading?(r(),U(d,{key:0,message:"Processing..."})):(r(),o("form",{key:1,onSubmit:e[4]||(e[4]=Z((...c)=>a.validateAndSubmit&&a.validateAndSubmit(...c),["prevent"]))},[t("div",Ei,[e[6]||(e[6]=t("label",{for:"scheduled_date",class:"form-label theme-label"},"Scheduled Date",-1)),N(t("input",{type:"date",id:"scheduled_date","onUpdate:modelValue":e[0]||(e[0]=c=>a.formData.scheduled_date=c),class:"form-control theme-input",min:a.minDate,onChange:e[1]||(e[1]=(...c)=>a.onDateChange&&a.onDateChange(...c)),required:""},null,40,Pi),[[K,a.formData.scheduled_date]]),a.errors.scheduled_date?(r(),o("div",Mi,u(a.errors.scheduled_date),1)):g("",!0)]),t("div",Ti,[e[8]||(e[8]=t("label",{for:"driver",class:"form-label theme-label"},"Driver",-1)),N(t("select",{id:"driver","onUpdate:modelValue":e[2]||(e[2]=c=>a.formData.userID=c),class:"form-select theme-select",disabled:!a.formData.scheduled_date,required:""},[e[7]||(e[7]=t("option",{value:""},"Select Driver",-1)),(r(!0),o(I,null,P(a.drivers,c=>(r(),o("option",{key:c.userID,value:c.userID},u(c.fullname),9,Li))),128))],8,$i),[[H,a.formData.userID]]),!a.formData.scheduled_date&&!a.errors.userID?(r(),o("div",Fi," Please select a date first ")):g("",!0),a.errors.userID?(r(),o("div",Oi,u(a.errors.userID),1)):g("",!0)]),t("div",Ri,[e[10]||(e[10]=t("label",{for:"vehicle",class:"form-label theme-label"},"Vehicle",-1)),N(t("select",{id:"vehicle","onUpdate:modelValue":e[3]||(e[3]=c=>a.formData.vehicleID=c),class:"form-select theme-select",disabled:!a.formData.scheduled_date,required:""},[e[9]||(e[9]=t("option",{value:""},"Select Vehicle",-1)),(r(!0),o(I,null,P(a.vehicles,c=>(r(),o("option",{key:c.vehicleID,value:c.vehicleID},u(c.vehicle_plate)+" - "+u(c.vehicle_load_weight)+"kg ",9,ji))),128))],8,Ai),[[H,a.formData.vehicleID]]),!a.formData.scheduled_date&&!a.errors.vehicleID?(r(),o("div",qi," Please select a date first ")):g("",!0),a.errors.vehicleID?(r(),o("div",Ni,u(a.errors.vehicleID),1)):g("",!0)])],32))]),t("div",Qi,[e[12]||(e[12]=t("button",{type:"button",class:"btn theme-btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn theme-btn-primary",onClick:e[5]||(e[5]=(...c)=>a.validateAndSubmit&&a.validateAndSubmit(...c)),disabled:a.loading||!a.isFormValid},e[11]||(e[11]=[t("i",{class:"fas fa-save me-1"},null,-1),_(" Create Delivery ")]),8,Vi)])])])])}const Ui=R(ki,[["render",Bi],["__scopeId","data-v-475df8c9"]]),zi={name:"CreatedDeliveriesList",components:{LoadingSpinner:G},props:{deliveries:{type:Object,required:!0},loading:{type:Boolean,default:!1},selectedDeliveryID:{type:[Number,String],default:null},expandedDeliveries:{type:Object,default:()=>({})},currentPage:{type:Number,default:1},pagination:{type:Object,default:()=>({current_page:1,last_page:1,total:0})},hasMorePages:{type:Boolean,default:!1}},methods:{formatDate(s){return s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}):"Not scheduled"}}},Wi={class:"card theme-card"},Hi={class:"card-header d-flex justify-content-between align-items-center theme-header"},Ki={key:0,class:"p-2 theme-selected-delivery border-bottom"},Gi={class:"d-flex justify-content-between align-items-center"},Ji={class:"d-flex align-items-center"},Xi={class:"card-body p-0"},Yi={key:1,class:"p-3 text-center"},Zi={key:2,class:"list-group list-group-flush"},ea={class:"d-flex justify-content-between align-items-center"},ta={class:"d-flex align-items-center"},sa={class:"form-check me-2"},ia=["id","value","checked","onChange"],aa=["for"],na={class:"visually-hidden"},la={class:"fw-bold"},ra={class:"small"},oa={class:"badge theme-badge-primary me-1"},da={class:"text-muted"},ca=["onClick"],ua={key:0,class:"mt-3 delivery-details theme-details"},va={class:"card theme-inner-card"},ma={class:"card-body"},ha={class:"row"},ga={class:"col-12"},fa={class:"mb-1 w-100"},ya={class:"mb-1 w-100"},pa={class:"mb-1 w-100"},ba={class:"mb-1 w-100"},_a={key:3,class:"d-flex justify-content-center p-2 theme-pagination-container"},Da=["disabled"],Ia={class:"align-self-center mx-2 theme-pagination-text"},ka=["disabled"];function xa(s,e,i,a,l,n){const d=E("LoadingSpinner");return r(),o("div",Wi,[t("div",Hi,[e[7]||(e[7]=t("h5",{class:"mb-0"},"Created Deliveries",-1)),t("div",null,[t("button",{class:"btn btn-sm btn-primary me-2",onClick:e[0]||(e[0]=c=>s.$emit("create-delivery"))},e[5]||(e[5]=[t("i",{class:"fas fa-plus"},null,-1)])),t("button",{class:"btn btn-sm theme-btn-outline",onClick:e[1]||(e[1]=c=>s.$emit("refresh"))},e[6]||(e[6]=[t("i",{class:"fas fa-sync-alt"},null,-1)]))])]),i.selectedDeliveryID?(r(),o("div",Ki,[t("div",Gi,[t("div",Ji,[e[8]||(e[8]=t("span",{class:"badge theme-badge-accent me-2"},"Selected",-1)),t("span",null,"Delivery #"+u(i.selectedDeliveryID),1)]),t("button",{class:"btn btn-sm theme-btn-outline-danger",onClick:e[2]||(e[2]=c=>s.$emit("deselect"))},e[9]||(e[9]=[t("i",{class:"fas fa-times"},null,-1)]))])])):g("",!0),t("div",Xi,[i.loading?(r(),U(d,{key:0,size:"md",message:"Loading deliveries..."})):Object.keys(i.deliveries).length===0?(r(),o("div",Yi,e[10]||(e[10]=[t("p",{class:"text-muted mb-0"},"No deliveries found",-1)]))):(r(),o("ul",Zi,[(r(!0),o(I,null,P(i.deliveries,(c,S)=>{var v,M;return r(),o("li",{key:S,class:k(["list-group-item theme-list-item",{"theme-list-item-active":i.selectedDeliveryID===c.deliveryID}])},[t("div",ea,[t("div",ta,[t("div",sa,[t("input",{class:"form-check-input theme-checkbox",type:"radio",id:"delivery-"+c.deliveryID,name:"selectedDelivery",value:c.deliveryID,checked:i.selectedDeliveryID===c.deliveryID,onChange:F=>s.$emit("select",c.deliveryID)},null,40,ia),t("label",{class:"form-check-label",for:"delivery-"+c.deliveryID},[t("span",na,"Select Delivery #"+u(c.deliveryID),1)],8,aa)]),t("div",null,[t("div",la,"Delivery #"+u(c.deliveryID),1),t("div",ra,[t("span",oa,u(c.status||"Pending"),1),t("span",da,u(n.formatDate(c.scheduledDate)),1)])])]),t("div",null,[t("i",{class:k(["fas theme-icon expand-icon",i.expandedDeliveries[c.deliveryID]?"fa-chevron-up":"fa-chevron-down"]),onClick:Z(F=>s.$emit("toggle-details",c.deliveryID),["stop"])},null,10,ca)])]),i.expandedDeliveries[c.deliveryID]?(r(),o("div",ua,[t("div",va,[t("div",ma,[t("div",ha,[t("div",ga,[e[15]||(e[15]=t("h6",{class:"theme-subtitle"},"Delivery Information",-1)),t("p",fa,[e[11]||(e[11]=t("strong",null,"Status:",-1)),_(" "+u(c.status||"Pending"),1)]),t("p",ya,[e[12]||(e[12]=t("strong",null,"Scheduled Date:",-1)),_(" "+u(n.formatDate(c.scheduledDate)),1)]),t("p",pa,[e[13]||(e[13]=t("strong",null,"Driver:",-1)),_(" "+u(((v=c.driver)==null?void 0:v.fullname)||"Not assigned"),1)]),t("p",ba,[e[14]||(e[14]=t("strong",null,"Vehicle:",-1)),_(" "+u(((M=c.vehicle)==null?void 0:M.vehicle_plate)||"Not assigned"),1)])])])])])])):g("",!0)],2)}),128))])),Object.keys(i.deliveries).length>0?(r(),o("div",_a,[t("button",{class:"btn btn-sm theme-btn-outline me-2",disabled:i.currentPage<=1,onClick:e[3]||(e[3]=c=>s.$emit("change-page",i.currentPage-1))},e[16]||(e[16]=[t("i",{class:"fas fa-chevron-left"},null,-1)]),8,Da),t("span",Ia," Page "+u(i.currentPage)+" of "+u(i.pagination.last_page)+" ("+u(i.pagination.total)+" total) ",1),t("button",{class:"btn btn-sm theme-btn-outline ms-2",disabled:!i.hasMorePages,onClick:e[4]||(e[4]=c=>s.$emit("change-page",i.currentPage+1))},e[17]||(e[17]=[t("i",{class:"fas fa-chevron-right"},null,-1)]),8,ka)])):g("",!0)])])}const Sa=R(zi,[["render",xa],["__scopeId","data-v-1ac892a8"]]),wa={name:"DeliveryPage",components:{StatsCard:ge,DeliveryAssignment:ht,DeliveryExecution:Ii,DeliveryFormModal:Ui,CreatedDeliveriesList:Sa},data(){return{activeTab:"assign",loading:!0,createdDeliveriesLoading:!1,assignDeliveriesLoading:!1,executeDeliveriesLoading:!1,pendingSelectionID:null,assignError:null,executeError:null,trips:[],tripsPagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},executionDeliveries:{},pagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},createdDeliveriesPagination:{current_page:1,last_page:1,per_page:10,total:0,from:0,to:0},deliveryStats:{pending:0,inProgress:0,completedToday:0,issues:0},selectedLocationID:"",locations:[],drivers:[],vehicles:[],expandedOrders:{},assignmentForm:{deliveryID:null,locationID:null,orderID:null,userID:"",vehicleID:"",scheduledDate:new Date().toISOString().split("T")[0],checkIDs:[],fromLocation:null,toLocation:null},locationInfo:{from:null,to:null},assignmentLoading:!1,createdDeliveries:{},createdDeliveriesPage:1,createdDeliveriesPerPage:3,hasMoreCreatedDeliveries:!1,selectedDeliveryID:null,selectedOrderInfo:null,expandedDeliveries:{},deliveryFormModal:null,activePhase:1}},mounted(){this.fetchTrips(),this.fetchDeliveryStats(),this.fetchCreatedDeliveries()},created(){const s=this.$route.query.selectionID;s&&(this.activeTab="execute",this.pendingSelectionID=s)},watch:{activeTab:{immediate:!0,handler(s){s==="execute"&&this.refreshExecutionDeliveries({}).then(()=>{if(this.pendingSelectionID){const e=Number(this.pendingSelectionID),i=this.executionDeliveries.find(a=>a.deliveryID===e);i&&(this.$refs.deliveryExecution.viewDelivery(i),this.pendingSelectionID=null)}})}}},methods:{async fetchTrips(){try{this.assignDeliveriesLoading=!0,this.assignError=null;const s=await L.getTrips({locationID:this.selectedLocationID,page:this.tripsPagination.current_page,per_page:this.tripsPagination.per_page,phase:this.activePhase});if(s.success){this.trips=s.data;const e=this.tripsPagination.current_page;this.tripsPagination={...s.pagination,current_page:e}}else this.assignError="Failed to fetch trips"}catch(s){console.error("Error fetching trips:",s),this.assignError=s.message||"An error occurred while fetching trips"}finally{this.assignDeliveriesLoading=!1}},handlePhaseChange(s){this.activePhase=s,this.fetchTrips()},handleTripsPageChange(s){this.tripsPagination.current_page=s,this.fetchTrips()},async assignTrip(s){try{if(!this.selectedDeliveryID){this.assignError="Please select a delivery first";return}const e=await L.assignSingleTrip({deliveryID:this.selectedDeliveryID,tripID:s.tripID});e&&e.success?(await this.fetchTrips(),await this.refreshCreatedDeliveries(),z({type:"success",title:"Success",message:e.message||"Delivery assigned successfully",buttons:[{label:"OK",type:"success",dismiss:!0,onClick:()=>{this.fetchTrips(),this.fetchDeliveryStats(),this.fetchCreatedDeliveries()}}]})):this.assignError=e&&e.message||"Failed to assign trip"}catch(e){console.error("Error assigning trip:",e),this.assignError=e.message||"An error occurred while assigning trip"}},deselectDelivery(){this.selectedDeliveryID=null,this.fetchTrips()},onDeliveryCreated(){this.refreshCreatedDeliveries(),this.refreshAssignDeliveries()},formatDate(s){if(!s)return"";const e=new Date(s);return isNaN(e.getTime())?"":e.toLocaleDateString("en-GB",{day:"2-digit",month:"2-digit",year:"numeric"})},async fetchCreatedDeliveries(){try{this.createdDeliveriesLoading=!0,this.assignError=null;const s=await L.getCreatedDeliveries(this.createdDeliveriesPage,3);s.success?(this.createdDeliveries=s.data,this.hasMoreCreatedDeliveries=s.pagination.current_page<s.pagination.last_page,this.createdDeliveriesPagination=s.pagination):this.assignError=s.message||"Failed to fetch created deliveries"}catch(s){console.error("Error fetching created deliveries:",s),this.assignError="An error occurred while fetching deliveries"}finally{this.createdDeliveriesLoading=!1}this.fetchDeliveryStats()},selectDelivery(s){this.selectedDeliveryID=s,this.fetchTrips()},changeCreatedDeliveriesPage(s){s<1||s>1&&!this.hasMoreCreatedDeliveries||(this.createdDeliveriesPage=s,this.fetchCreatedDeliveries())},viewDeliveryDetails(s){var e,i,a,l;z({type:"info",title:`Delivery Details - #${s.deliveryID}`,message:`
          <div>
            <p><strong>From:</strong> ${this.getLocationName((e=s.from)==null?void 0:e.locationID)}</p>
            <p><strong>To:</strong> ${this.getLocationName((i=s.to)==null?void 0:i.locationID)}</p>
            <p><strong>Status:</strong> ${s.status||"Pending"}</p>
            <p><strong>Scheduled Date:</strong> ${s.scheduledDate}</p>
            <p><strong>Driver:</strong> ${((a=s.driver)==null?void 0:a.name)||"Not assigned"}</p>
            <p><strong>Vehicle:</strong> ${((l=s.vehicle)==null?void 0:l.vehicle_plate)||"Not assigned"}</p>
          </div>
        `,buttons:[{label:"Close",type:"secondary",dismiss:!0}]})},handleLocationChange(s){this.selectedLocationID=s,this.pagination.current_page=1,this.fetchTrips()},refreshData(){this.fetchDeliveryStats(),this.selectedOrderInfo=null,this.activeTab==="execute"&&this.refreshExecutionDeliveries()},async refreshCreatedDeliveries(){try{this.createdDeliveriesLoading=!0,this.assignError=null;const s=await L.getCreatedDeliveries(this.createdDeliveriesPage,3);s.success?(this.createdDeliveries=s.data,this.hasMoreCreatedDeliveries=s.pagination.current_page<s.pagination.last_page,this.createdDeliveriesPagination=s.pagination):this.assignError=s.message||"Failed to fetch created deliveries"}catch(s){console.error("Error fetching created deliveries:",s),this.assignError="An error occurred while fetching deliveries"}finally{this.createdDeliveriesLoading=!1}this.fetchDeliveryStats()},async refreshAssignDeliveries(){try{this.assignDeliveriesLoading=!0,this.assignError=null;const s=await L.getTrips({locationID:this.selectedLocationID,page:this.tripsPagination.current_page,per_page:this.tripsPagination.per_page,phase:this.activePhase});s.success?(this.groupedDeliveries=s.data,this.tripsPagination=s.pagination):this.assignError=s.message||"Failed to load delivery data"}catch(s){console.error("Error fetching delivery data:",s),this.assignError="An unexpected error occurred while loading delivery data"}finally{this.assignDeliveriesLoading=!1}this.fetchDeliveryStats()},changePage(s){s<1||s>this.pagination.last_page||(this.pagination.current_page=s,this.fetchTrips())},getPageNumbers(){const s=this.pagination.last_page,e=this.pagination.current_page;return s<=5?Array.from({length:s},(i,a)=>a+1):e<=3?[1,2,3,4,5]:e>=s-2?[s-4,s-3,s-2,s-1,s]:[e-2,e-1,e,e+1,e+2]},getLocationName(s){const e=this.locations.find(i=>i.locationID==s);return e?e.company_address:null},formatPrice(s){return parseFloat(s).toFixed(2)},calculateTotalMeasurement(s){return Array.isArray(s)?s.reduce((i,a)=>a.measurement_type&&a.measurement_type.toLowerCase().includes("kg")?i+parseFloat(a.measurement_value||0)*parseFloat(a.quantity||1):i,0).toFixed(2):(console.warn("Items is not an array:",s),0)},toggleOrderDetails(s,e){const i=`${s}-${e}`;this.expandedOrders||(this.expandedOrders={}),this.expandedOrders[i]=!this.isOrderExpanded(s,e)},isOrderExpanded(s,e){if(!this.expandedOrders)return!1;const i=`${s}-${e}`;return!!this.expandedOrders[i]},getOrderInfo(s,e){return!this.groupedDeliveries[s]||!this.groupedDeliveries[s].orders[e]?null:this.groupedDeliveries[s].orders[e]},getLocationInfo(s,e){const i=this.getOrderInfo(s,e);return i?{from:i.from||null,to:i.to||null}:{from:null,to:null}},async assignDelivery(s,e){try{if(this.assignmentForm={locationID:s,orderID:e,deliveryID:this.selectedDeliveryID,scheduledDate:new Date().toISOString().split("T")[0],checkIDs:[],fromLocation:null,toLocation:null},this.locationInfo={from:null,to:null},this.groupedDeliveries[s]){const i=this.groupedDeliveries[s];if(i.orders&&i.orders[e]){const a=i.orders[e];this.locationInfo={from:a.from||i.from||null,to:a.to||i.to||null},this.selectedOrderInfo=a}}this.$refs.assignmentModal.show()}catch(i){console.error("Error in assignDelivery:",i),z({type:"error",title:"Error",message:(i==null?void 0:i.message)||"An error occurred while preparing the assignment",buttons:[{label:"OK",type:"primary",dismiss:!0}]})}},getLocationInfo(s,e){const i=this.getOrderInfo(s,e);return i?{from:i.from||null,to:i.to||null}:{from:null,to:null}},handleValidationError(s){z({type:"warning",title:"Validation Error",message:s||"Please check your input and try again"})},toggleDeliveryDetails(s){if(this.expandedDeliveries||(this.expandedDeliveries={}),this.expandedDeliveries[s]=!this.expandedDeliveries[s],this.expandedDeliveries[s]){const e=s.toString();Object.keys(this.expandedDeliveries).forEach(i=>{i!==e&&(this.expandedDeliveries[i]=!1)})}},async fetchDeliveryStats(){try{const s=await L.getDeliveryStats();s.success?this.deliveryStats=s.data:console.error("Failed to fetch delivery stats:",s.message)}catch(s){console.error("Error fetching delivery stats:",s)}},async refreshExecutionDeliveries(s={}){try{this.executeDeliveriesLoading=!0,this.executeError=null;const e=await L.getExecutionDeliveries(s);e.success?this.executionDeliveries=Object.values(e.data):this.executeError=e.message||"Failed to load execution deliveries"}catch(e){console.error("Error fetching execution deliveries:",e),this.executeError="An error occurred while loading execution deliveries. Please try again later."}finally{this.executeDeliveriesLoading=!1}},handleExecutionFilterChange(s){this.refreshExecutionDeliveries(s)},openCreateDeliveryModal(){const s=document.getElementById("deliveryFormModal");s?new B(s).show():console.error("Modal element not found with ID: deliveryFormModal")},openAssignmentModal(s){this.selectedOrderInfo=s;const e=this.$refs.assignmentModal;e&&e.setDeliveryID(this.selectedDeliveryID);const i=document.getElementById("assignmentModal");i&&new B(i).show()}}},Ca={class:"delivery-management"},Ea={class:"row delivery-tabs mb-4"},Pa={class:"col-md-6 mb-3"},Ma={class:"col-md-6 mb-3"},Ta={key:0,class:"row"},$a={class:"col-lg-4 col-md-12 mb-4"},La={class:"col-lg-8 col-md-12"},Fa={key:1};function Oa(s,e,i,a,l,n){const d=E("StatsCard"),c=E("CreatedDeliveriesList"),S=E("DeliveryAssignment"),v=E("DeliveryExecution"),M=E("DeliveryFormModal");return r(),o("div",Ca,[e[4]||(e[4]=t("h1",{class:"mb-4"},"Delivery Management",-1)),T(d,{stats:l.deliveryStats},null,8,["stats"]),t("div",Ea,[t("div",Pa,[t("div",{class:k(["delivery-tab-card",{active:l.activeTab==="assign"}]),onClick:e[0]||(e[0]=F=>l.activeTab="assign")},e[2]||(e[2]=[W('<div class="tab-icon" data-v-04d0c8fa><i class="fas fa-clipboard-list" data-v-04d0c8fa></i></div><div class="tab-content" data-v-04d0c8fa><div class="tab-title" data-v-04d0c8fa>Assign Deliveries</div><div class="tab-desc" data-v-04d0c8fa>Create and assign delivery trips to drivers</div></div>',2)]),2)]),t("div",Ma,[t("div",{class:k(["delivery-tab-card",{active:l.activeTab==="execute"}]),onClick:e[1]||(e[1]=F=>l.activeTab="execute")},e[3]||(e[3]=[W('<div class="tab-icon" data-v-04d0c8fa><i class="fas fa-truck" data-v-04d0c8fa></i></div><div class="tab-content" data-v-04d0c8fa><div class="tab-title" data-v-04d0c8fa>Execute Deliveries</div><div class="tab-desc" data-v-04d0c8fa>Track and manage ongoing deliveries</div></div>',2)]),2)])]),l.activeTab==="assign"?(r(),o("div",Ta,[t("div",$a,[T(c,{deliveries:l.createdDeliveries,loading:l.createdDeliveriesLoading,selectedDeliveryID:l.selectedDeliveryID,expandedDeliveries:l.expandedDeliveries,currentPage:l.createdDeliveriesPage,pagination:l.createdDeliveriesPagination,hasMorePages:l.hasMoreCreatedDeliveries,onCreateDelivery:n.openCreateDeliveryModal,onRefresh:n.refreshCreatedDeliveries,onSelect:n.selectDelivery,onDeselect:n.deselectDelivery,onToggleDetails:n.toggleDeliveryDetails,onChangePage:n.changeCreatedDeliveriesPage},null,8,["deliveries","loading","selectedDeliveryID","expandedDeliveries","currentPage","pagination","hasMorePages","onCreateDelivery","onRefresh","onSelect","onDeselect","onToggleDetails","onChangePage"])]),t("div",La,[l.activeTab==="assign"?(r(),U(S,{key:0,loading:l.assignDeliveriesLoading,error:l.assignError,trips:l.trips,pagination:l.tripsPagination,selectedDeliveryID:l.selectedDeliveryID,activePhase:l.activePhase,onRefresh:n.fetchTrips,onAssignTrip:n.assignTrip,onChangePhase:n.handlePhaseChange,onChangePage:n.handleTripsPageChange},null,8,["loading","error","trips","pagination","selectedDeliveryID","activePhase","onRefresh","onAssignTrip","onChangePhase","onChangePage"])):g("",!0)])])):g("",!0),l.activeTab==="execute"?(r(),o("div",Fa,[T(v,{ref:"deliveryExecution",deliveries:l.executionDeliveries,loading:l.executeDeliveriesLoading,error:l.executeError,onRefresh:n.refreshExecutionDeliveries,onFilterChanged:n.handleExecutionFilterChange},null,8,["deliveries","loading","error","onRefresh","onFilterChanged"])])):g("",!0),T(M,{ref:"deliveryFormModal",onDeliveryCreated:n.onDeliveryCreated},null,8,["onDeliveryCreated"])])}const Va=R(wa,[["render",Oa],["__scopeId","data-v-04d0c8fa"]]);export{Va as default};
