import{_ as R,c as f,a as l,f as F,g as k,e as j,b as x,B as U,t as h,E as M,C as w,d as S,F as z,i as q,r as g,A as Q,m as G,z as _,o as y}from"./main-6TRAM3lj.js";import{S as H}from"./StatsCard-CQZ5Yey2.js";import{R as J}from"./ResponsiveTable-Dmb47gmH.js";import{L as K}from"./LoadingSpinner-Bs7tkB0U.js";import{m as u}from"./modal-CNQBRbiU.js";const O={name:"PoultryManagement",components:{StatsCard:H,ResponsiveTable:J,LoadingSpinner:K},setup(){const m=g(!1),a=g(null),p=g([]),e=g(""),v=g(1),D=g(10),b=g({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),C=Q(()=>{const t=[],i=b.value.last_page;if(i<=5)for(let r=1;r<=i;r++)t.push(r);else{let r=Math.max(1,v.value-Math.floor(2.5)),c=Math.min(i,r+5-1);c===i&&(r=Math.max(1,c-5+1));for(let d=r;d<=c;d++)t.push(d)}return t}),P=g({total:0}),s=[{key:"poultry_image",label:"Image",sortable:!1},{key:"poultry_name",label:"Name",sortable:!0},{key:"created_at",label:"Created",sortable:!0}],n=async()=>{try{m.value=!0,a.value=null;const t={page:v.value,per_page:D.value,search:e.value||null},o=await _.get("/api/poultries",{params:t});o.data&&o.success?(p.value=o.data,b.value=o.pagination):(p.value=[],console.error("Unexpected response format:",o))}catch(t){console.error("Error fetching poultries:",t),a.value=t.message||"Failed to load poultries. Please try again later.",p.value=[]}finally{m.value=!1}},E=async()=>{try{const t={search:e.value||null},o=await _.get("/api/poultries/all/stats",{params:t});o&&(P.value=o)}catch(t){console.error("Error fetching poultry stats:",t)}},L=t=>{e.value=t,v.value=1,n(),E()},T=t=>{t<1||t>b.value.last_page||m.value||(v.value=t,n())},B=t=>t?new Date(t).toLocaleDateString():"",N=t=>{u.show({type:"info",title:"Edit Poultry",message:`
          <form id="edit-poultry-form">
            <div class="mb-3">
              <label for="edit-poultry-name" class="form-label">Poultry Name</label>
              <input type="text" class="form-control" id="edit-poultry-name" value="${t.poultry_name}" required>
            </div>
            <div class="mb-3">
              <label for="edit-poultry-image-file" class="form-label">Upload New Image</label>
              <input type="file" class="form-control" id="edit-poultry-image-file" accept="image/*">
            </div>
            ${t.poultry_image?`
            <div class="mb-3">
              <label class="form-label">Current Image</label>
              <div>
                <img src="${t.poultry_image}" alt="Current Poultry Image" class="img-thumbnail" style="max-width: 200px;">
              </div>
            </div>
            `:""}
          </form>
        `,buttons:[{label:"Cancel",type:"secondary",dismiss:!0},{label:"Save",type:"primary",onClick:async(o,i)=>{const r=document.getElementById("edit-poultry-name"),c=document.getElementById("edit-poultry-image-file");if(!r.value.trim()){r.classList.add("is-invalid");return}m.value=!0,p.value=[];try{const d=new FormData;d.append("poultry_name",r.value.trim()),d.append("_method","PUT"),c.files[0]&&d.append("poultry_image_file",c.files[0]),await _.post(`/api/poultries/${t.poultryID}`,d,{headers:{"Content-Type":"multipart/form-data"},onSuccess:I=>{n(),u.success("Success","Poultry updated successfully")},onError:I=>{console.error("Error updating poultry:",I),a.value="Failed to update poultry. Please try again.",u.danger("Error","Failed to update poultry. Please try again."),n()}}),i.hide()}catch{n()}}}]})},V=t=>{u.confirm("Delete Poultry",`Are you sure you want to delete "${t.poultry_name}"?`,async()=>{m.value=!0,p.value=[];try{await _.delete(`/api/poultries/${t.poultryID}`,{onSuccess:()=>{n(),u.success("Success","Poultry deleted successfully")},onError:o=>{if(console.error("Error deleting poultry:",o),o.response&&o.response.status===422&&o.response.data){const i=o.response.data;a.value=i.message;const r=i.item_count||"multiple",c=`${i.message}. This poultry has ${r} associated item(s).`;u.danger("Cannot Delete",c)}else a.value="Failed to delete poultry. Please try again.",u.danger("Error","Failed to delete poultry. Please try again.");n()}})}catch{n()}},null,{confirmLabel:"Delete",confirmType:"danger"})},A=()=>{u.show({type:"info",title:"Add New Poultry",message:`
          <form id="add-poultry-form">
            <div class="mb-3">
              <label for="poultry-name" class="form-label">Poultry Name</label>
              <input type="text" class="form-control" id="poultry-name" required>
            </div>
            <div class="mb-3">
              <label for="poultry-image-file" class="form-label">Upload Image</label>
              <input type="file" class="form-control" id="poultry-image-file" accept="image/*">
            </div>
          </form>
        `,buttons:[{label:"Cancel",type:"secondary",dismiss:!0},{label:"Save",type:"primary",onClick:async(t,o)=>{const i=document.getElementById("poultry-name"),r=document.getElementById("poultry-image-file");if(!i.value.trim()){i.classList.add("is-invalid");return}m.value=!0,p.value=[];try{const c=new FormData;c.append("poultry_name",i.value.trim()),r.files[0]&&c.append("poultry_image_file",r.files[0]),await _.post("/api/poultries",c,{headers:{"Content-Type":"multipart/form-data"},onSuccess:d=>{n(),u.success("Success","Poultry added successfully")},onError:d=>{console.error("Error adding poultry:",d),a.value="Failed to add poultry. Please try again.",u.danger("Error","Failed to add poultry. Please try again."),n()}}),o.hide()}catch{n()}}}]})};return G(()=>{n(),E()}),{loading:m,error:a,poultries:p,poultryStats:P,columns:s,searchQuery:e,currentPage:v,pagination:b,paginationRange:C,handleSearch:L,changePage:T,formatDate:B,editPoultry:N,confirmDelete:V,openAddModal:A}}},W={class:"poultry-management"},X={class:"row mb-4"},Y={class:"col-md-4 col-sm-6 mb-3"},Z={class:"card"},$={class:"card-header theme-header d-flex justify-content-between align-items-center"},ee={class:"card-body position-relative"},ae={key:0,class:"alert alert-danger",role:"alert"},te={class:"d-flex align-items-center"},le=["src"],oe={key:1,class:"bg-light d-flex align-items-center justify-content-center me-2",style:{width:"50px",height:"50px"}},se=["onClick"],re=["onClick"],ne={key:2,class:"d-flex justify-content-between align-items-center mt-4"},ie={class:"text-muted"},ce={"aria-label":"Poultry pagination"},de={class:"pagination mb-0"},ue=["onClick"];function me(m,a,p,e,v,D){const b=k("StatsCard"),C=k("LoadingSpinner"),P=k("ResponsiveTable");return y(),f("div",W,[a[10]||(a[10]=l("h1",{class:"mb-4"},"Poultry Management",-1)),l("div",X,[l("div",Y,[F(b,{title:"Total Poultries",count:e.poultryStats.total,icon:"fas fa-feather","bg-color":"bg-primary"},null,8,["count"])])]),l("div",Z,[l("div",$,[a[4]||(a[4]=l("h5",{class:"mb-0"},"Poultries",-1)),l("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=(...s)=>e.openAddModal&&e.openAddModal(...s))},a[3]||(a[3]=[l("i",{class:"fas fa-plus"},null,-1),j(),l("span",{class:"d-none d-md-inline"},"Add Poultry",-1)]))]),l("div",ee,[e.error?(y(),f("div",ae,h(e.error),1)):x("",!0),e.loading?(y(),U(C,{key:1,overlay:"",size:"md",message:"Loading poultries..."})):x("",!0),F(P,{columns:e.columns,items:e.poultries,loading:!1,"has-actions":!0,"item-key":"poultryID",onSearch:e.handleSearch,"show-pagination":!1,"server-side":!0},{poultry_image:M(({item:s})=>[l("div",te,[s.poultry_image?(y(),f("img",{key:0,src:s.poultry_image,alt:"Poultry Image",class:"img-thumbnail me-2",style:{width:"50px",height:"50px","object-fit":"cover"}},null,8,le)):(y(),f("div",oe,a[5]||(a[5]=[l("i",{class:"fas fa-feather text-muted"},null,-1)])))])]),actions:M(({item:s})=>[l("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:n=>e.editPoultry(s)},a[6]||(a[6]=[l("i",{class:"fas fa-edit"},null,-1)]),8,se),l("button",{class:"btn btn-sm btn-outline-danger",onClick:n=>e.confirmDelete(s)},a[7]||(a[7]=[l("i",{class:"fas fa-trash"},null,-1)]),8,re)]),_:1},8,["columns","items","onSearch"]),!e.loading&&e.poultries.length>0?(y(),f("div",ne,[l("div",null,[l("span",ie,"Showing "+h(e.pagination.from||1)+"-"+h(e.pagination.to||e.poultries.length)+" of "+h(e.pagination.total||e.poultries.length),1)]),l("nav",ce,[l("ul",de,[l("li",{class:w(["page-item",{disabled:e.currentPage<=1||e.loading}])},[l("a",{class:"page-link",href:"#",onClick:a[1]||(a[1]=S(s=>!e.loading&&e.changePage(e.currentPage-1),["prevent"]))},a[8]||(a[8]=[l("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(y(!0),f(z,null,q(e.paginationRange,s=>(y(),f("li",{key:s,class:w(["page-item",{active:s===e.currentPage,disabled:e.loading}])},[l("a",{class:"page-link",href:"#",onClick:S(n=>!e.loading&&e.changePage(s),["prevent"])},h(s),9,ue)],2))),128)),l("li",{class:w(["page-item",{disabled:e.currentPage>=e.pagination.last_page||e.loading}])},[l("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=S(s=>!e.loading&&e.changePage(e.currentPage+1),["prevent"]))},a[9]||(a[9]=[l("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):x("",!0)])])])}const be=R(O,[["render",me],["__scopeId","data-v-5eebfc2c"]]);export{be as default};
