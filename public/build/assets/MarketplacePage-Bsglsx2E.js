import{_ as U,c as u,a as e,w as T,v as O,d as W,e as b,A as K,F as R,j as J,b as _,o as d,t as v,n as j,g as N,f as Y,r as y,x as tt,s as $,M as Z,y as et}from"./main-BpaYbEPg.js";import{m as p}from"./marketplaceService-CbDHmkiN.js";import{m as F}from"./modal-ByxZIVwL.js";import{L as at}from"./LoadingSpinner-9sKMkQ1j.js";const nt={name:"SearchFilterBar",props:{poultryTypes:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},initialPoultryType:{type:[String,Number],default:""},initialSortBy:{type:String,default:"newest"},initialMinPrice:{type:[Number,String],default:""},initialMaxPrice:{type:[Number,String],default:""}},data(){return{searchText:this.initialSearchQuery,selectedType:this.initialPoultryType,sortOption:this.initialSortBy,minPrice:this.initialMinPrice,maxPrice:this.initialMaxPrice}},methods:{onSearchInput(){this.$emit("search-input",this.searchText)},onSearchClick(){this.$emit("search-click",this.searchText)},onFilterChange(){this.$emit("filter-change",{poultryType:this.selectedType,sortBy:this.sortOption,minPrice:this.minPrice,maxPrice:this.maxPrice})},resetPriceFilter(){this.minPrice="",this.maxPrice="",this.onFilterChange()}}},rt={class:"card mb-4 search-filter-card"},ot={class:"card-body"},it={class:"row g-3"},st={class:"col-md-6"},lt={class:"input-group"},ct={class:"col-md-6"},dt={class:"d-flex gap-2 justify-content-md-end"},ut=["value"],mt={class:"row mt-3"},gt={class:"col-12"},vt={class:"price-filter-container"},yt={class:"price-filter-header"},pt={class:"price-range-inputs"},ft={class:"price-input-group"},bt={class:"price-input-wrapper"},ht={class:"price-input-group"},Ct={class:"price-input-wrapper"};function _t(m,t,n,a,l,c){return d(),u("div",rt,[e("div",ot,[e("div",it,[e("div",st,[e("div",lt,[T(e("input",{type:"text",class:"form-control",placeholder:"Search products...","onUpdate:modelValue":t[0]||(t[0]=o=>l.searchText=o),onInput:t[1]||(t[1]=(...o)=>c.onSearchInput&&c.onSearchInput(...o))},null,544),[[O,l.searchText]]),e("button",{class:"btn btn-primary",type:"button",onClick:t[2]||(t[2]=W((...o)=>c.onSearchClick&&c.onSearchClick(...o),["prevent"]))},t[13]||(t[13]=[e("i",{class:"fas fa-search"},null,-1),b(" Search ")]))])]),e("div",ct,[e("div",dt,[T(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=o=>l.selectedType=o),onChange:t[4]||(t[4]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))},[t[14]||(t[14]=e("option",{value:""},"All Poultry Types",-1)),(d(!0),u(R,null,J(n.poultryTypes,o=>(d(),u("option",{key:o.poultryID,value:o.poultryID},v(o.poultry_name),9,ut))),128))],544),[[K,l.selectedType]]),T(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=o=>l.sortOption=o),onChange:t[6]||(t[6]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))},t[15]||(t[15]=[e("option",{value:"newest"},"Newest First",-1),e("option",{value:"price_low"},"Price: Low to High",-1),e("option",{value:"price_high"},"Price: High to Low",-1)]),544),[[K,l.sortOption]])])])]),e("div",mt,[e("div",gt,[e("div",vt,[e("div",yt,[t[17]||(t[17]=e("span",{class:"price-filter-label"},"Price Range",-1)),l.minPrice||l.maxPrice?(d(),u("button",{key:0,class:"btn btn-sm btn-link text-secondary p-0 ms-2",onClick:t[7]||(t[7]=(...o)=>c.resetPriceFilter&&c.resetPriceFilter(...o)),title:"Reset price filter"},t[16]||(t[16]=[e("i",{class:"fas fa-undo-alt"},null,-1),b(" Reset ")]))):_("",!0)]),e("div",pt,[e("div",ft,[e("div",bt,[t[18]||(t[18]=e("span",{class:"price-currency"},"$",-1)),T(e("input",{type:"number",class:"form-control price-input",placeholder:"Min","onUpdate:modelValue":t[8]||(t[8]=o=>l.minPrice=o),min:"0",onChange:t[9]||(t[9]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))},null,544),[[O,l.minPrice,void 0,{number:!0}]])])]),t[20]||(t[20]=e("div",{class:"price-range-separator"},[e("span",null,"-")],-1)),e("div",ht,[e("div",Ct,[t[19]||(t[19]=e("span",{class:"price-currency"},"$",-1)),T(e("input",{type:"number",class:"form-control price-input",placeholder:"Max","onUpdate:modelValue":t[10]||(t[10]=o=>l.maxPrice=o),min:"0",onChange:t[11]||(t[11]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))},null,544),[[O,l.maxPrice,void 0,{number:!0}]])])]),e("button",{class:"btn btn-sm btn-outline-primary apply-price-btn",onClick:t[12]||(t[12]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))}," Apply ")])])])])])])}const Pt=U(nt,[["render",_t],["__scopeId","data-v-bc0d9aef"]]),kt={name:"ProductCard",props:{product:{type:Object,required:!0}},methods:{formatPrice(m){return parseFloat(m).toFixed(2)},getStockClass(m){return m<=5?"text-danger":m<=20?"text-warning":"text-success"}}},wt={class:"card h-100 product-card"},xt={class:"product-image-container"},It=["src","alt"],Et={class:"card-body d-flex flex-column"},St=["title"],Tt={class:"card-text product-price mb-2"},Mt={class:"card-text product-measurement mb-2"},Ft={class:"card-text product-stock mb-2"},Dt=["title"],Lt=["title"],qt={class:"mt-auto"};function At(m,t,n,a,l,c){return d(),u("div",wt,[e("div",xt,[e("img",{src:n.product.image||"/images/no-image.jpg",alt:n.product.name,class:"product-image"},null,8,It)]),e("div",Et,[e("h5",{class:"card-title product-title",title:n.product.name},v(n.product.name),9,St),e("p",Tt," RM "+v(c.formatPrice(n.product.price)),1),e("p",Mt,v(n.product.measurement_value)+" "+v(n.product.unit),1),e("p",Ft,[t[1]||(t[1]=e("span",{class:"stock-label"},"Stock:",-1)),e("span",{class:j(c.getStockClass(n.product.quantity))},v(n.product.quantity)+" available ",3)]),e("p",{class:"card-text product-seller mb-2",title:n.product.seller},[t[2]||(t[2]=e("i",{class:"fas fa-store me-1"},null,-1)),b(v(n.product.seller),1)],8,Dt),e("p",{class:"card-text product-location mb-3",title:n.product.location},[t[3]||(t[3]=e("i",{class:"fas fa-map-marker-alt me-1"},null,-1)),b(v(n.product.location),1)],8,Lt),e("div",qt,[e("button",{class:"btn btn-primary w-100",onClick:t[0]||(t[0]=o=>m.$emit("add-to-cart",n.product))},t[4]||(t[4]=[e("i",{class:"fas fa-cart-plus me-1"},null,-1),b(" Add to Cart ")]))])])])}const Nt=U(kt,[["render",At],["__scopeId","data-v-8ee5db1a"]]),Ut={name:"ProductGrid",components:{ProductCard:Nt},props:{products:{type:Array,required:!0},loading:{type:Boolean,default:!1},error:{type:[String,null],default:null}}},Bt={key:0,class:"row g-4"},Vt={key:1,class:"text-center py-5"};function Qt(m,t,n,a,l,c){const o=N("ProductCard");return d(),u("div",null,[!n.loading&&!n.error?(d(),u("div",Bt,[(d(!0),u(R,null,J(n.products,r=>(d(),u("div",{key:r.id,class:"col-sm-6 col-md-4 col-xl-3"},[Y(o,{product:r,onAddToCart:h=>m.$emit("add-to-cart",r)},null,8,["product","onAddToCart"])]))),128))])):_("",!0),!n.loading&&!n.error&&n.products.length===0?(d(),u("div",Vt,t[0]||(t[0]=[e("div",{class:"alert alert-info"}," No products found. Try adjusting your search criteria. ",-1)]))):_("",!0)])}const Ot=U(Ut,[["render",Qt]]),jt={name:"MarketplacePagination",props:{currentPage:{type:Number,required:!0},lastPage:{type:Number,required:!0},from:{type:Number,default:null},to:{type:Number,default:null},total:{type:Number,default:null},itemCount:{type:Number,default:0},loading:{type:Boolean,default:!1}},computed:{paginationRange(){let m=5;window.innerWidth<768?m=3:window.innerWidth<992&&(m=4);let t=1,n=this.lastPage;if(this.lastPage>m){const l=Math.floor(m/2);this.currentPage<=l?n=m:this.currentPage>this.lastPage-l?t=this.lastPage-m+1:(t=this.currentPage-l,n=this.currentPage+l),t=Math.max(1,t),n=Math.min(this.lastPage,n)}const a=[];for(let l=t;l<=n;l++)a.push(l);return a}},methods:{onPageChange(m){m<1||m>this.lastPage||this.loading||this.$emit("page-change",m)}},mounted(){window.addEventListener("resize",this.$forceUpdate)},beforeUnmount(){window.removeEventListener("resize",this.$forceUpdate)}},Rt={class:"pagination-container mt-4"},Jt={class:"pagination-info"},zt={class:"text-muted"},Gt={key:0,"aria-label":"Product pagination",class:"pagination-nav"},Ht={class:"pagination mb-0"},Wt=["onClick"];function Yt(m,t,n,a,l,c){return d(),u("div",Rt,[e("div",Jt,[e("span",zt,"Showing "+v(n.from||1)+"-"+v(n.to||n.itemCount)+" of "+v(n.total||n.itemCount),1)]),n.lastPage>1?(d(),u("nav",Gt,[e("ul",Ht,[e("li",{class:j(["page-item",{disabled:n.currentPage<=1||n.loading}])},[e("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=W(o=>!n.loading&&c.onPageChange(n.currentPage-1),["prevent"]))},t[2]||(t[2]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(d(!0),u(R,null,J(c.paginationRange,o=>(d(),u("li",{key:o,class:j(["page-item",{active:o===n.currentPage,disabled:n.loading,"page-number":!0}])},[e("a",{class:"page-link",href:"#",onClick:W(r=>!n.loading&&c.onPageChange(o),["prevent"])},v(o),9,Wt)],2))),128)),e("li",{class:j(["page-item",{disabled:n.currentPage>=n.lastPage||n.loading}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=W(o=>!n.loading&&c.onPageChange(n.currentPage+1),["prevent"]))},t[3]||(t[3]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])):_("",!0)])}const Kt=U(jt,[["render",Yt],["__scopeId","data-v-d0b3ce19"]]),Xt={name:"CartModal",components:{LoadingSpinner:at},setup(){const m=y(!1),t=y(null),n=y(1),a=y([]),l=y([]),c=y(!1),o=y(!1),r=y(null),h=y(null),f=y([]),P=y(""),w=y(!1),k=y(!1),D=tt(()=>a.value.reduce((i,g)=>i+g.price_at_purchase*g.quantity,0)),E=()=>{const i=document.getElementById("addToCartModal");i&&(r.value=new Z(i),i.addEventListener("hidden.bs.modal",()=>{n.value=1,t.value=null,document.activeElement&&i.contains(document.activeElement)&&document.activeElement.blur()}),i.addEventListener("hide.bs.modal",()=>{document.activeElement&&i.contains(document.activeElement)&&document.activeElement.blur()}));const g=document.getElementById("viewCartModal");g&&(h.value=new Z(g),g.addEventListener("hidden.bs.modal",()=>{document.activeElement&&g.contains(document.activeElement)&&document.activeElement.blur()}),g.addEventListener("hide.bs.modal",()=>{document.activeElement&&g.contains(document.activeElement)&&document.activeElement.blur()}))},L=i=>{t.value=i,n.value=1,r.value||E(),r.value.show()},q=async()=>{try{const i=await p.getCartItems();i&&Array.isArray(i.cart_items)?(a.value=i.cart_items,l.value=JSON.parse(JSON.stringify(i.cart_items))):(a.value=[],l.value=[],console.warn("Cart items data is not in the expected format:",i)),c.value=!1,M(),k.value=!1,h.value||E(),h.value.show()}catch(i){console.error("Error fetching cart items:",i),a.value=[],l.value=[],h.value||E(),h.value.show()}},M=async()=>{w.value=!0;try{const i=await p.fetchUserLocations();console.log("Loaded locations:",i);const g=Array.isArray(i)?i.filter(x=>x.location_type==="kitchen"):[];f.value=g,f.value.length===1&&(P.value=f.value[0].locationID)}catch(i){console.error("Error loading locations:",i),f.value=[]}finally{w.value=!1}};return{selectedProduct:t,quantity:n,cartItems:a,cartTotal:D,isEditing:c,isLoading:o,isProcessingCheckout:m,locations:f,selectedLocationID:P,isLoadingLocations:w,locationError:k,showAddToCartModal:L,showViewCartModal:q,decreaseQuantity:()=>{n.value>1&&n.value--},increaseQuantity:()=>{n.value<99&&n.value++},decreaseCartItemQuantity:i=>{i.quantity>1&&i.quantity--},increaseCartItemQuantity:i=>{i.quantity<99&&i.quantity++},startEditing:()=>{c.value=!0},cancelEditing:()=>{a.value=JSON.parse(JSON.stringify(l.value)),c.value=!1},saveChanges:async()=>{try{o.value=!0;const i=a.value.map(async x=>{const A=l.value.find(H=>H.cartID===x.cartID);if(A&&A.quantity!==x.quantity)try{await p.updateCartItem(x.cartID,x.quantity)}catch(H){throw console.error(`Error updating item ${x.cartID}:`,H),H}});await Promise.all(i);const g=await p.getCartItems();g&&Array.isArray(g.cart_items)&&(a.value=g.cart_items,l.value=JSON.parse(JSON.stringify(g.cart_items))),p.notifyCartUpdate(g),c.value=!1,o.value=!1}catch{o.value=!1}},confirmAddToCart:async()=>{try{if(!t.value){console.error("No product selected");return}if(!n.value||n.value<1){console.error("Invalid quantity:",n.value),F.danger("Error","Please enter a valid quantity.");return}const i=t.value.itemID||t.value.id;if(!i){console.error("Invalid product ID:",t.value),F.danger("Error","Invalid product information. Please try again.");return}const g={...t.value,itemID:i,order_quantity:n.value};console.log("Sending to API:",{itemID:i,order_quantity:n.value});const x=await p.addToCart(g,{suppressErrorModal:!0});r.value.hide();try{const A=await p.getCartItems();p.notifyCartUpdate(A)}catch(A){console.warn("Error refreshing cart count:",A)}p.animateCartButton()}catch(i){if(console.error("Error adding to cart:",i),i.response&&i.response.status===422){const g=i.response.data.errors;if(console.error("Validation errors:",g),g){const x=Object.values(g).flat().join(`
`);F.danger("Validation Error",x)}else F.danger("Error","Failed to add item to cart. Please try again.")}else if(i.response&&i.response.data){const g=i.response.data;F.danger("Error",g.error||g.message||"Failed to add item to cart. Please try again.")}else F.danger("Error","Failed to add item to cart. Please try again.")}},updateCartItem:async i=>{console.log("Direct updateCartItem is deprecated, use saveChanges instead")},removeCartItem:async i=>{try{await p.removeCartItem(i,{suppressErrorModal:!0});const g=await p.getCartItems();a.value=g.cart_items||[],l.value=JSON.parse(JSON.stringify(a.value)),p.notifyCartUpdate(g),c.value=!1,o.value=!1}catch(g){console.error("Error removing cart item:",g),F.danger("Error","Failed to remove item from cart. Please try again.")}},proceedToCheckout:async()=>{try{if(!P.value){k.value=!0;return}k.value=!1,m.value=!0,await p.checkout(P.value)}catch(i){console.error("Checkout error:",i)}finally{m.value=!1}},formatPrice:i=>parseFloat(i).toFixed(2),loadLocations:M}}},Zt={class:"cart-modal-container"},$t={class:"modal fade",id:"addToCartModal",tabindex:"-1"},te={class:"modal-dialog modal-dialog-centered"},ee={class:"modal-content"},ae={class:"modal-body"},ne={key:0,class:"add-to-cart-item"},re=["src","alt"],oe={class:"add-to-cart-details"},ie={class:"add-to-cart-title"},se={class:"add-to-cart-price"},le={class:"add-to-cart-seller"},ce={class:"add-to-cart-location"},de={class:"text-center mt-4"},ue={class:"input-group quantity-input"},me={class:"modal-footer"},ge={class:"modal fade",id:"viewCartModal",tabindex:"-1"},ve={class:"modal-dialog modal-dialog-centered modal-lg"},ye={class:"modal-content"},pe={class:"modal-header"},fe={class:"modal-title"},be={class:"modal-body position-relative"},he={key:1,class:"text-center py-4"},Ce={key:2},_e={class:"d-flex"},Pe=["src","alt"],ke={class:"cart-item-details flex-grow-1"},we={class:"cart-item-title"},xe={class:"cart-item-price"},Ie={class:"cart-item-seller"},Ee={class:"cart-item-location"},Se={class:"d-flex flex-column align-items-end"},Te={class:"input-group cart-item-quantity mb-2"},Me=["onClick","disabled"],Fe=["onUpdate:modelValue","disabled"],De=["onClick","disabled"],Le=["onClick"],qe={class:"cart-total"},Ae={class:"delivery-location mt-4 p-3 border rounded bg-light"},Ne={key:0,class:"text-center py-2"},Ue={key:1,class:"alert alert-warning"},Be={key:2,class:"form-group"},Ve=["value"],Qe={key:0,class:"invalid-feedback"},Oe={class:"modal-footer"},je=["disabled"];function Re(m,t,n,a,l,c){const o=N("loading-spinner");return d(),u("div",Zt,[e("div",$t,[e("div",te,[e("div",ee,[t[13]||(t[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Add to Cart"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",ae,[a.selectedProduct?(d(),u("div",ne,[e("img",{src:a.selectedProduct.image||"/images/no-image.jpg",alt:a.selectedProduct.name,class:"add-to-cart-image"},null,8,re),e("div",oe,[e("h5",ie,v(a.selectedProduct.name),1),e("p",se,"RM "+v(a.formatPrice(a.selectedProduct.price)),1),e("p",le,[t[9]||(t[9]=e("i",{class:"bi bi-shop me-1"},null,-1)),b(v(a.selectedProduct.seller||"Unknown Seller"),1)]),e("p",ce,[t[10]||(t[10]=e("i",{class:"bi bi-geo-alt me-1"},null,-1)),b(v(a.selectedProduct.location||"Unknown Location"),1)])])])):_("",!0),e("div",de,[t[11]||(t[11]=e("label",{for:"quantity-input",class:"form-label"},"Quantity:",-1)),e("div",ue,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[0]||(t[0]=(...r)=>a.decreaseQuantity&&a.decreaseQuantity(...r))},"-"),T(e("input",{type:"number",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=r=>a.quantity=r),min:"1",max:"99"},null,512),[[O,a.quantity,void 0,{number:!0}]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[2]||(t[2]=(...r)=>a.increaseQuantity&&a.increaseQuantity(...r))},"+")])])]),e("div",me,[t[12]||(t[12]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=(...r)=>a.confirmAddToCart&&a.confirmAddToCart(...r)),ref:"addToCartButton"},"Add to Cart",512)])])])]),e("div",ge,[e("div",ve,[e("div",ye,[e("div",pe,[e("h5",fe,"Your Cart ("+v(a.cartItems.length)+" items)",1),t[14]||(t[14]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",be,[a.isLoading?(d(),$(o,{key:0,message:"Saving changes...",size:"lg",overlay:!0})):_("",!0),a.cartItems.length===0?(d(),u("div",he,t[15]||(t[15]=[e("i",{class:"bi bi-cart3",style:{"font-size":"3rem",color:"#ccc"}},null,-1),e("p",{class:"mt-3"},"Your cart is empty",-1)]))):(d(),u("div",Ce,[(d(!0),u(R,null,J(a.cartItems,r=>{var h,f,P,w,k,D,E,L,q,M,B,V,Q;return d(),u("div",{key:r.cartID,class:"cart-item"},[e("div",_e,[e("img",{src:(f=(h=r.item)==null?void 0:h.poultry)!=null&&f.poultry_image?`/storage/${r.item.poultry.poultry_image}`:"/images/no-image.jpg",alt:((w=(P=r.item)==null?void 0:P.poultry)==null?void 0:w.poultry_name)||"Product",class:"cart-item-image"},null,8,Pe),e("div",ke,[e("h6",we,v(((D=(k=r.item)==null?void 0:k.poultry)==null?void 0:D.poultry_name)||"Product")+" ("+v(((E=r.item)==null?void 0:E.measurement_value)||0)+" "+v(((L=r.item)==null?void 0:L.measurement_type)||"units")+")",1),e("p",xe,"RM "+v(a.formatPrice(r.price_at_purchase)),1),e("p",Ie,[t[16]||(t[16]=e("i",{class:"bi bi-shop me-1"},null,-1)),b(v(((B=(M=(q=r.item)==null?void 0:q.user)==null?void 0:M.company)==null?void 0:B.company_name)||"Unknown Seller"),1)]),e("p",Ee,[t[17]||(t[17]=e("i",{class:"bi bi-geo-alt me-1"},null,-1)),b(v(((Q=(V=r.item)==null?void 0:V.location)==null?void 0:Q.company_address)||"Unknown Location"),1)])]),e("div",Se,[e("div",Te,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:S=>a.decreaseCartItemQuantity(r),disabled:!a.isEditing},"-",8,Me),T(e("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":S=>r.quantity=S,min:"1",max:"99",disabled:!a.isEditing},null,8,Fe),[[O,r.quantity,void 0,{number:!0}]]),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:S=>a.increaseCartItemQuantity(r),disabled:!a.isEditing},"+",8,De)]),e("button",{class:"btn btn-sm btn-outline-danger",onClick:S=>a.removeCartItem(r.cartID)},t[18]||(t[18]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Le)])])])}),128)),e("div",qe," Total: RM "+v(a.formatPrice(a.cartTotal)),1),e("div",Ae,[t[23]||(t[23]=e("h6",{class:"mb-3"},[e("i",{class:"bi bi-geo-alt me-2"}),b("Delivery Location")],-1)),a.isLoadingLocations?(d(),u("div",Ne,t[19]||(t[19]=[e("div",{class:"spinner-border spinner-border-sm text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("span",{class:"ms-2"},"Loading locations...",-1)]))):a.locations.length===0?(d(),u("div",Ue,t[20]||(t[20]=[e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1),b(" No delivery locations found. Please add a location in your profile settings. ")]))):(d(),u("div",Be,[t[22]||(t[22]=e("label",{for:"deliveryLocation",class:"form-label"},"Select delivery location:",-1)),T(e("select",{id:"deliveryLocation","onUpdate:modelValue":t[4]||(t[4]=r=>a.selectedLocationID=r),class:j(["form-select",{"is-invalid":a.locationError}])},[t[21]||(t[21]=e("option",{value:"",disabled:"",selected:""},"-- Select a delivery location --",-1)),(d(!0),u(R,null,J(a.locations,r=>(d(),u("option",{key:r.locationID,value:r.locationID},v(r.company_address)+" ("+v(r.location_type)+") ",9,Ve))),128))],2),[[K,a.selectedLocationID]]),a.locationError?(d(),u("div",Qe," Please select a delivery location before checkout ")):_("",!0)]))])])),e("div",Oe,[!a.isEditing&&a.cartItems.length>0?(d(),u("button",{key:0,type:"button",class:"btn btn-outline-secondary me-2",onClick:t[5]||(t[5]=(...r)=>a.startEditing&&a.startEditing(...r))},t[24]||(t[24]=[e("i",{class:"bi bi-pencil me-1"},null,-1),b(" Edit Quantities ")]))):_("",!0),a.isEditing?(d(),u("button",{key:1,class:"btn btn-success me-2",onClick:t[6]||(t[6]=(...r)=>a.saveChanges&&a.saveChanges(...r))},t[25]||(t[25]=[e("i",{class:"bi bi-check-lg me-1"},null,-1),b(" Save Changes ")]))):_("",!0),a.isEditing?(d(),u("button",{key:2,class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...r)=>a.cancelEditing&&a.cancelEditing(...r))},t[26]||(t[26]=[e("i",{class:"bi bi-x-lg me-1"},null,-1),b(" Cancel ")]))):_("",!0),!a.isEditing&&a.cartItems.length>0?(d(),u("button",{key:3,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...r)=>a.proceedToCheckout&&a.proceedToCheckout(...r)),disabled:a.isProcessingCheckout},[t[27]||(t[27]=e("i",{class:"bi bi-credit-card me-1"},null,-1)),b(" "+v(a.isProcessingCheckout?"Processing...":"Proceed to Checkout"),1)],8,je)):_("",!0)])])])])])])}const Je=U(Xt,[["render",Re],["__scopeId","data-v-a2dd63e9"]]),ze={name:"MarketplacePage",components:{SearchFilterBar:Pt,ProductGrid:Ot,MarketplacePagination:Kt,CartModal:Je},setup(){const m=y([]),t=y([]),n=y(!0),a=y(null),l=y(""),c=y(""),o=y("newest"),r=y(0),h=y({current_page:1,last_page:1,from:1,to:0,total:0}),f=y(null),P=y(""),w=y(""),k=async(s=1)=>{try{n.value=!0,a.value=null;const G={page:parseInt(s)||1,search:l.value||null,poultry_type:c.value||null,sort:o.value||"newest",min_price:P.value||null,max_price:w.value||null},I=await p.fetchItems(G);I&&I.data?(m.value=I.data,h.value=I.pagination||{current_page:1,last_page:1,from:1,to:I.data.length,total:I.data.length}):(m.value=[],a.value="Unexpected response format")}catch(C){console.error("Error fetching items:",C),a.value="Failed to load products. Please try again later.",m.value=[]}finally{n.value=!1}},D=async()=>{try{t.value=await p.fetchPoultryTypes()}catch(s){console.error("Error fetching poultry types:",s)}},E=s=>{l.value=s},L=()=>{k(1)},q=({poultryType:s,sortBy:C,minPrice:G,maxPrice:I})=>{c.value=s,o.value=C,P.value=G,w.value=I,k(1)},M=s=>{s<1||s>h.value.last_page||n.value||k(s)},B=s=>{console.log("View details for product:",s)},V=s=>{if(s.quantity<=0){modal.warning("Out of Stock","This item is currently out of stock.");return}f.value?f.value.showAddToCartModal(s):p.addToCart(s).then(()=>{S()}).catch(C=>{console.error("Error adding to cart:",C)})},Q=()=>{f.value?(f.value.showViewCartModal(),S()):p.viewCart()},S=async()=>{try{const s=await p.getCartItems();z(s)}catch(s){console.error("Error refreshing cart count:",s)}},z=s=>{console.log("Updating cart badge with data:",s);let C=0;s&&s.cart_items&&Array.isArray(s.cart_items)?(C=s.cart_items.length,console.log("Cart badge updated with unique item count:",C)):s&&s.cart_item?(C=1,console.log("Cart badge updated for first item added:",C)):s&&typeof s.cart_count=="number"&&(C=s.cart_count,console.log("Cart badge updated with cart_count fallback:",C)),r.value=C||0},X=async()=>{try{const s=await p.getCartItems();z(s)}catch(s){console.error("Error initializing cart badge:",s),r.value=0}};return p.onCartUpdate(s=>{console.log("Cart update received in marketplace page:",s),z(s)}),et(()=>{k(),D(),X()}),{products:m,poultryTypes:t,loading:n,error:a,searchQuery:l,selectedPoultryType:c,sortBy:o,minPrice:P,maxPrice:w,pagination:h,cartModal:f,cartItemCount:r,handleSearch:E,handleSearchClick:L,handleFilters:q,changePage:M,viewProductDetails:B,addToCart:V,viewCart:Q}}},Ge={class:"marketplace-page"},He={class:"d-flex justify-content-between align-items-center mb-4"},We={class:"cart-badge"},Ye={key:0,class:"text-center py-5"},Ke={key:1,class:"alert alert-danger",role:"alert"};function Xe(m,t,n,a,l,c){const o=N("SearchFilterBar"),r=N("ProductGrid"),h=N("MarketplacePagination"),f=N("CartModal");return d(),u("div",Ge,[e("div",He,[t[3]||(t[3]=e("h1",{class:"mb-0"},"Marketplace",-1)),e("button",{class:"btn btn-primary cart-button",onClick:t[0]||(t[0]=(...P)=>a.viewCart&&a.viewCart(...P))},[t[1]||(t[1]=e("i",{class:"fas fa-shopping-cart me-2"},null,-1)),t[2]||(t[2]=b(" View Cart ")),e("span",We,v(a.cartItemCount),1)])]),Y(o,{"poultry-types":a.poultryTypes,"initial-search-query":a.searchQuery,"initial-poultry-type":a.selectedPoultryType,"initial-sort-by":a.sortBy,"initial-min-price":a.minPrice,"initial-max-price":a.maxPrice,onSearchInput:a.handleSearch,onSearchClick:a.handleSearchClick,onFilterChange:a.handleFilters},null,8,["poultry-types","initial-search-query","initial-poultry-type","initial-sort-by","initial-min-price","initial-max-price","onSearchInput","onSearchClick","onFilterChange"]),a.loading?(d(),u("div",Ye,t[4]||(t[4]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):_("",!0),a.error?(d(),u("div",Ke,v(a.error),1)):_("",!0),Y(r,{products:a.products,loading:a.loading,error:a.error,onViewDetails:a.viewProductDetails,onAddToCart:a.addToCart},null,8,["products","loading","error","onViewDetails","onAddToCart"]),!a.loading&&!a.error&&a.products.length>0?(d(),$(h,{key:2,"current-page":a.pagination.current_page,"last-page":a.pagination.last_page,from:a.pagination.from,to:a.pagination.to,total:a.pagination.total,"item-count":a.products.length,onPageChange:a.changePage},null,8,["current-page","last-page","from","to","total","item-count","onPageChange"])):_("",!0),Y(f,{id:"cart-modal-component",ref:"cartModal"},null,512)])}const ra=U(ze,[["render",Xe],["__scopeId","data-v-d35d073e"]]);export{ra as default};
