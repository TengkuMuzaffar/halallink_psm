import{_ as N,c as u,a as e,w as T,v as O,d as Y,e as h,y as W,F as R,i as J,b as _,o as d,t as g,n as j,g as A,f as K,r as v,j as tt,A as $,M as Z,k as et}from"./main-6HkEK7r2.js";import{m as p}from"./marketplaceService-Sfc_2ZME.js";import{m as D}from"./modal-BXblql9Y.js";import{L as at}from"./LoadingSpinner-TtFArfCL.js";const nt={name:"SearchFilterBar",props:{poultryTypes:{type:Array,default:()=>[]},initialSearchQuery:{type:String,default:""},initialPoultryType:{type:[String,Number],default:""},initialSortBy:{type:String,default:"newest"},initialMinPrice:{type:[Number,String],default:""},initialMaxPrice:{type:[Number,String],default:""}},data(){return{searchText:this.initialSearchQuery,selectedType:this.initialPoultryType,sortOption:this.initialSortBy,minPrice:this.initialMinPrice,maxPrice:this.initialMaxPrice}},methods:{onSearchInput(){this.$emit("search-input",this.searchText)},onSearchClick(){this.$emit("search-click",this.searchText)},onFilterChange(){this.$emit("filter-change",{poultryType:this.selectedType,sortBy:this.sortOption,minPrice:this.minPrice,maxPrice:this.maxPrice})},resetPriceFilter(){this.minPrice="",this.maxPrice="",this.onFilterChange()}}},rt={class:"card mb-4 search-filter-card"},ot={class:"card-body"},it={class:"row g-3"},st={class:"col-md-6"},lt={class:"input-group"},ct={class:"col-md-6"},dt={class:"d-flex gap-2 justify-content-md-end"},ut=["value"],mt={class:"row mt-3"},gt={class:"col-12"},yt={class:"price-filter-container"},vt={class:"price-filter-header"},pt={class:"price-range-inputs"},ft={class:"price-input-group"},bt={class:"price-input-wrapper"},ht={class:"price-input-group"},Ct={class:"price-input-wrapper"};function _t(y,t,n,a,l,c){return d(),u("div",rt,[e("div",ot,[e("div",it,[e("div",st,[e("div",lt,[T(e("input",{type:"text",class:"form-control",placeholder:"Search products...","onUpdate:modelValue":t[0]||(t[0]=o=>l.searchText=o),onInput:t[1]||(t[1]=(...o)=>c.onSearchInput&&c.onSearchInput(...o))},null,544),[[O,l.searchText]]),e("button",{class:"btn btn-primary",type:"button",onClick:t[2]||(t[2]=Y((...o)=>c.onSearchClick&&c.onSearchClick(...o),["prevent"]))},t[13]||(t[13]=[e("i",{class:"fas fa-search"},null,-1),h(" Search ")]))])]),e("div",ct,[e("div",dt,[T(e("select",{class:"form-select","onUpdate:modelValue":t[3]||(t[3]=o=>l.selectedType=o),onChange:t[4]||(t[4]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))},[t[14]||(t[14]=e("option",{value:""},"All Poultry Types",-1)),(d(!0),u(R,null,J(n.poultryTypes,o=>(d(),u("option",{key:o.poultryID,value:o.poultryID},g(o.poultry_name),9,ut))),128))],544),[[W,l.selectedType]]),T(e("select",{class:"form-select","onUpdate:modelValue":t[5]||(t[5]=o=>l.sortOption=o),onChange:t[6]||(t[6]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))},t[15]||(t[15]=[e("option",{value:"newest"},"Newest First",-1),e("option",{value:"price_low"},"Price: Low to High",-1),e("option",{value:"price_high"},"Price: High to Low",-1)]),544),[[W,l.sortOption]])])])]),e("div",mt,[e("div",gt,[e("div",yt,[e("div",vt,[t[17]||(t[17]=e("span",{class:"price-filter-label"},"Price Range",-1)),l.minPrice||l.maxPrice?(d(),u("button",{key:0,class:"btn btn-sm btn-link text-secondary p-0 ms-2",onClick:t[7]||(t[7]=(...o)=>c.resetPriceFilter&&c.resetPriceFilter(...o)),title:"Reset price filter"},t[16]||(t[16]=[e("i",{class:"fas fa-undo-alt"},null,-1),h(" Reset ")]))):_("",!0)]),e("div",pt,[e("div",ft,[e("div",bt,[t[18]||(t[18]=e("span",{class:"price-currency"},"$",-1)),T(e("input",{type:"number",class:"form-control price-input",placeholder:"Min","onUpdate:modelValue":t[8]||(t[8]=o=>l.minPrice=o),min:"0",onChange:t[9]||(t[9]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))},null,544),[[O,l.minPrice,void 0,{number:!0}]])])]),t[20]||(t[20]=e("div",{class:"price-range-separator"},[e("span",null,"-")],-1)),e("div",ht,[e("div",Ct,[t[19]||(t[19]=e("span",{class:"price-currency"},"$",-1)),T(e("input",{type:"number",class:"form-control price-input",placeholder:"Max","onUpdate:modelValue":t[10]||(t[10]=o=>l.maxPrice=o),min:"0",onChange:t[11]||(t[11]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))},null,544),[[O,l.maxPrice,void 0,{number:!0}]])])]),e("button",{class:"btn btn-sm btn-outline-primary apply-price-btn",onClick:t[12]||(t[12]=(...o)=>c.onFilterChange&&c.onFilterChange(...o))}," Apply ")])])])])])])}const Pt=N(nt,[["render",_t],["__scopeId","data-v-bc0d9aef"]]),kt={name:"ProductCard",props:{product:{type:Object,required:!0}},methods:{formatPrice(y){return parseFloat(y).toFixed(2)},getStockClass(y){return y<=5?"text-danger":y<=20?"text-warning":"text-success"}}},wt={class:"card h-100 product-card"},xt={class:"product-image-container"},It=["src","alt"],Et={class:"card-body d-flex flex-column"},St=["title"],Tt={class:"card-text product-price mb-2"},Mt={class:"card-text product-measurement mb-2"},Dt={class:"card-text product-stock mb-2"},Ft=["title"],Lt=["title"],qt={class:"mt-auto"};function Vt(y,t,n,a,l,c){return d(),u("div",wt,[e("div",xt,[e("img",{src:n.product.image||"/images/no-image.jpg",alt:n.product.name,class:"product-image"},null,8,It)]),e("div",Et,[e("h5",{class:"card-title product-title",title:n.product.name},g(n.product.name),9,St),e("p",Tt," RM "+g(c.formatPrice(n.product.price)),1),e("p",Mt,g(n.product.measurement_value)+" "+g(n.product.unit),1),e("p",Dt,[t[2]||(t[2]=e("span",{class:"stock-label"},"Stock:",-1)),e("span",{class:j(c.getStockClass(n.product.quantity))},g(n.product.quantity)+" available ",3)]),e("p",{class:"card-text product-seller mb-2",title:n.product.seller},[t[3]||(t[3]=e("i",{class:"fas fa-store me-1"},null,-1)),h(g(n.product.seller),1)],8,Ft),e("p",{class:"card-text product-location mb-3",title:n.product.location},[t[4]||(t[4]=e("i",{class:"fas fa-map-marker-alt me-1"},null,-1)),h(g(n.product.location),1)],8,Lt),e("div",qt,[e("button",{class:"btn btn-primary w-100 mb-2",onClick:t[0]||(t[0]=o=>y.$emit("view-details",n.product))}," View Details "),e("button",{class:"btn btn-outline-primary w-100",onClick:t[1]||(t[1]=o=>y.$emit("add-to-cart",n.product))},t[5]||(t[5]=[e("i",{class:"fas fa-cart-plus me-1"},null,-1),h(" Add to Cart ")]))])])])}const At=N(kt,[["render",Vt],["__scopeId","data-v-1c9f0b03"]]),Nt={name:"ProductGrid",components:{ProductCard:At},props:{products:{type:Array,required:!0},loading:{type:Boolean,default:!1},error:{type:[String,null],default:null}}},Bt={key:0,class:"row g-4"},Qt={key:1,class:"text-center py-5"};function Ut(y,t,n,a,l,c){const o=A("ProductCard");return d(),u("div",null,[!n.loading&&!n.error?(d(),u("div",Bt,[(d(!0),u(R,null,J(n.products,r=>(d(),u("div",{key:r.id,class:"col-sm-6 col-md-4 col-xl-3"},[K(o,{product:r,onViewDetails:f=>y.$emit("view-details",r),onAddToCart:f=>y.$emit("add-to-cart",r)},null,8,["product","onViewDetails","onAddToCart"])]))),128))])):_("",!0),!n.loading&&!n.error&&n.products.length===0?(d(),u("div",Qt,t[0]||(t[0]=[e("div",{class:"alert alert-info"}," No products found. Try adjusting your search criteria. ",-1)]))):_("",!0)])}const Ot=N(Nt,[["render",Ut]]),jt={name:"MarketplacePagination",props:{currentPage:{type:Number,required:!0},lastPage:{type:Number,required:!0},from:{type:Number,default:null},to:{type:Number,default:null},total:{type:Number,default:null},itemCount:{type:Number,default:0},loading:{type:Boolean,default:!1}},computed:{paginationRange(){let t=1,n=this.lastPage;if(this.lastPage>5){const l=Math.floor(2.5);this.currentPage<=l?n=5:this.currentPage>this.lastPage-l?t=this.lastPage-5+1:(t=this.currentPage-l,n=this.currentPage+l),t=Math.max(1,t),n=Math.min(this.lastPage,n)}const a=[];for(let l=t;l<=n;l++)a.push(l);return a}},methods:{onPageChange(y){y<1||y>this.lastPage||this.loading||this.$emit("page-change",y)}}},Rt={class:"d-flex justify-content-between align-items-center mt-4"},Jt={class:"text-muted"},zt={key:0,"aria-label":"Product pagination"},Gt={class:"pagination mb-0"},Ht=["onClick"];function Yt(y,t,n,a,l,c){return d(),u("div",Rt,[e("div",null,[e("span",Jt,"Showing "+g(n.from||1)+"-"+g(n.to||n.itemCount)+" of "+g(n.total||n.itemCount),1)]),n.lastPage>1?(d(),u("nav",zt,[e("ul",Gt,[e("li",{class:j(["page-item",{disabled:n.currentPage<=1||n.loading}])},[e("a",{class:"page-link",href:"#",onClick:t[0]||(t[0]=Y(o=>!n.loading&&c.onPageChange(n.currentPage-1),["prevent"]))},t[2]||(t[2]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(d(!0),u(R,null,J(c.paginationRange,o=>(d(),u("li",{key:o,class:j(["page-item",{active:o===n.currentPage,disabled:n.loading}])},[e("a",{class:"page-link",href:"#",onClick:Y(r=>!n.loading&&c.onPageChange(o),["prevent"])},g(o),9,Ht)],2))),128)),e("li",{class:j(["page-item",{disabled:n.currentPage>=n.lastPage||n.loading}])},[e("a",{class:"page-link",href:"#",onClick:t[1]||(t[1]=Y(o=>!n.loading&&c.onPageChange(n.currentPage+1),["prevent"]))},t[3]||(t[3]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])):_("",!0)])}const Kt=N(jt,[["render",Yt],["__scopeId","data-v-a00d3c79"]]),Wt={name:"CartModal",components:{LoadingSpinner:at},setup(){const y=v(!1),t=v(null),n=v(1),a=v([]),l=v([]),c=v(!1),o=v(!1),r=v(null),f=v(null),b=v([]),P=v(""),w=v(!1),k=v(!1),F=tt(()=>a.value.reduce((i,m)=>i+m.price_at_purchase*m.quantity,0)),E=()=>{const i=document.getElementById("addToCartModal");i&&(r.value=new Z(i),i.addEventListener("hidden.bs.modal",()=>{n.value=1,t.value=null,document.activeElement&&i.contains(document.activeElement)&&document.activeElement.blur()}),i.addEventListener("hide.bs.modal",()=>{document.activeElement&&i.contains(document.activeElement)&&document.activeElement.blur()}));const m=document.getElementById("viewCartModal");m&&(f.value=new Z(m),m.addEventListener("hidden.bs.modal",()=>{document.activeElement&&m.contains(document.activeElement)&&document.activeElement.blur()}),m.addEventListener("hide.bs.modal",()=>{document.activeElement&&m.contains(document.activeElement)&&document.activeElement.blur()}))},L=i=>{t.value=i,n.value=1,r.value||E(),r.value.show()},q=async()=>{try{const i=await p.getCartItems();i&&Array.isArray(i.cart_items)?(a.value=i.cart_items,l.value=JSON.parse(JSON.stringify(i.cart_items))):(a.value=[],l.value=[],console.warn("Cart items data is not in the expected format:",i)),c.value=!1,M(),k.value=!1,f.value||E(),f.value.show()}catch(i){console.error("Error fetching cart items:",i),a.value=[],l.value=[],f.value||E(),f.value.show()}},M=async()=>{w.value=!0;try{const i=await p.fetchUserLocations();console.log("Loaded locations:",i);const m=Array.isArray(i)?i.filter(x=>x.location_type==="kitchen"):[];b.value=m,b.value.length===1&&(P.value=b.value[0].locationID)}catch(i){console.error("Error loading locations:",i),b.value=[]}finally{w.value=!1}};return{selectedProduct:t,quantity:n,cartItems:a,cartTotal:F,isEditing:c,isLoading:o,isProcessingCheckout:y,locations:b,selectedLocationID:P,isLoadingLocations:w,locationError:k,showAddToCartModal:L,showViewCartModal:q,decreaseQuantity:()=>{n.value>1&&n.value--},increaseQuantity:()=>{n.value<99&&n.value++},decreaseCartItemQuantity:i=>{i.quantity>1&&i.quantity--},increaseCartItemQuantity:i=>{i.quantity<99&&i.quantity++},startEditing:()=>{c.value=!0},cancelEditing:()=>{a.value=JSON.parse(JSON.stringify(l.value)),c.value=!1},saveChanges:async()=>{try{o.value=!0;const i=a.value.map(async x=>{const V=l.value.find(H=>H.cartID===x.cartID);if(V&&V.quantity!==x.quantity)try{await p.updateCartItem(x.cartID,x.quantity)}catch(H){throw console.error(`Error updating item ${x.cartID}:`,H),H}});await Promise.all(i);const m=await p.getCartItems();m&&Array.isArray(m.cart_items)&&(a.value=m.cart_items,l.value=JSON.parse(JSON.stringify(m.cart_items))),p.notifyCartUpdate(m),c.value=!1,o.value=!1}catch{o.value=!1}},confirmAddToCart:async()=>{try{if(!t.value){console.error("No product selected");return}if(!n.value||n.value<1){console.error("Invalid quantity:",n.value),D.danger("Error","Please enter a valid quantity.");return}const i=t.value.itemID||t.value.id;if(!i){console.error("Invalid product ID:",t.value),D.danger("Error","Invalid product information. Please try again.");return}const m={...t.value,itemID:i,order_quantity:n.value};console.log("Sending to API:",{itemID:i,order_quantity:n.value});const x=await p.addToCart(m,{suppressErrorModal:!0});r.value.hide();try{const V=await p.getCartItems();p.notifyCartUpdate(V)}catch(V){console.warn("Error refreshing cart count:",V)}p.animateCartButton()}catch(i){if(console.error("Error adding to cart:",i),i.response&&i.response.status===422){const m=i.response.data.errors;if(console.error("Validation errors:",m),m){const x=Object.values(m).flat().join(`
`);D.danger("Validation Error",x)}else D.danger("Error","Failed to add item to cart. Please try again.")}else if(i.response&&i.response.data){const m=i.response.data;D.danger("Error",m.error||m.message||"Failed to add item to cart. Please try again.")}else D.danger("Error","Failed to add item to cart. Please try again.")}},updateCartItem:async i=>{console.log("Direct updateCartItem is deprecated, use saveChanges instead")},removeCartItem:async i=>{try{await p.removeCartItem(i,{suppressErrorModal:!0});const m=await p.getCartItems();a.value=m.cart_items||[],l.value=JSON.parse(JSON.stringify(a.value)),p.notifyCartUpdate(m),c.value=!1,o.value=!1}catch(m){console.error("Error removing cart item:",m),D.danger("Error","Failed to remove item from cart. Please try again.")}},proceedToCheckout:async()=>{try{if(!P.value){k.value=!0;return}k.value=!1,y.value=!0,await p.checkout(P.value)}catch(i){console.error("Checkout error:",i)}finally{y.value=!1}},formatPrice:i=>parseFloat(i).toFixed(2),loadLocations:M}}},Xt={class:"cart-modal-container"},Zt={class:"modal fade",id:"addToCartModal",tabindex:"-1"},$t={class:"modal-dialog modal-dialog-centered"},te={class:"modal-content"},ee={class:"modal-body"},ae={key:0,class:"add-to-cart-item"},ne=["src","alt"],re={class:"add-to-cart-details"},oe={class:"add-to-cart-title"},ie={class:"add-to-cart-price"},se={class:"add-to-cart-seller"},le={class:"add-to-cart-location"},ce={class:"text-center mt-4"},de={class:"input-group quantity-input"},ue={class:"modal-footer"},me={class:"modal fade",id:"viewCartModal",tabindex:"-1"},ge={class:"modal-dialog modal-dialog-centered modal-lg"},ye={class:"modal-content"},ve={class:"modal-header"},pe={class:"modal-title"},fe={class:"modal-body position-relative"},be={key:1,class:"text-center py-4"},he={key:2},Ce={class:"d-flex"},_e=["src","alt"],Pe={class:"cart-item-details flex-grow-1"},ke={class:"cart-item-title"},we={class:"cart-item-price"},xe={class:"cart-item-seller"},Ie={class:"cart-item-location"},Ee={class:"d-flex flex-column align-items-end"},Se={class:"input-group cart-item-quantity mb-2"},Te=["onClick","disabled"],Me=["onUpdate:modelValue","disabled"],De=["onClick","disabled"],Fe=["onClick"],Le={class:"cart-total"},qe={class:"delivery-location mt-4 p-3 border rounded bg-light"},Ve={key:0,class:"text-center py-2"},Ae={key:1,class:"alert alert-warning"},Ne={key:2,class:"form-group"},Be=["value"],Qe={key:0,class:"invalid-feedback"},Ue={class:"modal-footer"},Oe=["disabled"];function je(y,t,n,a,l,c){const o=A("loading-spinner");return d(),u("div",Xt,[e("div",Zt,[e("div",$t,[e("div",te,[t[13]||(t[13]=e("div",{class:"modal-header"},[e("h5",{class:"modal-title"},"Add to Cart"),e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),e("div",ee,[a.selectedProduct?(d(),u("div",ae,[e("img",{src:a.selectedProduct.image||"/images/no-image.jpg",alt:a.selectedProduct.name,class:"add-to-cart-image"},null,8,ne),e("div",re,[e("h5",oe,g(a.selectedProduct.name),1),e("p",ie,"RM "+g(a.formatPrice(a.selectedProduct.price)),1),e("p",se,[t[9]||(t[9]=e("i",{class:"bi bi-shop me-1"},null,-1)),h(g(a.selectedProduct.seller||"Unknown Seller"),1)]),e("p",le,[t[10]||(t[10]=e("i",{class:"bi bi-geo-alt me-1"},null,-1)),h(g(a.selectedProduct.location||"Unknown Location"),1)])])])):_("",!0),e("div",ce,[t[11]||(t[11]=e("label",{for:"quantity-input",class:"form-label"},"Quantity:",-1)),e("div",de,[e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[0]||(t[0]=(...r)=>a.decreaseQuantity&&a.decreaseQuantity(...r))},"-"),T(e("input",{type:"number",class:"form-control","onUpdate:modelValue":t[1]||(t[1]=r=>a.quantity=r),min:"1",max:"99"},null,512),[[O,a.quantity,void 0,{number:!0}]]),e("button",{class:"btn btn-outline-secondary",type:"button",onClick:t[2]||(t[2]=(...r)=>a.increaseQuantity&&a.increaseQuantity(...r))},"+")])])]),e("div",ue,[t[12]||(t[12]=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),e("button",{type:"button",class:"btn btn-primary",onClick:t[3]||(t[3]=(...r)=>a.confirmAddToCart&&a.confirmAddToCart(...r)),ref:"addToCartButton"},"Add to Cart",512)])])])]),e("div",me,[e("div",ge,[e("div",ye,[e("div",ve,[e("h5",pe,"Your Cart ("+g(a.cartItems.length)+" items)",1),t[14]||(t[14]=e("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),e("div",fe,[a.isLoading?(d(),$(o,{key:0,message:"Saving changes...",size:"lg",overlay:!0})):_("",!0),a.cartItems.length===0?(d(),u("div",be,t[15]||(t[15]=[e("i",{class:"bi bi-cart3",style:{"font-size":"3rem",color:"#ccc"}},null,-1),e("p",{class:"mt-3"},"Your cart is empty",-1)]))):(d(),u("div",he,[(d(!0),u(R,null,J(a.cartItems,r=>{var f,b,P,w,k,F,E,L,q,M,B,Q,U;return d(),u("div",{key:r.cartID,class:"cart-item"},[e("div",Ce,[e("img",{src:(b=(f=r.item)==null?void 0:f.poultry)!=null&&b.poultry_image?`/storage/${r.item.poultry.poultry_image}`:"/images/no-image.jpg",alt:((w=(P=r.item)==null?void 0:P.poultry)==null?void 0:w.poultry_name)||"Product",class:"cart-item-image"},null,8,_e),e("div",Pe,[e("h6",ke,g(((F=(k=r.item)==null?void 0:k.poultry)==null?void 0:F.poultry_name)||"Product")+" ("+g(((E=r.item)==null?void 0:E.measurement_value)||0)+" "+g(((L=r.item)==null?void 0:L.measurement_type)||"units")+")",1),e("p",we,"RM "+g(a.formatPrice(r.price_at_purchase)),1),e("p",xe,[t[16]||(t[16]=e("i",{class:"bi bi-shop me-1"},null,-1)),h(g(((B=(M=(q=r.item)==null?void 0:q.user)==null?void 0:M.company)==null?void 0:B.company_name)||"Unknown Seller"),1)]),e("p",Ie,[t[17]||(t[17]=e("i",{class:"bi bi-geo-alt me-1"},null,-1)),h(g(((U=(Q=r.item)==null?void 0:Q.location)==null?void 0:U.company_address)||"Unknown Location"),1)])]),e("div",Ee,[e("div",Se,[e("button",{class:"btn btn-sm btn-outline-secondary",onClick:S=>a.decreaseCartItemQuantity(r),disabled:!a.isEditing},"-",8,Te),T(e("input",{type:"number",class:"form-control form-control-sm","onUpdate:modelValue":S=>r.quantity=S,min:"1",max:"99",disabled:!a.isEditing},null,8,Me),[[O,r.quantity,void 0,{number:!0}]]),e("button",{class:"btn btn-sm btn-outline-secondary",onClick:S=>a.increaseCartItemQuantity(r),disabled:!a.isEditing},"+",8,De)]),e("button",{class:"btn btn-sm btn-outline-danger",onClick:S=>a.removeCartItem(r.cartID)},t[18]||(t[18]=[e("i",{class:"bi bi-trash"},null,-1)]),8,Fe)])])])}),128)),e("div",Le," Total: RM "+g(a.formatPrice(a.cartTotal)),1),e("div",qe,[t[23]||(t[23]=e("h6",{class:"mb-3"},[e("i",{class:"bi bi-geo-alt me-2"}),h("Delivery Location")],-1)),a.isLoadingLocations?(d(),u("div",Ve,t[19]||(t[19]=[e("div",{class:"spinner-border spinner-border-sm text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1),e("span",{class:"ms-2"},"Loading locations...",-1)]))):a.locations.length===0?(d(),u("div",Ae,t[20]||(t[20]=[e("i",{class:"bi bi-exclamation-triangle me-2"},null,-1),h(" No delivery locations found. Please add a location in your profile settings. ")]))):(d(),u("div",Ne,[t[22]||(t[22]=e("label",{for:"deliveryLocation",class:"form-label"},"Select delivery location:",-1)),T(e("select",{id:"deliveryLocation","onUpdate:modelValue":t[4]||(t[4]=r=>a.selectedLocationID=r),class:j(["form-select",{"is-invalid":a.locationError}])},[t[21]||(t[21]=e("option",{value:"",disabled:"",selected:""},"-- Select a delivery location --",-1)),(d(!0),u(R,null,J(a.locations,r=>(d(),u("option",{key:r.locationID,value:r.locationID},g(r.company_address)+" ("+g(r.location_type)+") ",9,Be))),128))],2),[[W,a.selectedLocationID]]),a.locationError?(d(),u("div",Qe," Please select a delivery location before checkout ")):_("",!0)]))])])),e("div",Ue,[!a.isEditing&&a.cartItems.length>0?(d(),u("button",{key:0,type:"button",class:"btn btn-outline-secondary me-2",onClick:t[5]||(t[5]=(...r)=>a.startEditing&&a.startEditing(...r))},t[24]||(t[24]=[e("i",{class:"bi bi-pencil me-1"},null,-1),h(" Edit Quantities ")]))):_("",!0),a.isEditing?(d(),u("button",{key:1,class:"btn btn-success me-2",onClick:t[6]||(t[6]=(...r)=>a.saveChanges&&a.saveChanges(...r))},t[25]||(t[25]=[e("i",{class:"bi bi-check-lg me-1"},null,-1),h(" Save Changes ")]))):_("",!0),a.isEditing?(d(),u("button",{key:2,class:"btn btn-outline-secondary",onClick:t[7]||(t[7]=(...r)=>a.cancelEditing&&a.cancelEditing(...r))},t[26]||(t[26]=[e("i",{class:"bi bi-x-lg me-1"},null,-1),h(" Cancel ")]))):_("",!0),!a.isEditing&&a.cartItems.length>0?(d(),u("button",{key:3,type:"button",class:"btn btn-primary",onClick:t[8]||(t[8]=(...r)=>a.proceedToCheckout&&a.proceedToCheckout(...r)),disabled:a.isProcessingCheckout},[t[27]||(t[27]=e("i",{class:"bi bi-credit-card me-1"},null,-1)),h(" "+g(a.isProcessingCheckout?"Processing...":"Proceed to Checkout"),1)],8,Oe)):_("",!0)])])])])])])}const Re=N(Wt,[["render",je],["__scopeId","data-v-a2dd63e9"]]),Je={name:"MarketplacePage",components:{SearchFilterBar:Pt,ProductGrid:Ot,MarketplacePagination:Kt,CartModal:Re},setup(){const y=v([]),t=v([]),n=v(!0),a=v(null),l=v(""),c=v(""),o=v("newest"),r=v(0),f=v({current_page:1,last_page:1,from:1,to:0,total:0}),b=v(null),P=v(""),w=v(""),k=async(s=1)=>{try{n.value=!0,a.value=null;const G={page:parseInt(s)||1,search:l.value||null,poultry_type:c.value||null,sort:o.value||"newest",min_price:P.value||null,max_price:w.value||null},I=await p.fetchItems(G);I&&I.data?(y.value=I.data,f.value=I.pagination||{current_page:1,last_page:1,from:1,to:I.data.length,total:I.data.length}):(y.value=[],a.value="Unexpected response format")}catch(C){console.error("Error fetching items:",C),a.value="Failed to load products. Please try again later.",y.value=[]}finally{n.value=!1}},F=async()=>{try{t.value=await p.fetchPoultryTypes()}catch(s){console.error("Error fetching poultry types:",s)}},E=s=>{l.value=s},L=()=>{k(1)},q=({poultryType:s,sortBy:C,minPrice:G,maxPrice:I})=>{c.value=s,o.value=C,P.value=G,w.value=I,k(1)},M=s=>{s<1||s>f.value.last_page||n.value||k(s)},B=s=>{console.log("View details for product:",s)},Q=s=>{if(s.quantity<=0){modal.warning("Out of Stock","This item is currently out of stock.");return}b.value?b.value.showAddToCartModal(s):p.addToCart(s).then(()=>{S()}).catch(C=>{console.error("Error adding to cart:",C)})},U=()=>{b.value?(b.value.showViewCartModal(),S()):p.viewCart()},S=async()=>{try{const s=await p.getCartItems();z(s)}catch(s){console.error("Error refreshing cart count:",s)}},z=s=>{console.log("Updating cart badge with data:",s);let C=0;s&&s.cart_items&&Array.isArray(s.cart_items)?(C=s.cart_items.length,console.log("Cart badge updated with unique item count:",C)):s&&s.cart_item?(C=1,console.log("Cart badge updated for first item added:",C)):s&&typeof s.cart_count=="number"&&(C=s.cart_count,console.log("Cart badge updated with cart_count fallback:",C)),r.value=C||0},X=async()=>{try{const s=await p.getCartItems();z(s)}catch(s){console.error("Error initializing cart badge:",s),r.value=0}};return p.onCartUpdate(s=>{console.log("Cart update received in marketplace page:",s),z(s)}),et(()=>{k(),F(),X()}),{products:y,poultryTypes:t,loading:n,error:a,searchQuery:l,selectedPoultryType:c,sortBy:o,minPrice:P,maxPrice:w,pagination:f,cartModal:b,cartItemCount:r,handleSearch:E,handleSearchClick:L,handleFilters:q,changePage:M,viewProductDetails:B,addToCart:Q,viewCart:U}}},ze={class:"marketplace-page"},Ge={class:"d-flex justify-content-between align-items-center mb-4"},He={class:"cart-badge"},Ye={key:0,class:"text-center py-5"},Ke={key:1,class:"alert alert-danger",role:"alert"};function We(y,t,n,a,l,c){const o=A("SearchFilterBar"),r=A("ProductGrid"),f=A("MarketplacePagination"),b=A("CartModal");return d(),u("div",ze,[e("div",Ge,[t[3]||(t[3]=e("h1",{class:"mb-0"},"Marketplace",-1)),e("button",{class:"btn btn-primary cart-button",onClick:t[0]||(t[0]=(...P)=>a.viewCart&&a.viewCart(...P))},[t[1]||(t[1]=e("i",{class:"fas fa-shopping-cart me-2"},null,-1)),t[2]||(t[2]=h(" View Cart ")),e("span",He,g(a.cartItemCount),1)])]),K(o,{"poultry-types":a.poultryTypes,"initial-search-query":a.searchQuery,"initial-poultry-type":a.selectedPoultryType,"initial-sort-by":a.sortBy,"initial-min-price":a.minPrice,"initial-max-price":a.maxPrice,onSearchInput:a.handleSearch,onSearchClick:a.handleSearchClick,onFilterChange:a.handleFilters},null,8,["poultry-types","initial-search-query","initial-poultry-type","initial-sort-by","initial-min-price","initial-max-price","onSearchInput","onSearchClick","onFilterChange"]),a.loading?(d(),u("div",Ye,t[4]||(t[4]=[e("div",{class:"spinner-border text-primary",role:"status"},[e("span",{class:"visually-hidden"},"Loading...")],-1)]))):_("",!0),a.error?(d(),u("div",Ke,g(a.error),1)):_("",!0),K(r,{products:a.products,loading:a.loading,error:a.error,onViewDetails:a.viewProductDetails,onAddToCart:a.addToCart},null,8,["products","loading","error","onViewDetails","onAddToCart"]),!a.loading&&!a.error&&a.products.length>0?(d(),$(f,{key:2,"current-page":a.pagination.current_page,"last-page":a.pagination.last_page,from:a.pagination.from,to:a.pagination.to,total:a.pagination.total,"item-count":a.products.length,onPageChange:a.changePage},null,8,["current-page","last-page","from","to","total","item-count","onPageChange"])):_("",!0),K(b,{id:"cart-modal-component",ref:"cartModal"},null,512)])}const na=N(Je,[["render",We],["__scopeId","data-v-d35d073e"]]);export{na as default};
