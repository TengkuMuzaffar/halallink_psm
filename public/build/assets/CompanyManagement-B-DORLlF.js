import{_ as H,c as i,a as t,F as M,i as T,b as h,f as V,t as m,E as v,g as B,C as f,d as D,r as d,A,m as K,z as S,o as r,w as L,J as R}from"./main-6TRAM3lj.js";import{S as O}from"./StatsCard-CQZ5Yey2.js";import{R as W}from"./ResponsiveTable-Dmb47gmH.js";import{m as C}from"./modal-CNQBRbiU.js";import"./LoadingSpinner-Bs7tkB0U.js";const X={name:"CompanyManagement",components:{StatsCard:O,ResponsiveTable:W},setup(){const p=d(!0),n=d(null),g=d([]),a=d(""),k=d(""),P=d(""),y=d(1),w=d(10),e=d({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),b=A(()=>{const s=[],u=e.value.last_page;if(u<=5)for(let l=1;l<=u;l++)s.push(l);else{let l=Math.max(1,e.value.current_page-Math.floor(2.5)),x=Math.min(u,l+5-1);x===u&&(l=Math.max(1,x-5+1));for(let F=l;F<=x;F++)s.push(F)}return s}),_=d({broiler:0,slaughterhouse:0,sme:0,logistic:0}),I=A(()=>[{title:"Broiler Companies",count:_.value.broiler,icon:"fas fa-industry",bgColor:"bg-primary"},{title:"Slaughterhouse",count:_.value.slaughterhouse,icon:"fas fa-warehouse",bgColor:"bg-danger"},{title:"SME",count:_.value.sme,icon:"fas fa-store",bgColor:"bg-success"},{title:"Logistics",count:_.value.logistic,icon:"fas fa-truck",bgColor:"bg-warning"}]),N=[{key:"company_name",label:"Company Name",sortable:!0},{key:"company_type",label:"Type",sortable:!1},{key:"email",label:"Email",sortable:!1},{key:"Phone",label:"Phone",sortable:!1},{key:"status",label:"Status",sortable:!1,class:"text-center"}],c=async()=>{try{g.value=[],p.value=!0,n.value=null;const s={page:y.value,per_page:w.value,search:P.value||null,company_type:a.value||null,status:k.value||null},o=await S.get("/api/companies",{params:s});o.data&&o.success?(g.value=o.data,e.value=o.pagination,await E()):(g.value=[],console.error("Unexpected response format:",o))}catch(s){console.error("Error fetching companies:",s),n.value=s.message||"Failed to load companies. Please try again later.",g.value=[]}finally{p.value=!1}},j=()=>{y.value=1,c()},z=s=>{P.value=s,y.value=1,c()},U=s=>s?new Date(s).toLocaleDateString():"",J=s=>{const o="badge ";switch(s){case"broiler":return o+"bg-primary";case"slaughterhouse":return o+"bg-danger";case"SME":return o+"bg-success";case"logistic":return o+"bg-warning";default:return o+"bg-secondary"}},Q=s=>{const o="badge ";switch(s){case"active":return o+"bg-success";case"inactive":return o+"bg-danger";default:return o+"bg-secondary"}},q=s=>{},G=async s=>{C.confirm("Delete Company",`Are you sure you want to delete ${s.company_name}? This will also delete the associated admin user.`,async()=>{g.value=[],p.value=!0;try{await S.fetchData(`/api/companies/${s.companyID}`,{method:"delete",onSuccess:o=>{C.success("Success","Company deleted successfully"),c()},onError:o=>{console.error("Error deleting company:",o),C.danger("Error","Failed to delete company. Please try again."),c()}})}catch{c()}},null,{confirmLabel:"Delete",confirmType:"danger"})},E=async()=>{try{const s=await S.get("/api/companies/all/stats",{onError:o=>{console.error("Error fetching company stats:",o),n.value="Failed to load company statistics. Please try again."}});typeof s=="object"&&(_.value=s)}catch{}};return K(()=>{c()}),{loading:p,error:n,companies:g,companyStats:I,columns:N,typeFilter:a,statusFilter:k,pagination:e,paginationRange:b,currentPage:y,formatDate:U,getTypeBadgeClass:J,getStatusBadgeClass:Q,editCompany:q,deleteCompany:G,toggleCompanyStatus:async s=>{if(!s.admin)return;const o=s.admin.status==="active"?"inactive":"active",u=o==="active"?"activate":"deactivate";C.confirm(`${o==="active"?"Activate":"Deactivate"} Company`,`Are you sure you want to ${u} ${s.company_name}?`,async()=>{g.value=[],p.value=!0;try{await S.fetchData(`/api/companies/${s.companyID}/status`,{method:"patch",data:{status:o},onSuccess:l=>{c(),C.success("Success",`Company ${u}d successfully`)},onError:l=>{console.error(`Error ${u}ing company:`,l),C.danger("Error",`Failed to ${u} company. Please try again.`),c()}})}catch{c()}},null,{confirmLabel:o==="active"?"Activate":"Deactivate",confirmType:o==="active"?"success":"warning"})},applyFilters:j,handleSearch:z,changePage:s=>{s<1||s>e.value.last_page||p.value||(y.value=s,c())},fetchCompanyStats:E}}},Y={class:"company-management"},Z={class:"row mb-4"},$={class:"card"},ee={class:"card-body"},ae={key:0,class:"alert alert-danger",role:"alert"},te={class:"d-flex gap-2"},se={key:0},ne={key:0},oe={class:"d-flex align-items-center"},le={key:0},ie={class:"d-flex align-items-center"},re={class:"d-flex justify-content-end"},ce=["onClick"],de=["onClick"],ue={key:1,class:"d-flex justify-content-between align-items-center mt-3"},me={class:"text-muted"},ge={"aria-label":"Table pagination"},pe={class:"pagination mb-0"},ye=["onClick"];function ve(p,n,g,a,k,P){const y=B("StatsCard"),w=B("ResponsiveTable");return r(),i("div",Y,[n[13]||(n[13]=t("h1",{class:"mb-4"},"Company Management",-1)),t("div",Z,[(r(!0),i(M,null,T(a.companyStats,(e,b)=>(r(),i("div",{key:b,class:"col-md-3 col-sm-6 mb-3"},[V(y,{title:e.title,count:e.count,icon:e.icon,"bg-color":e.bgColor},null,8,["title","count","icon","bg-color"])]))),128))]),t("div",$,[n[12]||(n[12]=t("div",{class:"card-header theme-header d-flex justify-content-between align-items-center"},[t("h5",{class:"mb-0"},"Companies")],-1)),t("div",ee,[a.error?(r(),i("div",ae,m(a.error),1)):h("",!0),V(w,{columns:a.columns,items:a.companies,loading:a.loading,"has-actions":!0,"item-key":"companyID",onSearch:a.handleSearch,"show-pagination":!1,"server-side":!0},{filters:v(()=>[t("div",te,[L(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":n[0]||(n[0]=e=>a.typeFilter=e),onChange:n[1]||(n[1]=(...e)=>a.applyFilters&&a.applyFilters(...e))},n[6]||(n[6]=[t("option",{value:""},"All Types",-1),t("option",{value:"broiler"},"Broiler",-1),t("option",{value:"slaughterhouse"},"Slaughterhouse",-1),t("option",{value:"sme"},"SME",-1),t("option",{value:"logistic"},"Logistic",-1)]),544),[[R,a.typeFilter]]),L(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":n[2]||(n[2]=e=>a.statusFilter=e),onChange:n[3]||(n[3]=(...e)=>a.applyFilters&&a.applyFilters(...e))},n[7]||(n[7]=[t("option",{value:""},"All Status",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1)]),544),[[R,a.statusFilter]])])]),company_type:v(({item:e})=>[t("span",{class:f(a.getTypeBadgeClass(e.company_type))},m(e.company_type),3)]),status:v(({item:e})=>[e.admin?(r(),i("div",se,[t("span",{class:f(a.getStatusBadgeClass(e.admin.status))},m(e.admin.status),3)])):h("",!0)]),email:v(({item:e})=>[e.admin?(r(),i("div",ne,[t("div",oe,[t("span",null,m(e.admin.email),1)])])):h("",!0)]),Phone:v(({item:e})=>[e.admin?(r(),i("div",le,[t("div",ie,[t("span",null,m(e.admin.tel_number),1)])])):h("",!0)]),actions:v(({item:e})=>[t("div",re,[e.admin?(r(),i("button",{key:0,class:f(["btn btn-sm me-1",e.admin.status==="active"?"btn-outline-warning":"btn-outline-success"]),onClick:b=>a.toggleCompanyStatus(e)},[t("i",{class:f(e.admin.status==="active"?"fas fa-ban":"fas fa-check")},null,2)],10,ce)):h("",!0),t("button",{class:"btn btn-sm btn-outline-danger",onClick:b=>a.deleteCompany(e)},n[8]||(n[8]=[t("i",{class:"fas fa-trash"},null,-1)]),8,de)])]),empty:v(()=>n[9]||(n[9]=[t("div",{class:"text-center py-4"},[t("i",{class:"fas fa-building text-muted mb-2",style:{"font-size":"2rem"}}),t("p",{class:"text-muted"},"No companies found")],-1)])),_:1},8,["columns","items","loading","onSearch"]),a.pagination.last_page>0?(r(),i("div",ue,[t("div",null,[t("span",me,"Showing "+m(a.pagination.from||0)+" to "+m(a.pagination.to||0)+" of "+m(a.pagination.total||0)+" entries",1)]),t("nav",ge,[t("ul",pe,[t("li",{class:f(["page-item",{disabled:a.currentPage===1||a.loading}])},[t("a",{class:"page-link",href:"#",onClick:n[4]||(n[4]=D(e=>!a.loading&&a.changePage(a.currentPage-1),["prevent"]))},n[10]||(n[10]=[t("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(r(!0),i(M,null,T(a.paginationRange,e=>(r(),i("li",{key:e,class:f(["page-item",{active:e===a.currentPage,disabled:a.loading}])},[t("a",{class:"page-link",href:"#",onClick:D(b=>!a.loading&&a.changePage(e),["prevent"])},m(e),9,ye)],2))),128)),t("li",{class:f(["page-item",{disabled:a.currentPage===a.pagination.last_page||a.loading}])},[t("a",{class:"page-link",href:"#",onClick:n[5]||(n[5]=D(e=>!a.loading&&a.changePage(a.currentPage+1),["prevent"]))},n[11]||(n[11]=[t("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):h("",!0)])])])}const Pe=H(X,[["render",ve],["__scopeId","data-v-536d226f"]]);export{Pe as default};
