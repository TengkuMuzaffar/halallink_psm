import{_ as z,c as d,G as se,C as k,o as n,a as t,f as N,g as I,e as w,b as _,B as oe,t as i,E as L,d as F,F as ie,i as ne,w as R,v as j,r,A as D,h as re,L as U,m as de,O as W,P as E}from"./main-6TRAM3lj.js";import{s as M}from"./modal-CNQBRbiU.js";import{S as ce}from"./StatsCard-CQZ5Yey2.js";import{R as me}from"./ResponsiveTable-Dmb47gmH.js";import{L as he}from"./LoadingSpinner-Bs7tkB0U.js";const ge={name:"Badge",props:{type:{type:String,default:"primary",validator:v=>["primary","secondary","success","danger","warning","info"].includes(v)},pill:{type:Boolean,default:!1}},computed:{badgeClass(){return{[`bg-${this.type}`]:!0,"rounded-pill":this.pill}}}};function ve(v,a,S,e,C,c){return n(),d("span",{class:k(["badge",c.badgeClass])},[se(v.$slots,"default")],2)}const ue=z(ge,[["render",ve]]),fe={name:"VehicleManagement",components:{StatsCard:ce,ResponsiveTable:me,LoadingSpinner:he,Badge:ue},setup(){const v=re(),a=r([]),S=r({total:0,average_weight:0}),e=r(!0),C=r(null);r([]);const c=r(null),p=r(!1),u=r(!1),f=r({}),P=D(()=>v.getters.user||{}),s=D(()=>v.getters.userCompany||{});let m=null,V=null;const x=r({current_page:1,from:1,last_page:1,per_page:10,to:0,total:0}),B=D(()=>x.value.current_page),q=D(()=>{const l=[],y=x.value.last_page||1,A=B.value,T=2,ae=A-T,le=A+T+1;for(let b=1;b<=y;b++)(b===1||b===y||b>=ae&&b<le)&&l.push(b);return l}),G=[{key:"vehicle_plate",label:"Plate Number",sortable:!0},{key:"vehicle_load_weight",label:"Load Capacity (kg)",sortable:!0}],h=U({companyID:"",vehicle_plate:"",vehicle_load_weight:0}),o=U({search:"",min_weight:"",max_weight:"",sort_field:"vehicleID",sort_direction:"desc",page:1,per_page:10}),g=async()=>{e.value=!0,C.value=null;try{const l=await E("/api/vehicles",{params:{...o,page:o.page}});a.value=l.vehicles.data,x.value={current_page:l.vehicles.current_page,from:l.vehicles.from,last_page:l.vehicles.last_page,per_page:l.vehicles.per_page,to:l.vehicles.to,total:l.vehicles.total},S.value=l.stats}catch(l){C.value="Failed to load vehicles. Please try again.",console.error("Error fetching vehicles:",l)}finally{e.value=!1}},O=()=>{var l;h.companyID=((l=s.value)==null?void 0:l.companyID)||"",h.vehicle_plate="",h.vehicle_load_weight=0,f.value={}},Y=()=>{p.value=!1,O(),m.show()},H=l=>{p.value=!0,c.value=l,h.companyID=l.companyID,h.vehicle_plate=l.vehicle_plate,h.vehicle_load_weight=l.vehicle_load_weight,f.value={},m.show()},J=l=>{c.value=l,V.show()},K=async()=>{u.value=!0,f.value={};try{let l;p.value?(l=await E(`/api/vehicles/${c.value.vehicleID}`,{method:"put",data:h}),M("Vehicle updated successfully","success")):(l=await E("/api/vehicles",{method:"post",data:h}),M("Vehicle added successfully","success")),m.hide(),g()}catch(l){l.response&&l.response.status===422?f.value=l.response.data.errors:M("An error occurred. Please try again.","danger"),console.error("Form submission error:",l)}finally{u.value=!1}},Q=async()=>{if(c.value){u.value=!0;try{await E(`/api/vehicles/${c.value.vehicleID}`,{method:"delete"}),V.hide(),M("Vehicle deleted successfully","success"),g()}catch(l){M("Failed to delete vehicle","danger"),console.error("Delete error:",l)}finally{u.value=!1}}},X=l=>{l<1||l>x.value.last_page||(o.page=l,g())},Z=({key:l,direction:y})=>{o.sort_field=l,o.sort_direction=y,g()},$=l=>{o.search=l,o.page=1,g()},ee=({min:l,max:y})=>{o.min_weight=l,o.max_weight=y,o.page=1,g()},te=l=>l==null?"0 kg":`${parseFloat(l).toLocaleString()} kg`;return de(()=>(m=new W(document.getElementById("vehicleModal")),V=new W(document.getElementById("deleteModal")),g(),()=>{m&&m.dispose(),V&&V.dispose()})),{vehicles:a,vehicleStats:S,loading:e,error:C,selectedVehicle:c,isEditing:p,formSubmitting:u,formErrors:f,vehicleForm:h,filters:o,pagination:x,currentPage:B,paginationRange:q,columns:G,currentUser:P,userCompany:s,handleMinMaxChange:ee,fetchVehicles:g,openAddModal:Y,editVehicle:H,confirmDelete:J,submitVehicleForm:K,deleteVehicle:Q,changePage:X,handleSort:Z,handleSearch:$,formatWeight:te}}},be={class:"vehicle-management"},_e={class:"row mb-4"},pe={class:"col-md-4 col-sm-6 mb-3"},ye={class:"card"},we={class:"card-header theme-header d-flex justify-content-between align-items-center"},ke={class:"card-body position-relative"},Ce={key:0,class:"alert alert-danger",role:"alert"},Ve=["onClick"],xe=["onClick"],Me={key:2,class:"d-flex justify-content-between align-items-center mt-4"},Se={class:"text-muted"},Pe={"aria-label":"Vehicle pagination"},Fe={class:"pagination mb-0"},De=["onClick"],Ee={class:"modal fade",id:"vehicleModal",tabindex:"-1","aria-hidden":"true"},Ie={class:"modal-dialog"},Le={class:"modal-content"},Be={class:"modal-header theme-header"},Ae={class:"modal-title"},Te={class:"modal-body"},Ne={class:"mb-3"},Re=["value"],je={class:"mb-3"},Ue={key:0,class:"invalid-feedback"},We={class:"mb-3"},ze={key:0,class:"invalid-feedback"},qe={class:"d-flex justify-content-end"},Ge=["disabled"],Oe={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Ye={class:"modal fade",id:"deleteModal",tabindex:"-1","aria-hidden":"true"},He={class:"modal-dialog modal-dialog-centered"},Je={class:"modal-content"},Ke={class:"modal-body"},Qe={class:"modal-footer"},Xe=["disabled"],Ze={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"};function $e(v,a,S,e,C,c){var P;const p=I("StatsCard"),u=I("LoadingSpinner"),f=I("ResponsiveTable");return n(),d("div",be,[a[26]||(a[26]=t("h1",{class:"mb-4"},"Vehicle Management",-1)),t("div",_e,[t("div",pe,[N(p,{title:"Total Vehicles",count:e.vehicleStats.total,icon:"fas fa-truck","bg-color":"bg-primary"},null,8,["count"])])]),t("div",ye,[t("div",we,[a[8]||(a[8]=t("h5",{class:"mb-0"},"Vehicles",-1)),t("button",{class:"btn btn-primary",onClick:a[0]||(a[0]=(...s)=>e.openAddModal&&e.openAddModal(...s))},a[7]||(a[7]=[t("i",{class:"fas fa-plus me-1"},null,-1),w(" Add Vehicle ")]))]),t("div",ke,[e.error?(n(),d("div",Ce,i(e.error),1)):_("",!0),e.loading?(n(),oe(u,{key:1,overlay:"",size:"md",message:"Loading vehicles..."})):_("",!0),N(f,{columns:e.columns,items:e.vehicles,loading:!1,"has-actions":!0,"item-key":"vehicleID",onSearch:e.handleSearch,onMinMaxChange:e.handleMinMaxChange,"show-pagination":!1,"server-side":!0,showFilters:!0,showMinMaxFilters:!0,minLabel:"Min Weight (kg)",maxLabel:"Max Weight (kg)",minPlaceholder:"Min",maxPlaceholder:"Max",searchPlaceholder:"Search by plate number...",minMaxField:"vehicle_load_weight"},{vehicle_load_weight:L(({item:s})=>[w(i(e.formatWeight(s.vehicle_load_weight)),1)]),actions:L(({item:s})=>[t("button",{class:"btn btn-sm btn-outline-primary me-1",onClick:m=>e.editVehicle(s)},a[9]||(a[9]=[t("i",{class:"fas fa-edit"},null,-1)]),8,Ve),t("button",{class:"btn btn-sm btn-outline-danger",onClick:m=>e.confirmDelete(s)},a[10]||(a[10]=[t("i",{class:"fas fa-trash"},null,-1)]),8,xe)]),empty:L(()=>a[11]||(a[11]=[t("div",{class:"text-center py-4"},[t("i",{class:"fas fa-truck text-muted mb-3",style:{"font-size":"2rem"}}),t("p",{class:"text-muted"},"No vehicles found. Try adjusting your filters or add a new vehicle.")],-1)])),_:1},8,["columns","items","onSearch","onMinMaxChange"]),!e.loading&&e.vehicles.length>0?(n(),d("div",Me,[t("div",null,[t("span",Se,"Showing "+i(e.pagination.from||1)+"-"+i(e.pagination.to||e.vehicles.length)+" of "+i(e.pagination.total||e.vehicles.length),1)]),t("nav",Pe,[t("ul",Fe,[t("li",{class:k(["page-item",{disabled:e.currentPage<=1||e.loading}])},[t("a",{class:"page-link",href:"#",onClick:a[1]||(a[1]=F(s=>!e.loading&&e.changePage(e.currentPage-1),["prevent"]))},a[12]||(a[12]=[t("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(n(!0),d(ie,null,ne(e.paginationRange,s=>(n(),d("li",{key:s,class:k(["page-item",{active:s===e.currentPage,disabled:e.loading}])},[t("a",{class:"page-link",href:"#",onClick:F(m=>!e.loading&&e.changePage(s),["prevent"])},i(s),9,De)],2))),128)),t("li",{class:k(["page-item",{disabled:e.currentPage>=e.pagination.last_page||e.loading}])},[t("a",{class:"page-link",href:"#",onClick:a[2]||(a[2]=F(s=>!e.loading&&e.changePage(e.currentPage+1),["prevent"]))},a[13]||(a[13]=[t("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):_("",!0)])]),t("div",Ee,[t("div",Ie,[t("div",Le,[t("div",Be,[t("h5",Ae,i(e.isEditing?"Edit Vehicle":"Add New Vehicle"),1),a[14]||(a[14]=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1))]),t("div",Te,[t("form",{onSubmit:a[5]||(a[5]=F((...s)=>e.submitVehicleForm&&e.submitVehicleForm(...s),["prevent"]))},[t("div",Ne,[a[15]||(a[15]=t("label",{class:"form-label"},"Company",-1)),t("input",{type:"text",class:"form-control",value:e.userCompany.company_name||"Your Company",disabled:""},null,8,Re),a[16]||(a[16]=t("small",{class:"text-muted"},"Vehicles are automatically assigned to your company",-1))]),t("div",je,[a[17]||(a[17]=t("label",{for:"vehicle_plate",class:"form-label"},"Vehicle Plate Number",-1)),R(t("input",{type:"text",class:k(["form-control",{"is-invalid":e.formErrors.vehicle_plate}]),id:"vehicle_plate","onUpdate:modelValue":a[3]||(a[3]=s=>e.vehicleForm.vehicle_plate=s),required:""},null,2),[[j,e.vehicleForm.vehicle_plate]]),e.formErrors.vehicle_plate?(n(),d("div",Ue,i(e.formErrors.vehicle_plate[0]),1)):_("",!0)]),t("div",We,[a[18]||(a[18]=t("label",{for:"vehicle_load_weight",class:"form-label"},"Load Capacity (kg)",-1)),R(t("input",{type:"number",class:k(["form-control",{"is-invalid":e.formErrors.vehicle_load_weight}]),id:"vehicle_load_weight","onUpdate:modelValue":a[4]||(a[4]=s=>e.vehicleForm.vehicle_load_weight=s),min:"0",step:"0.01",required:""},null,2),[[j,e.vehicleForm.vehicle_load_weight,void 0,{number:!0}]]),e.formErrors.vehicle_load_weight?(n(),d("div",ze,i(e.formErrors.vehicle_load_weight[0]),1)):_("",!0)]),t("div",qe,[a[19]||(a[19]=t("button",{type:"button",class:"btn btn-secondary me-2","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"submit",class:"btn btn-primary",disabled:e.formSubmitting},[e.formSubmitting?(n(),d("span",Oe)):_("",!0),w(" "+i(e.isEditing?"Update Vehicle":"Add Vehicle"),1)],8,Ge)])],32)])])])]),t("div",Ye,[t("div",He,[t("div",Je,[a[25]||(a[25]=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{class:"modal-title"},"Confirm Delete"),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),t("div",Ke,[t("p",null,[a[20]||(a[20]=w("Are you sure you want to delete the vehicle with plate number ")),t("strong",null,i((P=e.selectedVehicle)==null?void 0:P.vehicle_plate),1),a[21]||(a[21]=w("?"))]),a[22]||(a[22]=t("p",{class:"mb-0 text-danger"},[t("small",null,"This action cannot be undone.")],-1))]),t("div",Qe,[a[24]||(a[24]=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"Cancel",-1)),t("button",{type:"button",class:"btn btn-danger",onClick:a[6]||(a[6]=(...s)=>e.deleteVehicle&&e.deleteVehicle(...s)),disabled:e.formSubmitting},[e.formSubmitting?(n(),d("span",Ze)):_("",!0),a[23]||(a[23]=w(" Delete "))],8,Xe)])])])])])}const ot=z(fe,[["render",$e],["__scopeId","data-v-e3cf3f18"]]);export{ot as default};
