import{z as $,_ as z,r as d,G as J,c as n,o as l,b as x,d as C,a as e,t as v,s as O,n as P,F as S,j as U,w as q,Q as T,v as Q,e as R,x as G,y as H,D as K,f as j,k as W}from"./main-BpaYbEPg.js";import{R as X}from"./ResponsiveTable-B0dEHhy-.js";import{L as A}from"./LoadingSpinner-9sKMkQ1j.js";const L={getDeliveryInfo:async f=>{try{return await $.get(`/api/deliveries/${f}`)}catch(o){return console.error("Error fetching delivery info:",o),{status:"error",message:o.message||"Failed to fetch delivery information"}}},getVerifications:async(f,o,a)=>{try{return await $.get(`/api/verifications?deliveryID=${f}&locationID=${o}&token=${a}`)}catch(p){return console.error("Error fetching verifications:",p),{status:"error",message:p.message||"Failed to fetch verification data"}}},getCheckpointDetails:async f=>{try{return await $.get(`/api/checkpoints/${f}`)}catch(o){return console.error("Error fetching checkpoint details:",o),{status:"error",message:o.message||"Failed to fetch checkpoint details"}}},getVerificationById:async(f,o,a,p)=>{try{return await $.get(`/api/verifications/${f}`,{params:{deliveryID:o,locationID:a,token:p}})}catch(s){return console.error("Error fetching verification by ID:",s),{status:"error",message:s.message||"Failed to fetch verification details"}}},updateVerification:async(f,o)=>{try{return await $.put(`/api/verifications/${f}`,o)}catch(a){return console.error("Error updating verification:",a),{status:"error",message:a.message||"Failed to update verification"}}},completeVerifications:async(f,o)=>{try{return await $.post(`/api/verifications/complete/${o}/${f}`)}catch(a){return console.error("Error completing verifications:",a),{status:"error",message:a.message||"Failed to complete verifications"}}}},Y={class:"modal-dialog modal-dialog-centered modal-lg",role:"document"},Z={class:"modal-content"},ee={class:"modal-header theme-header"},te={class:"modal-title"},se={class:"modal-body"},ae={key:1,class:"alert alert-danger mt-3"},ie={key:2,class:"verification-form"},le={class:"d-flex justify-content-between align-items-center mb-3"},oe={class:"d-flex align-items-center"},re={class:"mb-0 me-2"},ne={class:"badge bg-secondary me-2"},ce={class:"form-section mb-4"},ue={class:"items-section"},de={key:0},ve={class:"table-responsive"},fe={class:"table table-sm table-hover mb-0"},me={class:"order-header"},pe={colspan:"4",class:"order-header-cell"},ge={class:"d-flex align-items-center"},he={class:"order-badge me-2"},ye={class:"order-item-count"},_e={class:"text-center"},be={class:"text-center"},ke={class:"quantity-badge"},De={class:"text-center"},Ve={key:1,class:"text-center text-muted py-3"},we={class:"form-section"},Ie={class:"mb-4"},xe={class:"status-options"},$e={class:"form-check form-check-inline"},Se={class:"form-check form-check-inline"},Ce={class:"mb-3"},Pe={key:3,class:"alert alert-danger mt-3"},Me={key:4,class:"alert alert-success mt-3"},Ee={class:"modal-footer theme-footer"},Fe=["disabled"],Ne={key:0,class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"},Be={key:1,class:"modal-backdrop fade show"},qe={__name:"VerifiesModalDetail",props:{show:{type:Boolean,required:!0},verifyId:{type:[Number,String],default:null},deliveryId:{type:[Number,String],default:null},locationId:{type:[Number,String],default:null},token:{type:String,default:null}},emits:["close","updated"],setup(f,{emit:o}){const a=f,p=o,s=d(null),b=d(!1),y=d(null),_=d(!1),I=d(!1),w=d(null);d(!1),J(()=>[a.show,a.verifyId],async([u,t])=>{u&&t?await k(t):(s.value=null,y.value=null,_.value=!1,w.value=null)},{immediate:!0});const k=async u=>{I.value=!0,w.value=null;try{const t=await L.getVerificationById(u,a.deliveryId,a.locationId,a.token);console.log("Response from fetchVerificationDetails:",JSON.stringify(t,null,2)),t.status==="success"?s.value={...t.data,associated_items:t.data.associated_items||[]}:w.value=t.message||"Failed to load verification details."}catch(t){console.error("Error fetching verification details:",t),w.value=t.message||"An unexpected error occurred while fetching details."}finally{I.value=!1}},D=()=>{p("close")},c=async()=>{var u,t;if(!(!s.value||!s.value.verifyID)){b.value=!0,y.value=null,_.value=!1;try{const g={verify_status:s.value.verify_status,verify_comment:s.value.verify_comment},m=await L.updateVerification(s.value.verifyID,g);m.status==="success"?(_.value=!0,p("updated",m.data),setTimeout(()=>{D()},1500)):(y.value=m.message||"Failed to update verification.",m.errors&&(y.value+=" Details: "+JSON.stringify(m.errors)))}catch(g){console.error("Error updating verification:",g),y.value=((t=(u=g.response)==null?void 0:u.data)==null?void 0:t.message)||g.message||"An unexpected error occurred."}finally{b.value=!1}}},M=u=>u==="complete"?"theme-badge-success":u==="pending"?"theme-badge-warning":u==="reject"?"theme-badge-danger":"theme-badge-secondary",E=()=>!s.value||!s.value.associated_items?{}:s.value.associated_items.reduce((u,t)=>{const g=t.orderID||"Unknown";return u[g]||(u[g]=[]),u[g].push(t),u},{});return(u,t)=>{var g;return l(),n(S,null,[f.show?(l(),n("div",{key:0,class:"modal fade show d-block",tabindex:"-1",role:"dialog",onClick:C(D,["self"])},[e("div",Y,[e("div",Z,[e("form",{onSubmit:C(c,["prevent"])},[e("div",ee,[e("h5",te,"Verification Form #"+v((g=s.value)==null?void 0:g.verifyID),1),e("button",{type:"button",class:"btn-close theme-close",onClick:D,"aria-label":"Close"})]),e("div",se,[I.value?(l(),O(A,{key:0,size:"md",message:"Loading verification details..."})):w.value?(l(),n("div",ae,v(w.value),1)):s.value?(l(),n("div",ie,[e("div",le,[e("div",oe,[e("h6",re,"Delivery ID: "+v(s.value.deliveryID),1),e("span",ne,"Checkpoint: "+v(s.value.checkID),1)]),e("span",{class:P(["badge",M(s.value.verify_status)])},v(s.value.verify_status||"Pending"),3)]),e("div",ce,[t[5]||(t[5]=e("h6",{class:"section-title"},"Items to Verify",-1)),e("div",ue,[s.value.associated_items&&s.value.associated_items.length>0?(l(),n("div",de,[e("div",ve,[e("table",fe,[t[3]||(t[3]=e("thead",{class:"table-header"},[e("tr",null,[e("th",{scope:"col",class:"text-center"},"#"),e("th",{scope:"col"},"Name"),e("th",{scope:"col",class:"text-center"},"Quantity"),e("th",{scope:"col",class:"text-center"},"Status")])],-1)),e("tbody",null,[(l(!0),n(S,null,U(E(),(m,F)=>(l(),n(S,null,[e("tr",me,[e("td",pe,[e("div",ge,[e("span",he,"Order #"+v(F),1),e("span",ye,v(m.length)+" item(s)",1)])])]),(l(!0),n(S,null,U(m,(i,r)=>(l(),n("tr",{key:i.itemID,class:"align-middle item-row"},[e("td",_e,v(r+1),1),e("td",null,v(i.item_name||"Unknown Item"),1),e("td",be,[e("span",ke,v(i.quantity||1),1)]),e("td",De,[e("span",{class:P(["badge",M(s.value.verify_status)])},v(s.value.verify_status||"Pending"),3)])]))),128))],64))),256))])])])])):(l(),n("div",Ve,t[4]||(t[4]=[e("p",{class:"mb-0"},"No items associated with this verification checkpoint.",-1)])))])]),e("div",we,[t[10]||(t[10]=e("h6",{class:"section-title"},"Update Verification Status",-1)),e("div",Ie,[t[8]||(t[8]=e("label",{for:"verify_status",class:"form-label"},"Status:",-1)),e("div",xe,[e("div",$e,[q(e("input",{class:"form-check-input",type:"radio",name:"verify_status",id:"status-pending",value:"pending","onUpdate:modelValue":t[0]||(t[0]=m=>s.value.verify_status=m)},null,512),[[T,s.value.verify_status]]),t[6]||(t[6]=e("label",{class:"form-check-label",for:"status-pending"},[e("span",{class:"status-badge theme-badge-warning"},"Pending")],-1))]),e("div",Se,[q(e("input",{class:"form-check-input",type:"radio",name:"verify_status",id:"status-complete",value:"complete","onUpdate:modelValue":t[1]||(t[1]=m=>s.value.verify_status=m)},null,512),[[T,s.value.verify_status]]),t[7]||(t[7]=e("label",{class:"form-check-label",for:"status-complete"},[e("span",{class:"status-badge theme-badge-success"},"Complete")],-1))])])]),e("div",Ce,[t[9]||(t[9]=e("label",{for:"verify_comment",class:"form-label"},"Verification Notes:",-1)),q(e("textarea",{class:"form-control",id:"verify_comment","onUpdate:modelValue":t[2]||(t[2]=m=>s.value.verify_comment=m),rows:"4",placeholder:"Enter any notes or comments about this verification..."},null,512),[[Q,s.value.verify_comment]])])])])):x("",!0),y.value?(l(),n("div",Pe,v(y.value),1)):x("",!0),_.value?(l(),n("div",Me,t[11]||(t[11]=[e("i",{class:"fas fa-check-circle me-2"},null,-1),R(" Verification updated successfully! ")]))):x("",!0)]),e("div",Ee,[e("button",{type:"button",class:"btn btn-outline-secondary",onClick:D},"Cancel"),e("button",{type:"submit",class:"btn theme-btn-primary",disabled:b.value||!s.value},[b.value?(l(),n("span",Ne)):x("",!0),R(" "+v(b.value?"Saving...":"Save Verification"),1)],8,Fe)])],32)])])])):x("",!0),f.show?(l(),n("div",Be)):x("",!0)],64)}}},Ue=z(qe,[["__scopeId","data-v-04be4aa5"]]),Le={class:"verify-delivery-management"},Te={class:"card theme-card"},Re={class:"card-body theme-body"},je={key:0,class:"alert alert-danger",role:"alert"},ze={key:2},Oe=["onClick"],Ae={key:0,class:"d-flex justify-content-between align-items-center mt-3"},Je={class:"text-muted"},Qe={"aria-label":"Table pagination"},Ge={class:"pagination mb-0 theme-pagination"},He=["onClick"],Ke={__name:"VerifyDeliveryPage",setup(f){const o=K(),a=d(!0),p=d(null),s=d(null),b=d(null),y=d(null),_=d([]),I=d(null),w=d(!1),k=d(1),D=d(10),c=d({current_page:1,last_page:1,per_page:10,total:0,from:0,to:0}),M=G(()=>{const i=[],h=c.value.last_page;if(h<=5)for(let V=1;V<=h;V++)i.push(V);else{let V=Math.max(1,c.value.current_page-Math.floor(2.5)),N=Math.min(h,V+5-1);N===h&&(V=Math.max(1,N-5+1));for(let B=V;B<=N;B++)i.push(B)}return i}),E=d([{key:"verifyID",label:"Verification ID",sortable:!0},{key:"verify_status",label:"Status",sortable:!0}]),u=async()=>{if(!s.value||!b.value||!y.value){p.value="Delivery ID, Location ID, and Token are required parameters.",a.value=!1;return}a.value=!0,p.value=null;try{const i=await L.getVerifications(s.value,b.value,y.value);if(i.status==="error")throw new Error(i.message);const r=i.data||i;if(_.value=r,!r.some(V=>V.verify_status==="pending")){window.location.href=`/deliveries?selectionID=${s.value}`;return}c.value.total=_.value.length,c.value.last_page=Math.ceil(_.value.length/D.value),c.value.current_page=k.value,c.value.from=_.value.length>0?(k.value-1)*D.value+1:0,c.value.to=Math.min(k.value*D.value,_.value.length)}catch(i){console.error("Error fetching verifications:",i),p.value=i.message||"Failed to fetch verification data. Please try again.",_.value=[],c.value={current_page:1,last_page:1,per_page:D.value,total:0,from:0,to:0}}finally{a.value=!1}},t=i=>{i<1||i>c.value.last_page||a.value||(k.value=i,c.value.current_page=i,c.value.from=(i-1)*D.value+1,c.value.to=Math.min(i*D.value,_.value.length))},g=i=>{I.value=i,w.value=!0},m=()=>{w.value=!1,I.value=null},F=()=>{u()};return H(()=>{s.value=o.query.deliveryID,b.value=o.query.locationID,y.value=o.query.token,!s.value||!b.value||!y.value?(p.value="Missing required parameters: Delivery ID, Location ID, and Token.",a.value=!1):u()}),(i,r)=>(l(),n("div",Le,[r[6]||(r[6]=e("h1",{class:"mb-4"},"Verify Delivery",-1)),e("div",Te,[r[5]||(r[5]=e("div",{class:"card-header d-flex justify-content-between align-items-center theme-header"},[e("h5",{class:"mb-0"},"Verifications")],-1)),e("div",Re,[p.value?(l(),n("div",je,v(p.value),1)):x("",!0),a.value?(l(),O(A,{key:1,size:"md",message:"Loading verifications..."})):(l(),n("div",ze,[j(X,{columns:E.value,items:_.value,loading:!1,"has-actions":!0,"item-key":"verifyID","show-pagination":!1},{actions:W(({item:h})=>[e("button",{class:"btn btn-sm theme-btn-info",onClick:V=>g(h)},r[2]||(r[2]=[e("i",{class:"fas fa-edit"},null,-1)]),8,Oe)]),_:1},8,["columns","items"]),c.value.last_page>0?(l(),n("div",Ae,[e("div",null,[e("span",Je,"Showing "+v(c.value.from||0)+" to "+v(c.value.to||0)+" of "+v(c.value.total||0)+" entries",1)]),e("nav",Qe,[e("ul",Ge,[e("li",{class:P(["page-item",{disabled:k.value===1||a.value}])},[e("a",{class:"page-link",href:"#",onClick:r[0]||(r[0]=C(h=>!a.value&&t(k.value-1),["prevent"]))},r[3]||(r[3]=[e("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(l(!0),n(S,null,U(M.value,h=>(l(),n("li",{key:h,class:P(["page-item",{active:h===k.value,disabled:a.value}])},[e("a",{class:"page-link",href:"#",onClick:C(V=>!a.value&&t(h),["prevent"])},v(h),9,He)],2))),128)),e("li",{class:P(["page-item",{disabled:k.value===c.value.last_page||a.value}])},[e("a",{class:"page-link",href:"#",onClick:r[1]||(r[1]=C(h=>!a.value&&t(k.value+1),["prevent"]))},r[4]||(r[4]=[e("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):x("",!0)]))])]),j(Ue,{show:w.value,"verify-id":I.value?I.value.verifyID:null,"delivery-id":s.value,"location-id":b.value,token:y.value,onClose:m,onUpdated:F},null,8,["show","verify-id","delivery-id","location-id","token"])]))}},Ze=z(Ke,[["__scopeId","data-v-c28d6e4b"]]);export{Ze as default};
