import{_ as K,c as i,a as t,F as E,i as T,e as A,b as h,f as V,t as d,p,g as B,n as f,d as M,r as u,j as L,k as W,l as k,o as r,w as N,y as R}from"./main-6HkEK7r2.js";import{S as X}from"./StatsCard-Daj1M7Ql.js";import{R as Y}from"./ResponsiveTable-DO6c7ISj.js";import{m as C}from"./modal-BXblql9Y.js";import"./LoadingSpinner-TtFArfCL.js";const Z={name:"CompanyManagement",components:{StatsCard:X,ResponsiveTable:Y},setup(){const y=u(!0),s=u(null),g=u([]),a=u(""),S=u(""),P=u(""),v=u(1),w=u(3),e=u({current_page:1,last_page:1,per_page:3,total:0,from:0,to:0}),b=L(()=>{const n=[],m=e.value.last_page;if(m<=5)for(let l=1;l<=m;l++)n.push(l);else{let l=Math.max(1,e.value.current_page-Math.floor(2.5)),x=Math.min(m,l+5-1);x===m&&(l=Math.max(1,x-5+1));for(let F=l;F<=x;F++)n.push(F)}return n}),_=u({broiler:0,slaughterhouse:0,sme:0,logistic:0}),j=L(()=>[{title:"Broiler Companies",count:_.value.broiler,icon:"fas fa-industry",bgColor:"bg-primary"},{title:"Slaughterhouse",count:_.value.slaughterhouse,icon:"fas fa-warehouse",bgColor:"bg-danger"},{title:"SME",count:_.value.sme,icon:"fas fa-store",bgColor:"bg-success"},{title:"Logistics",count:_.value.logistic,icon:"fas fa-truck",bgColor:"bg-warning"}]),I=[{key:"company_name",label:"Company Name",sortable:!0},{key:"company_type",label:"Type",sortable:!0},{key:"email",label:"Email",sortable:!0},{key:"Phone",label:"Phone",sortable:!0},{key:"status",label:"Status",sortable:!0,class:"text-center"},{key:"created_at",label:"Created",sortable:!0}],c=async()=>{try{g.value=[],y.value=!0,s.value=null;const n={page:v.value,per_page:w.value,search:P.value||null,company_type:a.value||null,status:S.value||null},o=await k.get("/api/companies",{params:n});o.data&&o.success?(g.value=o.data,e.value=o.pagination,await D()):(g.value=[],console.error("Unexpected response format:",o))}catch(n){console.error("Error fetching companies:",n),s.value=n.message||"Failed to load companies. Please try again later.",g.value=[]}finally{y.value=!1}},U=()=>{v.value=1,c()},z=n=>{P.value=n,v.value=1,c()},O=n=>n?new Date(n).toLocaleDateString():"",Q=n=>{const o="badge ";switch(n){case"broiler":return o+"bg-primary";case"slaughterhouse":return o+"bg-danger";case"SME":return o+"bg-success";case"logistic":return o+"bg-warning";default:return o+"bg-secondary"}},q=n=>{const o="badge ";switch(n){case"active":return o+"bg-success";case"inactive":return o+"bg-danger";default:return o+"bg-secondary"}},G=()=>{console.log("Opening add company modal")},H=n=>{console.log("Editing company:",n)},J=async n=>{C.confirm("Delete Company",`Are you sure you want to delete ${n.company_name}? This will also delete the associated admin user.`,async()=>{g.value=[],y.value=!0;try{await k.fetchData(`/api/companies/${n.companyID}`,{method:"delete",onSuccess:o=>{C.success("Success","Company deleted successfully"),c()},onError:o=>{console.error("Error deleting company:",o),C.danger("Error","Failed to delete company. Please try again."),c()}})}catch{c()}},null,{confirmLabel:"Delete",confirmType:"danger"})},D=async()=>{try{const n=await k.get("/api/companies/all/stats",{onError:o=>{console.error("Error fetching company stats:",o),s.value="Failed to load company statistics. Please try again."}});typeof n=="object"&&(_.value=n)}catch{}};return W(()=>{c()}),{loading:y,error:s,companies:g,companyStats:j,columns:I,typeFilter:a,statusFilter:S,pagination:e,paginationRange:b,currentPage:v,formatDate:O,getTypeBadgeClass:Q,getStatusBadgeClass:q,openAddModal:G,editCompany:H,deleteCompany:J,toggleCompanyStatus:async n=>{if(!n.admin)return;const o=n.admin.status==="active"?"inactive":"active",m=o==="active"?"activate":"deactivate";C.confirm(`${o==="active"?"Activate":"Deactivate"} Company`,`Are you sure you want to ${m} ${n.company_name}?`,async()=>{g.value=[],y.value=!0;try{await k.fetchData(`/api/companies/${n.companyID}/status`,{method:"patch",data:{status:o},onSuccess:l=>{c(),C.success("Success",`Company ${m}d successfully`)},onError:l=>{console.error(`Error ${m}ing company:`,l),C.danger("Error",`Failed to ${m} company. Please try again.`),c()}})}catch{c()}},null,{confirmLabel:o==="active"?"Activate":"Deactivate",confirmType:o==="active"?"success":"warning"})},applyFilters:U,handleSearch:z,changePage:n=>{n<1||n>e.value.last_page||y.value||(v.value=n,c())},fetchCompanyStats:D}}},$={class:"company-management"},ee={class:"row mb-4"},ae={class:"card"},te={class:"card-header d-flex justify-content-between align-items-center"},se={class:"card-body"},ne={key:0,class:"alert alert-danger",role:"alert"},oe={class:"d-flex gap-2"},le={key:0},ie={key:0},re={class:"d-flex align-items-center"},ce={key:0},de={class:"d-flex align-items-center"},ue={class:"d-flex justify-content-end"},me=["onClick"],ge=["onClick"],pe={key:1,class:"d-flex justify-content-between align-items-center mt-3"},ye={class:"text-muted"},ve={"aria-label":"Table pagination"},fe={class:"pagination mb-0"},be=["onClick"];function he(y,s,g,a,S,P){const v=B("StatsCard"),w=B("ResponsiveTable");return r(),i("div",$,[s[15]||(s[15]=t("h1",{class:"mb-4"},"Company Management",-1)),t("div",ee,[(r(!0),i(E,null,T(a.companyStats,(e,b)=>(r(),i("div",{key:b,class:"col-md-3 col-sm-6 mb-3"},[V(v,{title:e.title,count:e.count,icon:e.icon,"bg-color":e.bgColor},null,8,["title","count","icon","bg-color"])]))),128))]),t("div",ae,[t("div",te,[s[8]||(s[8]=t("h5",{class:"mb-0"},"Companies",-1)),t("button",{class:"btn btn-primary",onClick:s[0]||(s[0]=(...e)=>a.openAddModal&&a.openAddModal(...e))},s[7]||(s[7]=[t("i",{class:"fas fa-plus me-1"},null,-1),A(" Add Company ")]))]),t("div",se,[a.error?(r(),i("div",ne,d(a.error),1)):h("",!0),V(w,{columns:a.columns,items:a.companies,loading:a.loading,"has-actions":!0,"item-key":"companyID",onSearch:a.handleSearch,"show-pagination":!1,"server-side":!0},{filters:p(()=>[t("div",oe,[N(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":s[1]||(s[1]=e=>a.typeFilter=e),onChange:s[2]||(s[2]=(...e)=>a.applyFilters&&a.applyFilters(...e))},s[9]||(s[9]=[t("option",{value:""},"All Types",-1),t("option",{value:"broiler"},"Broiler",-1),t("option",{value:"slaughterhouse"},"Slaughterhouse",-1),t("option",{value:"SME"},"SME",-1),t("option",{value:"logistic"},"Logistic",-1)]),544),[[R,a.typeFilter]]),N(t("select",{class:"form-select form-select-sm","onUpdate:modelValue":s[3]||(s[3]=e=>a.statusFilter=e),onChange:s[4]||(s[4]=(...e)=>a.applyFilters&&a.applyFilters(...e))},s[10]||(s[10]=[t("option",{value:""},"All Status",-1),t("option",{value:"active"},"Active",-1),t("option",{value:"inactive"},"Inactive",-1)]),544),[[R,a.statusFilter]])])]),company_type:p(({item:e})=>[t("span",{class:f(a.getTypeBadgeClass(e.company_type))},d(e.company_type),3)]),status:p(({item:e})=>[e.admin?(r(),i("div",le,[t("span",{class:f(a.getStatusBadgeClass(e.admin.status))},d(e.admin.status),3)])):h("",!0)]),email:p(({item:e})=>[e.admin?(r(),i("div",ie,[t("div",re,[t("span",null,d(e.admin.email),1)])])):h("",!0)]),Phone:p(({item:e})=>[e.admin?(r(),i("div",ce,[t("div",de,[t("span",null,d(e.admin.tel_number),1)])])):h("",!0)]),created_at:p(({item:e})=>[A(d(a.formatDate(e.created_at)),1)]),actions:p(({item:e})=>[t("div",ue,[e.admin?(r(),i("button",{key:0,class:f(["btn btn-sm me-1",e.admin.status==="active"?"btn-outline-warning":"btn-outline-success"]),onClick:b=>a.toggleCompanyStatus(e)},[t("i",{class:f(e.admin.status==="active"?"fas fa-ban":"fas fa-check")},null,2)],10,me)):h("",!0),t("button",{class:"btn btn-sm btn-outline-danger",onClick:b=>a.deleteCompany(e)},s[11]||(s[11]=[t("i",{class:"fas fa-trash"},null,-1)]),8,ge)])]),empty:p(()=>s[12]||(s[12]=[t("div",{class:"text-center py-4"},[t("i",{class:"fas fa-building text-muted mb-2",style:{"font-size":"2rem"}}),t("p",{class:"text-muted"},"No companies found")],-1)])),_:1},8,["columns","items","loading","onSearch"]),a.pagination.last_page>0?(r(),i("div",pe,[t("div",null,[t("span",ye,"Showing "+d(a.pagination.from||0)+" to "+d(a.pagination.to||0)+" of "+d(a.pagination.total||0)+" entries",1)]),t("nav",ve,[t("ul",fe,[t("li",{class:f(["page-item",{disabled:a.currentPage===1||a.loading}])},[t("a",{class:"page-link",href:"#",onClick:s[5]||(s[5]=M(e=>!a.loading&&a.changePage(a.currentPage-1),["prevent"]))},s[13]||(s[13]=[t("i",{class:"fas fa-chevron-left"},null,-1)]))],2),(r(!0),i(E,null,T(a.paginationRange,e=>(r(),i("li",{key:e,class:f(["page-item",{active:e===a.currentPage,disabled:a.loading}])},[t("a",{class:"page-link",href:"#",onClick:M(b=>!a.loading&&a.changePage(e),["prevent"])},d(e),9,be)],2))),128)),t("li",{class:f(["page-item",{disabled:a.currentPage===a.pagination.last_page||a.loading}])},[t("a",{class:"page-link",href:"#",onClick:s[6]||(s[6]=M(e=>!a.loading&&a.changePage(a.currentPage+1),["prevent"]))},s[14]||(s[14]=[t("i",{class:"fas fa-chevron-right"},null,-1)]))],2)])])])):h("",!0)])])])}const Fe=K(Z,[["render",he],["__scopeId","data-v-f585a29c"]]);export{Fe as default};
